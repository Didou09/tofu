<!DOCTYPE html>
<!-- Generated by Cython 0.29.2 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: _GG03_LM.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.2</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="_GG03_LM.c">_GG03_LM.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0001</span>: # cython: boundscheck=False</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test_2, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0002</span>: # cython: wraparound=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">0003</span>: # cython: cdivision=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">0004</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">0005</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">0006</span>: cimport numpy as np</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0007</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0008</span>: from libc.math cimport sqrt as Csqrt, fabs as Cabs</pre>
<pre class="cython line score-0">&#xA0;<span class="">0009</span>: from libc.math cimport cos as Ccos, acos as Cacos, sin as Csin, asin as Casin</pre>
<pre class="cython line score-0">&#xA0;<span class="">0010</span>: from libc.math cimport atan2 as Catan2, pi as Cpi</pre>
<pre class="cython line score-0">&#xA0;<span class="">0011</span>: from libc.math cimport NAN as Cnan</pre>
<pre class="cython line score-0">&#xA0;<span class="">0012</span>: from cpython.array cimport array, clone</pre>
<pre class="cython line score-0">&#xA0;<span class="">0013</span>: from cython.parallel import prange</pre>
<pre class="cython line score-0">&#xA0;<span class="">0014</span>: from cython.parallel cimport parallel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0015</span>: from libc.stdlib cimport malloc, free, realloc</pre>
<pre class="cython line score-0">&#xA0;<span class="">0016</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0017</span>: cdef double _VSMALL = 1.e-9</pre>
<pre class='cython code score-0 '>  __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL = 1.e-9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0018</span>: cdef double _SMALL = 1.e-6</pre>
<pre class='cython code score-0 '>  __pyx_v_4tofu_4geom_8_GG03_LM__SMALL = 1.e-6;
</pre><pre class="cython line score-0">&#xA0;<span class="">0019</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0020</span>: # =============================================================================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0021</span>: # = Set of functions for Ray-tracing</pre>
<pre class="cython line score-0">&#xA0;<span class="">0022</span>: # =============================================================================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0023</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0024</span>: def LOS_Calc_PInOut_VesStruct(double[:, ::1] ray_orig,</pre>
<pre class='cython code score-30 '>/* Python wrapper */
static PyObject *__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct[] = "\n    Computes the entry and exit point of all provided LOS for the provided\n    vessel polygon (toroidal or linear) with its associated structures.\n    Return the normal vector at impact and the index of the impact segment\n\n    Params\n    ======\n    ray_orig : (3, num_los) double array\n       LOS origin points coordinates\n    ray_vdir : (3, num_los) double array\n       LOS normalized direction vector\n    ves_poly : (2, num_vertex) double array\n       Coordinates of the vertices of the Polygon defining the 2D poloidal\n       cut of the Vessel\n    ves_norm : (2, num_vertex-1) double array\n       Normal vectors going \"inwards\" of the edges of the Polygon defined\n       by ves_poly\n    nstruct : int\n       Total number of structures (counting each limited structure as one)\n    ves_nlim : int\n       Number of limits of the vessel\n           -1 : no limits, vessel continuous all around\n            1 : vessel is limited\n    ves_lims : array\n       If ves_nlim==1 contains the limits min and max of vessel\n    lstruct_poly : list\n       List of coordinates of the vertices of all structures on poloidal plane\n    lstruct_lims : list\n       List of limits of all structures\n    lstruct_nlim : array of ints\n       List of number of limits for all structures\n    lstruct_norm : list\n       List of coordinates of \"inwards\" normal vectors of the polygon of all\n       the structures\n    rmin : double\n       Minimal radius of vessel to take into consideration\n    eps&lt;val&gt; : double\n       Small value, acceptance of error\n    vtype : string\n       Type of vessel (\"Tor\" or \"Lin\")\n    forbid : bool\n       Should we forbid values behind vissible radius ? (see rmin)\n    test : bool\n       Should we run tests ?\n    num_threads : int\n       The num_threads argument indicates how many threads the team should\n       consist of. If not given, OpenMP will decide how many threads to use.\n       Typically this is the number of cores available on ""the machine.\n    Return\n    ======\n    coeff_inter_in : (num_los) array\n       scalars level of \"in\" intersection of the LOS (if k=0 at origin)\n    coeff_inter_out : (num_los) array\n       scalars level of \"out\" intersection of the LOS (if k=0 at origin)\n    vperp_out : (3, num_los) array\n       Coordinates of the normal vector of impact of the LOS (NaN if none)\n    ind_inter_out : (3, num_los)\n       Index of structure impacted by LOS: ind_inter_out[:,ind_los]=(i,j,k)\n       where k is the index of edge impacted on the j-th sub structure of the\n       structure number i. If the LOS impacted the vessel i=j=0\n    ";
static PyMethodDef __pyx_mdef_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct = {"LOS_Calc_PInOut_VesStruct", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct};
static PyObject *__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ray_orig = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ray_vdir = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ves_poly = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ves_norm = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ves_lims = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_lstruct_nlim = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_lstruct_poly = 0;
  PyObject *__pyx_v_lstruct_lims = 0;
  PyObject *__pyx_v_lstruct_norm = 0;
  int __pyx_v_nstruct;
  int __pyx_v_ves_nlim;
  double __pyx_v_rmin;
  double __pyx_v_eps_uz;
  double __pyx_v_eps_a;
  double __pyx_v_eps_vz;
  double __pyx_v_eps_b;
  double __pyx_v_eps_plane;
  PyObject *__pyx_v_ves_type = 0;
  int __pyx_v_forbid;
  int __pyx_v_test;
  int __pyx_v_num_threads;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("LOS_Calc_PInOut_VesStruct (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ray_orig,&amp;__pyx_n_s_ray_vdir,&amp;__pyx_n_s_ves_poly,&amp;__pyx_n_s_ves_norm,&amp;__pyx_n_s_ves_lims,&amp;__pyx_n_s_lstruct_nlim,&amp;__pyx_n_s_lstruct_poly,&amp;__pyx_n_s_lstruct_lims,&amp;__pyx_n_s_lstruct_norm,&amp;__pyx_n_s_nstruct,&amp;__pyx_n_s_ves_nlim,&amp;__pyx_n_s_rmin,&amp;__pyx_n_s_eps_uz,&amp;__pyx_n_s_eps_a,&amp;__pyx_n_s_eps_vz,&amp;__pyx_n_s_eps_b,&amp;__pyx_n_s_eps_plane,&amp;__pyx_n_s_ves_type,&amp;__pyx_n_s_forbid,&amp;__pyx_n_s_test,&amp;__pyx_n_s_num_threads,0};
    PyObject* values[21] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ray_orig, __Pyx_memviewslice __pyx_v_ray_vdir, __Pyx_memviewslice __pyx_v_ves_poly, __Pyx_memviewslice __pyx_v_ves_norm, __Pyx_memviewslice __pyx_v_ves_lims, __Pyx_memviewslice __pyx_v_lstruct_nlim, PyObject *__pyx_v_lstruct_poly, PyObject *__pyx_v_lstruct_lims, PyObject *__pyx_v_lstruct_norm, int __pyx_v_nstruct, int __pyx_v_ves_nlim, double __pyx_v_rmin, double __pyx_v_eps_uz, double __pyx_v_eps_a, double __pyx_v_eps_vz, double __pyx_v_eps_b, double __pyx_v_eps_plane, PyObject *__pyx_v_ves_type, int __pyx_v_forbid, int __pyx_v_test, int __pyx_v_num_threads) {
  int __pyx_v_npts_poly;
  int __pyx_v_num_los;
  int __pyx_v_nstruct_lim;
  int __pyx_v_ind_struct;
  int __pyx_v_totnvert;
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_kk;
  int __pyx_v_len_lim;
  int __pyx_v_nvert;
  double __pyx_v_Crit2_base;
  double __pyx_v_rmin2;
  double __pyx_v_lim_min;
  double __pyx_v_lim_max;
  PyObject *__pyx_v_error_message = 0;
  int __pyx_v_forbidbis;
  int __pyx_v_forbid0;
  int __pyx_v_bool1;
  int __pyx_v_bool2;
  double *__pyx_v_lbounds;
  double *__pyx_v_langles;
  arrayobject *__pyx_v_vperp_out = 0;
  arrayobject *__pyx_v_coeff_inter_in = 0;
  arrayobject *__pyx_v_coeff_inter_out = 0;
  arrayobject *__pyx_v_ind_inter_out = 0;
  int *__pyx_v_llimits;
  int *__pyx_v_lnvert;
  long *__pyx_v_lsz_lim;
  double *__pyx_v_lpolyx;
  double *__pyx_v_lpolyy;
  double *__pyx_v_lnormx;
  double *__pyx_v_lnormy;
  __Pyx_memviewslice __pyx_v_lspoly_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_lsvin_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_llim_ves[1];
  double __pyx_v_lbounds_ves[2];
  double __pyx_v_lim_ves[2];
  double __pyx_v_bounds[6];
  long __pyx_v_ind_vert;
  PyObject *__pyx_v_lslim = NULL;
  PyObject *__pyx_v_ee = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("LOS_Calc_PInOut_VesStruct", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_32, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_33, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_34, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_37, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("tofu.geom._GG03_LM.LOS_Calc_PInOut_VesStruct", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_error_message);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_vperp_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_coeff_inter_in);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_coeff_inter_out);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_ind_inter_out);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lspoly_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lsvin_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_lslim);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ee);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ray_orig, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ray_vdir, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ves_poly, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ves_norm, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ves_lims, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lstruct_nlim, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__37 = <span class='py_c_api'>PyTuple_Pack</span>(62, __pyx_n_s_ray_orig, __pyx_n_s_ray_vdir, __pyx_n_s_ves_poly, __pyx_n_s_ves_norm, __pyx_n_s_ves_lims, __pyx_n_s_lstruct_nlim, __pyx_n_s_lstruct_poly, __pyx_n_s_lstruct_lims, __pyx_n_s_lstruct_norm, __pyx_n_s_nstruct, __pyx_n_s_ves_nlim, __pyx_n_s_rmin, __pyx_n_s_eps_uz, __pyx_n_s_eps_a, __pyx_n_s_eps_vz, __pyx_n_s_eps_b, __pyx_n_s_eps_plane, __pyx_n_s_ves_type, __pyx_n_s_forbid, __pyx_n_s_test, __pyx_n_s_num_threads, __pyx_n_s_npts_poly, __pyx_n_s_num_los, __pyx_n_s_nstruct_lim, __pyx_n_s_ind_struct, __pyx_n_s_totnvert, __pyx_n_s_ii, __pyx_n_s_jj, __pyx_n_s_kk, __pyx_n_s_len_lim, __pyx_n_s_nvert, __pyx_n_s_Crit2_base, __pyx_n_s_rmin2, __pyx_n_s_lim_min, __pyx_n_s_lim_max, __pyx_n_s_error_message, __pyx_n_s_forbidbis, __pyx_n_s_forbid0, __pyx_n_s_bool1, __pyx_n_s_bool2, __pyx_n_s_lbounds, __pyx_n_s_langles, __pyx_n_s_vperp_out, __pyx_n_s_coeff_inter_in, __pyx_n_s_coeff_inter_out, __pyx_n_s_ind_inter_out, __pyx_n_s_llimits, __pyx_n_s_lnvert, __pyx_n_s_lsz_lim, __pyx_n_s_lpolyx, __pyx_n_s_lpolyy, __pyx_n_s_lnormx, __pyx_n_s_lnormy, __pyx_n_s_lspoly_view, __pyx_n_s_lsvin_view, __pyx_n_s_llim_ves, __pyx_n_s_lbounds_ves, __pyx_n_s_lim_ves, __pyx_n_s_bounds, __pyx_n_s_ind_vert, __pyx_n_s_lslim, __pyx_n_s_ee);<span class='error_goto'> if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__37);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__37);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct, NULL, __pyx_n_s_tofu_geom__GG03_LM);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_LOS_Calc_PInOut_VesStruct, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__38 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(21, 0, 62, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_tofu_geom__GG03_LM_pyx, __pyx_n_s_LOS_Calc_PInOut_VesStruct, 24, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0025</span>:                               double[:, ::1] ray_vdir,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0026</span>:                               double[:, ::1] ves_poly,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0027</span>:                               double[:, ::1] ves_norm,</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0028</span>:                               double[::1] ves_lims=None,</pre>
<pre class='cython code score-2 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  __pyx_k_ = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0029</span>:                               long[::1] lstruct_nlim=None,</pre>
<pre class='cython code score-2 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_3.memview)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
  __pyx_k__2 = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0030</span>:                               list lstruct_poly=None,</pre>
<pre class='cython code score-0 '>    values[6] = ((PyObject*)Py_None);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0031</span>:                               list lstruct_lims=None,</pre>
<pre class='cython code score-0 '>    values[7] = ((PyObject*)Py_None);
</pre><pre class="cython line score-219" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0032</span>:                               list lstruct_norm=None,</pre>
<pre class='cython code score-219 '>    values[8] = ((PyObject*)Py_None);
    values[17] = ((PyObject*)__pyx_n_s_Tor);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ray_orig)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ray_vdir)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 21, 1); <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ves_poly)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 21, 2); <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ves_norm)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 21, 3); <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ves_lims);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lstruct_nlim);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lstruct_poly);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lstruct_lims);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lstruct_norm);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nstruct);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ves_nlim);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_rmin);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_eps_uz);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_eps_a);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_eps_vz);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_eps_b);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_eps_plane);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ves_type);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_forbid);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_test);
          if (value) { values[19] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_num_threads);
          if (value) { values[20] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "LOS_Calc_PInOut_VesStruct") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ray_orig = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ray_orig.memview)) __PYX_ERR(0, 24, __pyx_L3_error)</span>
    __pyx_v_ray_vdir = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ray_vdir.memview)) __PYX_ERR(0, 25, __pyx_L3_error)</span>
    __pyx_v_ves_poly = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ves_poly.memview)) __PYX_ERR(0, 26, __pyx_L3_error)</span>
    __pyx_v_ves_norm = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ves_norm.memview)) __PYX_ERR(0, 27, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_ves_lims = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ves_lims.memview)) __PYX_ERR(0, 28, __pyx_L3_error)</span>
    } else {
      __pyx_v_ves_lims = __pyx_k_;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_ves_lims, 1);
    }
    if (values[5]) {
      __pyx_v_lstruct_nlim = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_long</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_lstruct_nlim.memview)) __PYX_ERR(0, 29, __pyx_L3_error)</span>
    } else {
      __pyx_v_lstruct_nlim = __pyx_k__2;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_lstruct_nlim, 1);
    }
    __pyx_v_lstruct_poly = ((PyObject*)values[6]);
    __pyx_v_lstruct_lims = ((PyObject*)values[7]);
    __pyx_v_lstruct_norm = ((PyObject*)values[8]);
    if (values[9]) {
      __pyx_v_nstruct = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[9]); if (unlikely((__pyx_v_nstruct == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
    } else {
      __pyx_v_nstruct = ((int)0);
    }
    if (values[10]) {
      __pyx_v_ves_nlim = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[10]); if (unlikely((__pyx_v_ves_nlim == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 34, __pyx_L3_error)</span>
    } else {
      __pyx_v_ves_nlim = ((int)-1);
    }
    if (values[11]) {
      __pyx_v_rmin = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_rmin == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 35, __pyx_L3_error)</span>
    } else {
      __pyx_v_rmin = ((double)-1.0);
    }
    if (values[12]) {
      __pyx_v_eps_uz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_eps_uz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 36, __pyx_L3_error)</span>
    } else {
      __pyx_v_eps_uz = __pyx_k__3;
    }
    if (values[13]) {
      __pyx_v_eps_a = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_eps_a == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 36, __pyx_L3_error)</span>
    } else {
      __pyx_v_eps_a = __pyx_k__4;
    }
    if (values[14]) {
      __pyx_v_eps_vz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_eps_vz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 37, __pyx_L3_error)</span>
    } else {
      __pyx_v_eps_vz = __pyx_k__5;
    }
    if (values[15]) {
      __pyx_v_eps_b = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_eps_b == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 37, __pyx_L3_error)</span>
    } else {
      __pyx_v_eps_b = __pyx_k__6;
    }
    if (values[16]) {
      __pyx_v_eps_plane = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]); if (unlikely((__pyx_v_eps_plane == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 38, __pyx_L3_error)</span>
    } else {
      __pyx_v_eps_plane = __pyx_k__7;
    }
    __pyx_v_ves_type = ((PyObject*)values[17]);
    if (values[18]) {
      __pyx_v_forbid = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[18]); if (unlikely((__pyx_v_forbid == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
    } else {
      __pyx_v_forbid = ((int)1);
    }
    if (values[19]) {
      __pyx_v_test = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[19]); if (unlikely((__pyx_v_test == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
    } else {
      __pyx_v_test = ((int)1);
    }
    if (values[20]) {
      __pyx_v_num_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[20]); if (unlikely((__pyx_v_num_threads == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 39, __pyx_L3_error)</span>
    } else {
      __pyx_v_num_threads = ((int)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 21, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("tofu.geom._GG03_LM.LOS_Calc_PInOut_VesStruct", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_lstruct_poly), (&amp;PyList_Type), 1, "lstruct_poly", 1))) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_lstruct_lims), (&amp;PyList_Type), 1, "lstruct_lims", 1))) <span class='error_goto'>__PYX_ERR(0, 31, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_lstruct_norm), (&amp;PyList_Type), 1, "lstruct_norm", 1))) <span class='error_goto'>__PYX_ERR(0, 32, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_ves_type), (&amp;PyString_Type), 1, "ves_type", 1))) <span class='error_goto'>__PYX_ERR(0, 38, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct(__pyx_self, __pyx_v_ray_orig, __pyx_v_ray_vdir, __pyx_v_ves_poly, __pyx_v_ves_norm, __pyx_v_ves_lims, __pyx_v_lstruct_nlim, __pyx_v_lstruct_poly, __pyx_v_lstruct_lims, __pyx_v_lstruct_norm, __pyx_v_nstruct, __pyx_v_ves_nlim, __pyx_v_rmin, __pyx_v_eps_uz, __pyx_v_eps_a, __pyx_v_eps_vz, __pyx_v_eps_b, __pyx_v_eps_plane, __pyx_v_ves_type, __pyx_v_forbid, __pyx_v_test, __pyx_v_num_threads);
</pre><pre class="cython line score-0">&#xA0;<span class="">0033</span>:                               int nstruct=0,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0034</span>:                               int ves_nlim=-1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0035</span>:                               double rmin=-1,</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0036</span>:                               double eps_uz=_SMALL, double eps_a=_VSMALL,</pre>
<pre class='cython code score-0 '>  __pyx_k__3 = __pyx_v_4tofu_4geom_8_GG03_LM__SMALL;
  __pyx_k__4 = __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0037</span>:                               double eps_vz=_VSMALL, double eps_b=_VSMALL,</pre>
<pre class='cython code score-0 '>  __pyx_k__5 = __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL;
  __pyx_k__6 = __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0038</span>:                               double eps_plane=_VSMALL, str ves_type='Tor',</pre>
<pre class='cython code score-0 '>  __pyx_k__7 = __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0039</span>:                               bint forbid=1, bint test=1, int num_threads=0):</pre>
<pre class="cython line score-0">&#xA0;<span class="">0040</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">0041</span>:     Computes the entry and exit point of all provided LOS for the provided</pre>
<pre class="cython line score-0">&#xA0;<span class="">0042</span>:     vessel polygon (toroidal or linear) with its associated structures.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0043</span>:     Return the normal vector at impact and the index of the impact segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">0044</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0045</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">0046</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">0047</span>:     ray_orig : (3, num_los) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0048</span>:        LOS origin points coordinates</pre>
<pre class="cython line score-0">&#xA0;<span class="">0049</span>:     ray_vdir : (3, num_los) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0050</span>:        LOS normalized direction vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">0051</span>:     ves_poly : (2, num_vertex) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0052</span>:        Coordinates of the vertices of the Polygon defining the 2D poloidal</pre>
<pre class="cython line score-0">&#xA0;<span class="">0053</span>:        cut of the Vessel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0054</span>:     ves_norm : (2, num_vertex-1) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0055</span>:        Normal vectors going "inwards" of the edges of the Polygon defined</pre>
<pre class="cython line score-0">&#xA0;<span class="">0056</span>:        by ves_poly</pre>
<pre class="cython line score-0">&#xA0;<span class="">0057</span>:     nstruct : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0058</span>:        Total number of structures (counting each limited structure as one)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0059</span>:     ves_nlim : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0060</span>:        Number of limits of the vessel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0061</span>:            -1 : no limits, vessel continuous all around</pre>
<pre class="cython line score-0">&#xA0;<span class="">0062</span>:             1 : vessel is limited</pre>
<pre class="cython line score-0">&#xA0;<span class="">0063</span>:     ves_lims : array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0064</span>:        If ves_nlim==1 contains the limits min and max of vessel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0065</span>:     lstruct_poly : list</pre>
<pre class="cython line score-0">&#xA0;<span class="">0066</span>:        List of coordinates of the vertices of all structures on poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">0067</span>:     lstruct_lims : list</pre>
<pre class="cython line score-0">&#xA0;<span class="">0068</span>:        List of limits of all structures</pre>
<pre class="cython line score-0">&#xA0;<span class="">0069</span>:     lstruct_nlim : array of ints</pre>
<pre class="cython line score-0">&#xA0;<span class="">0070</span>:        List of number of limits for all structures</pre>
<pre class="cython line score-0">&#xA0;<span class="">0071</span>:     lstruct_norm : list</pre>
<pre class="cython line score-0">&#xA0;<span class="">0072</span>:        List of coordinates of "inwards" normal vectors of the polygon of all</pre>
<pre class="cython line score-0">&#xA0;<span class="">0073</span>:        the structures</pre>
<pre class="cython line score-0">&#xA0;<span class="">0074</span>:     rmin : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0075</span>:        Minimal radius of vessel to take into consideration</pre>
<pre class="cython line score-0">&#xA0;<span class="">0076</span>:     eps&lt;val&gt; : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0077</span>:        Small value, acceptance of error</pre>
<pre class="cython line score-0">&#xA0;<span class="">0078</span>:     vtype : string</pre>
<pre class="cython line score-0">&#xA0;<span class="">0079</span>:        Type of vessel ("Tor" or "Lin")</pre>
<pre class="cython line score-0">&#xA0;<span class="">0080</span>:     forbid : bool</pre>
<pre class="cython line score-0">&#xA0;<span class="">0081</span>:        Should we forbid values behind vissible radius ? (see rmin)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0082</span>:     test : bool</pre>
<pre class="cython line score-0">&#xA0;<span class="">0083</span>:        Should we run tests ?</pre>
<pre class="cython line score-0">&#xA0;<span class="">0084</span>:     num_threads : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0085</span>:        The num_threads argument indicates how many threads the team should</pre>
<pre class="cython line score-0">&#xA0;<span class="">0086</span>:        consist of. If not given, OpenMP will decide how many threads to use.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0087</span>:        Typically this is the number of cores available on the machine.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0088</span>:     Return</pre>
<pre class="cython line score-0">&#xA0;<span class="">0089</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">0090</span>:     coeff_inter_in : (num_los) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0091</span>:        scalars level of "in" intersection of the LOS (if k=0 at origin)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0092</span>:     coeff_inter_out : (num_los) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0093</span>:        scalars level of "out" intersection of the LOS (if k=0 at origin)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0094</span>:     vperp_out : (3, num_los) array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0095</span>:        Coordinates of the normal vector of impact of the LOS (NaN if none)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0096</span>:     ind_inter_out : (3, num_los)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0097</span>:        Index of structure impacted by LOS: ind_inter_out[:,ind_los]=(i,j,k)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0098</span>:        where k is the index of edge impacted on the j-th sub structure of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0099</span>:        structure number i. If the LOS impacted the vessel i=j=0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0100</span>:     """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0101</span>:     cdef int npts_poly = ves_norm.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_npts_poly = (__pyx_v_ves_norm.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0102</span>:     cdef int num_los = ray_orig.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_num_los = (__pyx_v_ray_orig.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0103</span>:     cdef int nstruct_lim = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_nstruct_lim = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0104</span>:     cdef int ind_struct = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_ind_struct = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0105</span>:     cdef int totnvert = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_totnvert = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0106</span>:     cdef int ii, jj, kk</pre>
<pre class="cython line score-0">&#xA0;<span class="">0107</span>:     cdef int len_lim</pre>
<pre class="cython line score-0">&#xA0;<span class="">0108</span>:     cdef int nvert</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0109</span>:     cdef double Crit2_base = eps_uz * eps_uz /400.</pre>
<pre class='cython code score-0 '>  __pyx_v_Crit2_base = ((__pyx_v_eps_uz * __pyx_v_eps_uz) / 400.);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0110</span>:     cdef double rmin2 = 0.</pre>
<pre class='cython code score-0 '>  __pyx_v_rmin2 = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0111</span>:     cdef double lim_min = 0.</pre>
<pre class='cython code score-0 '>  __pyx_v_lim_min = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0112</span>:     cdef double lim_max = 0.</pre>
<pre class='cython code score-0 '>  __pyx_v_lim_max = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">0113</span>:     cdef str error_message</pre>
<pre class="cython line score-0">&#xA0;<span class="">0114</span>:     cdef bint forbidbis, forbid0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0115</span>:     cdef bint bool1, bool2</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0116</span>:     cdef double *lbounds = &lt;double *&gt;malloc(nstruct * 6 * sizeof(double))</pre>
<pre class='cython code score-0 '>  __pyx_v_lbounds = ((double *)malloc(((__pyx_v_nstruct * 6) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0117</span>:     cdef double *langles = &lt;double *&gt;malloc(nstruct * 2 * sizeof(double))</pre>
<pre class='cython code score-0 '>  __pyx_v_langles = ((double *)malloc(((__pyx_v_nstruct * 2) * (sizeof(double)))));
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0118</span>:     cdef array vperp_out = clone(array('d'), num_los * 3, True)</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_1), (__pyx_v_num_los * 3), 1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 118, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_vperp_out = ((arrayobject *)__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_tuple__8 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 118, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__8);
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0119</span>:     cdef array coeff_inter_in  = clone(array('d'), num_los, True)</pre>
<pre class='cython code score-3 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 119, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_2), __pyx_v_num_los, 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 119, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_coeff_inter_in = ((arrayobject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0120</span>:     cdef array coeff_inter_out = clone(array('d'), num_los, True)</pre>
<pre class='cython code score-3 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_1), __pyx_v_num_los, 1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_coeff_inter_out = ((arrayobject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0121</span>:     cdef array ind_inter_out = clone(array('i'), num_los * 3, True)</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_2), (__pyx_v_num_los * 3), 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ind_inter_out = ((arrayobject *)__pyx_t_1);
  __pyx_t_1 = 0;
/* … */
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0122</span>:     cdef int *llimits = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_llimits = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0123</span>:     cdef int *lnvert  = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lnvert = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0124</span>:     cdef long *lsz_lim = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lsz_lim = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0125</span>:     cdef double *lpolyx = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lpolyx = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0126</span>:     cdef double *lpolyy = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lpolyy = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0127</span>:     cdef double *lnormx = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lnormx = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0128</span>:     cdef double *lnormy = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lnormy = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0129</span>:     cdef double[:,::1] lspoly_view # memory view</pre>
<pre class="cython line score-0">&#xA0;<span class="">0130</span>:     cdef double[:,::1] lsvin_view # memory view</pre>
<pre class="cython line score-0">&#xA0;<span class="">0131</span>:     cdef int[1] llim_ves</pre>
<pre class="cython line score-0">&#xA0;<span class="">0132</span>:     cdef double[2] lbounds_ves</pre>
<pre class="cython line score-0">&#xA0;<span class="">0133</span>:     cdef double[2] lim_ves</pre>
<pre class="cython line score-0">&#xA0;<span class="">0134</span>:     cdef double[6] bounds</pre>
<pre class="cython line score-0">&#xA0;<span class="">0135</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0136</span>:     # == Testing inputs ========================================================</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0137</span>:     if test:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_test != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0138</span>:         error_message = "ray_orig and ray_vdir must have the same shape: "\</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0139</span>:                         + "(3,) or (3,NL)!"</pre>
<pre class='cython code score-5 '>    __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_kp_s_ray_orig_and_ray_vdir_must_have, __pyx_kp_s_3_or_3_NL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_v_error_message = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0140</span>:         assert tuple(ray_orig.shape) == tuple(ray_vdir.shape) and \</pre>
<pre class='cython code score-16 '>    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_1 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_ray_orig.shape, 8);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_ray_vdir.shape, 8);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_t_4, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_5) {
      } else {
        __pyx_t_3 = __pyx_t_5;
        goto __pyx_L4_bool_binop_done;
      }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0141</span>:           ray_orig.shape[0] == 3, error_message</pre>
<pre class='cython code score-5 '>      __pyx_t_5 = (((__pyx_v_ray_orig.shape[0]) == 3) != 0);
      __pyx_t_3 = __pyx_t_5;
      __pyx_L4_bool_binop_done:;
      if (unlikely(!__pyx_t_3)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0142</span>:         error_message = "ves_poly and ves_norm must have the same shape (2,NS)!"</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_ves_poly_and_ves_norm_must_have);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_ves_poly_and_ves_norm_must_have);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0143</span>:         assert ves_poly.shape[0] == 2 and ves_norm.shape[0] == 2 and \</pre>
<pre class='cython code score-0 '>    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = (((__pyx_v_ves_poly.shape[0]) == 2) != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_3 = __pyx_t_5;
        goto __pyx_L6_bool_binop_done;
      }
      __pyx_t_5 = (((__pyx_v_ves_norm.shape[0]) == 2) != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_3 = __pyx_t_5;
        goto __pyx_L6_bool_binop_done;
      }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0144</span>:             npts_poly == ves_poly.shape[1]-1, error_message</pre>
<pre class='cython code score-5 '>      __pyx_t_5 = ((__pyx_v_npts_poly == ((__pyx_v_ves_poly.shape[1]) - 1)) != 0);
      __pyx_t_3 = __pyx_t_5;
      __pyx_L6_bool_binop_done:;
      if (unlikely(!__pyx_t_3)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 143, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0145</span>:         bool1 = lstruct_lims is None or len(lstruct_lims) == len(lstruct_poly)</pre>
<pre class='cython code score-12 '>    __pyx_t_5 = (__pyx_v_lstruct_lims == ((PyObject*)Py_None));
    __pyx_t_6 = (__pyx_t_5 != 0);
    if (!__pyx_t_6) {
    } else {
      __pyx_t_3 = __pyx_t_6;
      goto __pyx_L9_bool_binop_done;
    }
    if (unlikely(__pyx_v_lstruct_lims == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
    }
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lstruct_lims);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 145, __pyx_L1_error)</span>
    if (unlikely(__pyx_v_lstruct_poly == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
    }
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lstruct_poly);<span class='error_goto'> if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 145, __pyx_L1_error)</span>
    __pyx_t_6 = ((__pyx_t_7 == __pyx_t_8) != 0);
    __pyx_t_3 = __pyx_t_6;
    __pyx_L9_bool_binop_done:;
    __pyx_v_bool1 = __pyx_t_3;
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0146</span>:         bool2 = lstruct_norm is None or len(lstruct_norm) == len(lstruct_poly)</pre>
<pre class='cython code score-12 '>    __pyx_t_6 = (__pyx_v_lstruct_norm == ((PyObject*)Py_None));
    __pyx_t_5 = (__pyx_t_6 != 0);
    if (!__pyx_t_5) {
    } else {
      __pyx_t_3 = __pyx_t_5;
      goto __pyx_L11_bool_binop_done;
    }
    if (unlikely(__pyx_v_lstruct_norm == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>
    }
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lstruct_norm);<span class='error_goto'> if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 146, __pyx_L1_error)</span>
    if (unlikely(__pyx_v_lstruct_poly == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 146, __pyx_L1_error)</span>
    }
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lstruct_poly);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 146, __pyx_L1_error)</span>
    __pyx_t_5 = ((__pyx_t_8 == __pyx_t_7) != 0);
    __pyx_t_3 = __pyx_t_5;
    __pyx_L11_bool_binop_done:;
    __pyx_v_bool2 = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0147</span>:         error_message = "lstruct_poly, lstruct_lims, lstruct_norm must be None"\</pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0148</span>:                         + " or lists of same len!"</pre>
<pre class='cython code score-6 '>    __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_kp_s_lstruct_poly_lstruct_lims_lstruc, __pyx_kp_s_or_lists_of_same_len);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, ((PyObject*)__pyx_t_1));
    __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0149</span>:         assert bool1 and bool2, error_message</pre>
<pre class='cython code score-5 '>    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = (__pyx_v_bool1 != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_3 = __pyx_t_5;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_5 = (__pyx_v_bool2 != 0);
      __pyx_t_3 = __pyx_t_5;
      __pyx_L13_bool_binop_done:;
      if (unlikely(!__pyx_t_3)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0150</span>:         error_message = "[eps_uz,eps_vz,eps_a,eps_b] must be floats &lt; 1.e-4!"</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_eps_uz_eps_vz_eps_a_eps_b_must);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_eps_uz_eps_vz_eps_a_eps_b_must);
</pre><pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0151</span>:         assert all([ee &lt; 1.e-4 for ee in [eps_uz, eps_a,</pre>
<pre class='cython code score-44 '>    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_eps_uz);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_eps_a);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
      __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2, __pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3, __pyx_t_10);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 4, __pyx_t_11);
      __pyx_t_4 = 0;
      __pyx_t_2 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_11 = __pyx_t_12; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      for (;;) {
        if (__pyx_t_7 &gt;= 5) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_11, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
        #else
        __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        #endif
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_ee, __pyx_t_12);
        __pyx_t_12 = 0;
        __pyx_t_12 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_ee, __pyx_float_1_eneg_4, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 151, __pyx_L1_error)
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_12))) __PYX_ERR(0, 151, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_all, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_3)) {
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0152</span>:                                           eps_vz, eps_b,</pre>
<pre class='cython code score-10 '>      __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_eps_vz);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_eps_b);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0153</span>:                                           eps_plane]]), error_message</pre>
<pre class='cython code score-10 '>      __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_eps_plane);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 153, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
/* … */
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0154</span>:         error_message = "ves_type must be a str in ['Tor','Lin']!"</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_ves_type_must_be_a_str_in_Tor_Li);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_ves_type_must_be_a_str_in_Tor_Li);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0155</span>:         assert ves_type.lower() in ['tor', 'lin'], error_message</pre>
<pre class='cython code score-10 '>    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_11 = __Pyx_CallUnboundCMethod0(&amp;__pyx_umethod_PyString_Type_lower, __pyx_v_ves_type);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_11, __pyx_n_s_tor, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
      if (!__pyx_t_5) {
      } else {
        __pyx_t_3 = __pyx_t_5;
        goto __pyx_L17_bool_binop_done;
      }
      __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_11, __pyx_n_s_lin, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
      __pyx_t_3 = __pyx_t_5;
      __pyx_L17_bool_binop_done:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!(__pyx_t_3 != 0))) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">0156</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0157</span>:     # == Treating input ========================================================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0158</span>:     # if there are, we get the limits for the vessel</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0159</span>:     if ves_nlim == 0:</pre>
<pre class='cython code score-0 '>  switch (__pyx_v_ves_nlim) {
    case 0:
/* … */
    break;
    case 1:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0160</span>:         llim_ves[0] = 1</pre>
<pre class='cython code score-0 '>    (__pyx_v_llim_ves[0]) = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0161</span>:         lbounds_ves[0] = 0</pre>
<pre class='cython code score-0 '>    (__pyx_v_lbounds_ves[0]) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0162</span>:         lbounds_ves[1] = 0</pre>
<pre class='cython code score-0 '>    (__pyx_v_lbounds_ves[1]) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0163</span>:     elif ves_nlim == 1:</pre>
<pre class='cython code score-0 '>    break;
    default: break;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0164</span>:         llim_ves[0] = 0</pre>
<pre class='cython code score-0 '>    (__pyx_v_llim_ves[0]) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0165</span>:         lbounds_ves[0] = Catan2(Csin(ves_lims[0]), Ccos(ves_lims[0]))</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = 0;
    __pyx_t_14 = 0;
    (__pyx_v_lbounds_ves[0]) = atan2(sin((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_ves_lims.data) + __pyx_t_13)) )))), cos((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_ves_lims.data) + __pyx_t_14)) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0166</span>:         lbounds_ves[1] = Catan2(Csin(ves_lims[1]), Ccos(ves_lims[1]))</pre>
<pre class='cython code score-0 '>    __pyx_t_15 = 1;
    __pyx_t_16 = 1;
    (__pyx_v_lbounds_ves[1]) = atan2(sin((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_ves_lims.data) + __pyx_t_15)) )))), cos((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_ves_lims.data) + __pyx_t_16)) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0167</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0168</span>:     # ==========================================================================</pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0169</span>:     if ves_type.lower() == 'tor':</pre>
<pre class='cython code score-3 '>  __pyx_t_11 = __Pyx_CallUnboundCMethod0(&amp;__pyx_umethod_PyString_Type_lower, __pyx_v_ves_type);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_3 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_11, __pyx_n_s_tor, Py_EQ)); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 169, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0170</span>:         # rmin is necessary to avoid looking on the other side of the tokamak</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0171</span>:         if rmin &lt; 0.:</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = ((__pyx_v_rmin &lt; 0.) != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0172</span>:             rmin = 0.95*min(np.min(ves_poly[0, ...]),</pre>
<pre class='cython code score-37 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_min);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_17.data = __pyx_v_ves_poly.data;
      __pyx_t_17.memview = __pyx_v_ves_poly.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_17, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_ves_poly.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
        __pyx_t_17.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_17.shape[0] = __pyx_v_ves_poly.shape[1];
__pyx_t_17.strides[0] = __pyx_v_ves_poly.strides[1];
    __pyx_t_17.suboffsets[0] = -1;

__pyx_t_1 = __pyx_memoryview_fromslice(__pyx_t_17, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
      __pyx_t_17.memview = NULL;
      __pyx_t_17.data = NULL;
      __pyx_t_19 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
        __pyx_t_19 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
        if (likely(__pyx_t_19)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_19);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
        }
      }
      __pyx_t_12 = (__pyx_t_19) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_19, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_9, __pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_12)) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
/* … */
      __pyx_t_11 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_float_0_95, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_20 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_11); if (unlikely((__pyx_t_20 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_v_rmin = __pyx_t_20;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0173</span>:                                 np.min(np.hypot(ray_orig[0, ...],</pre>
<pre class='cython code score-22 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_min);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_hypot);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_17.data = __pyx_v_ray_orig.data;
      __pyx_t_17.memview = __pyx_v_ray_orig.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_17, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_ray_orig.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>
        __pyx_t_17.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_17.shape[0] = __pyx_v_ray_orig.shape[1];
__pyx_t_17.strides[0] = __pyx_v_ray_orig.strides[1];
    __pyx_t_17.suboffsets[0] = -1;

__pyx_t_10 = __pyx_memoryview_fromslice(__pyx_t_17, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
      __pyx_t_17.memview = NULL;
      __pyx_t_17.data = NULL;
/* … */
      __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_11, __pyx_t_12, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_3 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_3) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
        __pyx_t_9 = __pyx_t_11;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
        __pyx_t_9 = __pyx_t_12;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-54" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0174</span>:                                                 ray_orig[1, ...])))</pre>
<pre class='cython code score-54 '>      __pyx_t_17.data = __pyx_v_ray_orig.data;
      __pyx_t_17.memview = __pyx_v_ray_orig.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_17, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_ray_orig.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
        __pyx_t_17.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_17.shape[0] = __pyx_v_ray_orig.shape[1];
__pyx_t_17.strides[0] = __pyx_v_ray_orig.strides[1];
    __pyx_t_17.suboffsets[0] = -1;

__pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_17, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 174, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
      __pyx_t_17.memview = NULL;
      __pyx_t_17.data = NULL;
      __pyx_t_4 = NULL;
      __pyx_t_18 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
          __pyx_t_18 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_9)) {
        PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_10, __pyx_t_2};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_9)) {
        PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_t_10, __pyx_t_2};
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_18, 2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      } else
      #endif
      {
        __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_18);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
        if (__pyx_t_4) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, __pyx_t_4); __pyx_t_4 = NULL;
        }
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0+__pyx_t_18, __pyx_t_10);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 1+__pyx_t_18, __pyx_t_2);
        __pyx_t_10 = 0;
        __pyx_t_2 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_19, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
        __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
        if (likely(__pyx_t_9)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
        }
      }
      __pyx_t_11 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_9, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_12, __pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0175</span>:         rmin2 = rmin*rmin</pre>
<pre class='cython code score-0 '>    __pyx_v_rmin2 = (__pyx_v_rmin * __pyx_v_rmin);
</pre><pre class="cython line score-0">&#xA0;<span class="">0176</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0177</span>:         # Variable to avoid looking "behind" blind spot of tore</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0178</span>:         if forbid:</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_v_forbid != 0);
    if (__pyx_t_3) {
/* … */
      goto __pyx_L21;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0179</span>:             forbid0, forbidbis = 1, 1</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = 1;
      __pyx_t_5 = 1;
      __pyx_v_forbid0 = __pyx_t_3;
      __pyx_v_forbidbis = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">0180</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0181</span>:             forbid0, forbidbis = 0, 0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_5 = 0;
      __pyx_t_3 = 0;
      __pyx_v_forbid0 = __pyx_t_5;
      __pyx_v_forbidbis = __pyx_t_3;
    }
    __pyx_L21:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0182</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0183</span>:         # Arrays to get X,Y coordinates of the Vessel's poly</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0184</span>:         lpolyx = &lt;double *&gt;malloc((npts_poly + 1) * sizeof(double))</pre>
<pre class='cython code score-0 '>    __pyx_v_lpolyx = ((double *)malloc(((__pyx_v_npts_poly + 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0185</span>:         lpolyy = &lt;double *&gt;malloc((npts_poly + 1) * sizeof(double))</pre>
<pre class='cython code score-0 '>    __pyx_v_lpolyy = ((double *)malloc(((__pyx_v_npts_poly + 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0186</span>:         lnormx = &lt;double *&gt;malloc((npts_poly + 1) * sizeof(double))</pre>
<pre class='cython code score-0 '>    __pyx_v_lnormx = ((double *)malloc(((__pyx_v_npts_poly + 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0187</span>:         lnormy = &lt;double *&gt;malloc((npts_poly + 1) * sizeof(double))</pre>
<pre class='cython code score-0 '>    __pyx_v_lnormy = ((double *)malloc(((__pyx_v_npts_poly + 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0188</span>:         for ind_vert in range(npts_poly+1):</pre>
<pre class='cython code score-0 '>    __pyx_t_21 = (__pyx_v_npts_poly + 1);
    __pyx_t_22 = __pyx_t_21;
    for (__pyx_t_23 = 0; __pyx_t_23 &lt; __pyx_t_22; __pyx_t_23+=1) {
      __pyx_v_ind_vert = __pyx_t_23;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0189</span>:             lpolyx[ind_vert] = ves_poly[0][ind_vert]</pre>
<pre class='cython code score-0 '>      __pyx_t_24 = 0;
      __pyx_t_25 = __pyx_v_ind_vert;
      (__pyx_v_lpolyx[__pyx_v_ind_vert]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ves_poly.data + __pyx_t_24 * __pyx_v_ves_poly.strides[0]) )) + __pyx_t_25)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0190</span>:             lpolyy[ind_vert] = ves_poly[1][ind_vert]</pre>
<pre class='cython code score-0 '>      __pyx_t_26 = 1;
      __pyx_t_27 = __pyx_v_ind_vert;
      (__pyx_v_lpolyy[__pyx_v_ind_vert]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ves_poly.data + __pyx_t_26 * __pyx_v_ves_poly.strides[0]) )) + __pyx_t_27)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0191</span>:             lnormx[ind_vert] = ves_norm[0][ind_vert]</pre>
<pre class='cython code score-0 '>      __pyx_t_28 = 0;
      __pyx_t_29 = __pyx_v_ind_vert;
      (__pyx_v_lnormx[__pyx_v_ind_vert]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ves_norm.data + __pyx_t_28 * __pyx_v_ves_norm.strides[0]) )) + __pyx_t_29)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0192</span>:             lnormy[ind_vert] = ves_norm[1][ind_vert]</pre>
<pre class='cython code score-0 '>      __pyx_t_30 = 1;
      __pyx_t_31 = __pyx_v_ind_vert;
      (__pyx_v_lnormy[__pyx_v_ind_vert]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ves_norm.data + __pyx_t_30 * __pyx_v_ves_norm.strides[0]) )) + __pyx_t_31)) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0193</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0194</span>:         # -- Computing intersection between LOS and Vessel ---------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0195</span>:         raytracing_inout_struct_tor(num_los, ray_vdir, ray_orig,</pre>
<pre class='cython code score-0 '>    __pyx_f_4tofu_4geom_8_GG03_LM_raytracing_inout_struct_tor(__pyx_v_num_los, __pyx_v_ray_vdir, __pyx_v_ray_orig, __pyx_t_17, __pyx_t_32, __pyx_t_33, __pyx_v_lstruct_nlim, __pyx_t_34, __pyx_v_forbid0, __pyx_v_forbidbis, __pyx_v_rmin, __pyx_v_rmin2, __pyx_v_Crit2_base, __pyx_v_npts_poly, NULL, __pyx_v_lbounds_ves, __pyx_v_llim_ves, NULL, NULL, __pyx_v_lpolyx, __pyx_v_lpolyy, __pyx_v_lnormx, __pyx_v_lnormy, __pyx_v_eps_uz, __pyx_v_eps_vz, __pyx_v_eps_a, __pyx_v_eps_b, __pyx_v_eps_plane, __pyx_v_num_threads, 0);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
    __pyx_t_17.memview = NULL;
    __pyx_t_17.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_32, 1);
    __pyx_t_32.memview = NULL;
    __pyx_t_32.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_33, 1);
    __pyx_t_33.memview = NULL;
    __pyx_t_33.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_34, 1);
    __pyx_t_34.memview = NULL;
    __pyx_t_34.data = NULL;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0196</span>:                                     coeff_inter_out, coeff_inter_in,</pre>
<pre class='cython code score-4 '>    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_coeff_inter_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
    __pyx_t_32 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_coeff_inter_in), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_32.memview)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0197</span>:                                     vperp_out, lstruct_nlim, ind_inter_out,</pre>
<pre class='cython code score-4 '>    __pyx_t_33 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_vperp_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_33.memview)) __PYX_ERR(0, 197, __pyx_L1_error)</span>
    __pyx_t_34 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_int</span>(((PyObject *)__pyx_v_ind_inter_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_34.memview)) __PYX_ERR(0, 197, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0198</span>:                                     forbid0, forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0199</span>:                                     rmin, rmin2, Crit2_base,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0200</span>:                                     npts_poly,  NULL, lbounds_ves,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0201</span>:                                     llim_ves, NULL, NULL,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0202</span>:                                     lpolyx, lpolyy, lnormx, lnormy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0203</span>:                                     eps_uz, eps_vz, eps_a, eps_b, eps_plane,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0204</span>:                                     num_threads, False) # structure is in</pre>
<pre class="cython line score-0">&#xA0;<span class="">0205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0206</span>:         # We can free local arrays and set them as NULL for structures</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0207</span>:         free(lpolyx)</pre>
<pre class='cython code score-0 '>    free(__pyx_v_lpolyx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0208</span>:         free(lpolyy)</pre>
<pre class='cython code score-0 '>    free(__pyx_v_lpolyy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0209</span>:         free(lnormx)</pre>
<pre class='cython code score-0 '>    free(__pyx_v_lnormx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0210</span>:         free(lnormy)</pre>
<pre class='cython code score-0 '>    free(__pyx_v_lnormy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0211</span>:         lpolyx = NULL</pre>
<pre class='cython code score-0 '>    __pyx_v_lpolyx = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0212</span>:         lpolyy = NULL</pre>
<pre class='cython code score-0 '>    __pyx_v_lpolyy = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0213</span>:         lnormx = NULL</pre>
<pre class='cython code score-0 '>    __pyx_v_lnormx = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0214</span>:         lnormy = NULL</pre>
<pre class='cython code score-0 '>    __pyx_v_lnormy = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0215</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0216</span>:         # -- Treating the structures (if any) ----------------------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0217</span>:         if nstruct &gt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = ((__pyx_v_nstruct &gt; 0) != 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0218</span>:             ind_struct = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_ind_struct = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0219</span>:             nstruct_lim = len(lstruct_poly) # num of structures (no limits)</pre>
<pre class='cython code score-6 '>      if (unlikely(__pyx_v_lstruct_poly == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
        <span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>
      }
      __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lstruct_poly);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 219, __pyx_L1_error)</span>
      __pyx_v_nstruct_lim = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0220</span>:             lnvert = &lt;int *&gt;malloc(nstruct_lim * sizeof(int))</pre>
<pre class='cython code score-0 '>      __pyx_v_lnvert = ((int *)malloc((__pyx_v_nstruct_lim * (sizeof(int)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0221</span>:             llimits = &lt;int *&gt;malloc(nstruct * sizeof(int))</pre>
<pre class='cython code score-0 '>      __pyx_v_llimits = ((int *)malloc((__pyx_v_nstruct * (sizeof(int)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0222</span>:             lsz_lim = &lt;long *&gt;malloc(nstruct_lim * sizeof(long))</pre>
<pre class='cython code score-0 '>      __pyx_v_lsz_lim = ((long *)malloc((__pyx_v_nstruct_lim * (sizeof(long)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0223</span>:             for ii in range(nstruct_lim):</pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_nstruct_lim;
      __pyx_t_35 = __pyx_t_18;
      for (__pyx_t_36 = 0; __pyx_t_36 &lt; __pyx_t_35; __pyx_t_36+=1) {
        __pyx_v_ii = __pyx_t_36;
</pre><pre class="cython line score-0">&#xA0;<span class="">0224</span>:                 # For fast accessing</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0225</span>:                 lspoly_view = lstruct_poly[ii]</pre>
<pre class='cython code score-8 '>        if (unlikely(__pyx_v_lstruct_poly == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 225, __pyx_L1_error)</span>
        }
        __pyx_t_37 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lstruct_poly, __pyx_v_ii), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_37.memview)) __PYX_ERR(0, 225, __pyx_L1_error)</span>
        __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lspoly_view, 1);
        __pyx_v_lspoly_view = __pyx_t_37;
        __pyx_t_37.memview = NULL;
        __pyx_t_37.data = NULL;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0226</span>:                 lsvin_view = lstruct_norm[ii]</pre>
<pre class='cython code score-8 '>        if (unlikely(__pyx_v_lstruct_norm == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>
        }
        __pyx_t_37 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lstruct_norm, __pyx_v_ii), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_37.memview)) __PYX_ERR(0, 226, __pyx_L1_error)</span>
        __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lsvin_view, 1);
        __pyx_v_lsvin_view = __pyx_t_37;
        __pyx_t_37.memview = NULL;
        __pyx_t_37.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0227</span>:                 len_lim = lstruct_nlim[ii]</pre>
<pre class='cython code score-0 '>        __pyx_t_38 = __pyx_v_ii;
        __pyx_v_len_lim = (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_lstruct_nlim.data) + __pyx_t_38)) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">0228</span>:                 # We get the limits if any</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0229</span>:                 if len_lim == 0:</pre>
<pre class='cython code score-0 '>        switch (__pyx_v_len_lim) {
          case 0:
/* … */
          break;
          case 1:
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0230</span>:                     lslim = [None]</pre>
<pre class='cython code score-8 '>          __pyx_t_11 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 230, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
          <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_11, 0, Py_None);
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_lslim, __pyx_t_11);
          __pyx_t_11 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0231</span>:                     lstruct_nlim[ii] = lstruct_nlim[ii] + 1</pre>
<pre class='cython code score-0 '>          __pyx_t_39 = __pyx_v_ii;
          __pyx_t_40 = __pyx_v_ii;
          *((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_lstruct_nlim.data) + __pyx_t_40)) )) = ((*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_lstruct_nlim.data) + __pyx_t_39)) ))) + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0232</span>:                 elif len_lim == 1:</pre>
<pre class='cython code score-0 '>          break;
          default:
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0233</span>:                     lslim = [[lstruct_lims[ii][0, 0], lstruct_lims[ii][0, 1]]]</pre>
<pre class='cython code score-40 '>          if (unlikely(__pyx_v_lstruct_lims == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
          }
          __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lstruct_lims, __pyx_v_ii), __pyx_tuple__10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
          if (unlikely(__pyx_v_lstruct_lims == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
          }
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lstruct_lims, __pyx_v_ii), __pyx_tuple__11);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_12 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_11);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_9);
          __pyx_t_11 = 0;
          __pyx_t_9 = 0;
          __pyx_t_9 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_12);
          __pyx_t_12 = 0;
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_lslim, __pyx_t_9);
          __pyx_t_9 = 0;
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
</pre><pre class="cython line score-0">&#xA0;<span class="">0234</span>:                 else:</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0235</span>:                     lslim = lstruct_lims[ii]</pre>
<pre class='cython code score-8 '>          if (unlikely(__pyx_v_lstruct_lims == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>
          }
          __pyx_t_9 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lstruct_lims, __pyx_v_ii);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_lslim, __pyx_t_9);
          __pyx_t_9 = 0;
          break;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">0236</span>:                 # We get the number of vertices and limits of the struct's poly</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0237</span>:                 nvert = len(lspoly_view[0])</pre>
<pre class='cython code score-2 '>        __pyx_t_33.data = __pyx_v_lspoly_view.data;
        __pyx_t_33.memview = __pyx_v_lspoly_view.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_33, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_lspoly_view.strides[0];
        if ((0)) <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L1_error)</span>
        __pyx_t_33.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_33.shape[0] = __pyx_v_lspoly_view.shape[1];
__pyx_t_33.strides[0] = __pyx_v_lspoly_view.strides[1];
    __pyx_t_33.suboffsets[0] = -1;

__pyx_t_41 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_t_33); 
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_33, 1);
        __pyx_t_33.memview = NULL;
        __pyx_t_33.data = NULL;
        __pyx_v_nvert = __pyx_t_41;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0238</span>:                 if ii == 0:</pre>
<pre class='cython code score-0 '>        __pyx_t_3 = ((__pyx_v_ii == 0) != 0);
        if (__pyx_t_3) {
/* … */
          goto __pyx_L27;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0239</span>:                     lnvert[0] = nvert</pre>
<pre class='cython code score-0 '>          (__pyx_v_lnvert[0]) = __pyx_v_nvert;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0240</span>:                     lsz_lim[0] = 0</pre>
<pre class='cython code score-0 '>          (__pyx_v_lsz_lim[0]) = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0241</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0242</span>:                     lnvert[ii] = nvert + lnvert[ii-1]</pre>
<pre class='cython code score-0 '>        /*else*/ {
          (__pyx_v_lnvert[__pyx_v_ii]) = (__pyx_v_nvert + (__pyx_v_lnvert[(__pyx_v_ii - 1)]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0243</span>:                     lsz_lim[ii] = lstruct_nlim[ii-1] + lsz_lim[ii-1]</pre>
<pre class='cython code score-0 '>          __pyx_t_42 = (__pyx_v_ii - 1);
          (__pyx_v_lsz_lim[__pyx_v_ii]) = ((*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_lstruct_nlim.data) + __pyx_t_42)) ))) + (__pyx_v_lsz_lim[(__pyx_v_ii - 1)]));
        }
        __pyx_L27:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0244</span>:                 # ...and the poly itself (and normal vector)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0245</span>:                 lpolyx = &lt;double *&gt;realloc(lpolyx,</pre>
<pre class='cython code score-0 '>        __pyx_v_lpolyx = ((double *)realloc(__pyx_v_lpolyx, ((__pyx_v_totnvert + __pyx_v_nvert) * (sizeof(double)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0246</span>:                                            (totnvert+nvert) * sizeof(double))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0247</span>:                 lpolyy = &lt;double *&gt;realloc(lpolyy,</pre>
<pre class='cython code score-0 '>        __pyx_v_lpolyy = ((double *)realloc(__pyx_v_lpolyy, ((__pyx_v_totnvert + __pyx_v_nvert) * (sizeof(double)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0248</span>:                                            (totnvert+nvert) * sizeof(double))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0249</span>:                 lnormx = &lt;double *&gt;realloc(lnormx,</pre>
<pre class='cython code score-0 '>        __pyx_v_lnormx = ((double *)realloc(__pyx_v_lnormx, ((((__pyx_v_totnvert + __pyx_v_nvert) - 1) - __pyx_v_ii) * (sizeof(double)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0250</span>:                                            (totnvert+nvert-1-ii) * sizeof(double))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0251</span>:                 lnormy = &lt;double *&gt;realloc(lnormy,</pre>
<pre class='cython code score-0 '>        __pyx_v_lnormy = ((double *)realloc(__pyx_v_lnormy, ((((__pyx_v_totnvert + __pyx_v_nvert) - 1) - __pyx_v_ii) * (sizeof(double)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0252</span>:                                            (totnvert+nvert-1-ii) * sizeof(double))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0253</span>:                 for jj in range(nvert-1):</pre>
<pre class='cython code score-0 '>        __pyx_t_21 = (__pyx_v_nvert - 1);
        __pyx_t_22 = __pyx_t_21;
        for (__pyx_t_43 = 0; __pyx_t_43 &lt; __pyx_t_22; __pyx_t_43+=1) {
          __pyx_v_jj = __pyx_t_43;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0254</span>:                     lpolyx[totnvert + jj] = lspoly_view[0,jj]</pre>
<pre class='cython code score-0 '>          __pyx_t_44 = 0;
          __pyx_t_45 = __pyx_v_jj;
          (__pyx_v_lpolyx[(__pyx_v_totnvert + __pyx_v_jj)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lspoly_view.data + __pyx_t_44 * __pyx_v_lspoly_view.strides[0]) )) + __pyx_t_45)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0255</span>:                     lpolyy[totnvert + jj] = lspoly_view[1,jj]</pre>
<pre class='cython code score-0 '>          __pyx_t_46 = 1;
          __pyx_t_47 = __pyx_v_jj;
          (__pyx_v_lpolyy[(__pyx_v_totnvert + __pyx_v_jj)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lspoly_view.data + __pyx_t_46 * __pyx_v_lspoly_view.strides[0]) )) + __pyx_t_47)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0256</span>:                     lnormx[totnvert + jj - ii] = lsvin_view[0,jj]</pre>
<pre class='cython code score-0 '>          __pyx_t_48 = 0;
          __pyx_t_49 = __pyx_v_jj;
          (__pyx_v_lnormx[((__pyx_v_totnvert + __pyx_v_jj) - __pyx_v_ii)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lsvin_view.data + __pyx_t_48 * __pyx_v_lsvin_view.strides[0]) )) + __pyx_t_49)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0257</span>:                     lnormy[totnvert + jj - ii] = lsvin_view[1,jj]</pre>
<pre class='cython code score-0 '>          __pyx_t_50 = 1;
          __pyx_t_51 = __pyx_v_jj;
          (__pyx_v_lnormy[((__pyx_v_totnvert + __pyx_v_jj) - __pyx_v_ii)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lsvin_view.data + __pyx_t_50 * __pyx_v_lsvin_view.strides[0]) )) + __pyx_t_51)) )));
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0258</span>:                 lpolyx[totnvert + nvert-1] = lspoly_view[0,nvert-1]</pre>
<pre class='cython code score-0 '>        __pyx_t_52 = 0;
        __pyx_t_53 = (__pyx_v_nvert - 1);
        (__pyx_v_lpolyx[((__pyx_v_totnvert + __pyx_v_nvert) - 1)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lspoly_view.data + __pyx_t_52 * __pyx_v_lspoly_view.strides[0]) )) + __pyx_t_53)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0259</span>:                 lpolyy[totnvert + nvert-1] = lspoly_view[1,nvert-1]</pre>
<pre class='cython code score-0 '>        __pyx_t_54 = 1;
        __pyx_t_55 = (__pyx_v_nvert - 1);
        (__pyx_v_lpolyy[((__pyx_v_totnvert + __pyx_v_nvert) - 1)]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_lspoly_view.data + __pyx_t_54 * __pyx_v_lspoly_view.strides[0]) )) + __pyx_t_55)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0260</span>:                 totnvert = totnvert + nvert</pre>
<pre class='cython code score-0 '>        __pyx_v_totnvert = (__pyx_v_totnvert + __pyx_v_nvert);
</pre><pre class="cython line score-0">&#xA0;<span class="">0261</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0262</span>:                 # and loop over the limits (one continous structure)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0263</span>:                 for jj in range(max(len_lim,1)):</pre>
<pre class='cython code score-0 '>        __pyx_t_21 = 1;
        __pyx_t_43 = __pyx_v_len_lim;
        if (((__pyx_t_21 &gt; __pyx_t_43) != 0)) {
          __pyx_t_22 = __pyx_t_21;
        } else {
          __pyx_t_22 = __pyx_t_43;
        }
        __pyx_t_21 = __pyx_t_22;
        __pyx_t_22 = __pyx_t_21;
        for (__pyx_t_43 = 0; __pyx_t_43 &lt; __pyx_t_22; __pyx_t_43+=1) {
          __pyx_v_jj = __pyx_t_43;
</pre><pre class="cython line score-0">&#xA0;<span class="">0264</span>:                     # We compute the structure's bounding box:</pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0265</span>:                     if lslim[jj] is not None:</pre>
<pre class='cython code score-3 '>          __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
          __pyx_t_3 = (__pyx_t_9 != Py_None);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
          __pyx_t_5 = (__pyx_t_3 != 0);
          if (__pyx_t_5) {
/* … */
            goto __pyx_L32;
          }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0266</span>:                         lim_ves[0] = lslim[jj][0]</pre>
<pre class='cython code score-16 '>            __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_9, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
            __pyx_t_20 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_12); if (unlikely((__pyx_t_20 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            (__pyx_v_lim_ves[0]) = __pyx_t_20;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0267</span>:                         lim_ves[1] = lslim[jj][1]</pre>
<pre class='cython code score-16 '>            __pyx_t_12 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
            __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_12, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
            __pyx_t_20 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9); if (unlikely((__pyx_t_20 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
            (__pyx_v_lim_ves[1]) = __pyx_t_20;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0268</span>:                         llimits[ind_struct] = 0 # False : struct is limited</pre>
<pre class='cython code score-0 '>            (__pyx_v_llimits[__pyx_v_ind_struct]) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0269</span>:                         lim_min = Catan2(Csin(lim_ves[0]), Ccos(lim_ves[0]))</pre>
<pre class='cython code score-0 '>            __pyx_v_lim_min = atan2(sin((__pyx_v_lim_ves[0])), cos((__pyx_v_lim_ves[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0270</span>:                         lim_max = Catan2(Csin(lim_ves[1]), Ccos(lim_ves[1]))</pre>
<pre class='cython code score-0 '>            __pyx_v_lim_max = atan2(sin((__pyx_v_lim_ves[1])), cos((__pyx_v_lim_ves[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0271</span>:                         compute_bbox_lim(nvert, lspoly_view, bounds,</pre>
<pre class='cython code score-0 '>            __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_lim(__pyx_v_nvert, __pyx_v_lspoly_view, __pyx_v_bounds, __pyx_v_lim_min, __pyx_v_lim_max);
</pre><pre class="cython line score-0">&#xA0;<span class="">0272</span>:                                          lim_min, lim_max)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0273</span>:                     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0274</span>:                         llimits[ind_struct] = 1 # True : is continous</pre>
<pre class='cython code score-0 '>          /*else*/ {
            (__pyx_v_llimits[__pyx_v_ind_struct]) = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0275</span>:                         compute_bbox_extr(nvert, lspoly_view, bounds)</pre>
<pre class='cython code score-0 '>            __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_extr(__pyx_v_nvert, __pyx_v_lspoly_view, __pyx_v_bounds);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0276</span>:                         lim_min = 0.</pre>
<pre class='cython code score-0 '>            __pyx_v_lim_min = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0277</span>:                         lim_max = 0.</pre>
<pre class='cython code score-0 '>            __pyx_v_lim_max = 0.;
          }
          __pyx_L32:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0278</span>:                     langles[ind_struct*2] = lim_min</pre>
<pre class='cython code score-0 '>          (__pyx_v_langles[(__pyx_v_ind_struct * 2)]) = __pyx_v_lim_min;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0279</span>:                     langles[ind_struct*2 + 1] = lim_max</pre>
<pre class='cython code score-0 '>          (__pyx_v_langles[((__pyx_v_ind_struct * 2) + 1)]) = __pyx_v_lim_max;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0280</span>:                     for kk in range(6):</pre>
<pre class='cython code score-0 '>          for (__pyx_t_56 = 0; __pyx_t_56 &lt; 6; __pyx_t_56+=1) {
            __pyx_v_kk = __pyx_t_56;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0281</span>:                         lbounds[ind_struct*6 + kk] = bounds[kk]</pre>
<pre class='cython code score-0 '>            (__pyx_v_lbounds[((__pyx_v_ind_struct * 6) + __pyx_v_kk)]) = (__pyx_v_bounds[__pyx_v_kk]);
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0282</span>:                     ind_struct = 1 + ind_struct</pre>
<pre class='cython code score-0 '>          __pyx_v_ind_struct = (1 + __pyx_v_ind_struct);
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0283</span>:             # end loops over structures</pre>
<pre class="cython line score-0">&#xA0;<span class="">0284</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0285</span>:             # -- Computing intersection between structures and LOS -------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0286</span>:             raytracing_inout_struct_tor(num_los, ray_vdir, ray_orig,</pre>
<pre class='cython code score-0 '>      __pyx_f_4tofu_4geom_8_GG03_LM_raytracing_inout_struct_tor(__pyx_v_num_los, __pyx_v_ray_vdir, __pyx_v_ray_orig, __pyx_t_33, __pyx_t_32, __pyx_t_17, __pyx_v_lstruct_nlim, __pyx_t_34, __pyx_v_forbid0, __pyx_v_forbidbis, __pyx_v_rmin, __pyx_v_rmin2, __pyx_v_Crit2_base, __pyx_v_nstruct_lim, __pyx_v_lbounds, __pyx_v_langles, __pyx_v_llimits, __pyx_v_lnvert, __pyx_v_lsz_lim, __pyx_v_lpolyx, __pyx_v_lpolyy, __pyx_v_lnormx, __pyx_v_lnormy, __pyx_v_eps_uz, __pyx_v_eps_vz, __pyx_v_eps_a, __pyx_v_eps_b, __pyx_v_eps_plane, __pyx_v_num_threads, 1);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_33, 1);
      __pyx_t_33.memview = NULL;
      __pyx_t_33.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_32, 1);
      __pyx_t_32.memview = NULL;
      __pyx_t_32.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
      __pyx_t_17.memview = NULL;
      __pyx_t_17.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_34, 1);
      __pyx_t_34.memview = NULL;
      __pyx_t_34.data = NULL;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0287</span>:                                         coeff_inter_out, coeff_inter_in,</pre>
<pre class='cython code score-4 '>      __pyx_t_33 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_coeff_inter_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_33.memview)) __PYX_ERR(0, 287, __pyx_L1_error)</span>
      __pyx_t_32 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_coeff_inter_in), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_32.memview)) __PYX_ERR(0, 287, __pyx_L1_error)</span>
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0288</span>:                                         vperp_out, lstruct_nlim, ind_inter_out,</pre>
<pre class='cython code score-4 '>      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_double</span>(((PyObject *)__pyx_v_vperp_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
      __pyx_t_34 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_int</span>(((PyObject *)__pyx_v_ind_inter_out), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_34.memview)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0289</span>:                                         forbid0, forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0290</span>:                                         rmin, rmin2, Crit2_base,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0291</span>:                                         nstruct_lim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0292</span>:                                         lbounds, langles, llimits,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0293</span>:                                         lnvert, lsz_lim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0294</span>:                                         lpolyx, lpolyy, lnormx, lnormy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0295</span>:                                         eps_uz, eps_vz, eps_a, eps_b, eps_plane,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0296</span>:                                         num_threads,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0297</span>:                                         True) # the structure is "OUT"</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0298</span>:             free(lpolyx)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lpolyx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0299</span>:             free(lpolyy)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lpolyy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0300</span>:             free(lnormx)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lnormx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0301</span>:             free(lnormy)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lnormy);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0302</span>:             free(lnvert)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lnvert);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0303</span>:             free(lsz_lim)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_lsz_lim);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0304</span>:             free(llimits)</pre>
<pre class='cython code score-0 '>      free(__pyx_v_llimits);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0305</span>:             del(lspoly_view)</pre>
<pre class='cython code score-2 '>      if (unlikely(!__pyx_v_lspoly_view.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("lspoly_view"); <span class='error_goto'>__PYX_ERR(0, 305, __pyx_L1_error)</span> }
      __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lspoly_view, 1);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0306</span>:             del(lsvin_view)</pre>
<pre class='cython code score-2 '>      if (unlikely(!__pyx_v_lsvin_view.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("lsvin_view"); <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span> }
      __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lsvin_view, 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0307</span>:             # end if nstruct &gt; 0</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0308</span>:     free(lbounds)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_lbounds);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0309</span>:     free(langles)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_langles);
</pre><pre class="cython line score-0">&#xA0;<span class="">0310</span>: </pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0311</span>:     return np.asarray(coeff_inter_in), np.asarray(coeff_inter_out),\</pre>
<pre class='cython code score-48 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_12, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  __pyx_t_9 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_12, ((PyObject *)__pyx_v_coeff_inter_in)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, ((PyObject *)__pyx_v_coeff_inter_in));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_12, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_11 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_12, ((PyObject *)__pyx_v_coeff_inter_out)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, ((PyObject *)__pyx_v_coeff_inter_out));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 3, __pyx_t_10);
  __pyx_t_9 = 0;
  __pyx_t_11 = 0;
  __pyx_t_1 = 0;
  __pyx_t_10 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0312</span>:            np.asarray(vperp_out), np.asarray(ind_inter_out, dtype=int)</pre>
<pre class='cython code score-43 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_12, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_19))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_19);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_19, function);
    }
  }
  __pyx_t_1 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_19, __pyx_t_12, ((PyObject *)__pyx_v_vperp_out)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_19, ((PyObject *)__pyx_v_vperp_out));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_19, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_19, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  __pyx_t_19 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_ind_inter_out));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_ind_inter_out));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_19, 0, ((PyObject *)__pyx_v_ind_inter_out));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_dtype, ((PyObject *)(&amp;PyInt_Type))) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_12, __pyx_t_19, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0313</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0315</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0316</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0317</span>: cdef inline void raytracing_inout_struct_tor(int num_los,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_raytracing_inout_struct_tor(CYTHON_UNUSED int __pyx_v_num_los, __Pyx_memviewslice __pyx_v_ray_vdir, __Pyx_memviewslice __pyx_v_ray_orig, __Pyx_memviewslice __pyx_v_coeff_inter_out, __Pyx_memviewslice __pyx_v_coeff_inter_in, __Pyx_memviewslice __pyx_v_vperp_out, __Pyx_memviewslice __pyx_v_lstruct_nlim, __Pyx_memviewslice __pyx_v_ind_inter_out, int __pyx_v_forbid0, int __pyx_v_forbidbis, double __pyx_v_rmin, double __pyx_v_rmin2, double __pyx_v_crit2_base, int __pyx_v_nstruct_lim, double *__pyx_v_lbounds, double *__pyx_v_langles, int *__pyx_v_lis_limited, int *__pyx_v_lnvert, long *__pyx_v_lsz_lim, double *__pyx_v_lstruct_polyx, double *__pyx_v_lstruct_polyy, double *__pyx_v_lstruct_normx, double *__pyx_v_lstruct_normy, double __pyx_v_eps_uz, double __pyx_v_eps_vz, double __pyx_v_eps_a, double __pyx_v_eps_b, double __pyx_v_eps_plane, int __pyx_v_num_threads, int __pyx_v_is_out_struct) {
  double __pyx_v_upscaDp;
  double __pyx_v_upar2;
  double __pyx_v_dpar2;
  double __pyx_v_crit2;
  double __pyx_v_idpar2;
  double __pyx_v_dist;
  double __pyx_v_s1x;
  double __pyx_v_s1y;
  double __pyx_v_s2x;
  double __pyx_v_s2y;
  double __pyx_v_lim_min;
  double __pyx_v_lim_max;
  double __pyx_v_invuz;
  int __pyx_v_totnvert;
  int __pyx_v_nvert;
  int __pyx_v_ind_struct;
  int __pyx_v_ind_los;
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_kk;
  int __pyx_v_lim_is_none;
  int __pyx_v_found_new_kout;
  int __pyx_v_inter_bbox;
  double *__pyx_v_lstruct_polyxii;
  double *__pyx_v_lstruct_polyyii;
  double *__pyx_v_lstruct_normxii;
  double *__pyx_v_lstruct_normyii;
  double *__pyx_v_last_pout;
  double *__pyx_v_kpout_loc;
  double *__pyx_v_kpin_loc;
  double *__pyx_v_invr_ray;
  double *__pyx_v_loc_org;
  double *__pyx_v_loc_dir;
  double *__pyx_v_lim_ves;
  double *__pyx_v_loc_vp;
  double *__pyx_v_bounds;
  int *__pyx_v_sign_ray;
  int *__pyx_v_ind_loc;
/* … */
  /* function exit code */
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0318</span>:                                              double[:,::1] ray_vdir,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0319</span>:                                              double[:,::1] ray_orig,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0320</span>:                                              double[::1] coeff_inter_out,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0321</span>:                                              double[::1] coeff_inter_in,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0322</span>:                                              double[::1] vperp_out,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0323</span>:                                              long[::1] lstruct_nlim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0324</span>:                                              int[::1] ind_inter_out,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0325</span>:                                              bint forbid0, bint forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0326</span>:                                              double rmin, double rmin2,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0327</span>:                                              double crit2_base,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0328</span>:                                              int nstruct_lim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0329</span>:                                              double* lbounds, double* langles,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0330</span>:                                              int* lis_limited, int* lnvert,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0331</span>:                                              long* lsz_lim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0332</span>:                                              double* lstruct_polyx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0333</span>:                                              double* lstruct_polyy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0334</span>:                                              double* lstruct_normx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0335</span>:                                              double* lstruct_normy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0336</span>:                                              double eps_uz, double eps_vz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0337</span>:                                              double eps_a, double eps_b,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0338</span>:                                              double eps_plane,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0339</span>:                                              int num_threads,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0340</span>:                                              bint is_out_struct) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">0341</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">0342</span>:     Computes the entry and exit point of all provided LOS/rays for a set of</pre>
<pre class="cython line score-0">&#xA0;<span class="">0343</span>:     structures that can be of type "OUT" (is_out_struct=True) or "IN"</pre>
<pre class="cython line score-0">&#xA0;<span class="">0344</span>:     (is_out_struct=False) in a TORE. An "OUT" structure cannot be penetrated</pre>
<pre class="cython line score-0">&#xA0;<span class="">0345</span>:     whereas an "IN" structure can. The latter is typically a vessel and are</pre>
<pre class="cython line score-0">&#xA0;<span class="">0346</span>:     toroidally continous. If a structure is limited we can determine the number</pre>
<pre class="cython line score-0">&#xA0;<span class="">0347</span>:     of limits and the limits itself. For optimization reasons we will also pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">0348</span>:     the bounding box limits. And the information of the last intersected point,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0349</span>:     if any.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0350</span>:     This functions is parallelized.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0351</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0352</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">0353</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">0354</span>:     num_los : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0355</span>:        Total number of lines of sight (LOS) (aka. rays)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0356</span>:     ray_vdir : (3, num_los) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0357</span>:        LOS normalized direction vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">0358</span>:     ray_orig : (3, num_los) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0359</span>:        LOS origin points coordinates</pre>
<pre class="cython line score-0">&#xA0;<span class="">0360</span>:     coeff_inter_out : (num_los) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0361</span>:        Coefficient of exit (kout) of the last point of intersection for each LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0362</span>:        with the global geometry (with ALL structures)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0363</span>:     coeff_inter_in : (num_los) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0364</span>:        Coefficient of entry (kin) of the last point of intersection for each LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0365</span>:        with the global geometry (with ALL structures). If intersection at origin</pre>
<pre class="cython line score-0">&#xA0;<span class="">0366</span>:        k = 0, if no intersection k = NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">0367</span>:     vperp_out : (3*num_los) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0368</span>:        Coordinates of the normal vector of impact of the LOS (0 if none). It is</pre>
<pre class="cython line score-0">&#xA0;<span class="">0369</span>:        stored in the following way [v_{0,x}, v_{0,y}, v_{0,z}, ..., v_{n-1,z}]</pre>
<pre class="cython line score-0">&#xA0;<span class="">0370</span>:     lstruct_nlim : array of ints</pre>
<pre class="cython line score-0">&#xA0;<span class="">0371</span>:        List of number of limits for all structures</pre>
<pre class="cython line score-0">&#xA0;<span class="">0372</span>:     ind_inter_out : (3 * num_los)  &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0373</span>:        Index of structure impacted by LOS such that:</pre>
<pre class="cython line score-0">&#xA0;<span class="">0374</span>:                 ind_inter_out[ind_los*3:ind_los*3+3]=(i,j,k)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0375</span>:        where k is the index of edge impacted on the j-th sub structure of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0376</span>:        structure number i. If the LOS impacted the vessel i=j=0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0377</span>:     forbid0 : bool</pre>
<pre class="cython line score-0">&#xA0;<span class="">0378</span>:        Should we forbid values behind vissible radius ? (see Rmin). If false,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0379</span>:        will test "hidden" part always, else, it will depend on the LOS and</pre>
<pre class="cython line score-0">&#xA0;<span class="">0380</span>:        on forbidbis.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0381</span>:     forbidbis: bint</pre>
<pre class="cython line score-0">&#xA0;<span class="">0382</span>:        Should we forbid values behind vissible radius for each LOS ?</pre>
<pre class="cython line score-0">&#xA0;<span class="">0383</span>:     rmin : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0384</span>:        Minimal radius of vessel to take into consideration</pre>
<pre class="cython line score-0">&#xA0;<span class="">0385</span>:     rmin2 : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0386</span>:        Squared valued of the minimal radius</pre>
<pre class="cython line score-0">&#xA0;<span class="">0387</span>:     crit2_base : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0388</span>:        Critical value to evaluate for each LOS if horizontal or not</pre>
<pre class="cython line score-0">&#xA0;<span class="">0389</span>:     nstruct_lim : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0390</span>:        Number of OUT structures (not counting the limited versions).</pre>
<pre class="cython line score-0">&#xA0;<span class="">0391</span>:        If not is_out_struct then lenght of vpoly.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0392</span>:     lbounds : (6 * ntotstruct) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0393</span>:        Coordinates of lower and upper edges of the bounding box for each</pre>
<pre class="cython line score-0">&#xA0;<span class="">0394</span>:        structures (ntotstruct = sum_i(nstruct_lim * lsz_lim[i])</pre>
<pre class="cython line score-0">&#xA0;<span class="">0395</span>:        If not is_out_struct then NULL</pre>
<pre class="cython line score-0">&#xA0;<span class="">0396</span>:     langles : (2 * ntotstruct) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0397</span>:        Minimum and maximum angles where the structure lives. If the structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0398</span>:        number 'i' is toroidally continous then langles[i:i+2] = [0, 0].</pre>
<pre class="cython line score-0">&#xA0;<span class="">0399</span>:     lis_limited : (ntotstruct) int array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0400</span>:        List of bool to know if the structures (or the vessel) is limited or not.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0401</span>:     lnvert : (nstruct_lim) int array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0402</span>:        List of vertices of each polygon for each structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0403</span>:        If not is_out_struct then NULL</pre>
<pre class="cython line score-0">&#xA0;<span class="">0404</span>:     lsz_lim : (ntotstruct) int array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0405</span>:        List of the total number of structures before the ith structure. First</pre>
<pre class="cython line score-0">&#xA0;<span class="">0406</span>:        element is always 0, else lsz_lim[i] = sum_j(lstruct_nlim[j], j=0..i-1)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0407</span>:        If not is_out_struct then NULL</pre>
<pre class="cython line score-0">&#xA0;<span class="">0408</span>:     lstruct_polyx : (ntotnvert)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0409</span>:        List of "x" coordinates of the polygon's vertices of all structures on</pre>
<pre class="cython line score-0">&#xA0;<span class="">0410</span>:        the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">0411</span>:     lstruct_polyy : (ntotnvert)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0412</span>:        List of "y" coordinates of the polygon's vertices of all structures on</pre>
<pre class="cython line score-0">&#xA0;<span class="">0413</span>:        the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">0414</span>:     lstruct_normx : (2, num_vertex-1) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0415</span>:        List of "x" coordinates of the normal vectors going "inwards" of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0416</span>:         edges of the Polygon defined by lstruct_poly</pre>
<pre class="cython line score-0">&#xA0;<span class="">0417</span>:     lstruct_normy : (2, num_vertex-1) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0418</span>:        List of "y" coordinates of the normal vectors going "inwards" of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0419</span>:         edges of the Polygon defined by lstruct_poly</pre>
<pre class="cython line score-0">&#xA0;<span class="">0420</span>:     eps&lt;val&gt; : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0421</span>:        Small value, acceptance of error</pre>
<pre class="cython line score-0">&#xA0;<span class="">0422</span>:     num_threads : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0423</span>:        The num_threads argument indicates how many threads the team should</pre>
<pre class="cython line score-0">&#xA0;<span class="">0424</span>:        consist of. If not given, OpenMP will decide how many threads to use.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0425</span>:        Typically this is the number of cores available on the machine.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0426</span>:     is_out_struct : bint</pre>
<pre class="cython line score-0">&#xA0;<span class="">0427</span>:        Bool to determine if the structure is "OUT" or "IN". An "OUT" structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0428</span>:        cannot be penetrated whereas an "IN" structure can. The latter is</pre>
<pre class="cython line score-0">&#xA0;<span class="">0429</span>:        typically a vessel and are toroidally continous.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0430</span>:     """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0431</span>:     cdef double upscaDp=0., upar2=0., dpar2=0., crit2=0., idpar2=0.</pre>
<pre class='cython code score-0 '>  __pyx_v_upscaDp = 0.;
  __pyx_v_upar2 = 0.;
  __pyx_v_dpar2 = 0.;
  __pyx_v_crit2 = 0.;
  __pyx_v_idpar2 = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0432</span>:     cdef double dist = 0., s1x = 0., s1y = 0., s2x = 0., s2y = 0.</pre>
<pre class='cython code score-0 '>  __pyx_v_dist = 0.;
  __pyx_v_s1x = 0.;
  __pyx_v_s1y = 0.;
  __pyx_v_s2x = 0.;
  __pyx_v_s2y = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0433</span>:     cdef double lim_min=0., lim_max=0., invuz=0.</pre>
<pre class='cython code score-0 '>  __pyx_v_lim_min = 0.;
  __pyx_v_lim_max = 0.;
  __pyx_v_invuz = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0434</span>:     cdef int totnvert=0</pre>
<pre class='cython code score-0 '>  __pyx_v_totnvert = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0435</span>:     cdef int nvert</pre>
<pre class="cython line score-0">&#xA0;<span class="">0436</span>:     cdef int ind_struct, ind_bounds</pre>
<pre class="cython line score-0">&#xA0;<span class="">0437</span>:     cdef int ind_los, ii, jj, kk</pre>
<pre class="cython line score-0">&#xA0;<span class="">0438</span>:     cdef bint lim_is_none</pre>
<pre class="cython line score-0">&#xA0;<span class="">0439</span>:     cdef bint found_new_kout</pre>
<pre class="cython line score-0">&#xA0;<span class="">0440</span>:     cdef bint inter_bbox</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0441</span>:     cdef double* lstruct_polyxii = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lstruct_polyxii = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0442</span>:     cdef double* lstruct_polyyii = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lstruct_polyyii = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0443</span>:     cdef double* lstruct_normxii = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lstruct_normxii = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0444</span>:     cdef double* lstruct_normyii = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lstruct_normyii = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0445</span>:     cdef double* last_pout = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_last_pout = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0446</span>:     cdef double* kpout_loc = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_kpout_loc = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0447</span>:     cdef double* kpin_loc = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_kpin_loc = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0448</span>:     cdef double* invr_ray = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_invr_ray = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0449</span>:     cdef double* loc_org = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_loc_org = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0450</span>:     cdef double* loc_dir = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_loc_dir = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0451</span>:     cdef double* lim_ves = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_lim_ves = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0452</span>:     cdef double* loc_vp = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_loc_vp = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0453</span>:     cdef double* bounds = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_bounds = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0454</span>:     cdef int* sign_ray = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_sign_ray = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0455</span>:     cdef int* ind_loc = NULL</pre>
<pre class='cython code score-0 '>  __pyx_v_ind_loc = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0456</span>:     # == Defining parallel part ================================================</pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0457</span>:     with nogil, parallel(num_threads=num_threads):</pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            #ifdef _OPENMP
            #pragma omp parallel private(__pyx_v_bounds, __pyx_v_ind_loc, __pyx_v_invr_ray, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_last_pout, __pyx_v_lim_ves, __pyx_v_loc_dir, __pyx_v_loc_org, __pyx_v_loc_vp, __pyx_v_sign_ray)        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            #ifdef _OPENMP
            #pragma omp parallel private(__pyx_v_bounds, __pyx_v_ind_loc, __pyx_v_invr_ray, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_last_pout, __pyx_v_lim_ves, __pyx_v_loc_dir, __pyx_v_loc_org, __pyx_v_loc_vp, __pyx_v_sign_ray) num_threads(__pyx_v_num_threads)
            #endif /* _OPENMP */
            {
                /* Initialize private variables to invalid values */
                __pyx_v_bounds = ((double *)1);
                __pyx_v_ind_loc = ((int *)1);
                __pyx_v_invr_ray = ((double *)1);
                __pyx_v_kpin_loc = ((double *)1);
                __pyx_v_kpout_loc = ((double *)1);
                __pyx_v_last_pout = ((double *)1);
                __pyx_v_lim_ves = ((double *)1);
                __pyx_v_loc_dir = ((double *)1);
                __pyx_v_loc_org = ((double *)1);
                __pyx_v_loc_vp = ((double *)1);
                __pyx_v_sign_ray = ((int *)1);
/* … */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L5;
        }
        __pyx_L5:;
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0458</span>:         # We use local arrays for each thread so</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0459</span>:         loc_org   = &lt;double *&gt; malloc(sizeof(double) * 3)</pre>
<pre class='cython code score-0 '>                __pyx_v_loc_org = ((double *)malloc(((sizeof(double)) * 3)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0460</span>:         loc_dir   = &lt;double *&gt; malloc(sizeof(double) * 3)</pre>
<pre class='cython code score-0 '>                __pyx_v_loc_dir = ((double *)malloc(((sizeof(double)) * 3)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0461</span>:         loc_vp    = &lt;double *&gt; malloc(sizeof(double) * 3)</pre>
<pre class='cython code score-0 '>                __pyx_v_loc_vp = ((double *)malloc(((sizeof(double)) * 3)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0462</span>:         kpin_loc  = &lt;double *&gt; malloc(sizeof(double) * 1)</pre>
<pre class='cython code score-0 '>                __pyx_v_kpin_loc = ((double *)malloc(((sizeof(double)) * 1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0463</span>:         kpout_loc = &lt;double *&gt; malloc(sizeof(double) * 1)</pre>
<pre class='cython code score-0 '>                __pyx_v_kpout_loc = ((double *)malloc(((sizeof(double)) * 1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0464</span>:         ind_loc   = &lt;int *&gt; malloc(sizeof(int) * 1)</pre>
<pre class='cython code score-0 '>                __pyx_v_ind_loc = ((int *)malloc(((sizeof(int)) * 1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0465</span>:         if is_out_struct:</pre>
<pre class='cython code score-0 '>                __pyx_t_1 = (__pyx_v_is_out_struct != 0);
                if (__pyx_t_1) {
/* … */
                }
</pre><pre class="cython line score-0">&#xA0;<span class="">0466</span>:             # if the structure is "out" (solid) we need more arrays</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0467</span>:             last_pout = &lt;double *&gt; malloc(sizeof(double) * 3)</pre>
<pre class='cython code score-0 '>                  __pyx_v_last_pout = ((double *)malloc(((sizeof(double)) * 3)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0468</span>:             invr_ray  = &lt;double *&gt; malloc(sizeof(double) * 3)</pre>
<pre class='cython code score-0 '>                  __pyx_v_invr_ray = ((double *)malloc(((sizeof(double)) * 3)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0469</span>:             lim_ves   = &lt;double *&gt; malloc(sizeof(double) * 2)</pre>
<pre class='cython code score-0 '>                  __pyx_v_lim_ves = ((double *)malloc(((sizeof(double)) * 2)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0470</span>:             bounds    = &lt;double *&gt; malloc(sizeof(double) * 6)</pre>
<pre class='cython code score-0 '>                  __pyx_v_bounds = ((double *)malloc(((sizeof(double)) * 6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0471</span>:             sign_ray  = &lt;int *&gt; malloc(sizeof(int) * 3)</pre>
<pre class='cython code score-0 '>                  __pyx_v_sign_ray = ((int *)malloc(((sizeof(int)) * 3)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0472</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0473</span>:         # == The parallelization over the LOS ==================================</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0474</span>:         for ind_los in prange(num_los, schedule='dynamic'):</pre>
<pre class='cython code score-0 '>                __pyx_t_2 = __pyx_v_num_los;
                if (1 == 0) abort();
                {
                    __pyx_t_4 = (__pyx_t_2 - 0 + 1 - 1/abs(1)) / 1;
                    if (__pyx_t_4 &gt; 0)
                    {
                        #ifdef _OPENMP
                        #pragma omp for lastprivate(__pyx_v_crit2) lastprivate(__pyx_v_dist) lastprivate(__pyx_v_dpar2) lastprivate(__pyx_v_forbidbis) lastprivate(__pyx_v_found_new_kout) lastprivate(__pyx_v_idpar2) lastprivate(__pyx_v_ii) firstprivate(__pyx_v_ind_los) lastprivate(__pyx_v_ind_los) lastprivate(__pyx_v_ind_struct) lastprivate(__pyx_v_inter_bbox) lastprivate(__pyx_v_invuz) lastprivate(__pyx_v_jj) lastprivate(__pyx_v_kk) lastprivate(__pyx_v_lim_is_none) lastprivate(__pyx_v_lim_max) lastprivate(__pyx_v_lim_min) lastprivate(__pyx_v_lstruct_normxii) lastprivate(__pyx_v_lstruct_normyii) lastprivate(__pyx_v_lstruct_polyxii) lastprivate(__pyx_v_lstruct_polyyii) lastprivate(__pyx_v_nvert) lastprivate(__pyx_v_s1x) lastprivate(__pyx_v_s1y) lastprivate(__pyx_v_s2x) lastprivate(__pyx_v_s2y) lastprivate(__pyx_v_totnvert) lastprivate(__pyx_v_upar2) lastprivate(__pyx_v_upscaDp) schedule(dynamic)
                        #endif /* _OPENMP */
                        for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_4; __pyx_t_3++){
                            {
                                __pyx_v_ind_los = (int)(0 + 1 * __pyx_t_3);
                                /* Initialize private variables to invalid values */
                                __pyx_v_crit2 = ((double)__PYX_NAN());
                                __pyx_v_dist = ((double)__PYX_NAN());
                                __pyx_v_dpar2 = ((double)__PYX_NAN());
                                __pyx_v_forbidbis = ((int)0xbad0bad0);
                                __pyx_v_found_new_kout = ((int)0xbad0bad0);
                                __pyx_v_idpar2 = ((double)__PYX_NAN());
                                __pyx_v_ii = ((int)0xbad0bad0);
                                __pyx_v_ind_struct = ((int)0xbad0bad0);
                                __pyx_v_inter_bbox = ((int)0xbad0bad0);
                                __pyx_v_invuz = ((double)__PYX_NAN());
                                __pyx_v_jj = ((int)0xbad0bad0);
                                __pyx_v_kk = ((int)0xbad0bad0);
                                __pyx_v_lim_is_none = ((int)0xbad0bad0);
                                __pyx_v_lim_max = ((double)__PYX_NAN());
                                __pyx_v_lim_min = ((double)__PYX_NAN());
                                __pyx_v_lstruct_normxii = ((double *)1);
                                __pyx_v_lstruct_normyii = ((double *)1);
                                __pyx_v_lstruct_polyxii = ((double *)1);
                                __pyx_v_lstruct_polyyii = ((double *)1);
                                __pyx_v_nvert = ((int)0xbad0bad0);
                                __pyx_v_s1x = ((double)__PYX_NAN());
                                __pyx_v_s1y = ((double)__PYX_NAN());
                                __pyx_v_s2x = ((double)__PYX_NAN());
                                __pyx_v_s2y = ((double)__PYX_NAN());
                                __pyx_v_totnvert = ((int)0xbad0bad0);
                                __pyx_v_upar2 = ((double)__PYX_NAN());
                                __pyx_v_upscaDp = ((double)__PYX_NAN());
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0475</span>:             ind_struct = 0</pre>
<pre class='cython code score-0 '>                                __pyx_v_ind_struct = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0476</span>:             loc_org[0] = ray_orig[0, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_5 = 0;
                                __pyx_t_6 = __pyx_v_ind_los;
                                (__pyx_v_loc_org[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_orig.data + __pyx_t_5 * __pyx_v_ray_orig.strides[0]) )) + __pyx_t_6)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0477</span>:             loc_org[1] = ray_orig[1, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_7 = 1;
                                __pyx_t_8 = __pyx_v_ind_los;
                                (__pyx_v_loc_org[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_orig.data + __pyx_t_7 * __pyx_v_ray_orig.strides[0]) )) + __pyx_t_8)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0478</span>:             loc_org[2] = ray_orig[2, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_9 = 2;
                                __pyx_t_10 = __pyx_v_ind_los;
                                (__pyx_v_loc_org[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_orig.data + __pyx_t_9 * __pyx_v_ray_orig.strides[0]) )) + __pyx_t_10)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0479</span>:             loc_dir[0] = ray_vdir[0, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_11 = 0;
                                __pyx_t_12 = __pyx_v_ind_los;
                                (__pyx_v_loc_dir[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_vdir.data + __pyx_t_11 * __pyx_v_ray_vdir.strides[0]) )) + __pyx_t_12)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0480</span>:             loc_dir[1] = ray_vdir[1, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_13 = 1;
                                __pyx_t_14 = __pyx_v_ind_los;
                                (__pyx_v_loc_dir[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_vdir.data + __pyx_t_13 * __pyx_v_ray_vdir.strides[0]) )) + __pyx_t_14)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0481</span>:             loc_dir[2] = ray_vdir[2, ind_los]</pre>
<pre class='cython code score-0 '>                                __pyx_t_15 = 2;
                                __pyx_t_16 = __pyx_v_ind_los;
                                (__pyx_v_loc_dir[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_ray_vdir.data + __pyx_t_15 * __pyx_v_ray_vdir.strides[0]) )) + __pyx_t_16)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0482</span>:             loc_vp[0] = 0.</pre>
<pre class='cython code score-0 '>                                (__pyx_v_loc_vp[0]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0483</span>:             loc_vp[1] = 0.</pre>
<pre class='cython code score-0 '>                                (__pyx_v_loc_vp[1]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0484</span>:             loc_vp[2] = 0.</pre>
<pre class='cython code score-0 '>                                (__pyx_v_loc_vp[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0485</span>:             if is_out_struct:</pre>
<pre class='cython code score-0 '>                                __pyx_t_1 = (__pyx_v_is_out_struct != 0);
                                if (__pyx_t_1) {
/* … */
                                  goto __pyx_L15;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">0486</span>:                 # if structure is of "Out" type, then we compute the last</pre>
<pre class="cython line score-0">&#xA0;<span class="">0487</span>:                 # poit where it went out of a structure.</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0488</span>:                 ind_loc[0] = ind_inter_out[2+3*ind_los]</pre>
<pre class='cython code score-0 '>                                  __pyx_t_17 = (2 + (3 * __pyx_v_ind_los));
                                  (__pyx_v_ind_loc[0]) = (*((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_17)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0489</span>:                 kpin_loc[0] = coeff_inter_out[ind_los]</pre>
<pre class='cython code score-0 '>                                  __pyx_t_18 = __pyx_v_ind_los;
                                  (__pyx_v_kpin_loc[0]) = (*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_18)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0490</span>:                 last_pout[0] = kpin_loc[0] * loc_dir[0] + loc_org[0]</pre>
<pre class='cython code score-0 '>                                  (__pyx_v_last_pout[0]) = (((__pyx_v_kpin_loc[0]) * (__pyx_v_loc_dir[0])) + (__pyx_v_loc_org[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0491</span>:                 last_pout[1] = kpin_loc[0] * loc_dir[1] + loc_org[1]</pre>
<pre class='cython code score-0 '>                                  (__pyx_v_last_pout[1]) = (((__pyx_v_kpin_loc[0]) * (__pyx_v_loc_dir[1])) + (__pyx_v_loc_org[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0492</span>:                 last_pout[2] = kpin_loc[0] * loc_dir[2] + loc_org[2]</pre>
<pre class='cython code score-0 '>                                  (__pyx_v_last_pout[2]) = (((__pyx_v_kpin_loc[0]) * (__pyx_v_loc_dir[2])) + (__pyx_v_loc_org[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0493</span>:                 compute_inv_and_sign(loc_dir, sign_ray, invr_ray)</pre>
<pre class='cython code score-0 '>                                  __pyx_f_4tofu_4geom_8_GG03_LM_compute_inv_and_sign(__pyx_v_loc_dir, __pyx_v_sign_ray, __pyx_v_invr_ray);
</pre><pre class="cython line score-0">&#xA0;<span class="">0494</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0495</span>:                 kpout_loc[0] = 0</pre>
<pre class='cython code score-0 '>                                /*else*/ {
                                  (__pyx_v_kpout_loc[0]) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0496</span>:                 kpin_loc[0] = 0</pre>
<pre class='cython code score-0 '>                                  (__pyx_v_kpin_loc[0]) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0497</span>:                 ind_loc[0] = 0</pre>
<pre class='cython code score-0 '>                                  (__pyx_v_ind_loc[0]) = 0;
                                }
                                __pyx_L15:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0498</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0499</span>:             # -- Computing values that depend on the LOS/ray -------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0500</span>:             upscaDp = loc_dir[0]*loc_org[0] + loc_dir[1]*loc_org[1]</pre>
<pre class='cython code score-0 '>                                __pyx_v_upscaDp = (((__pyx_v_loc_dir[0]) * (__pyx_v_loc_org[0])) + ((__pyx_v_loc_dir[1]) * (__pyx_v_loc_org[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0501</span>:             upar2   = loc_dir[0]*loc_dir[0] + loc_dir[1]*loc_dir[1]</pre>
<pre class='cython code score-0 '>                                __pyx_v_upar2 = (((__pyx_v_loc_dir[0]) * (__pyx_v_loc_dir[0])) + ((__pyx_v_loc_dir[1]) * (__pyx_v_loc_dir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0502</span>:             dpar2   = loc_org[0]*loc_org[0] + loc_org[1]*loc_org[1]</pre>
<pre class='cython code score-0 '>                                __pyx_v_dpar2 = (((__pyx_v_loc_org[0]) * (__pyx_v_loc_org[0])) + ((__pyx_v_loc_org[1]) * (__pyx_v_loc_org[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0503</span>:             idpar2 = 1./dpar2</pre>
<pre class='cython code score-0 '>                                __pyx_v_idpar2 = (1. / __pyx_v_dpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0504</span>:             invuz = 1./loc_dir[2]</pre>
<pre class='cython code score-0 '>                                __pyx_v_invuz = (1. / (__pyx_v_loc_dir[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0505</span>:             crit2 = upar2*crit2_base</pre>
<pre class='cython code score-0 '>                                __pyx_v_crit2 = (__pyx_v_upar2 * __pyx_v_crit2_base);
</pre><pre class="cython line score-0">&#xA0;<span class="">0506</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0507</span>:             # -- Prepare in case forbid is True --------------------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0508</span>:             if forbid0 and not dpar2&gt;0:</pre>
<pre class='cython code score-0 '>                                __pyx_t_19 = (__pyx_v_forbid0 != 0);
                                if (__pyx_t_19) {
                                } else {
                                  __pyx_t_1 = __pyx_t_19;
                                  goto __pyx_L17_bool_binop_done;
                                }
                                __pyx_t_19 = ((!((__pyx_v_dpar2 &gt; 0.0) != 0)) != 0);
                                __pyx_t_1 = __pyx_t_19;
                                __pyx_L17_bool_binop_done:;
                                if (__pyx_t_1) {
/* … */
                                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0509</span>:                 forbidbis = 0</pre>
<pre class='cython code score-0 '>                                  __pyx_v_forbidbis = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0510</span>:             if forbidbis:</pre>
<pre class='cython code score-0 '>                                __pyx_t_1 = (__pyx_v_forbidbis != 0);
                                if (__pyx_t_1) {
/* … */
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">0511</span>:                 # Compute coordinates of the 2 points where the tangents touch</pre>
<pre class="cython line score-0">&#xA0;<span class="">0512</span>:                 # the inner circle</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0513</span>:                 dist = Csqrt(dpar2-rmin2)</pre>
<pre class='cython code score-0 '>                                  __pyx_v_dist = sqrt((__pyx_v_dpar2 - __pyx_v_rmin2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0514</span>:                 s1x = (rmin2 * loc_org[0] + rmin * loc_org[1] * dist) * idpar2</pre>
<pre class='cython code score-0 '>                                  __pyx_v_s1x = (((__pyx_v_rmin2 * (__pyx_v_loc_org[0])) + ((__pyx_v_rmin * (__pyx_v_loc_org[1])) * __pyx_v_dist)) * __pyx_v_idpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0515</span>:                 s1y = (rmin2 * loc_org[1] - rmin * loc_org[0] * dist) * idpar2</pre>
<pre class='cython code score-0 '>                                  __pyx_v_s1y = (((__pyx_v_rmin2 * (__pyx_v_loc_org[1])) - ((__pyx_v_rmin * (__pyx_v_loc_org[0])) * __pyx_v_dist)) * __pyx_v_idpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0516</span>:                 s2x = (rmin2 * loc_org[0] - rmin * loc_org[1] * dist) * idpar2</pre>
<pre class='cython code score-0 '>                                  __pyx_v_s2x = (((__pyx_v_rmin2 * (__pyx_v_loc_org[0])) - ((__pyx_v_rmin * (__pyx_v_loc_org[1])) * __pyx_v_dist)) * __pyx_v_idpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0517</span>:                 s2y = (rmin2 * loc_org[1] + rmin * loc_org[0] * dist) * idpar2</pre>
<pre class='cython code score-0 '>                                  __pyx_v_s2y = (((__pyx_v_rmin2 * (__pyx_v_loc_org[1])) + ((__pyx_v_rmin * (__pyx_v_loc_org[0])) * __pyx_v_dist)) * __pyx_v_idpar2);
</pre><pre class="cython line score-0">&#xA0;<span class="">0518</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0519</span>:             # == Case "OUT" structure ==========================================</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0520</span>:             if is_out_struct:</pre>
<pre class='cython code score-0 '>                                __pyx_t_1 = (__pyx_v_is_out_struct != 0);
                                if (__pyx_t_1) {
/* … */
                                  goto __pyx_L20;
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">0521</span>:                 # We work on each structure</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0522</span>:                 for ii in range(nstruct_lim):</pre>
<pre class='cython code score-0 '>                                  __pyx_t_20 = __pyx_v_nstruct_lim;
                                  __pyx_t_21 = __pyx_t_20;
                                  for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_21; __pyx_t_22+=1) {
                                    __pyx_v_ii = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">0523</span>:                     # -- Getting structure's data ------------------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0524</span>:                     if ii == 0:</pre>
<pre class='cython code score-0 '>                                    __pyx_t_1 = ((__pyx_v_ii == 0) != 0);
                                    if (__pyx_t_1) {
/* … */
                                      goto __pyx_L23;
                                    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0525</span>:                         nvert = lnvert[0]</pre>
<pre class='cython code score-0 '>                                      __pyx_v_nvert = (__pyx_v_lnvert[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0526</span>:                         totnvert = 0</pre>
<pre class='cython code score-0 '>                                      __pyx_v_totnvert = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0527</span>:                     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0528</span>:                         totnvert = lnvert[ii-1]</pre>
<pre class='cython code score-0 '>                                    /*else*/ {
                                      __pyx_v_totnvert = (__pyx_v_lnvert[(__pyx_v_ii - 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0529</span>:                         nvert = lnvert[ii] - totnvert</pre>
<pre class='cython code score-0 '>                                      __pyx_v_nvert = ((__pyx_v_lnvert[__pyx_v_ii]) - __pyx_v_totnvert);
                                    }
                                    __pyx_L23:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0530</span>:                     lstruct_polyxii = &lt;double *&gt;malloc((nvert) * sizeof(double))</pre>
<pre class='cython code score-0 '>                                    __pyx_v_lstruct_polyxii = ((double *)malloc((__pyx_v_nvert * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0531</span>:                     lstruct_polyyii = &lt;double *&gt;malloc((nvert) * sizeof(double))</pre>
<pre class='cython code score-0 '>                                    __pyx_v_lstruct_polyyii = ((double *)malloc((__pyx_v_nvert * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0532</span>:                     lstruct_normxii = &lt;double *&gt;malloc((nvert-1)*sizeof(double))</pre>
<pre class='cython code score-0 '>                                    __pyx_v_lstruct_normxii = ((double *)malloc(((__pyx_v_nvert - 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0533</span>:                     lstruct_normyii = &lt;double *&gt;malloc((nvert-1)*sizeof(double))</pre>
<pre class='cython code score-0 '>                                    __pyx_v_lstruct_normyii = ((double *)malloc(((__pyx_v_nvert - 1) * (sizeof(double)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0534</span>:                     for kk in range(nvert-1):</pre>
<pre class='cython code score-0 '>                                    __pyx_t_23 = (__pyx_v_nvert - 1);
                                    __pyx_t_24 = __pyx_t_23;
                                    for (__pyx_t_25 = 0; __pyx_t_25 &lt; __pyx_t_24; __pyx_t_25+=1) {
                                      __pyx_v_kk = __pyx_t_25;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0535</span>:                         lstruct_polyxii[kk] = lstruct_polyx[totnvert + kk]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_lstruct_polyxii[__pyx_v_kk]) = (__pyx_v_lstruct_polyx[(__pyx_v_totnvert + __pyx_v_kk)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0536</span>:                         lstruct_polyyii[kk] = lstruct_polyy[totnvert + kk]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_lstruct_polyyii[__pyx_v_kk]) = (__pyx_v_lstruct_polyy[(__pyx_v_totnvert + __pyx_v_kk)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0537</span>:                         lstruct_normxii[kk] = lstruct_normx[totnvert + kk - ii]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_lstruct_normxii[__pyx_v_kk]) = (__pyx_v_lstruct_normx[((__pyx_v_totnvert + __pyx_v_kk) - __pyx_v_ii)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0538</span>:                         lstruct_normyii[kk] = lstruct_normy[totnvert + kk - ii]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_lstruct_normyii[__pyx_v_kk]) = (__pyx_v_lstruct_normy[((__pyx_v_totnvert + __pyx_v_kk) - __pyx_v_ii)]);
                                    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0539</span>:                     lstruct_polyxii[nvert-1] = lstruct_polyx[totnvert + nvert-1]</pre>
<pre class='cython code score-0 '>                                    (__pyx_v_lstruct_polyxii[(__pyx_v_nvert - 1)]) = (__pyx_v_lstruct_polyx[((__pyx_v_totnvert + __pyx_v_nvert) - 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0540</span>:                     lstruct_polyyii[nvert-1] = lstruct_polyy[totnvert + nvert-1]</pre>
<pre class='cython code score-0 '>                                    (__pyx_v_lstruct_polyyii[(__pyx_v_nvert - 1)]) = (__pyx_v_lstruct_polyy[((__pyx_v_totnvert + __pyx_v_nvert) - 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0541</span>:                     ind_struct = lsz_lim[ii]</pre>
<pre class='cython code score-0 '>                                    __pyx_v_ind_struct = (__pyx_v_lsz_lim[__pyx_v_ii]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0542</span>:                     # -- Working on the structure limited ----------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0543</span>:                     for jj in range(lstruct_nlim[ii]):</pre>
<pre class='cython code score-0 '>                                    __pyx_t_26 = __pyx_v_ii;
                                    __pyx_t_23 = (*((long *) ( /* dim=0 */ ((char *) (((long *) __pyx_v_lstruct_nlim.data) + __pyx_t_26)) )));
                                    __pyx_t_24 = __pyx_t_23;
                                    for (__pyx_t_25 = 0; __pyx_t_25 &lt; __pyx_t_24; __pyx_t_25+=1) {
                                      __pyx_v_jj = __pyx_t_25;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0544</span>:                         bounds[0] = lbounds[(ind_struct + jj)*6]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[0]) = (__pyx_v_lbounds[((__pyx_v_ind_struct + __pyx_v_jj) * 6)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0545</span>:                         bounds[1] = lbounds[(ind_struct + jj)*6 + 1]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[1]) = (__pyx_v_lbounds[(((__pyx_v_ind_struct + __pyx_v_jj) * 6) + 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0546</span>:                         bounds[2] = lbounds[(ind_struct + jj)*6 + 2]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[2]) = (__pyx_v_lbounds[(((__pyx_v_ind_struct + __pyx_v_jj) * 6) + 2)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0547</span>:                         bounds[3] = lbounds[(ind_struct + jj)*6 + 3]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[3]) = (__pyx_v_lbounds[(((__pyx_v_ind_struct + __pyx_v_jj) * 6) + 3)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0548</span>:                         bounds[4] = lbounds[(ind_struct + jj)*6 + 4]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[4]) = (__pyx_v_lbounds[(((__pyx_v_ind_struct + __pyx_v_jj) * 6) + 4)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0549</span>:                         bounds[5] = lbounds[(ind_struct + jj)*6 + 5]</pre>
<pre class='cython code score-0 '>                                      (__pyx_v_bounds[5]) = (__pyx_v_lbounds[(((__pyx_v_ind_struct + __pyx_v_jj) * 6) + 5)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0550</span>:                         lim_min = langles[(ind_struct+jj)*2]</pre>
<pre class='cython code score-0 '>                                      __pyx_v_lim_min = (__pyx_v_langles[((__pyx_v_ind_struct + __pyx_v_jj) * 2)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0551</span>:                         lim_max = langles[(ind_struct+jj)*2 + 1]</pre>
<pre class='cython code score-0 '>                                      __pyx_v_lim_max = (__pyx_v_langles[(((__pyx_v_ind_struct + __pyx_v_jj) * 2) + 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0552</span>:                         lim_is_none = lis_limited[ind_struct+jj] == 1</pre>
<pre class='cython code score-0 '>                                      __pyx_v_lim_is_none = ((__pyx_v_lis_limited[(__pyx_v_ind_struct + __pyx_v_jj)]) == 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">0553</span>:                         # We test if it is really necessary to compute the inter</pre>
<pre class="cython line score-0">&#xA0;<span class="">0554</span>:                         # ie. we check if the ray intersects the bounding box</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0555</span>:                         inter_bbox = inter_ray_aabb_box(sign_ray, invr_ray,</pre>
<pre class='cython code score-0 '>                                      __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_inter_ray_aabb_box(__pyx_v_sign_ray, __pyx_v_invr_ray, __pyx_v_bounds, __pyx_v_loc_org);
</pre><pre class="cython line score-0">&#xA0;<span class="">0556</span>:                                                         bounds, loc_org)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0557</span>:                         if not inter_bbox:</pre>
<pre class='cython code score-0 '>                                      __pyx_t_1 = ((!(__pyx_v_inter_bbox != 0)) != 0);
                                      if (__pyx_t_1) {
/* … */
                                      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0558</span>:                             continue</pre>
<pre class='cython code score-0 '>                                        goto __pyx_L26_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0559</span>:                         # We check that the bounding box is not "behind"</pre>
<pre class="cython line score-0">&#xA0;<span class="">0560</span>:                         # the last POut encountered</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0561</span>:                         inter_bbox = inter_ray_aabb_box(sign_ray, invr_ray,</pre>
<pre class='cython code score-0 '>                                      __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_inter_ray_aabb_box(__pyx_v_sign_ray, __pyx_v_invr_ray, __pyx_v_bounds, __pyx_v_last_pout);
</pre><pre class="cython line score-0">&#xA0;<span class="">0562</span>:                                                         bounds, last_pout)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0563</span>:                         if inter_bbox:</pre>
<pre class='cython code score-0 '>                                      __pyx_t_1 = (__pyx_v_inter_bbox != 0);
                                      if (__pyx_t_1) {
/* … */
                                      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0564</span>:                             continue</pre>
<pre class='cython code score-0 '>                                        goto __pyx_L26_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0565</span>:                          # Else, we compute the new values</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0566</span>:                         found_new_kout = comp_inter_los_vpoly(loc_org,</pre>
<pre class='cython code score-0 '>                                      __pyx_v_found_new_kout = __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(__pyx_v_loc_org, __pyx_v_loc_dir, __pyx_v_lstruct_polyxii, __pyx_v_lstruct_polyyii, __pyx_v_lstruct_normxii, __pyx_v_lstruct_normyii, (__pyx_v_nvert - 1), __pyx_v_lim_is_none, __pyx_v_lim_min, __pyx_v_lim_max, __pyx_v_forbidbis, __pyx_v_upscaDp, __pyx_v_upar2, __pyx_v_dpar2, __pyx_v_invuz, __pyx_v_s1x, __pyx_v_s1y, __pyx_v_s2x, __pyx_v_s2y, __pyx_v_crit2, __pyx_v_eps_uz, __pyx_v_eps_vz, __pyx_v_eps_a, __pyx_v_eps_b, __pyx_v_eps_plane, 0, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_ind_loc, __pyx_v_loc_vp);
</pre><pre class="cython line score-0">&#xA0;<span class="">0567</span>:                                                               loc_dir,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0568</span>:                                                               lstruct_polyxii,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0569</span>:                                                               lstruct_polyyii,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0570</span>:                                                               lstruct_normxii,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0571</span>:                                                               lstruct_normyii,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0572</span>:                                                               nvert-1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0573</span>:                                                               lim_is_none,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0574</span>:                                                               lim_min, lim_max,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0575</span>:                                                               forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0576</span>:                                                               upscaDp, upar2,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0577</span>:                                                               dpar2, invuz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0578</span>:                                                               s1x, s1y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0579</span>:                                                               s2x, s2y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0580</span>:                                                               crit2, eps_uz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0581</span>:                                                               eps_vz, eps_a,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0582</span>:                                                               eps_b, eps_plane,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0583</span>:                                                               False,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0584</span>:                                                               kpin_loc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0585</span>:                                                               kpout_loc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0586</span>:                                                               ind_loc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0587</span>:                                                               loc_vp)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0588</span>:                         if found_new_kout :</pre>
<pre class='cython code score-0 '>                                      __pyx_t_1 = (__pyx_v_found_new_kout != 0);
                                      if (__pyx_t_1) {
/* … */
                                      }
                                      __pyx_L26_continue:;
                                    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0589</span>:                             coeff_inter_out[ind_los] = kpin_loc[0]</pre>
<pre class='cython code score-0 '>                                        __pyx_t_27 = __pyx_v_ind_los;
                                        *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_27)) )) = (__pyx_v_kpin_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0590</span>:                             vperp_out[0+3*ind_los] = loc_vp[0]</pre>
<pre class='cython code score-0 '>                                        __pyx_t_28 = (0 + (3 * __pyx_v_ind_los));
                                        *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_28)) )) = (__pyx_v_loc_vp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0591</span>:                             vperp_out[1+3*ind_los] = loc_vp[1]</pre>
<pre class='cython code score-0 '>                                        __pyx_t_29 = (1 + (3 * __pyx_v_ind_los));
                                        *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_29)) )) = (__pyx_v_loc_vp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0592</span>:                             vperp_out[2+3*ind_los] = loc_vp[2]</pre>
<pre class='cython code score-0 '>                                        __pyx_t_30 = (2 + (3 * __pyx_v_ind_los));
                                        *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_30)) )) = (__pyx_v_loc_vp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0593</span>:                             ind_inter_out[2+3*ind_los] = ind_loc[0]</pre>
<pre class='cython code score-0 '>                                        __pyx_t_31 = (2 + (3 * __pyx_v_ind_los));
                                        *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_31)) )) = (__pyx_v_ind_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0594</span>:                             ind_inter_out[0+3*ind_los] = 1+ii</pre>
<pre class='cython code score-0 '>
                                        /* "tofu/geom/_GG03_LM.pyx":594
 *                             vperp_out[2+3*ind_los] = loc_vp[2]
 *                             ind_inter_out[2+3*ind_los] = ind_loc[0]
 *                             ind_inter_out[0+3*ind_los] = 1+ii             # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
 *                             ind_inter_out[1+3*ind_los] = jj
 *                             last_pout[0] = (coeff_inter_out[ind_los] *
 */
                                        __pyx_t_32 = (0 + (3 * __pyx_v_ind_los));
                                        *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_32)) )) = (1 + __pyx_v_ii);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0595</span>:                             ind_inter_out[1+3*ind_los] = jj</pre>
<pre class='cython code score-0 '>                                        __pyx_t_33 = (1 + (3 * __pyx_v_ind_los));
                                        *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_33)) )) = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0596</span>:                             last_pout[0] = (coeff_inter_out[ind_los] *</pre>
<pre class='cython code score-0 '>
                                        /* "tofu/geom/_GG03_LM.pyx":596
 *                             ind_inter_out[0+3*ind_los] = 1+ii
 *                             ind_inter_out[1+3*ind_los] = jj
 *                             last_pout[0] = (coeff_inter_out[ind_los] *             # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
 *                                             loc_dir[0]) + loc_org[0]
 *                             last_pout[1] = (coeff_inter_out[ind_los] *
 */
                                        __pyx_t_34 = __pyx_v_ind_los;
/* … */
                                        (__pyx_v_last_pout[0]) = (((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_34)) ))) * (__pyx_v_loc_dir[0])) + (__pyx_v_loc_org[0]));
</pre><pre class="cython line score-0">&#xA0;<span class="">0597</span>:                                             loc_dir[0]) + loc_org[0]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0598</span>:                             last_pout[1] = (coeff_inter_out[ind_los] *</pre>
<pre class='cython code score-0 '>
                                        /* "tofu/geom/_GG03_LM.pyx":598
 *                             last_pout[0] = (coeff_inter_out[ind_los] *
 *                                             loc_dir[0]) + loc_org[0]
 *                             last_pout[1] = (coeff_inter_out[ind_los] *             # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
 *                                             loc_dir[1]) + loc_org[1]
 *                             last_pout[2] = (coeff_inter_out[ind_los] *
 */
                                        __pyx_t_35 = __pyx_v_ind_los;
/* … */
                                        (__pyx_v_last_pout[1]) = (((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_35)) ))) * (__pyx_v_loc_dir[1])) + (__pyx_v_loc_org[1]));
</pre><pre class="cython line score-0">&#xA0;<span class="">0599</span>:                                             loc_dir[1]) + loc_org[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0600</span>:                             last_pout[2] = (coeff_inter_out[ind_los] *</pre>
<pre class='cython code score-0 '>                                        __pyx_t_36 = __pyx_v_ind_los;
/* … */
                                        (__pyx_v_last_pout[2]) = (((*((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_36)) ))) * (__pyx_v_loc_dir[2])) + (__pyx_v_loc_org[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">0601</span>:                                             loc_dir[2]) + loc_org[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0602</span>:                     free(lstruct_polyxii)</pre>
<pre class='cython code score-0 '>                                    free(__pyx_v_lstruct_polyxii);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0603</span>:                     free(lstruct_polyyii)</pre>
<pre class='cython code score-0 '>                                    free(__pyx_v_lstruct_polyyii);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0604</span>:                     free(lstruct_normxii)</pre>
<pre class='cython code score-0 '>                                    free(__pyx_v_lstruct_normxii);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0605</span>:                     free(lstruct_normyii)</pre>
<pre class='cython code score-0 '>                                    free(__pyx_v_lstruct_normyii);
                                  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0606</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">0607</span>:                 # == Case "IN" structure =======================================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0608</span>:                 # Nothing to do but compute intersection between vessel and LOS</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0609</span>:                 found_new_kout = comp_inter_los_vpoly(loc_org, loc_dir,</pre>
<pre class='cython code score-0 '>                                /*else*/ {
/* … */
                                  __pyx_v_found_new_kout = __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(__pyx_v_loc_org, __pyx_v_loc_dir, __pyx_v_lstruct_polyx, __pyx_v_lstruct_polyy, __pyx_v_lstruct_normx, __pyx_v_lstruct_normy, __pyx_v_nstruct_lim, (__pyx_v_lis_limited[0]), (__pyx_v_langles[0]), (__pyx_v_langles[1]), __pyx_v_forbidbis, __pyx_v_upscaDp, __pyx_v_upar2, __pyx_v_dpar2, __pyx_v_invuz, __pyx_v_s1x, __pyx_v_s1y, __pyx_v_s2x, __pyx_v_s2y, __pyx_v_crit2, __pyx_v_eps_uz, __pyx_v_eps_vz, __pyx_v_eps_a, __pyx_v_eps_b, __pyx_v_eps_plane, 1, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_ind_loc, __pyx_v_loc_vp);
</pre><pre class="cython line score-0">&#xA0;<span class="">0610</span>:                                                       lstruct_polyx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0611</span>:                                                       lstruct_polyy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0612</span>:                                                       lstruct_normx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0613</span>:                                                       lstruct_normy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0614</span>:                                                       nstruct_lim,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0615</span>:                                                       lis_limited[0],</pre>
<pre class="cython line score-0">&#xA0;<span class="">0616</span>:                                                       langles[0], langles[1],</pre>
<pre class="cython line score-0">&#xA0;<span class="">0617</span>:                                                       forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0618</span>:                                                       upscaDp, upar2,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0619</span>:                                                       dpar2, invuz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0620</span>:                                                       s1x, s1y, s2x, s2y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0621</span>:                                                       crit2, eps_uz, eps_vz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0622</span>:                                                       eps_a,eps_b, eps_plane,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0623</span>:                                                       True,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0624</span>:                                                       kpin_loc, kpout_loc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0625</span>:                                                       ind_loc, loc_vp,)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0626</span>:                 if found_new_kout:</pre>
<pre class='cython code score-0 '>                                  __pyx_t_1 = (__pyx_v_found_new_kout != 0);
                                  if (__pyx_t_1) {
/* … */
                                    goto __pyx_L31;
                                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0627</span>:                     coeff_inter_in[ind_los]  = kpin_loc[0]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_37 = __pyx_v_ind_los;
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_in.data) + __pyx_t_37)) )) = (__pyx_v_kpin_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0628</span>:                     coeff_inter_out[ind_los] = kpout_loc[0]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_38 = __pyx_v_ind_los;
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_38)) )) = (__pyx_v_kpout_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0629</span>:                     ind_inter_out[2+3*ind_los] = ind_loc[0]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_39 = (2 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_39)) )) = (__pyx_v_ind_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0630</span>:                     ind_inter_out[0+3*ind_los] = 0</pre>
<pre class='cython code score-0 '>                                    __pyx_t_40 = (0 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_40)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0631</span>:                     ind_inter_out[1+3*ind_los] = 0</pre>
<pre class='cython code score-0 '>                                    __pyx_t_41 = (1 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_41)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0632</span>:                     vperp_out[0+3*ind_los] = loc_vp[0]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_42 = (0 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_42)) )) = (__pyx_v_loc_vp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0633</span>:                     vperp_out[1+3*ind_los] = loc_vp[1]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_43 = (1 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_43)) )) = (__pyx_v_loc_vp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0634</span>:                     vperp_out[2+3*ind_los] = loc_vp[2]</pre>
<pre class='cython code score-0 '>                                    __pyx_t_44 = (2 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_44)) )) = (__pyx_v_loc_vp[2]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0635</span>:                 else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0636</span>:                     coeff_inter_in[ind_los]  = Cnan</pre>
<pre class='cython code score-0 '>                                  /*else*/ {
                                    __pyx_t_45 = __pyx_v_ind_los;
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_in.data) + __pyx_t_45)) )) = NAN;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0637</span>:                     coeff_inter_out[ind_los] = Cnan</pre>
<pre class='cython code score-0 '>                                    __pyx_t_46 = __pyx_v_ind_los;
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_coeff_inter_out.data) + __pyx_t_46)) )) = NAN;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0638</span>:                     ind_inter_out[2+3*ind_los] = 0</pre>
<pre class='cython code score-0 '>                                    __pyx_t_47 = (2 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_47)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0639</span>:                     ind_inter_out[0+3*ind_los] = 0</pre>
<pre class='cython code score-0 '>                                    __pyx_t_48 = (0 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_48)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0640</span>:                     ind_inter_out[1+3*ind_los] = 0</pre>
<pre class='cython code score-0 '>                                    __pyx_t_49 = (1 + (3 * __pyx_v_ind_los));
                                    *((int *) ( /* dim=0 */ ((char *) (((int *) __pyx_v_ind_inter_out.data) + __pyx_t_49)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0641</span>:                     vperp_out[0+3*ind_los] = 0.</pre>
<pre class='cython code score-0 '>                                    __pyx_t_50 = (0 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_50)) )) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0642</span>:                     vperp_out[1+3*ind_los] = 0.</pre>
<pre class='cython code score-0 '>                                    __pyx_t_51 = (1 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_51)) )) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0643</span>:                     vperp_out[2+3*ind_los] = 0.</pre>
<pre class='cython code score-0 '>                                    __pyx_t_52 = (2 + (3 * __pyx_v_ind_los));
                                    *((double *) ( /* dim=0 */ ((char *) (((double *) __pyx_v_vperp_out.data) + __pyx_t_52)) )) = 0.;
                                  }
                                  __pyx_L31:;
                                }
                                __pyx_L20:;
                            }
                        }
                    }
                }
</pre><pre class="cython line score-0">&#xA0;<span class="">0644</span>:             # end case IN/OUT</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0645</span>:         free(loc_org)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_loc_org);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0646</span>:         free(loc_dir)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_loc_dir);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0647</span>:         free(loc_vp)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_loc_vp);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0648</span>:         free(kpin_loc)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_kpin_loc);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0649</span>:         free(kpout_loc)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_kpout_loc);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0650</span>:         free(ind_loc)</pre>
<pre class='cython code score-0 '>                free(__pyx_v_ind_loc);
</pre><pre class="cython line score-0">&#xA0;<span class="">0651</span>:         # end loop over LOS</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0652</span>:         if is_out_struct:</pre>
<pre class='cython code score-0 '>                __pyx_t_1 = (__pyx_v_is_out_struct != 0);
                if (__pyx_t_1) {
/* … */
                }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0653</span>:             free(last_pout)</pre>
<pre class='cython code score-0 '>                  free(__pyx_v_last_pout);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0654</span>:             free(bounds)</pre>
<pre class='cython code score-0 '>                  free(__pyx_v_bounds);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0655</span>:             free(lim_ves)</pre>
<pre class='cython code score-0 '>                  free(__pyx_v_lim_ves);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0656</span>:             free(invr_ray)</pre>
<pre class='cython code score-0 '>                  free(__pyx_v_invr_ray);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0657</span>:             free(sign_ray)</pre>
<pre class='cython code score-0 '>                  free(__pyx_v_sign_ray);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0658</span>:     return</pre>
<pre class='cython code score-0 '>  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0659</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0660</span>: cdef inline bint comp_inter_los_vpoly(const double[3] ray_orig,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(double *__pyx_v_ray_orig, double *__pyx_v_ray_vdir, double const *__pyx_v_lpolyx, double const *__pyx_v_lpolyy, double const *__pyx_v_normx, double const *__pyx_v_normy, int const __pyx_v_nvert, int const __pyx_v_lim_is_none, double const __pyx_v_lim_min, double const __pyx_v_lim_max, int const __pyx_v_forbidbis, double const __pyx_v_upscaDp, double const __pyx_v_upar2, double const __pyx_v_dpar2, double const __pyx_v_invuz, double const __pyx_v_s1x, double const __pyx_v_s1y, double const __pyx_v_s2x, double const __pyx_v_s2y, double const __pyx_v_crit2, CYTHON_UNUSED double const __pyx_v_eps_uz, double const __pyx_v_eps_vz, double const __pyx_v_eps_a, double const __pyx_v_eps_b, double const __pyx_v_eps_pln, int const __pyx_v_is_in_struct, double *__pyx_v_kpin_loc, double *__pyx_v_kpout_loc, int *__pyx_v_ind_loc, double *__pyx_v_vperpin) {
  int __pyx_v_jj;
  int __pyx_v_done;
  int __pyx_v_indin;
  int __pyx_v_indout;
  int __pyx_v_inter_bbox;
  double __pyx_v_kout;
  double __pyx_v_kin;
  double __pyx_v_res_kin;
  double __pyx_v_sca;
  double __pyx_v_sca0;
  double __pyx_v_sca1;
  double __pyx_v_sca2;
  double __pyx_v_q;
  double __pyx_v_coeff;
  double __pyx_v_delta;
  double __pyx_v_sqd;
  double __pyx_v_k;
  double __pyx_v_sol0;
  double __pyx_v_sol1;
  double __pyx_v_phi;
  double __pyx_v_v0;
  double __pyx_v_v1;
  double __pyx_v_val_a;
  double __pyx_v_val_b;
  double __pyx_v_ephi_in0;
  double __pyx_v_ephi_in1;
  double __pyx_v_sout1;
  double __pyx_v_sout0;
  double __pyx_v_sin1;
  double __pyx_v_sin0;
  double __pyx_v_invupar2;
  double __pyx_v_cosl0;
  double __pyx_v_cosl1;
  double __pyx_v_sinl0;
  double __pyx_v_sinl1;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0661</span>:                                       const double[3] ray_vdir,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0662</span>:                                       const double* lpolyx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0663</span>:                                       const double* lpolyy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0664</span>:                                       const double* normx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0665</span>:                                       const double* normy,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0666</span>:                                       const int nvert,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0667</span>:                                       const bint lim_is_none,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0668</span>:                                       const double lim_min,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0669</span>:                                       const double lim_max,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0670</span>:                                       const bint forbidbis,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0671</span>:                                       const double upscaDp, const double upar2,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0672</span>:                                       const double dpar2, const double invuz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0673</span>:                                       const double s1x,   const double s1y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0674</span>:                                       const double s2x, const double s2y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0675</span>:                                       const double crit2, const double eps_uz,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0676</span>:                                       const double eps_vz, const double eps_a,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0677</span>:                                       const double eps_b, const double eps_pln,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0678</span>:                                       const bint is_in_struct,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0679</span>:                                       double[1] kpin_loc, double[1] kpout_loc,</pre>
<pre class="cython line score-0">&#xA0;<span class="">0680</span>:                                       int[1] ind_loc, double[3] vperpin) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">0681</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">0682</span>:     Computes the entry and exit point of ONE provided LOS/rays for a single</pre>
<pre class="cython line score-0">&#xA0;<span class="">0683</span>:     structure that can be of type "OUT" (is_out_struct=True) or "IN"</pre>
<pre class="cython line score-0">&#xA0;<span class="">0684</span>:     (is_out_struct=False). An "OUT" structure cannot be penetrated whereas an</pre>
<pre class="cython line score-0">&#xA0;<span class="">0685</span>:     "IN" structure can. The latter is typically a vessel and are toroidally</pre>
<pre class="cython line score-0">&#xA0;<span class="">0686</span>:     continous. If a structure is limited we can determine the number of limits</pre>
<pre class="cython line score-0">&#xA0;<span class="">0687</span>:     and the limits itself. For optimization reasons we will also pass the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0688</span>:     bounding box limits. And the information of the last intersected point, if</pre>
<pre class="cython line score-0">&#xA0;<span class="">0689</span>:     any.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0690</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0691</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">0692</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">0693</span>:     ray_vdir : (3) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0694</span>:        LOS normalized direction vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">0695</span>:     ray_orig : (3) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0696</span>:        LOS origin points coordinates</pre>
<pre class="cython line score-0">&#xA0;<span class="">0697</span>:     lpolyx : (ntotnvert)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0698</span>:        List of "x" coordinates of the polygon's vertices of the structures on</pre>
<pre class="cython line score-0">&#xA0;<span class="">0699</span>:        the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">0700</span>:     lpolyy : (ntotnvert)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0701</span>:        List of "y" coordinates of the polygon's vertices of the structures on</pre>
<pre class="cython line score-0">&#xA0;<span class="">0702</span>:        the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">0703</span>:     normx : (2, num_vertex-1) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0704</span>:        List of "x" coordinates of the normal vectors going "inwards" of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0705</span>:         edges of the Polygon defined by lpolyx/y</pre>
<pre class="cython line score-0">&#xA0;<span class="">0706</span>:     normy : (2, num_vertex-1) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">0707</span>:        List of "y" coordinates of the normal vectors going "inwards" of the</pre>
<pre class="cython line score-0">&#xA0;<span class="">0708</span>:         edges of the Polygon defined by lpolyxy</pre>
<pre class="cython line score-0">&#xA0;<span class="">0709</span>:     nvert : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">0710</span>:        Number of vertices on the polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">0711</span>:     lim_is_none : bint</pre>
<pre class="cython line score-0">&#xA0;<span class="">0712</span>:        Bool to know if the structures (or the vessel) is limited or not.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0713</span>:     lim_min : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0714</span>:        Minimum angle where the structure lives. If the structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0715</span>:        is toroidally continous then lim_min = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0716</span>:     lim_max : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0717</span>:        Maximum angle where the structure lives. If the structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0718</span>:        is toroidally continous then lim_min = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0719</span>:     forbidbis: bint</pre>
<pre class="cython line score-0">&#xA0;<span class="">0720</span>:        Should we forbid values behind vissible radius for each LOS ?</pre>
<pre class="cython line score-0">&#xA0;<span class="">0721</span>:     upscaDp: double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0722</span>:        Scalar product between LOS' origin and direction</pre>
<pre class="cython line score-0">&#xA0;<span class="">0723</span>:     upar2 : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0724</span>:        Norm direction LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0725</span>:     dpar2 : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0726</span>:        Norm origin LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0727</span>:     invuz : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0728</span>:        Inverse of 3rd component of direction. ie. if direction is (ux, uy, uz)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0729</span>:        then invuz = 1/uz</pre>
<pre class="cython line score-0">&#xA0;<span class="">0730</span>:     s1x, s1y, s2x, s2y : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0731</span>:        Compute coordinates of the 2 points where the tangents touch the inner</pre>
<pre class="cython line score-0">&#xA0;<span class="">0732</span>:        circle of the Tore, only needed if forbidbis = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0733</span>:     crit2 : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0734</span>:        Critical value to evaluate for each LOS if horizontal or not</pre>
<pre class="cython line score-0">&#xA0;<span class="">0735</span>:     eps&lt;val&gt; : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">0736</span>:        Small value, acceptance of error</pre>
<pre class="cython line score-0">&#xA0;<span class="">0737</span>:     is_in_struct : bint</pre>
<pre class="cython line score-0">&#xA0;<span class="">0738</span>:        Bool to determine if the structure is "OUT" or "IN". An "OUT" structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0739</span>:        cannot be penetrated whereas an "IN" structure can. The latter is</pre>
<pre class="cython line score-0">&#xA0;<span class="">0740</span>:        typically a vessel and are toroidally continous.</pre>
<pre class="cython line score-0">&#xA0;<span class="">0741</span>:     kpout_loc : double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0742</span>:        Coefficient of exit (kout) of the last point of intersection for the LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0743</span>:        with the structure or vessel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0744</span>:     kpin_loc : double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0745</span>:        Coefficient of exit (kin) of the last point of intersection for the LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">0746</span>:        with the structure or vessel</pre>
<pre class="cython line score-0">&#xA0;<span class="">0747</span>:     vperpin : (3) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">0748</span>:        Coordinates of the normal vector of impact of the LOS (0 if none)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0749</span>:     Return</pre>
<pre class="cython line score-0">&#xA0;<span class="">0750</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">0751</span>:     bool : If true, there was in impact</pre>
<pre class="cython line score-0">&#xA0;<span class="">0752</span>:            If false, no intersection between LOS and structure</pre>
<pre class="cython line score-0">&#xA0;<span class="">0753</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">0754</span>:     cdef int jj</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0755</span>:     cdef int done=0</pre>
<pre class='cython code score-0 '>  __pyx_v_done = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0756</span>:     cdef int indin=0</pre>
<pre class='cython code score-0 '>  __pyx_v_indin = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0757</span>:     cdef int indout=0</pre>
<pre class='cython code score-0 '>  __pyx_v_indout = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0758</span>:     cdef bint inter_bbox</pre>
<pre class="cython line score-0">&#xA0;<span class="">0759</span>:     cdef double kout, kin</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0760</span>:     cdef double res_kin = kpin_loc[0]</pre>
<pre class='cython code score-0 '>  __pyx_v_res_kin = (__pyx_v_kpin_loc[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0761</span>:     cdef double sca=0., sca0=0., sca1=0., sca2=0.</pre>
<pre class='cython code score-0 '>  __pyx_v_sca = 0.;
  __pyx_v_sca0 = 0.;
  __pyx_v_sca1 = 0.;
  __pyx_v_sca2 = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0762</span>:     cdef double q, coeff, delta, sqd, k, sol0, sol1, phi=0.</pre>
<pre class='cython code score-0 '>  __pyx_v_phi = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">0763</span>:     cdef double v0, v1, val_a, val_b, ephi_in0, ephi_in1</pre>
<pre class="cython line score-0">&#xA0;<span class="">0764</span>:     cdef double sout1, sout0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0765</span>:     cdef double sin1, sin0</pre>
<pre class="cython line score-0">&#xA0;<span class="">0766</span>:     cdef double invupar2</pre>
<pre class="cython line score-0">&#xA0;<span class="">0767</span>:     cdef double cosl0, cosl1, sinl0, sinl1</pre>
<pre class="cython line score-0">&#xA0;<span class="">0768</span>:     cdef double[3] opp_dir</pre>
<pre class="cython line score-0">&#xA0;<span class="">0769</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0770</span>:     # -- Computing some seful values -------------------------------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0771</span>:     cosl0 = Ccos(lim_min)</pre>
<pre class='cython code score-0 '>  __pyx_v_cosl0 = cos(__pyx_v_lim_min);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0772</span>:     cosl1 = Ccos(lim_max)</pre>
<pre class='cython code score-0 '>  __pyx_v_cosl1 = cos(__pyx_v_lim_max);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0773</span>:     sinl0 = Csin(lim_min)</pre>
<pre class='cython code score-0 '>  __pyx_v_sinl0 = sin(__pyx_v_lim_min);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0774</span>:     sinl1 = Csin(lim_max)</pre>
<pre class='cython code score-0 '>  __pyx_v_sinl1 = sin(__pyx_v_lim_max);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0775</span>:     invupar2 = 1./upar2</pre>
<pre class='cython code score-0 '>  __pyx_v_invupar2 = (1. / __pyx_v_upar2);
</pre><pre class="cython line score-0">&#xA0;<span class="">0776</span>:     # == Compute all solutions =================================================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0777</span>:     # Set tolerance value for ray_vdir[2,ii]</pre>
<pre class="cython line score-0">&#xA0;<span class="">0778</span>:     # eps_uz is the tolerated DZ across 20m (max Tokamak size)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0779</span>:     kout, kin, done = 1.e12, 1.e12, 0</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1.e12;
  __pyx_t_2 = 1.e12;
  __pyx_t_3 = 0;
  __pyx_v_kout = __pyx_t_1;
  __pyx_v_kin = __pyx_t_2;
  __pyx_v_done = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0780</span>:     if ray_vdir[2] * ray_vdir[2] &lt; crit2:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((((__pyx_v_ray_vdir[2]) * (__pyx_v_ray_vdir[2])) &lt; __pyx_v_crit2) != 0);
  if (__pyx_t_4) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0781</span>:         # -- Case with horizontal semi-line ------------------------------------</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0782</span>:         for jj in range(nvert):</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_v_nvert;
    __pyx_t_5 = __pyx_t_3;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">0783</span>:             # Solutions exist only in the case with non-horizontal</pre>
<pre class="cython line score-0">&#xA0;<span class="">0784</span>:             # segment (i.e.: cone, not plane)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0785</span>:             if (lpolyy[jj+1] - lpolyy[jj])**2 &gt; eps_vz * eps_vz:</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = ((pow(((__pyx_v_lpolyy[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyy[__pyx_v_jj])), 2.0) &gt; (__pyx_v_eps_vz * __pyx_v_eps_vz)) != 0);
      if (__pyx_t_4) {
/* … */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0786</span>:                 q = (ray_orig[2] - lpolyy[jj]) / (lpolyy[jj+1] - lpolyy[jj])</pre>
<pre class='cython code score-0 '>        __pyx_v_q = (((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj])) / ((__pyx_v_lpolyy[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyy[__pyx_v_jj])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0787</span>:                 # The intersection must stand on the segment</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0788</span>:                 if q&gt;=0 and q&lt;1:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((__pyx_v_q &gt;= 0.0) != 0);
        if (__pyx_t_7) {
        } else {
          __pyx_t_4 = __pyx_t_7;
          goto __pyx_L8_bool_binop_done;
        }
        __pyx_t_7 = ((__pyx_v_q &lt; 1.0) != 0);
        __pyx_t_4 = __pyx_t_7;
        __pyx_L8_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">0789</span>:                     coeff = q * q * (lpolyx[jj+1]-lpolyx[jj])**2 + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0790</span>:                         2. * q * lpolyx[jj] * (lpolyx[jj+1] - lpolyx[jj]) + \</pre>
<pre class='cython code score-0 '>          __pyx_v_coeff = ((((__pyx_v_q * __pyx_v_q) * pow(((__pyx_v_lpolyx[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyx[__pyx_v_jj])), 2.0)) + (((2. * __pyx_v_q) * (__pyx_v_lpolyx[__pyx_v_jj])) * ((__pyx_v_lpolyx[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyx[__pyx_v_jj])))) + ((__pyx_v_lpolyx[__pyx_v_jj]) * (__pyx_v_lpolyx[__pyx_v_jj])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0791</span>:                         lpolyx[jj] * lpolyx[jj]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0792</span>:                     delta = upscaDp * upscaDp - upar2 * (dpar2 - coeff)</pre>
<pre class='cython code score-0 '>          __pyx_v_delta = ((__pyx_v_upscaDp * __pyx_v_upscaDp) - (__pyx_v_upar2 * (__pyx_v_dpar2 - __pyx_v_coeff)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0793</span>:                     if delta&gt;0.:</pre>
<pre class='cython code score-0 '>          __pyx_t_4 = ((__pyx_v_delta &gt; 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0794</span>:                         sqd = Csqrt(delta)</pre>
<pre class='cython code score-0 '>            __pyx_v_sqd = sqrt(__pyx_v_delta);
</pre><pre class="cython line score-0">&#xA0;<span class="">0795</span>:                         # The intersection must be on the semi-line (i.e.: k&gt;=0)</pre>
<pre class="cython line score-0">&#xA0;<span class="">0796</span>:                         # First solution</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0797</span>:                         if -upscaDp - sqd &gt;= 0:</pre>
<pre class='cython code score-0 '>            __pyx_t_4 = ((((-__pyx_v_upscaDp) - __pyx_v_sqd) &gt;= 0.0) != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0798</span>:                             k = (-upscaDp - sqd) * invupar2</pre>
<pre class='cython code score-0 '>              __pyx_v_k = (((-__pyx_v_upscaDp) - __pyx_v_sqd) * __pyx_v_invupar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0799</span>:                             sol0 = ray_orig[0] + k * ray_vdir[0]</pre>
<pre class='cython code score-0 '>              __pyx_v_sol0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0800</span>:                             sol1 = ray_orig[1] + k * ray_vdir[1]</pre>
<pre class='cython code score-0 '>              __pyx_v_sol1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0801</span>:                             if forbidbis:</pre>
<pre class='cython code score-0 '>              __pyx_t_4 = (__pyx_v_forbidbis != 0);
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0802</span>:                                 sca0 = (sol0-s1x)*ray_orig[0] + \</pre>
<pre class='cython code score-0 '>                __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_s1x) * (__pyx_v_ray_orig[0])) + ((__pyx_v_sol1 - __pyx_v_s1y) * (__pyx_v_ray_orig[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0803</span>:                                        (sol1-s1y)*ray_orig[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0804</span>:                                 sca1 = (sol0-s1x)*s1x + (sol1-s1y)*s1y</pre>
<pre class='cython code score-0 '>                __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_s1x) * __pyx_v_s1x) + ((__pyx_v_sol1 - __pyx_v_s1y) * __pyx_v_s1y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0805</span>:                                 sca2 = (sol0-s2x)*s2x + (sol1-s2y)*s2y</pre>
<pre class='cython code score-0 '>                __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_s2x) * __pyx_v_s2x) + ((__pyx_v_sol1 - __pyx_v_s2y) * __pyx_v_s2y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0806</span>:                             if not forbidbis or (forbidbis and not</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((!(__pyx_v_forbidbis != 0)) != 0);
              if (!__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L14_bool_binop_done;
              }
              __pyx_t_7 = (__pyx_v_forbidbis != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L14_bool_binop_done;
              }
/* … */
              __pyx_t_8 = ((!__pyx_t_7) != 0);
              __pyx_t_4 = __pyx_t_8;
              __pyx_L14_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0807</span>:                                                  (sca0&lt;0 and sca1&lt;0 and</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_8) {
              } else {
                __pyx_t_7 = __pyx_t_8;
                goto __pyx_L17_bool_binop_done;
              }
              __pyx_t_8 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_8) {
              } else {
                __pyx_t_7 = __pyx_t_8;
                goto __pyx_L17_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0808</span>:                                                   sca2&lt;0)):</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_7 = __pyx_t_8;
              __pyx_L17_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0809</span>:                                 # Get the normalized perpendicular vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">0810</span>:                                 # at intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0811</span>:                                 phi = Catan2(sol1, sol0)</pre>
<pre class='cython code score-0 '>                __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0812</span>:                                 # Check sol inside the Lim</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0813</span>:                                 if lim_is_none or (not lim_is_none and</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = (__pyx_v_lim_is_none != 0);
                if (!__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L21_bool_binop_done;
                }
                __pyx_t_8 = ((!(__pyx_v_lim_is_none != 0)) != 0);
                if (__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L21_bool_binop_done;
                }
/* … */
                if (__pyx_t_4) {
/* … */
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0814</span>:                                                    ((lim_min&lt;lim_max and</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_lim_min &lt; __pyx_v_lim_max) != 0);
                if (!__pyx_t_8) {
                  goto __pyx_L24_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0815</span>:                                                      lim_min&lt;=phi and</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_lim_min &lt;= __pyx_v_phi) != 0);
                if (!__pyx_t_8) {
                  goto __pyx_L24_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0816</span>:                                                      phi&lt;=lim_max)</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
                if (!__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L21_bool_binop_done;
                }
                __pyx_L24_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0817</span>:                                                     or (lim_min&gt;lim_max and</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_lim_min &gt; __pyx_v_lim_max) != 0);
                if (__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L21_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0818</span>:                                                         (phi&gt;=lim_min or</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_phi &gt;= __pyx_v_lim_min) != 0);
                if (!__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L21_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0819</span>:                                                          phi&lt;=lim_max)))):</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
                __pyx_t_4 = __pyx_t_8;
                __pyx_L21_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0820</span>:                                     # Get the scalar product to determine</pre>
<pre class="cython line score-0">&#xA0;<span class="">0821</span>:                                     # entry or exit point</pre>
<pre class="cython line score-0">&#xA0;<span class="">0822</span>:                                     sca = Ccos(phi)*normx[jj]*ray_vdir[0] + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0823</span>:                                           Csin(phi)*normx[jj]*ray_vdir[1] + \</pre>
<pre class='cython code score-0 '>                  __pyx_v_sca = ((((cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[0])) + ((sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[1]))) + ((__pyx_v_normy[__pyx_v_jj]) * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0824</span>:                                           normy[jj]*ray_vdir[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0825</span>:                                     if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>                  __pyx_t_8 = ((__pyx_v_sca &lt;= 0.0) != 0);
                  if (__pyx_t_8) {
                  } else {
                    __pyx_t_4 = __pyx_t_8;
                    goto __pyx_L30_bool_binop_done;
                  }
                  __pyx_t_8 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                  __pyx_t_4 = __pyx_t_8;
                  __pyx_L30_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                    goto __pyx_L29;
                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0826</span>:                                         kout = k</pre>
<pre class='cython code score-0 '>                    __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0827</span>:                                         done = 1</pre>
<pre class='cython code score-0 '>                    __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0828</span>:                                         indout = jj</pre>
<pre class='cython code score-0 '>                    __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0829</span>:                                     elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>                  __pyx_t_8 = ((__pyx_v_sca &gt;= 0.0) != 0);
                  if (__pyx_t_8) {
                  } else {
                    __pyx_t_4 = __pyx_t_8;
                    goto __pyx_L32_bool_binop_done;
                  }
                  __pyx_t_2 = __pyx_v_kout;
                  __pyx_t_1 = __pyx_v_kin;
                  if (((__pyx_t_2 &lt; __pyx_t_1) != 0)) {
                    __pyx_t_9 = __pyx_t_2;
                  } else {
                    __pyx_t_9 = __pyx_t_1;
                  }
                  __pyx_t_8 = ((__pyx_v_k &lt; __pyx_t_9) != 0);
                  __pyx_t_4 = __pyx_t_8;
                  __pyx_L32_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                  }
                  __pyx_L29:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0830</span>:                                         kin = k</pre>
<pre class='cython code score-0 '>                    __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0831</span>:                                         indin = jj</pre>
<pre class='cython code score-0 '>                    __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">0832</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0833</span>:                         # Second solution</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0834</span>:                         if -upscaDp + sqd &gt;=0:</pre>
<pre class='cython code score-0 '>            __pyx_t_4 = ((((-__pyx_v_upscaDp) + __pyx_v_sqd) &gt;= 0.0) != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0835</span>:                             k = (-upscaDp + sqd)*invupar2</pre>
<pre class='cython code score-0 '>              __pyx_v_k = (((-__pyx_v_upscaDp) + __pyx_v_sqd) * __pyx_v_invupar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0836</span>:                             sol0 = ray_orig[0] + k * ray_vdir[0]</pre>
<pre class='cython code score-0 '>              __pyx_v_sol0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0837</span>:                             sol1 = ray_orig[1] + k * ray_vdir[1]</pre>
<pre class='cython code score-0 '>              __pyx_v_sol1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0838</span>:                             if forbidbis:</pre>
<pre class='cython code score-0 '>              __pyx_t_4 = (__pyx_v_forbidbis != 0);
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0839</span>:                                 sca0 = (sol0-s1x) * ray_orig[0] + \</pre>
<pre class='cython code score-0 '>                __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_s1x) * (__pyx_v_ray_orig[0])) + ((__pyx_v_sol1 - __pyx_v_s1y) * (__pyx_v_ray_orig[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0840</span>:                                        (sol1-s1y) * ray_orig[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0841</span>:                                 sca1 = (sol0-s1x) * s1x + (sol1-s1y) * s1y</pre>
<pre class='cython code score-0 '>                __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_s1x) * __pyx_v_s1x) + ((__pyx_v_sol1 - __pyx_v_s1y) * __pyx_v_s1y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0842</span>:                                 sca2 = (sol0-s2x) * s2x + (sol1-s2y) * s2y</pre>
<pre class='cython code score-0 '>                __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_s2x) * __pyx_v_s2x) + ((__pyx_v_sol1 - __pyx_v_s2y) * __pyx_v_s2y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0843</span>:                             if not forbidbis or (forbidbis and not</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((!(__pyx_v_forbidbis != 0)) != 0);
              if (!__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L37_bool_binop_done;
              }
              __pyx_t_8 = (__pyx_v_forbidbis != 0);
              if (__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L37_bool_binop_done;
              }
/* … */
              __pyx_t_7 = ((!__pyx_t_8) != 0);
              __pyx_t_4 = __pyx_t_7;
              __pyx_L37_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0844</span>:                                                  (sca0&lt;0 and sca1&lt;0 and</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_8 = __pyx_t_7;
                goto __pyx_L40_bool_binop_done;
              }
              __pyx_t_7 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_8 = __pyx_t_7;
                goto __pyx_L40_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0845</span>:                                                   sca2&lt;0)):</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_8 = __pyx_t_7;
              __pyx_L40_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0846</span>:                                 # Get the normalized perpendicular vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">0847</span>:                                 # at intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0848</span>:                                 phi = Catan2(sol1,sol0)</pre>
<pre class='cython code score-0 '>                __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0849</span>:                                 if lim_is_none or (not lim_is_none and</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = (__pyx_v_lim_is_none != 0);
                if (!__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L44_bool_binop_done;
                }
                __pyx_t_7 = ((!(__pyx_v_lim_is_none != 0)) != 0);
                if (__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L44_bool_binop_done;
                }
/* … */
                if (__pyx_t_4) {
/* … */
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0850</span>:                                                    ((lim_min&lt;lim_max and</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_lim_min &lt; __pyx_v_lim_max) != 0);
                if (!__pyx_t_7) {
                  goto __pyx_L47_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0851</span>:                                                      lim_min&lt;=phi and</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_lim_min &lt;= __pyx_v_phi) != 0);
                if (!__pyx_t_7) {
                  goto __pyx_L47_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0852</span>:                                                      phi&lt;=lim_max) or</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
                if (!__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L44_bool_binop_done;
                }
                __pyx_L47_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0853</span>:                                                     (lim_min&gt;lim_max and</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_lim_min &gt; __pyx_v_lim_max) != 0);
                if (__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L44_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0854</span>:                                                      (phi&gt;=lim_min or</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_phi &gt;= __pyx_v_lim_min) != 0);
                if (!__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L44_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0855</span>:                                                       phi&lt;=lim_max))</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
                __pyx_t_4 = __pyx_t_7;
                __pyx_L44_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0856</span>:                                                    )):</pre>
<pre class="cython line score-0">&#xA0;<span class="">0857</span>:                                     # Get the scalar product to determine</pre>
<pre class="cython line score-0">&#xA0;<span class="">0858</span>:                                     # entry or exit point</pre>
<pre class="cython line score-0">&#xA0;<span class="">0859</span>:                                     sca = Ccos(phi)*normx[jj]*ray_vdir[0] + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0860</span>:                                           Csin(phi)*normx[jj]*ray_vdir[1] + \</pre>
<pre class='cython code score-0 '>                  __pyx_v_sca = ((((cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[0])) + ((sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[1]))) + ((__pyx_v_normy[__pyx_v_jj]) * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0861</span>:                                           normy[jj]*ray_vdir[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0862</span>:                                     if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>                  __pyx_t_7 = ((__pyx_v_sca &lt;= 0.0) != 0);
                  if (__pyx_t_7) {
                  } else {
                    __pyx_t_4 = __pyx_t_7;
                    goto __pyx_L53_bool_binop_done;
                  }
                  __pyx_t_7 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                  __pyx_t_4 = __pyx_t_7;
                  __pyx_L53_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                    goto __pyx_L52;
                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0863</span>:                                         kout = k</pre>
<pre class='cython code score-0 '>                    __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0864</span>:                                         done = 1</pre>
<pre class='cython code score-0 '>                    __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0865</span>:                                         indout = jj</pre>
<pre class='cython code score-0 '>                    __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0866</span>:                                     elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>                  __pyx_t_7 = ((__pyx_v_sca &gt;= 0.0) != 0);
                  if (__pyx_t_7) {
                  } else {
                    __pyx_t_4 = __pyx_t_7;
                    goto __pyx_L55_bool_binop_done;
                  }
                  __pyx_t_9 = __pyx_v_kout;
                  __pyx_t_2 = __pyx_v_kin;
                  if (((__pyx_t_9 &lt; __pyx_t_2) != 0)) {
                    __pyx_t_1 = __pyx_t_9;
                  } else {
                    __pyx_t_1 = __pyx_t_2;
                  }
                  __pyx_t_7 = ((__pyx_v_k &lt; __pyx_t_1) != 0);
                  __pyx_t_4 = __pyx_t_7;
                  __pyx_L55_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                  }
                  __pyx_L52:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0867</span>:                                         kin = k</pre>
<pre class='cython code score-0 '>                    __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0868</span>:                                         indin = jj</pre>
<pre class='cython code score-0 '>                    __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">0869</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0870</span>:     # == More general non-horizontal semi-line case ============================</pre>
<pre class="cython line score-0">&#xA0;<span class="">0871</span>:     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0872</span>:         for jj in range(nvert):</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_3 = __pyx_v_nvert;
    __pyx_t_5 = __pyx_t_3;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0873</span>:             v0 = lpolyx[jj+1]-lpolyx[jj]</pre>
<pre class='cython code score-0 '>      __pyx_v_v0 = ((__pyx_v_lpolyx[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyx[__pyx_v_jj]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0874</span>:             v1 = lpolyy[jj+1]-lpolyy[jj]</pre>
<pre class='cython code score-0 '>      __pyx_v_v1 = ((__pyx_v_lpolyy[(__pyx_v_jj + 1)]) - (__pyx_v_lpolyy[__pyx_v_jj]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0875</span>:             val_a = v0 * v0 - upar2 * v1 * invuz * v1 * invuz</pre>
<pre class='cython code score-0 '>      __pyx_v_val_a = ((__pyx_v_v0 * __pyx_v_v0) - ((((__pyx_v_upar2 * __pyx_v_v1) * __pyx_v_invuz) * __pyx_v_v1) * __pyx_v_invuz));
</pre><pre class="cython line score-0">&#xA0;<span class="">0876</span>:             val_b = lpolyx[jj] * v0 + v1 * (ray_orig[2] - lpolyy[jj]) * upar2 *\</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0877</span>:                     invuz * invuz - upscaDp * v1 * invuz</pre>
<pre class='cython code score-0 '>      __pyx_v_val_b = ((((__pyx_v_lpolyx[__pyx_v_jj]) * __pyx_v_v0) + ((((__pyx_v_v1 * ((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj]))) * __pyx_v_upar2) * __pyx_v_invuz) * __pyx_v_invuz)) - ((__pyx_v_upscaDp * __pyx_v_v1) * __pyx_v_invuz));
</pre><pre class="cython line score-0">&#xA0;<span class="">0878</span>:             coeff = - upar2 * (ray_orig[2] - lpolyy[jj])**2 * invuz * invuz +\</pre>
<pre class="cython line score-0">&#xA0;<span class="">0879</span>:                     2. * upscaDp * (ray_orig[2]-lpolyy[jj]) * invuz -\</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0880</span>:                     dpar2 + lpolyx[jj] * lpolyx[jj]</pre>
<pre class='cython code score-0 '>      __pyx_v_coeff = (((((((-__pyx_v_upar2) * pow(((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj])), 2.0)) * __pyx_v_invuz) * __pyx_v_invuz) + (((2. * __pyx_v_upscaDp) * ((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj]))) * __pyx_v_invuz)) - __pyx_v_dpar2) + ((__pyx_v_lpolyx[__pyx_v_jj]) * (__pyx_v_lpolyx[__pyx_v_jj])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0881</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0882</span>:             if ((val_a * val_a &lt; eps_a * eps_a) and</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = (((__pyx_v_val_a * __pyx_v_val_a) &lt; (__pyx_v_eps_a * __pyx_v_eps_a)) != 0);
      if (__pyx_t_7) {
      } else {
        __pyx_t_4 = __pyx_t_7;
        goto __pyx_L60_bool_binop_done;
      }
/* … */
      if (__pyx_t_4) {
/* … */
        goto __pyx_L59;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0883</span>:                 (val_b * val_b &gt; eps_b * eps_b)):</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = (((__pyx_v_val_b * __pyx_v_val_b) &gt; (__pyx_v_eps_b * __pyx_v_eps_b)) != 0);
      __pyx_t_4 = __pyx_t_7;
      __pyx_L60_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0884</span>:                 q = -coeff / (2. * val_b)</pre>
<pre class='cython code score-0 '>        __pyx_v_q = ((-__pyx_v_coeff) / (2. * __pyx_v_val_b));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0885</span>:                 if q &gt;= 0. and q &lt; 1.:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_7) {
        } else {
          __pyx_t_4 = __pyx_t_7;
          goto __pyx_L63_bool_binop_done;
        }
        __pyx_t_7 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_7;
        __pyx_L63_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0886</span>:                     k = (q * v1 - (ray_orig[2] - lpolyy[jj])) * invuz</pre>
<pre class='cython code score-0 '>          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj]))) * __pyx_v_invuz);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0887</span>:                     if k &gt;= 0:</pre>
<pre class='cython code score-0 '>          __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0888</span>:                         sol0 = ray_orig[0] + k * ray_vdir[0]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0889</span>:                         sol1 = ray_orig[1] + k * ray_vdir[1]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0890</span>:                         if forbidbis:</pre>
<pre class='cython code score-0 '>            __pyx_t_4 = (__pyx_v_forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0891</span>:                             sca0 = (sol0-s1x)*ray_orig[0] + \</pre>
<pre class='cython code score-0 '>              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_s1x) * (__pyx_v_ray_orig[0])) + ((__pyx_v_sol1 - __pyx_v_s1y) * (__pyx_v_ray_orig[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0892</span>:                                    (sol1-s1y)*ray_orig[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0893</span>:                             sca1 = (sol0-s1x)*s1x + (sol1-s1y)*s1y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_s1x) * __pyx_v_s1x) + ((__pyx_v_sol1 - __pyx_v_s1y) * __pyx_v_s1y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0894</span>:                             sca2 = (sol0-s2x)*s2x + (sol1-s2y)*s2y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_s2x) * __pyx_v_s2x) + ((__pyx_v_sol1 - __pyx_v_s2y) * __pyx_v_s2y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0895</span>:                             if sca0&lt;0 and sca1&lt;0 and sca2&lt;0:</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L68_bool_binop_done;
              }
              __pyx_t_7 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L68_bool_binop_done;
              }
              __pyx_t_7 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_4 = __pyx_t_7;
              __pyx_L68_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0896</span>:                                 continue</pre>
<pre class='cython code score-0 '>                goto __pyx_L57_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0897</span>:                         # Get the normalized perpendicular vect at intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0898</span>:                         phi = Catan2(sol1,sol0)</pre>
<pre class='cython code score-0 '>            __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0899</span>:                         if lim_is_none or (not lim_is_none and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = (__pyx_v_lim_is_none != 0);
            if (!__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_t_7 = ((!(__pyx_v_lim_is_none != 0)) != 0);
            if (__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L72_bool_binop_done;
            }
/* … */
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0900</span>:                                            ((lim_min &lt; lim_max and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_lim_min &lt; __pyx_v_lim_max) != 0);
            if (!__pyx_t_7) {
              goto __pyx_L75_next_or;
            } else {
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0901</span>:                                              lim_min &lt;= phi and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_lim_min &lt;= __pyx_v_phi) != 0);
            if (!__pyx_t_7) {
              goto __pyx_L75_next_or;
            } else {
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0902</span>:                                              phi &lt;= lim_max) or</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
            if (!__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_L75_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0903</span>:                                             (lim_min &gt; lim_max and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_lim_min &gt; __pyx_v_lim_max) != 0);
            if (__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L72_bool_binop_done;
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0904</span>:                                              (phi &gt;= lim_min or</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_phi &gt;= __pyx_v_lim_min) != 0);
            if (!__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L72_bool_binop_done;
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0905</span>:                                               phi &lt;= lim_max)))):</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
            __pyx_t_4 = __pyx_t_7;
            __pyx_L72_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0906</span>:                             # Get the scal prod to determine entry or exit point</pre>
<pre class="cython line score-0">&#xA0;<span class="">0907</span>:                             sca = Ccos(phi) * normx[jj] * ray_vdir[0] + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0908</span>:                                   Csin(phi) * normx[jj] * ray_vdir[1] + \</pre>
<pre class='cython code score-0 '>              __pyx_v_sca = ((((cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[0])) + ((sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[1]))) + ((__pyx_v_normy[__pyx_v_jj]) * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0909</span>:                                   normy[jj] * ray_vdir[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0910</span>:                             if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_sca &lt;= 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L81_bool_binop_done;
              }
              __pyx_t_7 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
              __pyx_t_4 = __pyx_t_7;
              __pyx_L81_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
                goto __pyx_L80;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0911</span>:                                 kout = k</pre>
<pre class='cython code score-0 '>                __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0912</span>:                                 done = 1</pre>
<pre class='cython code score-0 '>                __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0913</span>:                                 indout = jj</pre>
<pre class='cython code score-0 '>                __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0914</span>:                             elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_sca &gt;= 0.0) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L83_bool_binop_done;
              }
              __pyx_t_1 = __pyx_v_kout;
              __pyx_t_9 = __pyx_v_kin;
              if (((__pyx_t_1 &lt; __pyx_t_9) != 0)) {
                __pyx_t_2 = __pyx_t_1;
              } else {
                __pyx_t_2 = __pyx_t_9;
              }
              __pyx_t_7 = ((__pyx_v_k &lt; __pyx_t_2) != 0);
              __pyx_t_4 = __pyx_t_7;
              __pyx_L83_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
              __pyx_L80:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0915</span>:                                 kin = k</pre>
<pre class='cython code score-0 '>                __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0916</span>:                                 indin = jj</pre>
<pre class='cython code score-0 '>                __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0917</span>:             elif ((val_a * val_a &gt;= eps_a * eps_a) and</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = (((__pyx_v_val_a * __pyx_v_val_a) &gt;= (__pyx_v_eps_a * __pyx_v_eps_a)) != 0);
      if (__pyx_t_7) {
      } else {
        __pyx_t_4 = __pyx_t_7;
        goto __pyx_L85_bool_binop_done;
      }
/* … */
      if (__pyx_t_4) {
/* … */
      }
      __pyx_L59:;
      __pyx_L57_continue:;
    }
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0918</span>:                   (val_b * val_b &gt; val_a * coeff)):</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = (((__pyx_v_val_b * __pyx_v_val_b) &gt; (__pyx_v_val_a * __pyx_v_coeff)) != 0);
      __pyx_t_4 = __pyx_t_7;
      __pyx_L85_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0919</span>:                 sqd = Csqrt(val_b * val_b - val_a * coeff)</pre>
<pre class='cython code score-0 '>        __pyx_v_sqd = sqrt(((__pyx_v_val_b * __pyx_v_val_b) - (__pyx_v_val_a * __pyx_v_coeff)));
</pre><pre class="cython line score-0">&#xA0;<span class="">0920</span>:                 # First solution</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0921</span>:                 q = (-val_b + sqd) / val_a</pre>
<pre class='cython code score-0 '>        __pyx_v_q = (((-__pyx_v_val_b) + __pyx_v_sqd) / __pyx_v_val_a);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0922</span>:                 if q &gt;= 0. and q &lt; 1.:</pre>
<pre class='cython code score-0 '>        __pyx_t_7 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_7) {
        } else {
          __pyx_t_4 = __pyx_t_7;
          goto __pyx_L88_bool_binop_done;
        }
        __pyx_t_7 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_7;
        __pyx_L88_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0923</span>:                     k = (q * v1 - (ray_orig[2] - lpolyy[jj])) * invuz</pre>
<pre class='cython code score-0 '>          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj]))) * __pyx_v_invuz);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0924</span>:                     if k &gt;= 0.:</pre>
<pre class='cython code score-0 '>          __pyx_t_4 = ((__pyx_v_k &gt;= 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0925</span>:                         sol0 = ray_orig[0] + k * ray_vdir[0]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0926</span>:                         sol1 = ray_orig[1] + k * ray_vdir[1]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0927</span>:                         if forbidbis:</pre>
<pre class='cython code score-0 '>            __pyx_t_4 = (__pyx_v_forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0928</span>:                             sca0 = (sol0-s1x) * ray_orig[0] + \</pre>
<pre class='cython code score-0 '>              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_s1x) * (__pyx_v_ray_orig[0])) + ((__pyx_v_sol1 - __pyx_v_s1y) * (__pyx_v_ray_orig[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0929</span>:                                    (sol1-s1y) * ray_orig[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0930</span>:                             sca1 = (sol0-s1x) * s1x + (sol1-s1y) * s1y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_s1x) * __pyx_v_s1x) + ((__pyx_v_sol1 - __pyx_v_s1y) * __pyx_v_s1y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0931</span>:                             sca2 = (sol0-s2x) * s2x + (sol1-s2y) * s2y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_s2x) * __pyx_v_s2x) + ((__pyx_v_sol1 - __pyx_v_s2y) * __pyx_v_s2y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0932</span>:                         if not forbidbis or (forbidbis and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((!(__pyx_v_forbidbis != 0)) != 0);
            if (!__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L93_bool_binop_done;
            }
            __pyx_t_7 = (__pyx_v_forbidbis != 0);
            if (__pyx_t_7) {
            } else {
              __pyx_t_4 = __pyx_t_7;
              goto __pyx_L93_bool_binop_done;
            }
/* … */
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0933</span>:                                              not (sca0&lt;0 and sca1&lt;0 and</pre>
<pre class='cython code score-0 '>            __pyx_t_8 = ((__pyx_v_sca0 &lt; 0.0) != 0);
            if (__pyx_t_8) {
            } else {
              __pyx_t_7 = __pyx_t_8;
              goto __pyx_L96_bool_binop_done;
            }
            __pyx_t_8 = ((__pyx_v_sca1 &lt; 0.0) != 0);
            if (__pyx_t_8) {
            } else {
              __pyx_t_7 = __pyx_t_8;
              goto __pyx_L96_bool_binop_done;
            }
/* … */
            __pyx_t_8 = ((!__pyx_t_7) != 0);
            __pyx_t_4 = __pyx_t_8;
            __pyx_L93_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0934</span>:                                                   sca2&lt;0)):</pre>
<pre class='cython code score-0 '>            __pyx_t_8 = ((__pyx_v_sca2 &lt; 0.0) != 0);
            __pyx_t_7 = __pyx_t_8;
            __pyx_L96_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0935</span>:                             # Get the normalized perpendicular vector at inter</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0936</span>:                             phi = Catan2(sol1, sol0)</pre>
<pre class='cython code score-0 '>              __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0937</span>:                             if lim_is_none or (not lim_is_none and</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = (__pyx_v_lim_is_none != 0);
              if (!__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_t_8 = ((!(__pyx_v_lim_is_none != 0)) != 0);
              if (__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L100_bool_binop_done;
              }
/* … */
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0938</span>:                                                ((lim_min &lt; lim_max and</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_lim_min &lt; __pyx_v_lim_max) != 0);
              if (!__pyx_t_8) {
                goto __pyx_L103_next_or;
              } else {
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0939</span>:                                                  lim_min &lt;= phi and</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_lim_min &lt;= __pyx_v_phi) != 0);
              if (!__pyx_t_8) {
                goto __pyx_L103_next_or;
              } else {
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0940</span>:                                                  phi &lt;= lim_max) or</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
              if (!__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_L103_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0941</span>:                                                 (lim_min &gt; lim_max and</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_lim_min &gt; __pyx_v_lim_max) != 0);
              if (__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L100_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0942</span>:                                                  (phi &gt;= lim_min or</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_phi &gt;= __pyx_v_lim_min) != 0);
              if (!__pyx_t_8) {
              } else {
                __pyx_t_4 = __pyx_t_8;
                goto __pyx_L100_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0943</span>:                                                   phi &lt;= lim_max)))):</pre>
<pre class='cython code score-0 '>              __pyx_t_8 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
              __pyx_t_4 = __pyx_t_8;
              __pyx_L100_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0944</span>:                                 # Get the scal prod to determine in or out point</pre>
<pre class="cython line score-0">&#xA0;<span class="">0945</span>:                                 sca = Ccos(phi) * normx[jj] * ray_vdir[0] + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0946</span>:                                       Csin(phi) * normx[jj] * ray_vdir[1] + \</pre>
<pre class='cython code score-0 '>                __pyx_v_sca = ((((cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[0])) + ((sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[1]))) + ((__pyx_v_normy[__pyx_v_jj]) * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0947</span>:                                       normy[jj] * ray_vdir[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0948</span>:                                 if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_sca &lt;= 0.0) != 0);
                if (__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L109_bool_binop_done;
                }
                __pyx_t_8 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                __pyx_t_4 = __pyx_t_8;
                __pyx_L109_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                  goto __pyx_L108;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0949</span>:                                     kout = k</pre>
<pre class='cython code score-0 '>                  __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0950</span>:                                     done = 1</pre>
<pre class='cython code score-0 '>                  __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0951</span>:                                     indout = jj</pre>
<pre class='cython code score-0 '>                  __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0952</span>:                                 elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>                __pyx_t_8 = ((__pyx_v_sca &gt;= 0.0) != 0);
                if (__pyx_t_8) {
                } else {
                  __pyx_t_4 = __pyx_t_8;
                  goto __pyx_L111_bool_binop_done;
                }
                __pyx_t_2 = __pyx_v_kout;
                __pyx_t_1 = __pyx_v_kin;
                if (((__pyx_t_2 &lt; __pyx_t_1) != 0)) {
                  __pyx_t_9 = __pyx_t_2;
                } else {
                  __pyx_t_9 = __pyx_t_1;
                }
                __pyx_t_8 = ((__pyx_v_k &lt; __pyx_t_9) != 0);
                __pyx_t_4 = __pyx_t_8;
                __pyx_L111_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                }
                __pyx_L108:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0953</span>:                                     kin = k</pre>
<pre class='cython code score-0 '>                  __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0954</span>:                                     indin = jj</pre>
<pre class='cython code score-0 '>                  __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">0955</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0956</span>:                 # == Second solution ===========================================</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0957</span>:                 q = (-val_b - sqd) / val_a</pre>
<pre class='cython code score-0 '>        __pyx_v_q = (((-__pyx_v_val_b) - __pyx_v_sqd) / __pyx_v_val_a);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0958</span>:                 if q &gt;= 0. and q &lt; 1.:</pre>
<pre class='cython code score-0 '>        __pyx_t_8 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_8) {
        } else {
          __pyx_t_4 = __pyx_t_8;
          goto __pyx_L114_bool_binop_done;
        }
        __pyx_t_8 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_8;
        __pyx_L114_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0959</span>:                     k = (q * v1 - (ray_orig[2] - lpolyy[jj])) * invuz</pre>
<pre class='cython code score-0 '>          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_ray_orig[2]) - (__pyx_v_lpolyy[__pyx_v_jj]))) * __pyx_v_invuz);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0960</span>:                     if k&gt;=0.:</pre>
<pre class='cython code score-0 '>          __pyx_t_4 = ((__pyx_v_k &gt;= 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0961</span>:                         sol0 = ray_orig[0] + k * ray_vdir[0]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0962</span>:                         sol1 = ray_orig[1] + k * ray_vdir[1]</pre>
<pre class='cython code score-0 '>            __pyx_v_sol1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0963</span>:                         if forbidbis:</pre>
<pre class='cython code score-0 '>            __pyx_t_4 = (__pyx_v_forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0964</span>:                             sca0 = (sol0-s1x) * ray_orig[0] + \</pre>
<pre class='cython code score-0 '>              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_s1x) * (__pyx_v_ray_orig[0])) + ((__pyx_v_sol1 - __pyx_v_s1y) * (__pyx_v_ray_orig[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0965</span>:                                    (sol1-s1y) * ray_orig[1]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0966</span>:                             sca1 = (sol0-s1x) * s1x + (sol1-s1y) * s1y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_s1x) * __pyx_v_s1x) + ((__pyx_v_sol1 - __pyx_v_s1y) * __pyx_v_s1y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0967</span>:                             sca2 = (sol0-s2x) * s2x + (sol1-s2y) * s2y</pre>
<pre class='cython code score-0 '>              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_s2x) * __pyx_v_s2x) + ((__pyx_v_sol1 - __pyx_v_s2y) * __pyx_v_s2y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0968</span>:                         if not forbidbis or (forbidbis and</pre>
<pre class='cython code score-0 '>            __pyx_t_8 = ((!(__pyx_v_forbidbis != 0)) != 0);
            if (!__pyx_t_8) {
            } else {
              __pyx_t_4 = __pyx_t_8;
              goto __pyx_L119_bool_binop_done;
            }
            __pyx_t_8 = (__pyx_v_forbidbis != 0);
            if (__pyx_t_8) {
            } else {
              __pyx_t_4 = __pyx_t_8;
              goto __pyx_L119_bool_binop_done;
            }
/* … */
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0969</span>:                                              not (sca0&lt;0 and sca1&lt;0 and</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_sca0 &lt; 0.0) != 0);
            if (__pyx_t_7) {
            } else {
              __pyx_t_8 = __pyx_t_7;
              goto __pyx_L122_bool_binop_done;
            }
            __pyx_t_7 = ((__pyx_v_sca1 &lt; 0.0) != 0);
            if (__pyx_t_7) {
            } else {
              __pyx_t_8 = __pyx_t_7;
              goto __pyx_L122_bool_binop_done;
            }
/* … */
            __pyx_t_7 = ((!__pyx_t_8) != 0);
            __pyx_t_4 = __pyx_t_7;
            __pyx_L119_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0970</span>:                                                   sca2&lt;0)):</pre>
<pre class='cython code score-0 '>            __pyx_t_7 = ((__pyx_v_sca2 &lt; 0.0) != 0);
            __pyx_t_8 = __pyx_t_7;
            __pyx_L122_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0971</span>:                             # Get the normalized perpendicular vector at inter</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0972</span>:                             phi = Catan2(sol1,sol0)</pre>
<pre class='cython code score-0 '>              __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0973</span>:                             if lim_is_none or (not lim_is_none and</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = (__pyx_v_lim_is_none != 0);
              if (!__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_t_7 = ((!(__pyx_v_lim_is_none != 0)) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L126_bool_binop_done;
              }
/* … */
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0974</span>:                                                ((lim_min &lt; lim_max and</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_lim_min &lt; __pyx_v_lim_max) != 0);
              if (!__pyx_t_7) {
                goto __pyx_L129_next_or;
              } else {
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0975</span>:                                                  lim_min &lt;= phi and</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_lim_min &lt;= __pyx_v_phi) != 0);
              if (!__pyx_t_7) {
                goto __pyx_L129_next_or;
              } else {
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0976</span>:                                                  phi &lt;= lim_max) or</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
              if (!__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_L129_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0977</span>:                                                 (lim_min&gt;lim_max and</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_lim_min &gt; __pyx_v_lim_max) != 0);
              if (__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L126_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0978</span>:                                                  (phi&gt;=lim_min or</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_phi &gt;= __pyx_v_lim_min) != 0);
              if (!__pyx_t_7) {
              } else {
                __pyx_t_4 = __pyx_t_7;
                goto __pyx_L126_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0979</span>:                                                   phi&lt;=lim_max)))):</pre>
<pre class='cython code score-0 '>              __pyx_t_7 = ((__pyx_v_phi &lt;= __pyx_v_lim_max) != 0);
              __pyx_t_4 = __pyx_t_7;
              __pyx_L126_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0980</span>:                                 # Get the scal prod to determine if in or out</pre>
<pre class="cython line score-0">&#xA0;<span class="">0981</span>:                                 sca = Ccos(phi) * normx[jj] * ray_vdir[0] + \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0982</span>:                                       Csin(phi) * normx[jj] * ray_vdir[1] + \</pre>
<pre class='cython code score-0 '>                __pyx_v_sca = ((((cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[0])) + ((sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_jj])) * (__pyx_v_ray_vdir[1]))) + ((__pyx_v_normy[__pyx_v_jj]) * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">0983</span>:                                       normy[jj] * ray_vdir[2]</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0984</span>:                                 if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_sca &lt;= 0.0) != 0);
                if (__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L135_bool_binop_done;
                }
                __pyx_t_7 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                __pyx_t_4 = __pyx_t_7;
                __pyx_L135_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                  goto __pyx_L134;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0985</span>:                                     kout = k</pre>
<pre class='cython code score-0 '>                  __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0986</span>:                                     done = 1</pre>
<pre class='cython code score-0 '>                  __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0987</span>:                                     indout = jj</pre>
<pre class='cython code score-0 '>                  __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0988</span>:                                 elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>                __pyx_t_7 = ((__pyx_v_sca &gt;= 0.0) != 0);
                if (__pyx_t_7) {
                } else {
                  __pyx_t_4 = __pyx_t_7;
                  goto __pyx_L137_bool_binop_done;
                }
                __pyx_t_9 = __pyx_v_kout;
                __pyx_t_2 = __pyx_v_kin;
                if (((__pyx_t_9 &lt; __pyx_t_2) != 0)) {
                  __pyx_t_1 = __pyx_t_9;
                } else {
                  __pyx_t_1 = __pyx_t_2;
                }
                __pyx_t_7 = ((__pyx_v_k &lt; __pyx_t_1) != 0);
                __pyx_t_4 = __pyx_t_7;
                __pyx_L137_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                }
                __pyx_L134:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0989</span>:                                     kin = k</pre>
<pre class='cython code score-0 '>                  __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0990</span>:                                     indin = jj</pre>
<pre class='cython code score-0 '>                  __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">0991</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0992</span>:     if not lim_is_none:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((!(__pyx_v_lim_is_none != 0)) != 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0993</span>:         ephi_in0 = -sinl0</pre>
<pre class='cython code score-0 '>    __pyx_v_ephi_in0 = (-__pyx_v_sinl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0994</span>:         ephi_in1 =  cosl0</pre>
<pre class='cython code score-0 '>    __pyx_v_ephi_in1 = __pyx_v_cosl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0995</span>:         if Cabs(ray_vdir[0] * ephi_in0 + ray_vdir[1] * ephi_in1) &gt; eps_pln:</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((fabs((((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1))) &gt; __pyx_v_eps_pln) != 0);
    if (__pyx_t_4) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0996</span>:             k = -(ray_orig[0] * ephi_in0 + ray_orig[1] * ephi_in1) \</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0997</span>:                 /(ray_vdir[0] * ephi_in0 + ray_vdir[1] * ephi_in1)</pre>
<pre class='cython code score-0 '>      __pyx_v_k = ((-(((__pyx_v_ray_orig[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_orig[1]) * __pyx_v_ephi_in1))) / (((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0998</span>:             if k &gt;= 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0999</span>:                 # Check if in ves_poly</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1000</span>:                 sol0 = (ray_orig[0] + k * ray_vdir[0]) * cosl0 + \</pre>
<pre class='cython code score-0 '>        __pyx_v_sol0 = ((((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0]))) * __pyx_v_cosl0) + (((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1]))) * __pyx_v_sinl0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1001</span>:                        (ray_orig[1] + k * ray_vdir[1]) * sinl0</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1002</span>:                 sol1 =  ray_orig[2] + k * ray_vdir[2]</pre>
<pre class='cython code score-0 '>        __pyx_v_sol1 = ((__pyx_v_ray_orig[2]) + (__pyx_v_k * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1003</span>:                 inter_bbox = is_point_in_path(nvert, lpolyx, lpolyy, sol0, sol1)</pre>
<pre class='cython code score-0 '>        __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(__pyx_v_nvert, __pyx_v_lpolyx, __pyx_v_lpolyy, __pyx_v_sol0, __pyx_v_sol1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1004</span>:                 if inter_bbox:</pre>
<pre class='cython code score-0 '>        __pyx_t_4 = (__pyx_v_inter_bbox != 0);
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">1005</span>:                     # Check PIn (POut not possible for limited torus)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1006</span>:                     sca = ray_vdir[0] * ephi_in0 + ray_vdir[1] * ephi_in1</pre>
<pre class='cython code score-0 '>          __pyx_v_sca = (((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1007</span>:                     if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_sca &lt;= 0.0) != 0);
          if (__pyx_t_7) {
          } else {
            __pyx_t_4 = __pyx_t_7;
            goto __pyx_L144_bool_binop_done;
          }
          __pyx_t_7 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
          __pyx_t_4 = __pyx_t_7;
          __pyx_L144_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
            goto __pyx_L143;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1008</span>:                         kout = k</pre>
<pre class='cython code score-0 '>            __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1009</span>:                         done = 1</pre>
<pre class='cython code score-0 '>            __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1010</span>:                         indout = -1</pre>
<pre class='cython code score-0 '>            __pyx_v_indout = -1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1011</span>:                     elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_sca &gt;= 0.0) != 0);
          if (__pyx_t_7) {
          } else {
            __pyx_t_4 = __pyx_t_7;
            goto __pyx_L146_bool_binop_done;
          }
          __pyx_t_1 = __pyx_v_kout;
          __pyx_t_9 = __pyx_v_kin;
          if (((__pyx_t_1 &lt; __pyx_t_9) != 0)) {
            __pyx_t_2 = __pyx_t_1;
          } else {
            __pyx_t_2 = __pyx_t_9;
          }
          __pyx_t_7 = ((__pyx_v_k &lt; __pyx_t_2) != 0);
          __pyx_t_4 = __pyx_t_7;
          __pyx_L146_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
          }
          __pyx_L143:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1012</span>:                         kin = k</pre>
<pre class='cython code score-0 '>            __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1013</span>:                         indin = -1</pre>
<pre class='cython code score-0 '>            __pyx_v_indin = -1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1014</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1015</span>:         ephi_in0 =  sinl1</pre>
<pre class='cython code score-0 '>    __pyx_v_ephi_in0 = __pyx_v_sinl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1016</span>:         ephi_in1 = -cosl1</pre>
<pre class='cython code score-0 '>    __pyx_v_ephi_in1 = (-__pyx_v_cosl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1017</span>:         if Cabs(ray_vdir[0] * ephi_in0 + ray_vdir[1] * ephi_in1) &gt; eps_pln:</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((fabs((((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1))) &gt; __pyx_v_eps_pln) != 0);
    if (__pyx_t_4) {
/* … */
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1018</span>:             k = -(ray_orig[0] * ephi_in0 + ray_orig[1] * ephi_in1)\</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1019</span>:                 /(ray_vdir[0] * ephi_in0 + ray_vdir[1] * ephi_in1)</pre>
<pre class='cython code score-0 '>      __pyx_v_k = ((-(((__pyx_v_ray_orig[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_orig[1]) * __pyx_v_ephi_in1))) / (((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1020</span>:             if k &gt;= 0:</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1021</span>:                 sol0 = (ray_orig[0] + k * ray_vdir[0]) * cosl1 +\</pre>
<pre class='cython code score-0 '>        __pyx_v_sol0 = ((((__pyx_v_ray_orig[0]) + (__pyx_v_k * (__pyx_v_ray_vdir[0]))) * __pyx_v_cosl1) + (((__pyx_v_ray_orig[1]) + (__pyx_v_k * (__pyx_v_ray_vdir[1]))) * __pyx_v_sinl1));
</pre><pre class="cython line score-0">&#xA0;<span class="">1022</span>:                        (ray_orig[1] + k * ray_vdir[1]) * sinl1</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1023</span>:                 sol1 =  ray_orig[2] + k * ray_vdir[2]</pre>
<pre class='cython code score-0 '>        __pyx_v_sol1 = ((__pyx_v_ray_orig[2]) + (__pyx_v_k * (__pyx_v_ray_vdir[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1024</span>:                 # Check if in ves_poly</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1025</span>:                 inter_bbox = is_point_in_path(nvert, lpolyx, lpolyy, sol0, sol1)</pre>
<pre class='cython code score-0 '>        __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(__pyx_v_nvert, __pyx_v_lpolyx, __pyx_v_lpolyy, __pyx_v_sol0, __pyx_v_sol1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1026</span>:                 if inter_bbox:</pre>
<pre class='cython code score-0 '>        __pyx_t_4 = (__pyx_v_inter_bbox != 0);
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">1027</span>:                     # Check PIn (POut not possible for limited torus)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1028</span>:                     sca = ray_vdir[0]*ephi_in0 + ray_vdir[1]*ephi_in1</pre>
<pre class='cython code score-0 '>          __pyx_v_sca = (((__pyx_v_ray_vdir[0]) * __pyx_v_ephi_in0) + ((__pyx_v_ray_vdir[1]) * __pyx_v_ephi_in1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1029</span>:                     if sca&lt;=0 and k&lt;kout:</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_sca &lt;= 0.0) != 0);
          if (__pyx_t_7) {
          } else {
            __pyx_t_4 = __pyx_t_7;
            goto __pyx_L152_bool_binop_done;
          }
          __pyx_t_7 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
          __pyx_t_4 = __pyx_t_7;
          __pyx_L152_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
            goto __pyx_L151;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1030</span>:                         kout = k</pre>
<pre class='cython code score-0 '>            __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1031</span>:                         done = 1</pre>
<pre class='cython code score-0 '>            __pyx_v_done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1032</span>:                         indout = -2</pre>
<pre class='cython code score-0 '>            __pyx_v_indout = -2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1033</span>:                     elif sca&gt;=0 and k&lt;min(kin,kout):</pre>
<pre class='cython code score-0 '>          __pyx_t_7 = ((__pyx_v_sca &gt;= 0.0) != 0);
          if (__pyx_t_7) {
          } else {
            __pyx_t_4 = __pyx_t_7;
            goto __pyx_L154_bool_binop_done;
          }
          __pyx_t_2 = __pyx_v_kout;
          __pyx_t_1 = __pyx_v_kin;
          if (((__pyx_t_2 &lt; __pyx_t_1) != 0)) {
            __pyx_t_9 = __pyx_t_2;
          } else {
            __pyx_t_9 = __pyx_t_1;
          }
          __pyx_t_7 = ((__pyx_v_k &lt; __pyx_t_9) != 0);
          __pyx_t_4 = __pyx_t_7;
          __pyx_L154_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
          }
          __pyx_L151:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1034</span>:                         kin = k</pre>
<pre class='cython code score-0 '>            __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1035</span>:                         indin = -2</pre>
<pre class='cython code score-0 '>            __pyx_v_indin = -2;
</pre><pre class="cython line score-0">&#xA0;<span class="">1036</span>:     # == Analyzing if there was impact =========================================</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1037</span>:     if done==1:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_done == 1) != 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1038</span>:         if is_in_struct :</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = (__pyx_v_is_in_struct != 0);
    if (__pyx_t_4) {
/* … */
      goto __pyx_L157;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1039</span>:             kpout_loc[0] = kout</pre>
<pre class='cython code score-0 '>      (__pyx_v_kpout_loc[0]) = __pyx_v_kout;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1040</span>:             if indout==-1:</pre>
<pre class='cython code score-0 '>      switch (__pyx_v_indout) {
        case -1L:
/* … */
        break;
        case -2L:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1041</span>:                 vperpin[0] = -sinl0</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = (-__pyx_v_sinl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1042</span>:                 vperpin[1] = cosl0</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = __pyx_v_cosl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1043</span>:                 vperpin[2] = 0.</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1044</span>:             elif indout==-2:</pre>
<pre class='cython code score-0 '>        break;
        default:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1045</span>:                 vperpin[0] = sinl1</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = __pyx_v_sinl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1046</span>:                 vperpin[1] = -cosl1</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = (-__pyx_v_cosl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1047</span>:                 vperpin[2] = 0.</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">1048</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1049</span>:                 sout0 = ray_orig[0] + kout * ray_vdir[0]</pre>
<pre class='cython code score-0 '>        __pyx_v_sout0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_kout * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1050</span>:                 sout1 = ray_orig[1] + kout * ray_vdir[1]</pre>
<pre class='cython code score-0 '>        __pyx_v_sout1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_kout * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1051</span>:                 phi = Catan2(sout1, sout0)</pre>
<pre class='cython code score-0 '>        __pyx_v_phi = atan2(__pyx_v_sout1, __pyx_v_sout0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1052</span>:                 vperpin[0] = Ccos(phi) * normx[indout]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = (cos(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_indout]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1053</span>:                 vperpin[1] = Csin(phi) * normx[indout]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = (sin(__pyx_v_phi) * (__pyx_v_normx[__pyx_v_indout]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1054</span>:                 vperpin[2] = normy[indout]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = (__pyx_v_normy[__pyx_v_indout]);
        break;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1055</span>:             ind_loc[0] = indout</pre>
<pre class='cython code score-0 '>      (__pyx_v_ind_loc[0]) = __pyx_v_indout;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1056</span>:             if kin&lt;kout:</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = ((__pyx_v_kin &lt; __pyx_v_kout) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1057</span>:                 kpin_loc[0] = kin</pre>
<pre class='cython code score-0 '>        (__pyx_v_kpin_loc[0]) = __pyx_v_kin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1058</span>:         elif kin &lt; kout and kin &lt; res_kin:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_kin &lt; __pyx_v_kout) != 0);
    if (__pyx_t_7) {
    } else {
      __pyx_t_4 = __pyx_t_7;
      goto __pyx_L159_bool_binop_done;
    }
    __pyx_t_7 = ((__pyx_v_kin &lt; __pyx_v_res_kin) != 0);
    __pyx_t_4 = __pyx_t_7;
    __pyx_L159_bool_binop_done:;
    if (__pyx_t_4) {
/* … */
    }
    __pyx_L157:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1059</span>:             kpin_loc[0] = kin</pre>
<pre class='cython code score-0 '>      (__pyx_v_kpin_loc[0]) = __pyx_v_kin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1060</span>:             if indin==-1:</pre>
<pre class='cython code score-0 '>      switch (__pyx_v_indin) {
        case -1L:
/* … */
        break;
        case -2L:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1061</span>:                 vperpin[0] = sinl0</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = __pyx_v_sinl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1062</span>:                 vperpin[1] = -cosl0</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = (-__pyx_v_cosl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1063</span>:                 vperpin[2] = 0.</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1064</span>:             elif indin==-2:</pre>
<pre class='cython code score-0 '>        break;
        default:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1065</span>:                 vperpin[0] = -sinl1</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = (-__pyx_v_sinl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1066</span>:                 vperpin[1] = cosl1</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = __pyx_v_cosl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1067</span>:                 vperpin[2] = 0.</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">1068</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1069</span>:                 sin0 = ray_orig[0] + kin * ray_vdir[0]</pre>
<pre class='cython code score-0 '>        __pyx_v_sin0 = ((__pyx_v_ray_orig[0]) + (__pyx_v_kin * (__pyx_v_ray_vdir[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1070</span>:                 sin1 = ray_orig[1] + kin * ray_vdir[1]</pre>
<pre class='cython code score-0 '>        __pyx_v_sin1 = ((__pyx_v_ray_orig[1]) + (__pyx_v_kin * (__pyx_v_ray_vdir[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1071</span>:                 phi = Catan2(sin1,sin0)</pre>
<pre class='cython code score-0 '>        __pyx_v_phi = atan2(__pyx_v_sin1, __pyx_v_sin0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1072</span>:                 vperpin[0] = -Ccos(phi) * normx[indin]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[0]) = ((-cos(__pyx_v_phi)) * (__pyx_v_normx[__pyx_v_indin]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1073</span>:                 vperpin[1] = -Csin(phi) * normx[indin]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[1]) = ((-sin(__pyx_v_phi)) * (__pyx_v_normx[__pyx_v_indin]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1074</span>:                 vperpin[2] = -normy[indin]</pre>
<pre class='cython code score-0 '>        (__pyx_v_vperpin[2]) = (-(__pyx_v_normy[__pyx_v_indin]));
        break;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1075</span>:             ind_loc[0] = indin</pre>
<pre class='cython code score-0 '>      (__pyx_v_ind_loc[0]) = __pyx_v_indin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1076</span>:     return res_kin != kpin_loc[0]</pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_res_kin != (__pyx_v_kpin_loc[0]));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1077</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1078</span>: cdef inline void compute_inv_and_sign(const double[3] ray_vdir,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_inv_and_sign(double *__pyx_v_ray_vdir, int *__pyx_v_sign, double *__pyx_v_inv_direction) {
  int __pyx_v_t0;
  long __pyx_v_ii;
/* … */
  /* function exit code */
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1079</span>:                                       int[3] sign,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1080</span>:                                       double[3] inv_direction) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1081</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1082</span>:     Computes the inverse direction and sign of each coordinate of a LOS.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1083</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">1084</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">1085</span>:     ray_vdir : (3) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1086</span>:        direction of the LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">1087</span>:     sign : (3) int array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">1088</span>:        for each coordinate of the direction, indicates if negative or not</pre>
<pre class="cython line score-0">&#xA0;<span class="">1089</span>:        If sign[i] = 1, ray_vdir[i] &lt; 0, else sign[i] = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">1090</span>:     inv_direction : (3) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1091</span>:        Inverse on each axis of direction of LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">1092</span>:     """</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1093</span>:     cdef int t0 = 1000000</pre>
<pre class='cython code score-0 '>  __pyx_v_t0 = 0xF4240;
</pre><pre class="cython line score-0">&#xA0;<span class="">1094</span>:     # computing sign and direction</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1095</span>:     for  ii in range(3):</pre>
<pre class='cython code score-0 '>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_ii = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1096</span>:         if ray_vdir[ii] * ray_vdir[ii] &lt; _VSMALL:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = ((((__pyx_v_ray_vdir[__pyx_v_ii]) * (__pyx_v_ray_vdir[__pyx_v_ii])) &lt; __pyx_v_4tofu_4geom_8_GG03_LM__VSMALL) != 0);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1097</span>:             inv_direction[ii] = t0</pre>
<pre class='cython code score-0 '>      (__pyx_v_inv_direction[__pyx_v_ii]) = __pyx_v_t0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1098</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1099</span>:             inv_direction[ii] = 1. / ray_vdir[ii]</pre>
<pre class='cython code score-0 '>    /*else*/ {
      (__pyx_v_inv_direction[__pyx_v_ii]) = (1. / (__pyx_v_ray_vdir[__pyx_v_ii]));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1100</span>:         if ray_vdir[ii] &lt; 0.:</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (((__pyx_v_ray_vdir[__pyx_v_ii]) &lt; 0.) != 0);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1101</span>:             sign[ii] = 1</pre>
<pre class='cython code score-0 '>      (__pyx_v_sign[__pyx_v_ii]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1102</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1103</span>:             sign[ii] = 0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      (__pyx_v_sign[__pyx_v_ii]) = 0;
    }
    __pyx_L6:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1104</span>:     return</pre>
<pre class='cython code score-0 '>  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1105</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1106</span>: cdef inline bint inter_ray_aabb_box(const int[3] sign,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_inter_ray_aabb_box(int *__pyx_v_sign, double *__pyx_v_inv_direction, double *__pyx_v_bounds, double *__pyx_v_ds) {
  double __pyx_v_tmin;
  double __pyx_v_tmax;
  double __pyx_v_tymin;
  double __pyx_v_tymax;
  double __pyx_v_tzmin;
  double __pyx_v_tzmax;
  int __pyx_v_t0;
  int __pyx_v_res;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1107</span>:                                     const double[3] inv_direction,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1108</span>:                                     const double[6] bounds,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1109</span>:                                     const double[3] ds) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1110</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1111</span>:     Computes intersection between a ray (LOS) and a axis aligned bounding</pre>
<pre class="cython line score-0">&#xA0;<span class="">1112</span>:     box. It returns True if ray intersects box, else False.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1113</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">1114</span>:     =====</pre>
<pre class="cython line score-0">&#xA0;<span class="">1115</span>:     sign : (3) int array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1116</span>:        Sign of the direction of the ray.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1117</span>:        If sign[i] = 1, ray_vdir[i] &lt; 0, else sign[i] = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">1118</span>:     inv_direction : (3) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1119</span>:        Inverse on each axis of direction of LOS</pre>
<pre class="cython line score-0">&#xA0;<span class="">1120</span>:     bounds : (6) double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1121</span>:        [3d coords of lowerleftback point of bounding box,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1122</span>:         3d coords of upperrightfront point of bounding box]</pre>
<pre class="cython line score-0">&#xA0;<span class="">1123</span>:     ds : (3) doubel array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1124</span>:        [3d coords of origin of ray]</pre>
<pre class="cython line score-0">&#xA0;<span class="">1125</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">1126</span>:     =======</pre>
<pre class="cython line score-0">&#xA0;<span class="">1127</span>:        True if ray intersects bounding box, else False</pre>
<pre class="cython line score-0">&#xA0;<span class="">1128</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1129</span>:     cdef double tmin, tmax, tymin, tymax</pre>
<pre class="cython line score-0">&#xA0;<span class="">1130</span>:     cdef double tzmin, tzmax</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1131</span>:     cdef int t0 = 1000000</pre>
<pre class='cython code score-0 '>  __pyx_v_t0 = 0xF4240;
</pre><pre class="cython line score-0">&#xA0;<span class="">1132</span>:     cdef bint res</pre>
<pre class="cython line score-0">&#xA0;<span class="">1133</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1134</span>:     # computing intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1135</span>:     tmin = (bounds[sign[0]*3] - ds[0]) * inv_direction[0];</pre>
<pre class='cython code score-0 '>  __pyx_v_tmin = (((__pyx_v_bounds[((__pyx_v_sign[0]) * 3)]) - (__pyx_v_ds[0])) * (__pyx_v_inv_direction[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1136</span>:     tmax = (bounds[(1-sign[0])*3] - ds[0]) * inv_direction[0];</pre>
<pre class='cython code score-0 '>  __pyx_v_tmax = (((__pyx_v_bounds[((1 - (__pyx_v_sign[0])) * 3)]) - (__pyx_v_ds[0])) * (__pyx_v_inv_direction[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1137</span>:     tymin = (bounds[(sign[1])*3 + 1] - ds[1]) * inv_direction[1];</pre>
<pre class='cython code score-0 '>  __pyx_v_tymin = (((__pyx_v_bounds[(((__pyx_v_sign[1]) * 3) + 1)]) - (__pyx_v_ds[1])) * (__pyx_v_inv_direction[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1138</span>:     tymax = (bounds[(1-sign[1])*3+1] - ds[1]) * inv_direction[1];</pre>
<pre class='cython code score-0 '>  __pyx_v_tymax = (((__pyx_v_bounds[(((1 - (__pyx_v_sign[1])) * 3) + 1)]) - (__pyx_v_ds[1])) * (__pyx_v_inv_direction[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1139</span>:     if ( (tmin &gt; tymax) or (tymin &gt; tmax) ):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tymax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tymin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1140</span>:         return 0</pre>
<pre class='cython code score-0 '>    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1141</span>:     if (tymin &gt; tmin):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1142</span>:         tmin = tymin</pre>
<pre class='cython code score-0 '>    __pyx_v_tmin = __pyx_v_tymin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1143</span>:     if (tymax &lt; tmax):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tymax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1144</span>:         tmax = tymax</pre>
<pre class='cython code score-0 '>    __pyx_v_tmax = __pyx_v_tymax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1145</span>:     tzmin = (bounds[(sign[2])*3+2] - ds[2]) * inv_direction[2]</pre>
<pre class='cython code score-0 '>  __pyx_v_tzmin = (((__pyx_v_bounds[(((__pyx_v_sign[2]) * 3) + 2)]) - (__pyx_v_ds[2])) * (__pyx_v_inv_direction[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1146</span>:     tzmax = (bounds[(1-sign[2])*3+2] - ds[2]) * inv_direction[2]</pre>
<pre class='cython code score-0 '>  __pyx_v_tzmax = (((__pyx_v_bounds[(((1 - (__pyx_v_sign[2])) * 3) + 2)]) - (__pyx_v_ds[2])) * (__pyx_v_inv_direction[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1147</span>:     if ( (tmin &gt; tzmax) or (tzmin &gt; tmax) ):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tzmax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L9_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tzmin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L9_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1148</span>:         return 0</pre>
<pre class='cython code score-0 '>    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1149</span>:     if (tzmin &gt; tmin):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tzmin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1150</span>:         tmin = tzmin</pre>
<pre class='cython code score-0 '>    __pyx_v_tmin = __pyx_v_tzmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1151</span>:     if (tzmax &lt; tmax):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tzmax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1152</span>:         tmax = tzmax</pre>
<pre class='cython code score-0 '>    __pyx_v_tmax = __pyx_v_tzmax;
</pre><pre class="cython line score-0">&#xA0;<span class="">1153</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1154</span>:     res = (tmin &lt; t0) and (tmax &gt; -t0)</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_tmin &lt; __pyx_v_t0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tmax &gt; (-__pyx_v_t0)) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L13_bool_binop_done:;
  __pyx_v_res = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1155</span>:     if (tmin &lt; 0) :</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_tmin &lt; 0.0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1156</span>:         return 0</pre>
<pre class='cython code score-0 '>    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1157</span>:     return  res</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_res;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1158</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1159</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1160</span>: cdef inline bint is_point_in_path(int nvert,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(int __pyx_v_nvert, double *__pyx_v_vertx, double *__pyx_v_verty, double __pyx_v_testx, double __pyx_v_testy) {
  int __pyx_v_i;
  int __pyx_v_c;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1161</span>:                                   double* vertx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1162</span>:                                   double* verty,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1163</span>:                                   double testx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1164</span>:                                   double testy) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1165</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1166</span>:     Computes if a point of coordiates (testx, testy) is in the polygon defined</pre>
<pre class="cython line score-0">&#xA0;<span class="">1167</span>:     by nvert vertices of coordinates (vertx, verty)</pre>
<pre class="cython line score-0">&#xA0;<span class="">1168</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">1169</span>:     ======</pre>
<pre class="cython line score-0">&#xA0;<span class="">1170</span>:     nvert : int</pre>
<pre class="cython line score-0">&#xA0;<span class="">1171</span>:        number of vertices in polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1172</span>:     vertx : double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1173</span>:        x-coordinates of polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1174</span>:     verty : double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1175</span>:        y-coordinate of polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1176</span>:     testx : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">1177</span>:        x-coordinate of point to be tested if in or out of polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1178</span>:     testy : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">1179</span>:        y-coordinate of point to be tested if in or out of polygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1180</span>:     Returns</pre>
<pre class="cython line score-0">&#xA0;<span class="">1181</span>:     =======</pre>
<pre class="cython line score-0">&#xA0;<span class="">1182</span>:     bool : True if point is in the polygon, else False</pre>
<pre class="cython line score-0">&#xA0;<span class="">1183</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1184</span>:     cdef int i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1185</span>:     cdef bint c = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_c = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1186</span>:     for i in range(nvert):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_nvert;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1187</span>:         if ( ((verty[i]&gt;testy) != (verty[i+1]&gt;testy)) and</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = ((((__pyx_v_verty[__pyx_v_i]) &gt; __pyx_v_testy) != ((__pyx_v_verty[(__pyx_v_i + 1)]) &gt; __pyx_v_testy)) != 0);
    if (__pyx_t_5) {
    } else {
      __pyx_t_4 = __pyx_t_5;
      goto __pyx_L6_bool_binop_done;
    }
/* … */
    if (__pyx_t_4) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1188</span>:             (testx &lt; (vertx[i+1]-vertx[i]) * (testy-verty[i]) \</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = ((__pyx_v_testx &lt; (((((__pyx_v_vertx[(__pyx_v_i + 1)]) - (__pyx_v_vertx[__pyx_v_i])) * (__pyx_v_testy - (__pyx_v_verty[__pyx_v_i]))) / ((__pyx_v_verty[(__pyx_v_i + 1)]) - (__pyx_v_verty[__pyx_v_i]))) + (__pyx_v_vertx[__pyx_v_i]))) != 0);
    __pyx_t_4 = __pyx_t_5;
    __pyx_L6_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1189</span>:              / (verty[i+1]-verty[i]) + vertx[i]) ):</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1190</span>:             c = not c</pre>
<pre class='cython code score-0 '>      __pyx_v_c = (!(__pyx_v_c != 0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1191</span>:     return c</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_c;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1192</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1193</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1194</span>: cdef inline void compute_bbox_extr(int nvert,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_extr(int __pyx_v_nvert, __Pyx_memviewslice __pyx_v_vert, double *__pyx_v_bounds) {
  int __pyx_v_ii;
  double __pyx_v_rmax;
  double __pyx_v_zmin;
  double __pyx_v_zmax;
  double __pyx_v_tmp_val;
/* … */
  /* function exit code */
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1195</span>:                                    double[:,::1] vert,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1196</span>:                                    double[6] bounds) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1197</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1198</span>:     Computes bounding box of a toroidally continous structure defined by</pre>
<pre class="cython line score-0">&#xA0;<span class="">1199</span>:     the vertices vert.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1200</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">1201</span>:     =====</pre>
<pre class="cython line score-0">&#xA0;<span class="">1202</span>:     nvert : inter</pre>
<pre class="cython line score-0">&#xA0;<span class="">1203</span>:        Number of vertices in the poygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1204</span>:     vert : double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1205</span>:        Coordinates of the polygon defining the structure in the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">1206</span>:        such that vert[0:3, ii] = (x_i, y_i) the coordinates of the i-th vertex</pre>
<pre class="cython line score-0">&#xA0;<span class="">1207</span>:     bounds : (6) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">1208</span>:        coordinates of the lowerleftback point and of the upperrightfront point</pre>
<pre class="cython line score-0">&#xA0;<span class="">1209</span>:        of the bounding box of the structure toroidally continous on the tore.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1210</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1211</span>:     cdef int ii</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1212</span>:     cdef double rmax=vert[0,0], zmin=vert[1,0], zmax=vert[1,0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_v_rmax = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_1 * __pyx_v_vert.strides[0]) )) + __pyx_t_2)) )));
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_v_zmin = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_3 * __pyx_v_vert.strides[0]) )) + __pyx_t_4)) )));
  __pyx_t_5 = 1;
  __pyx_t_6 = 0;
  __pyx_v_zmax = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_5 * __pyx_v_vert.strides[0]) )) + __pyx_t_6)) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">1213</span>:     cdef double tmp_val</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1214</span>:     for ii in range(1, nvert):</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_nvert;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 1; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_ii = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1215</span>:         tmp_val = vert[0,ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = 0;
    __pyx_t_11 = __pyx_v_ii;
    __pyx_v_tmp_val = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_10 * __pyx_v_vert.strides[0]) )) + __pyx_t_11)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1216</span>:         if tmp_val &gt; rmax:</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = ((__pyx_v_tmp_val &gt; __pyx_v_rmax) != 0);
    if (__pyx_t_12) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1217</span>:             rmax = tmp_val</pre>
<pre class='cython code score-0 '>      __pyx_v_rmax = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1218</span>:         tmp_val = vert[1,ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = 1;
    __pyx_t_14 = __pyx_v_ii;
    __pyx_v_tmp_val = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_13 * __pyx_v_vert.strides[0]) )) + __pyx_t_14)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1219</span>:         if tmp_val &gt; zmax:</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = ((__pyx_v_tmp_val &gt; __pyx_v_zmax) != 0);
    if (__pyx_t_12) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1220</span>:             zmax = tmp_val</pre>
<pre class='cython code score-0 '>      __pyx_v_zmax = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1221</span>:         elif tmp_val &lt; zmin:</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = ((__pyx_v_tmp_val &lt; __pyx_v_zmin) != 0);
    if (__pyx_t_12) {
/* … */
    }
    __pyx_L6:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1222</span>:             zmin = tmp_val</pre>
<pre class='cython code score-0 '>      __pyx_v_zmin = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1223</span>:     bounds[0] = -rmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[0]) = (-__pyx_v_rmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1224</span>:     bounds[1] = -rmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[1]) = (-__pyx_v_rmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1225</span>:     bounds[2] = zmin</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[2]) = __pyx_v_zmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1226</span>:     bounds[3] = rmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[3]) = __pyx_v_rmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1227</span>:     bounds[4] = rmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[4]) = __pyx_v_rmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1228</span>:     bounds[5] = zmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[5]) = __pyx_v_zmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1229</span>:     return</pre>
<pre class='cython code score-0 '>  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1230</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1231</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1232</span>: cdef inline void compute_bbox_lim(int nvert,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_lim(int __pyx_v_nvert, __Pyx_memviewslice __pyx_v_vert, double *__pyx_v_bounds, double __pyx_v_lmin, double __pyx_v_lmax) {
  int __pyx_v_ii;
  double __pyx_v_toto;
  double __pyx_v_xmin;
  double __pyx_v_xmax;
  double __pyx_v_ymin;
  double __pyx_v_ymax;
  double __pyx_v_zmin;
  double __pyx_v_zmax;
  double __pyx_v_cos_min;
  double __pyx_v_sin_min;
  double __pyx_v_cos_max;
  double __pyx_v_sin_max;
  double __pyx_v_temp[3];
/* … */
  /* function exit code */
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1233</span>:                                   double[:,::1] vert,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1234</span>:                                   double[6] bounds,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1235</span>:                                   double lmin, double lmax) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1236</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1237</span>:     Computes bounding box of a toroidally limited structure defined by</pre>
<pre class="cython line score-0">&#xA0;<span class="">1238</span>:     the vertices vert, and limited to the angles (lmin, lmax)</pre>
<pre class="cython line score-0">&#xA0;<span class="">1239</span>:     Params</pre>
<pre class="cython line score-0">&#xA0;<span class="">1240</span>:     =====</pre>
<pre class="cython line score-0">&#xA0;<span class="">1241</span>:     nvert : inter</pre>
<pre class="cython line score-0">&#xA0;<span class="">1242</span>:        Number of vertices in the poygon</pre>
<pre class="cython line score-0">&#xA0;<span class="">1243</span>:     vert : double array</pre>
<pre class="cython line score-0">&#xA0;<span class="">1244</span>:        Coordinates of the polygon defining the structure in the poloidal plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">1245</span>:        such that vert[0:3, ii] = (x_i, y_i) the coordinates of the i-th vertex</pre>
<pre class="cython line score-0">&#xA0;<span class="">1246</span>:     bounds : (6) double array &lt;INOUT&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">1247</span>:        coordinates of the lowerleftback point and of the upperrightfront point</pre>
<pre class="cython line score-0">&#xA0;<span class="">1248</span>:        of the bounding box of the structure toroidally limited on the tore.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1249</span>:     lmin : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">1250</span>:        minimum toroidal angle where the structure lays.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1251</span>:     lmax : double</pre>
<pre class="cython line score-0">&#xA0;<span class="">1252</span>:        maximum toroidal angle where the structure lays.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1253</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1254</span>:     cdef int ii</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1255</span>:     cdef double toto=100000.</pre>
<pre class='cython code score-0 '>  __pyx_v_toto = 100000.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1256</span>:     cdef double xmin=toto, xmax=-toto</pre>
<pre class='cython code score-0 '>  __pyx_v_xmin = __pyx_v_toto;
  __pyx_v_xmax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1257</span>:     cdef double ymin=toto, ymax=-toto</pre>
<pre class='cython code score-0 '>  __pyx_v_ymin = __pyx_v_toto;
  __pyx_v_ymax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1258</span>:     cdef double zmin=toto, zmax=-toto</pre>
<pre class='cython code score-0 '>  __pyx_v_zmin = __pyx_v_toto;
  __pyx_v_zmax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1259</span>:     cdef double cos_min = Ccos(lmin)</pre>
<pre class='cython code score-0 '>  __pyx_v_cos_min = cos(__pyx_v_lmin);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1260</span>:     cdef double sin_min = Csin(lmin)</pre>
<pre class='cython code score-0 '>  __pyx_v_sin_min = sin(__pyx_v_lmin);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1261</span>:     cdef double cos_max = Ccos(lmax)</pre>
<pre class='cython code score-0 '>  __pyx_v_cos_max = cos(__pyx_v_lmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1262</span>:     cdef double sin_max = Csin(lmax)</pre>
<pre class='cython code score-0 '>  __pyx_v_sin_max = sin(__pyx_v_lmax);
</pre><pre class="cython line score-0">&#xA0;<span class="">1263</span>:     cdef double[3] temp</pre>
<pre class="cython line score-0">&#xA0;<span class="">1264</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1265</span>:     for ii in range(nvert):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_nvert;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_ii = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1266</span>:         temp[0] = vert[0, ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_ii;
    (__pyx_v_temp[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_4 * __pyx_v_vert.strides[0]) )) + __pyx_t_5)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1267</span>:         temp[1] = vert[1, ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_7 = __pyx_v_ii;
    (__pyx_v_temp[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_6 * __pyx_v_vert.strides[0]) )) + __pyx_t_7)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1268</span>:         coordshift_simple1d(temp, in_is_cartesian=False, CrossRef=1.,</pre>
<pre class='cython code score-0 '>    __pyx_t_8.__pyx_n = 4;
    __pyx_t_8.in_is_cartesian = 0;
    __pyx_t_8.CrossRef = 1.;
    __pyx_t_8.cos_phi = __pyx_v_cos_min;
    __pyx_t_8.sin_phi = __pyx_v_sin_min;
    __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(__pyx_v_temp, &amp;__pyx_t_8); 
</pre><pre class="cython line score-0">&#xA0;<span class="">1269</span>:                           cos_phi=cos_min, sin_phi=sin_min)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1270</span>:         if xmin &gt; temp[0]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_xmin &gt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1271</span>:             xmin = temp[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_xmin = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1272</span>:         if xmax &lt; temp[0]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_xmax &lt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1273</span>:             xmax = temp[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_xmax = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1274</span>:         if ymin &gt; temp[1]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_ymin &gt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1275</span>:             ymin = temp[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_ymin = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1276</span>:         if ymax &lt; temp[1]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_ymax &lt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1277</span>:             ymax = temp[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_ymax = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1278</span>:         if zmin &gt; temp[2]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_zmin &gt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1279</span>:             zmin = temp[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_zmin = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1280</span>:         if zmax &lt; temp[2]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_zmax &lt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1281</span>:             zmax = temp[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_zmax = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1282</span>:         temp[0] = vert[0, ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = 0;
    __pyx_t_11 = __pyx_v_ii;
    (__pyx_v_temp[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_10 * __pyx_v_vert.strides[0]) )) + __pyx_t_11)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1283</span>:         temp[1] = vert[1, ii]</pre>
<pre class='cython code score-0 '>    __pyx_t_12 = 1;
    __pyx_t_13 = __pyx_v_ii;
    (__pyx_v_temp[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_12 * __pyx_v_vert.strides[0]) )) + __pyx_t_13)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1284</span>:         coordshift_simple1d(temp, in_is_cartesian=False, CrossRef=1.,</pre>
<pre class='cython code score-0 '>    __pyx_t_8.__pyx_n = 4;
    __pyx_t_8.in_is_cartesian = 0;
    __pyx_t_8.CrossRef = 1.;
    __pyx_t_8.cos_phi = __pyx_v_cos_max;
    __pyx_t_8.sin_phi = __pyx_v_sin_max;
    __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(__pyx_v_temp, &amp;__pyx_t_8); 
</pre><pre class="cython line score-0">&#xA0;<span class="">1285</span>:                           cos_phi=cos_max, sin_phi=sin_max)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1286</span>:         if xmin &gt; temp[0]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_xmin &gt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1287</span>:             xmin = temp[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_xmin = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1288</span>:         if xmax &lt; temp[0]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_xmax &lt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1289</span>:             xmax = temp[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_xmax = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1290</span>:         if ymin &gt; temp[1]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_ymin &gt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1291</span>:             ymin = temp[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_ymin = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1292</span>:         if ymax &lt; temp[1]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_ymax &lt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1293</span>:             ymax = temp[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_ymax = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1294</span>:         if zmin &gt; temp[2]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_zmin &gt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1295</span>:             zmin = temp[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_zmin = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1296</span>:         if zmax &lt; temp[2]:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_zmax &lt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1297</span>:             zmax = temp[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_zmax = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1298</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1299</span>:     bounds[0] = xmin</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[0]) = __pyx_v_xmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1300</span>:     bounds[1] = ymin</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[1]) = __pyx_v_ymin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1301</span>:     bounds[2] = zmin</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[2]) = __pyx_v_zmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1302</span>:     bounds[3] = xmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[3]) = __pyx_v_xmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1303</span>:     bounds[4] = ymax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[4]) = __pyx_v_ymax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1304</span>:     bounds[5] = zmax</pre>
<pre class='cython code score-0 '>  (__pyx_v_bounds[5]) = __pyx_v_zmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1305</span>:     return</pre>
<pre class='cython code score-0 '>  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1306</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1307</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1308</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1309</span>: cdef inline void coordshift_simple1d(double[3] pts, bint in_is_cartesian=True,</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(double *__pyx_v_pts, struct __pyx_opt_args_4tofu_4geom_8_GG03_LM_coordshift_simple1d *__pyx_optional_args) {
  int __pyx_v_in_is_cartesian = ((int)1);
  double __pyx_v_CrossRef = ((double)0.);
  double __pyx_v_cos_phi = ((double)0.);
  double __pyx_v_sin_phi = ((double)0.);
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  double __pyx_v_r;
  double __pyx_v_p;
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_in_is_cartesian = __pyx_optional_args-&gt;in_is_cartesian;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_CrossRef = __pyx_optional_args-&gt;CrossRef;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_cos_phi = __pyx_optional_args-&gt;cos_phi;
          if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {
            __pyx_v_sin_phi = __pyx_optional_args-&gt;sin_phi;
          }
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L0:;
}
/* … */
struct __pyx_opt_args_4tofu_4geom_8_GG03_LM_coordshift_simple1d {
  int __pyx_n;
  int in_is_cartesian;
  double CrossRef;
  double cos_phi;
  double sin_phi;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">1310</span>:                                      double CrossRef=0., double cos_phi=0.,</pre>
<pre class="cython line score-0">&#xA0;<span class="">1311</span>:                                      double sin_phi=0.) nogil:</pre>
<pre class="cython line score-0">&#xA0;<span class="">1312</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1313</span>:     Similar to coordshift but only pas from 3D cartesian to 3D toroidal</pre>
<pre class="cython line score-0">&#xA0;<span class="">1314</span>:     coordinates or vice-versa.</pre>
<pre class="cython line score-0">&#xA0;<span class="">1315</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">1316</span>:     cdef double x, y, z</pre>
<pre class="cython line score-0">&#xA0;<span class="">1317</span>:     cdef double r, p</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1318</span>:     if in_is_cartesian:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_in_is_cartesian != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1319</span>:         if CrossRef==0.:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_CrossRef == 0.) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1320</span>:             x = pts[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_x = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1321</span>:             y = pts[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_y = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1322</span>:             z = pts[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_z = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1323</span>:             pts[0] = Csqrt(x*x+y*y)</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[0]) = sqrt(((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1324</span>:             pts[1] = z</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[1]) = __pyx_v_z;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1325</span>:             pts[2] = Catan2(y,x)</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[2]) = atan2(__pyx_v_y, __pyx_v_x);
</pre><pre class="cython line score-0">&#xA0;<span class="">1326</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1327</span>:             x = pts[0]</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_x = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1328</span>:             y = pts[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_y = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1329</span>:             z = pts[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_z = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1330</span>:             pts[0] = Csqrt(x*x+y*y)</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[0]) = sqrt(((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1331</span>:             pts[1] = z</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[1]) = __pyx_v_z;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1332</span>:             pts[2] = CrossRef</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[2]) = __pyx_v_CrossRef;
    }
    __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1333</span>:     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1334</span>:         if CrossRef==0.:</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_1 = ((__pyx_v_CrossRef == 0.) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1335</span>:             r = pts[0]</pre>
<pre class='cython code score-0 '>      __pyx_v_r = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1336</span>:             z = pts[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_z = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1337</span>:             p = pts[2]</pre>
<pre class='cython code score-0 '>      __pyx_v_p = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1338</span>:             pts[0] = r*Ccos(p)</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[0]) = (__pyx_v_r * cos(__pyx_v_p));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1339</span>:             pts[1] = r*Csin(p)</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[1]) = (__pyx_v_r * sin(__pyx_v_p));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1340</span>:             pts[2] = z</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[2]) = __pyx_v_z;
</pre><pre class="cython line score-0">&#xA0;<span class="">1341</span>:         else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1342</span>:             r = pts[0]</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_r = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1343</span>:             z = pts[1]</pre>
<pre class='cython code score-0 '>      __pyx_v_z = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1344</span>:             pts[0] = r*cos_phi</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[0]) = (__pyx_v_r * __pyx_v_cos_phi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1345</span>:             pts[1] = r*sin_phi</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[1]) = (__pyx_v_r * __pyx_v_sin_phi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1346</span>:             pts[2] = z</pre>
<pre class='cython code score-0 '>      (__pyx_v_pts[2]) = __pyx_v_z;
    }
    __pyx_L5:;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1347</span>:     return</pre>
<pre class='cython code score-0 '>  goto __pyx_L0;
</pre></div></body></html>
