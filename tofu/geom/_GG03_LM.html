<!DOCTYPE html>
<!-- Generated by Cython 0.29 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: _GG03_LM.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
.cython .hll { background-color: #ffffcc }
.cython  { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="_GG03_LM.c">_GG03_LM.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># cython: boundscheck=False</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(1,0,<span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>)
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="c"># cython: wraparound=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="c"># cython: cdivision=True</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="k">cimport</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">sqrt</span> <span class="k">as</span> <span class="n">Csqrt</span><span class="p">,</span> <span class="n">ceil</span> <span class="k">as</span> <span class="n">Cceil</span><span class="p">,</span> <span class="n">fabs</span> <span class="k">as</span> <span class="n">Cabs</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">floor</span> <span class="k">as</span> <span class="n">Cfloor</span><span class="p">,</span> <span class="n">log2</span> <span class="k">as</span> <span class="n">Clog2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">cos</span> <span class="k">as</span> <span class="n">Ccos</span><span class="p">,</span> <span class="n">acos</span> <span class="k">as</span> <span class="n">Cacos</span><span class="p">,</span> <span class="n">sin</span> <span class="k">as</span> <span class="n">Csin</span><span class="p">,</span> <span class="n">asin</span> <span class="k">as</span> <span class="n">Casin</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">atan2</span> <span class="k">as</span> <span class="n">Catan2</span><span class="p">,</span> <span class="n">pi</span> <span class="k">as</span> <span class="n">Cpi</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">NAN</span> <span class="k">as</span> <span class="n">Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="k">from</span> <span class="nn">cpython.mem</span> <span class="k">cimport</span> <span class="n">PyMem_Malloc</span><span class="p">,</span> <span class="n">PyMem_Free</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="k">from</span> <span class="nn">cpython.array</span> <span class="k">cimport</span> <span class="n">array</span><span class="p">,</span> <span class="n">clone</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">015</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(15,0,<span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>)
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 15, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">016</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">_SMALL</span> <span class="o">=</span> <span class="mf">1.e-6</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(16,0,<span class='error_goto'>__PYX_ERR(0, 16, __pyx_L1_error)</span>)
  __pyx_v_4tofu_4geom_8_GG03_LM__SMALL = 1.e-6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">017</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">_VERYSMALL</span> <span class="o">=</span> <span class="mf">1.e-9</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(17,0,<span class='error_goto'>__PYX_ERR(0, 17, __pyx_L1_error)</span>)
  __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL = 1.e-9;
</pre><pre class="cython line score-0">&#xA0;<span class="">018</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="c"># =============================================================================</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="c"># = Set of functions for Ray-tracing</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: <span class="c"># =============================================================================</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: </pre>
<pre class="cython line score-327" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">023</span>: <span class="k">def</span> <span class="nf">LOS_Calc_PInOut_VesStruct</span><span class="p">(</span><span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">Ds</span><span class="p">,</span>    <span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">dus</span><span class="p">,</span></pre>
<pre class='cython code score-327 '>static PyObject *__pyx_pf_4tofu_4geom_8_GG03_LM_2__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__defaults__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__defaults__", __pyx_f[0], 23, 0, <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
/* … */
  <span class='trace'>__Pyx_TraceLine</span>(23,0,<span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>)
  __pyx_t_3 = __pyx_memoryview_fromslice(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_Lim, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
/* … */
  <span class='trace'>__Pyx_TraceLine</span>(23,0,<span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>)
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_EpsUz);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_EpsA);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_EpsVz);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_EpsB);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_EpsPlane);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
/* … */
  <span class='trace'>__Pyx_TraceLine</span>(23,0,<span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>)
  __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(16);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)Py_None));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)Py_None));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3, ((PyObject *)Py_None));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)Py_None));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)Py_None));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 4, ((PyObject *)Py_None));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)Py_None));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)Py_None));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 5, ((PyObject *)Py_None));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)Py_None));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)Py_None));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 6, ((PyObject *)Py_None));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 7, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 8, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 9, __pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 10, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 11, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 12, __pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject*)__pyx_n_s_Tor));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject*)__pyx_n_s_Tor));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 13, ((PyObject*)__pyx_n_s_Tor));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 14, __pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 15, __pyx_t_11);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_8 = 0;
  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, Py_None);
  __pyx_t_12 = 0;
  __pyx_r = __pyx_t_11;
  __pyx_t_11 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("tofu.geom._GG03_LM.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct[] = "\n    Computes the entry and exit point of all provided LOS for the provided\n    vessel polygon (toroidal or linear) with its associated structures.\n    Return the normal vector at impact and the index of the impact segment\n\n    Params\n    ======\n    Ds : (3, num_los) double array\n       LOS origin points coordinates\n    us : (3, num_los) double array\n       LOS normalized direction vector\n    VPoly : (2, num_vertex) double array\n       Coordinates of the vertices of the Polygon defining the 2D poloidal\n       cut of the Vessel\n    VIn : (2, num_vertex-1) double array\n       Normal vectors going \"inwards\" of the edges of the Polygon defined\n       by VPoly\n    nLim : int\n       Number of limits of the vessel\n           -1 : no limits, vessel continuous all around\n            1 : vessel is limited\n    Lim : array\n       If nLim==1 contains the limits min and max of vessel\n    ntotStruc : int\n       Total number of structures (counting each limited structure as one)\n    LSPoly : list\n       List of coordinates of the vertices of all structures on poloidal plane\n    LSLim : list\n       List of limits of all structures\n    LSnLim : list\n       List of number of limits for all structures\n    LSVIn : list\n       List of coordinates of \"inwards\" normal vectors of the polygon of all\n       the structures\n    RMin : double\n       Minimal radius of vessel to take into consideration\n    Eps&lt;val&gt; : double\n       Small value, acceptance of error\n    Vtype : string\n       Type of vessel (\"Tor\" or \"Lin\")\n    Forbid : bool\n       Should we forbid values behind vissible radius ? (see Rmin)\n    Test : bool\n       Should we run tests ?\n\n    Return\n    ======\n    kPIn : (num_los) array\n       scalars defining level of \"in\" intersection of the LOS (if k=0 at origin)\n    kPOut : (num_los) array\n       scalars defining level of \"out\" intersection of the LOS (if k=0 at origin)\n    VperpOut : (3, num_los) array\n       Coordinate""s of the normal vector of impact of the LOS (NaN if none)\n    IOut : (3, num_los)\n       Index of structure impacted by LOS: IOut[:,ind_los]=(i,j,k) where k is\n       the index of edge impacted on the j-th sub structure of the structure\n       number i. If the LOS impacted the vessel i=j=0\n    ";
static PyMethodDef __pyx_mdef_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct = {"LOS_Calc_PInOut_VesStruct", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct, METH_VARARGS|METH_KEYWORDS, __pyx_doc_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct};
static PyObject *__pyx_pw_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_Ds = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_dus = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_VPoly = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_VIn = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_ntotStruct;
  int __pyx_v_nLim;
  __Pyx_memviewslice __pyx_v_Lim = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_LSPoly = 0;
  PyObject *__pyx_v_LSLim = 0;
  PyObject *__pyx_v_lSnLim = 0;
  PyObject *__pyx_v_LSVIn = 0;
  double __pyx_v_RMin;
  double __pyx_v_EpsUz;
  double __pyx_v_EpsA;
  double __pyx_v_EpsVz;
  double __pyx_v_EpsB;
  double __pyx_v_EpsPlane;
  PyObject *__pyx_v_VType = 0;
  int __pyx_v_Forbid;
  int __pyx_v_Test;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("LOS_Calc_PInOut_VesStruct (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_Ds,&amp;__pyx_n_s_dus,&amp;__pyx_n_s_VPoly,&amp;__pyx_n_s_VIn,&amp;__pyx_n_s_ntotStruct,&amp;__pyx_n_s_nLim,&amp;__pyx_n_s_Lim,&amp;__pyx_n_s_LSPoly,&amp;__pyx_n_s_LSLim,&amp;__pyx_n_s_lSnLim,&amp;__pyx_n_s_LSVIn,&amp;__pyx_n_s_RMin,&amp;__pyx_n_s_EpsUz,&amp;__pyx_n_s_EpsA,&amp;__pyx_n_s_EpsVz,&amp;__pyx_n_s_EpsB,&amp;__pyx_n_s_EpsPlane,&amp;__pyx_n_s_VType,&amp;__pyx_n_s_Forbid,&amp;__pyx_n_s_Test,0};
    PyObject* values[20] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    __pyx_defaults *__pyx_dynamic_args = <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self);
    values[7] = ((PyObject*)((PyObject *)Py_None));
    values[8] = ((PyObject*)((PyObject *)Py_None));
    values[9] = ((PyObject*)((PyObject *)Py_None));
    values[10] = ((PyObject*)((PyObject *)Py_None));
    values[17] = ((PyObject*)((PyObject*)__pyx_n_s_Tor));
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_Ds)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dus)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 20, 1); <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_VPoly)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 20, 2); <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_VIn)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 20, 3); <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ntotStruct);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_nLim);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_Lim);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_LSPoly);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_LSLim);
          if (value) { values[8] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_lSnLim);
          if (value) { values[9] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_LSVIn);
          if (value) { values[10] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_RMin);
          if (value) { values[11] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_EpsUz);
          if (value) { values[12] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_EpsA);
          if (value) { values[13] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_EpsVz);
          if (value) { values[14] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_EpsB);
          if (value) { values[15] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_EpsPlane);
          if (value) { values[16] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_VType);
          if (value) { values[17] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_Forbid);
          if (value) { values[18] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_Test);
          if (value) { values[19] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "LOS_Calc_PInOut_VesStruct") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_Ds = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_Ds.memview)) __PYX_ERR(0, 23, __pyx_L3_error)</span>
    __pyx_v_dus = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_dus.memview)) __PYX_ERR(0, 23, __pyx_L3_error)</span>
    __pyx_v_VPoly = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_VPoly.memview)) __PYX_ERR(0, 24, __pyx_L3_error)</span>
    __pyx_v_VIn = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_VIn.memview)) __PYX_ERR(0, 24, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_ntotStruct = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_ntotStruct == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L3_error)</span>
    } else {
      __pyx_v_ntotStruct = ((int)((int)0));
    }
    if (values[5]) {
      __pyx_v_nLim = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[5]); if (unlikely((__pyx_v_nLim == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L3_error)</span>
    } else {
      __pyx_v_nLim = ((int)((int)-1));
    }
    if (values[6]) {
      __pyx_v_Lim = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_Lim.memview)) __PYX_ERR(0, 26, __pyx_L3_error)</span>
    } else {
      __pyx_v_Lim = __pyx_dynamic_args-&gt;__pyx_arg_Lim;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_Lim, 1);
    }
    __pyx_v_LSPoly = ((PyObject*)values[7]);
    __pyx_v_LSLim = ((PyObject*)values[8]);
    __pyx_v_lSnLim = ((PyObject*)values[9]);
    __pyx_v_LSVIn = ((PyObject*)values[10]);
    if (values[11]) {
      __pyx_v_RMin = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_RMin == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 29, __pyx_L3_error)</span>
    } else {
      __pyx_v_RMin = ((double)((double)-1.0));
    }
    if (values[12]) {
      __pyx_v_EpsUz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_EpsUz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L3_error)</span>
    } else {
      __pyx_v_EpsUz = __pyx_dynamic_args-&gt;__pyx_arg_EpsUz;
    }
    if (values[13]) {
      __pyx_v_EpsA = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[13]); if (unlikely((__pyx_v_EpsA == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 30, __pyx_L3_error)</span>
    } else {
      __pyx_v_EpsA = __pyx_dynamic_args-&gt;__pyx_arg_EpsA;
    }
    if (values[14]) {
      __pyx_v_EpsVz = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[14]); if (unlikely((__pyx_v_EpsVz == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 31, __pyx_L3_error)</span>
    } else {
      __pyx_v_EpsVz = __pyx_dynamic_args-&gt;__pyx_arg_EpsVz;
    }
    if (values[15]) {
      __pyx_v_EpsB = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[15]); if (unlikely((__pyx_v_EpsB == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 31, __pyx_L3_error)</span>
    } else {
      __pyx_v_EpsB = __pyx_dynamic_args-&gt;__pyx_arg_EpsB;
    }
    if (values[16]) {
      __pyx_v_EpsPlane = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[16]); if (unlikely((__pyx_v_EpsPlane == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 32, __pyx_L3_error)</span>
    } else {
      __pyx_v_EpsPlane = __pyx_dynamic_args-&gt;__pyx_arg_EpsPlane;
    }
    __pyx_v_VType = ((PyObject*)values[17]);
    if (values[18]) {
      __pyx_v_Forbid = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[18]); if (unlikely((__pyx_v_Forbid == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 34, __pyx_L3_error)</span>
    } else {
      __pyx_v_Forbid = ((int)((int)1));
    }
    if (values[19]) {
      __pyx_v_Test = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[19]); if (unlikely((__pyx_v_Test == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 34, __pyx_L3_error)</span>
    } else {
      __pyx_v_Test = ((int)((int)1));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("LOS_Calc_PInOut_VesStruct", 0, 4, 20, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("tofu.geom._GG03_LM.LOS_Calc_PInOut_VesStruct", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_LSPoly), (&amp;PyList_Type), 1, "LSPoly", 1))) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_LSLim), (&amp;PyList_Type), 1, "LSLim", 1))) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_lSnLim), (&amp;PyList_Type), 1, "lSnLim", 1))) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_LSVIn), (&amp;PyList_Type), 1, "LSVIn", 1))) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_VType), (&amp;PyString_Type), 1, "VType", 1))) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  __pyx_r = __pyx_pf_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct(__pyx_self, __pyx_v_Ds, __pyx_v_dus, __pyx_v_VPoly, __pyx_v_VIn, __pyx_v_ntotStruct, __pyx_v_nLim, __pyx_v_Lim, __pyx_v_LSPoly, __pyx_v_LSLim, __pyx_v_lSnLim, __pyx_v_LSVIn, __pyx_v_RMin, __pyx_v_EpsUz, __pyx_v_EpsA, __pyx_v_EpsVz, __pyx_v_EpsB, __pyx_v_EpsPlane, __pyx_v_VType, __pyx_v_Forbid, __pyx_v_Test);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4tofu_4geom_8_GG03_LM_LOS_Calc_PInOut_VesStruct(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_Ds, __Pyx_memviewslice __pyx_v_dus, __Pyx_memviewslice __pyx_v_VPoly, __Pyx_memviewslice __pyx_v_VIn, int __pyx_v_ntotStruct, int __pyx_v_nLim, __Pyx_memviewslice __pyx_v_Lim, PyObject *__pyx_v_LSPoly, PyObject *__pyx_v_LSLim, PyObject *__pyx_v_lSnLim, PyObject *__pyx_v_LSVIn, double __pyx_v_RMin, double __pyx_v_EpsUz, double __pyx_v_EpsA, double __pyx_v_EpsVz, double __pyx_v_EpsB, double __pyx_v_EpsPlane, PyObject *__pyx_v_VType, int __pyx_v_Forbid, int __pyx_v_Test) {
  int __pyx_v_ii;
  int __pyx_v_jj;
  int __pyx_v_ind_lim_data;
  int __pyx_v_len_lspoly;
  int __pyx_v_found_new_kout;
  int __pyx_v_lim_is_none;
  int __pyx_v_bool1;
  int __pyx_v_bool2;
  double __pyx_v_val_rmin;
  double __pyx_v_kpout_jj;
  double __pyx_v_L0;
  double __pyx_v_L1;
  int __pyx_v_inter_bbox;
  int __pyx_v_ind_tmp;
  int __pyx_v_len_lim;
  int __pyx_v_num_los;
  int __pyx_v_Ns;
  int __pyx_v_Forbidbis;
  int __pyx_v_Forbid0;
  double __pyx_v_upscaDp;
  double __pyx_v_upar2;
  double __pyx_v_Dpar2;
  double __pyx_v_Crit2;
  double __pyx_v_invDpar2;
  double __pyx_v_rmin2;
  double __pyx_v_L;
  double __pyx_v_S1X;
  double __pyx_v_S1Y;
  double __pyx_v_S2X;
  double __pyx_v_S2Y;
  double __pyx_v_Crit2_base;
  double __pyx_v_loc_vp[3];
  double __pyx_v_last_pout[3];
  double __pyx_v_bounds[6];
  double __pyx_v_kpin_loc[1];
  double __pyx_v_kpout_loc[1];
  double __pyx_v_loc_ds[3];
  double __pyx_v_loc_us[3];
  double __pyx_v_lim_ves[2];
  double __pyx_v_invr_ray[3];
  int __pyx_v_sign_ray[3];
  int __pyx_v_ind_loc[1];
  PyObject *__pyx_v_error_message = 0;
  PyObject *__pyx_v_llim_ves = NULL;
  double *__pyx_v_lbounds;
  double *__pyx_v_langles;
  int *__pyx_v_llen_lim;
  __Pyx_memviewslice __pyx_v_lspoly_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_nvert;
  arrayobject *__pyx_v_kPIn = 0;
  arrayobject *__pyx_v_kPOut = 0;
  arrayobject *__pyx_v_VperpOut = 0;
  arrayobject *__pyx_v_IOut = 0;
  int __pyx_v_found_new;
  PyObject *__pyx_v_lslim = NULL;
  PyObject *__pyx_v_ee = NULL;
  PyObject *__pyx_v_ll = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj_)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("LOS_Calc_PInOut_VesStruct", 0);
  <span class='trace'>__Pyx_TraceCall</span>("LOS_Calc_PInOut_VesStruct", __pyx_f[0], 23, 0, <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_37, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_57, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("tofu.geom._GG03_LM.LOS_Calc_PInOut_VesStruct", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_error_message);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_llim_ves);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lspoly_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_kPIn);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_kPOut);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_VperpOut);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_IOut);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_lslim);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ee);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ll);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Ds, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_dus, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_VPoly, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_VIn, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_Lim, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__44 = <span class='py_c_api'>PyTuple_Pack</span>(79, __pyx_n_s_Ds, __pyx_n_s_dus, __pyx_n_s_VPoly, __pyx_n_s_VIn, __pyx_n_s_ntotStruct, __pyx_n_s_nLim, __pyx_n_s_Lim, __pyx_n_s_LSPoly, __pyx_n_s_LSLim, __pyx_n_s_lSnLim, __pyx_n_s_LSVIn, __pyx_n_s_RMin, __pyx_n_s_EpsUz, __pyx_n_s_EpsA, __pyx_n_s_EpsVz, __pyx_n_s_EpsB, __pyx_n_s_EpsPlane, __pyx_n_s_VType, __pyx_n_s_Forbid, __pyx_n_s_Test, __pyx_n_s_ii, __pyx_n_s_jj, __pyx_n_s_ind_lim_data, __pyx_n_s_len_lspoly, __pyx_n_s_found_new_kout, __pyx_n_s_lim_is_none, __pyx_n_s_bool1, __pyx_n_s_bool2, __pyx_n_s_val_rmin, __pyx_n_s_kpin_jj, __pyx_n_s_kpout_jj, __pyx_n_s_L0, __pyx_n_s_L1, __pyx_n_s_inter_bbox, __pyx_n_s_ind_tmp, __pyx_n_s_len_lim, __pyx_n_s_num_los, __pyx_n_s_Ns, __pyx_n_s_size_lspoly, __pyx_n_s_Forbidbis, __pyx_n_s_Forbid0, __pyx_n_s_upscaDp, __pyx_n_s_upar2, __pyx_n_s_Dpar2, __pyx_n_s_Crit2, __pyx_n_s_invDpar2, __pyx_n_s_rmin2, __pyx_n_s_L, __pyx_n_s_S1X, __pyx_n_s_S1Y, __pyx_n_s_S2X, __pyx_n_s_S2Y, __pyx_n_s_Crit2_base, __pyx_n_s_loc_vp, __pyx_n_s_last_pout, __pyx_n_s_bounds, __pyx_n_s_kpin_loc, __pyx_n_s_kpout_loc, __pyx_n_s_loc_ds, __pyx_n_s_loc_us, __pyx_n_s_lim_ves, __pyx_n_s_invr_ray, __pyx_n_s_sign_ray, __pyx_n_s_ind_loc, __pyx_n_s_error_message, __pyx_n_s_llim_ves, __pyx_n_s_lbounds, __pyx_n_s_langles, __pyx_n_s_llen_lim, __pyx_n_s_lspoly_view, __pyx_n_s_nvert, __pyx_n_s_kPIn, __pyx_n_s_kPOut, __pyx_n_s_VperpOut, __pyx_n_s_IOut, __pyx_n_s_found_new, __pyx_n_s_lslim, __pyx_n_s_ee, __pyx_n_s_ll);<span class='error_goto'> if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__44);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__44);
/* … */
  <span class='trace'>__Pyx_TraceLine</span>(23,0,<span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>)
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_CyFunction_NewEx</span>(&amp;__pyx_mdef_4tofu_4geom_8_GG03_LM_1LOS_Calc_PInOut_VesStruct, 0, __pyx_n_s_LOS_Calc_PInOut_VesStruct, NULL, __pyx_n_s_tofu_geom__GG03_LM, __pyx_d, ((PyObject *)__pyx_codeobj_));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (!<span class='pyx_c_api'>__Pyx_CyFunction_InitDefaults</span>(__pyx_t_1, sizeof(__pyx_defaults), 0)) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  __pyx_codeobj_ = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(20, 0, 79, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_tofu_geom__GG03_LM_pyx, __pyx_n_s_LOS_Calc_PInOut_VesStruct, 23, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">024</span>:                               <span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">VPoly</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">VIn</span><span class="p">,</span></pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">025</span>:                               <span class="nb">int</span> <span class="n">ntotStruct</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">nLim</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class='cython code score-4 '>  <span class='trace'>__Pyx_TraceLine</span>(25,0,<span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>)
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(((int)-1));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">026</span>:                               <span class="n">double</span><span class="p">[:]</span> <span class="n">Lim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class='cython code score-4 '>  <span class='trace'>__Pyx_TraceLine</span>(26,0,<span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>)
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 26, __pyx_L1_error)</span>
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_Lim = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">027</span>:                               <span class="nb">list</span> <span class="n">LSPoly</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">list</span> <span class="n">LSLim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>:                               <span class="nb">list</span> <span class="n">lSnLim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">list</span> <span class="n">LSVIn</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">029</span>:                               <span class="n">double</span> <span class="n">RMin</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(29,0,<span class='error_goto'>__PYX_ERR(0, 29, __pyx_L1_error)</span>)
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)-1.0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 29, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">030</span>:                               <span class="n">double</span> <span class="n">EpsUz</span><span class="o">=</span><span class="n">_SMALL</span><span class="p">,</span>     <span class="n">double</span> <span class="n">EpsA</span><span class="o">=</span><span class="n">_VERYSMALL</span><span class="p">,</span></pre>
<pre class='cython code score-4 '>  <span class='trace'>__Pyx_TraceLine</span>(30,0,<span class='error_goto'>__PYX_ERR(0, 30, __pyx_L1_error)</span>)
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_EpsUz = __pyx_v_4tofu_4geom_8_GG03_LM__SMALL;
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_EpsA = __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">031</span>:                               <span class="n">double</span> <span class="n">EpsVz</span><span class="o">=</span><span class="n">_VERYSMALL</span><span class="p">,</span> <span class="n">double</span> <span class="n">EpsB</span><span class="o">=</span><span class="n">_VERYSMALL</span><span class="p">,</span></pre>
<pre class='cython code score-4 '>  <span class='trace'>__Pyx_TraceLine</span>(31,0,<span class='error_goto'>__PYX_ERR(0, 31, __pyx_L1_error)</span>)
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_EpsVz = __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL;
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_EpsB = __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">032</span>:                               <span class="n">double</span> <span class="n">EpsPlane</span><span class="o">=</span><span class="n">_VERYSMALL</span><span class="p">,</span></pre>
<pre class='cython code score-10 '>  <span class='trace'>__Pyx_TraceLine</span>(32,0,<span class='error_goto'>__PYX_ERR(0, 32, __pyx_L1_error)</span>)
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_1)-&gt;__pyx_arg_EpsPlane = __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL;
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsGetter</span>(__pyx_t_1, __pyx_pf_4tofu_4geom_8_GG03_LM_2__defaults__);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_LOS_Calc_PInOut_VesStruct, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">033</span>:                               <span class="nb">str</span> <span class="n">VType</span><span class="o">=</span><span class="s">&#39;Tor&#39;</span><span class="p">,</span></pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">034</span>:                               <span class="n">bint</span> <span class="n">Forbid</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">bint</span> <span class="n">Test</span><span class="o">=</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-4 '>  <span class='trace'>__Pyx_TraceLine</span>(34,0,<span class='error_goto'>__PYX_ERR(0, 34, __pyx_L1_error)</span>)
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)1));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)1));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
</pre><pre class="cython line score-0">&#xA0;<span class="">035</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="sd">    Computes the entry and exit point of all provided LOS for the provided</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="sd">    vessel polygon (toroidal or linear) with its associated structures.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="sd">    Return the normal vector at impact and the index of the impact segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="sd">    Params</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="sd">    ======</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="sd">    Ds : (3, num_los) double array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">       LOS origin points coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">    us : (3, num_los) double array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="sd">       LOS normalized direction vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="sd">    VPoly : (2, num_vertex) double array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: <span class="sd">       Coordinates of the vertices of the Polygon defining the 2D poloidal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: <span class="sd">       cut of the Vessel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: <span class="sd">    VIn : (2, num_vertex-1) double array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: <span class="sd">       Normal vectors going &quot;inwards&quot; of the edges of the Polygon defined</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: <span class="sd">       by VPoly</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: <span class="sd">    nLim : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: <span class="sd">       Number of limits of the vessel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">           -1 : no limits, vessel continuous all around</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">            1 : vessel is limited</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: <span class="sd">    Lim : array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: <span class="sd">       If nLim==1 contains the limits min and max of vessel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: <span class="sd">    ntotStruc : int</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: <span class="sd">       Total number of structures (counting each limited structure as one)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: <span class="sd">    LSPoly : list</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: <span class="sd">       List of coordinates of the vertices of all structures on poloidal plane</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: <span class="sd">    LSLim : list</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: <span class="sd">       List of limits of all structures</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>: <span class="sd">    LSnLim : list</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: <span class="sd">       List of number of limits for all structures</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>: <span class="sd">    LSVIn : list</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: <span class="sd">       List of coordinates of &quot;inwards&quot; normal vectors of the polygon of all</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: <span class="sd">       the structures</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: <span class="sd">    RMin : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: <span class="sd">       Minimal radius of vessel to take into consideration</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: <span class="sd">    Eps&lt;val&gt; : double</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="sd">       Small value, acceptance of error</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: <span class="sd">    Vtype : string</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: <span class="sd">       Type of vessel (&quot;Tor&quot; or &quot;Lin&quot;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: <span class="sd">    Forbid : bool</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>: <span class="sd">       Should we forbid values behind vissible radius ? (see Rmin)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>: <span class="sd">    Test : bool</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: <span class="sd">       Should we run tests ?</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>: <span class="sd">    Return</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: <span class="sd">    ======</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>: <span class="sd">    kPIn : (num_los) array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: <span class="sd">       scalars defining level of &quot;in&quot; intersection of the LOS (if k=0 at origin)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: <span class="sd">    kPOut : (num_los) array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: <span class="sd">       scalars defining level of &quot;out&quot; intersection of the LOS (if k=0 at origin)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>: <span class="sd">    VperpOut : (3, num_los) array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: <span class="sd">       Coordinates of the normal vector of impact of the LOS (NaN if none)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>: <span class="sd">    IOut : (3, num_los)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: <span class="sd">       Index of structure impacted by LOS: IOut[:,ind_los]=(i,j,k) where k is</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: <span class="sd">       the index of edge impacted on the j-th sub structure of the structure</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>: <span class="sd">       number i. If the LOS impacted the vessel i=j=0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ii</span><span class="p">,</span> <span class="nf">jj</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ind_lim_data</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(95,0,<span class='error_goto'>__PYX_ERR(0, 95, __pyx_L1_error)</span>)
  __pyx_v_ind_lim_data = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">096</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">len_lspoly</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">found_new_kout</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">lim_is_none</span><span class="o">=</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(98,0,<span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>)
  __pyx_v_lim_is_none = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">099</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">bool1</span><span class="p">,</span> <span class="nf">bool2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">val_rmin</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">kpin_jj</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">kpout_jj</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">L0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">L1</span><span class="o">=</span><span class="mf">0.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(103,0,<span class='error_goto'>__PYX_ERR(0, 103, __pyx_L1_error)</span>)
  __pyx_v_L0 = 0.;
  __pyx_v_L1 = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">104</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">inter_bbox</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ind_tmp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">len_lim</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">num_los</span> <span class="o">=</span> <span class="n">Ds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(107,0,<span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>)
  __pyx_v_num_los = (__pyx_v_Ds.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">108</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">Ns</span><span class="o">=</span><span class="n">VIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(108,0,<span class='error_goto'>__PYX_ERR(0, 108, __pyx_L1_error)</span>)
  __pyx_v_Ns = (__pyx_v_VIn.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">109</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">size_lspoly</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">Forbidbis</span><span class="p">,</span> <span class="nf">Forbid0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">upscaDp</span><span class="p">,</span> <span class="nf">upar2</span><span class="p">,</span> <span class="nf">Dpar2</span><span class="p">,</span> <span class="nf">Crit2</span><span class="p">,</span> <span class="nf">invDpar2</span><span class="p">,</span> <span class="nf">rmin2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">L</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">S1X</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">S1Y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">S2X</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">S2Y</span><span class="o">=</span><span class="mf">0.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(112,0,<span class='error_goto'>__PYX_ERR(0, 112, __pyx_L1_error)</span>)
  __pyx_v_L = 0.;
  __pyx_v_S1X = 0.;
  __pyx_v_S1Y = 0.;
  __pyx_v_S2X = 0.;
  __pyx_v_S2Y = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">Crit2_base</span> <span class="o">=</span> <span class="n">EpsUz</span><span class="o">*</span><span class="n">EpsUz</span><span class="o">/</span><span class="mf">400.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(113,0,<span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>)
  __pyx_v_Crit2_base = ((__pyx_v_EpsUz * __pyx_v_EpsUz) / 400.);
</pre><pre class="cython line score-0">&#xA0;<span class="">114</span>:     <span class="k">cdef</span> <span class="kt">double</span> [3] <span class="nf">loc_vp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">last_pout</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:     <span class="k">cdef</span> <span class="kt">double</span>[6] <span class="nf">bounds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:     <span class="k">cdef</span> <span class="kt">double</span>[1] <span class="nf">kpin_loc</span><span class="p">,</span> <span class="nf">kpout_loc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">loc_ds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">loc_us</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:     <span class="k">cdef</span> <span class="kt">double</span>[2] <span class="nf">lim_ves</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">invr_ray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:     <span class="k">cdef</span> <span class="kt">int</span>[3] <span class="nf">sign_ray</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:     <span class="k">cdef</span> <span class="kt">int</span>[1] <span class="nf">ind_loc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:     <span class="k">cdef</span> <span class="kt">str</span> <span class="nf">error_message</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">126</span>:     <span class="k">if</span> <span class="n">Test</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(126,0,<span class='error_goto'>__PYX_ERR(0, 126, __pyx_L1_error)</span>)
  __pyx_t_1 = (__pyx_v_Test != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">127</span>:         <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;Args Ds and dus must be of the same shape: (3,) or (3,NL)!&quot;</span></pre>
<pre class='cython code score-1 '>    <span class='trace'>__Pyx_TraceLine</span>(127,0,<span class='error_goto'>__PYX_ERR(0, 127, __pyx_L1_error)</span>)
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_Args_Ds_and_dus_must_be_of_the_s);
    __pyx_v_error_message = __pyx_kp_s_Args_Ds_and_dus_must_be_of_the_s;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">128</span>:         <span class="k">assert</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Ds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span><span class="p">(</span><span class="n">dus</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">and</span> \</pre>
<pre class='cython code score-16 '>    <span class='trace'>__Pyx_TraceLine</span>(128,0,<span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>)
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_2 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_Ds.shape, 8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_carray_to_py_Py_ssize_t(__pyx_v_dus.shape, 8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PySequence_Tuple</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_t_4, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_5) {
      } else {
        __pyx_t_1 = __pyx_t_5;
        goto __pyx_L4_bool_binop_done;
      }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>:             <span class="n">Ds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">==</span><span class="mf">3</span><span class="p">,</span> <span class="n">error_message</span></pre>
<pre class='cython code score-5 '>      <span class='trace'>__Pyx_TraceLine</span>(129,0,<span class='error_goto'>__PYX_ERR(0, 129, __pyx_L1_error)</span>)
      __pyx_t_5 = (((__pyx_v_Ds.shape[0]) == 3) != 0);
      __pyx_t_1 = __pyx_t_5;
      __pyx_L4_bool_binop_done:;
      if (unlikely(!__pyx_t_1)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">130</span>:         <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;Args VPoly and VIn must be of the same shape (2,NS)!&quot;</span></pre>
<pre class='cython code score-2 '>    <span class='trace'>__Pyx_TraceLine</span>(130,0,<span class='error_goto'>__PYX_ERR(0, 130, __pyx_L1_error)</span>)
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_Args_VPoly_and_VIn_must_be_of_th);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_Args_VPoly_and_VIn_must_be_of_th);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:         <span class="k">assert</span> <span class="n">VPoly</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">==</span><span class="mf">2</span> <span class="ow">and</span> <span class="n">VIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">==</span><span class="mf">2</span> <span class="ow">and</span> \</pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(131,0,<span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>)
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = (((__pyx_v_VPoly.shape[0]) == 2) != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_1 = __pyx_t_5;
        goto __pyx_L6_bool_binop_done;
      }
      __pyx_t_5 = (((__pyx_v_VIn.shape[0]) == 2) != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_1 = __pyx_t_5;
        goto __pyx_L6_bool_binop_done;
      }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>:             <span class="n">VIn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">==</span><span class="n">VPoly</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="n">error_message</span></pre>
<pre class='cython code score-5 '>      <span class='trace'>__Pyx_TraceLine</span>(132,0,<span class='error_goto'>__PYX_ERR(0, 132, __pyx_L1_error)</span>)
      __pyx_t_5 = (((__pyx_v_VIn.shape[1]) == ((__pyx_v_VPoly.shape[1]) - 1)) != 0);
      __pyx_t_1 = __pyx_t_5;
      __pyx_L6_bool_binop_done:;
      if (unlikely(!__pyx_t_1)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>:         <span class="n">bool1</span> <span class="o">=</span> <span class="n">LSLim</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">LSLim</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">LSPoly</span><span class="p">)</span></pre>
<pre class='cython code score-12 '>    <span class='trace'>__Pyx_TraceLine</span>(133,0,<span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>)
    __pyx_t_5 = (__pyx_v_LSLim == ((PyObject*)Py_None));
    __pyx_t_6 = (__pyx_t_5 != 0);
    if (!__pyx_t_6) {
    } else {
      __pyx_t_1 = __pyx_t_6;
      goto __pyx_L9_bool_binop_done;
    }
    if (unlikely(__pyx_v_LSLim == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    }
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_LSLim);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    if (unlikely(__pyx_v_LSPoly == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    }
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_LSPoly);<span class='error_goto'> if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    __pyx_t_6 = ((__pyx_t_7 == __pyx_t_8) != 0);
    __pyx_t_1 = __pyx_t_6;
    __pyx_L9_bool_binop_done:;
    __pyx_v_bool1 = __pyx_t_1;
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:         <span class="n">bool2</span> <span class="o">=</span> <span class="n">LSVIn</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">LSVIn</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">LSPoly</span><span class="p">)</span></pre>
<pre class='cython code score-12 '>    <span class='trace'>__Pyx_TraceLine</span>(134,0,<span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>)
    __pyx_t_6 = (__pyx_v_LSVIn == ((PyObject*)Py_None));
    __pyx_t_5 = (__pyx_t_6 != 0);
    if (!__pyx_t_5) {
    } else {
      __pyx_t_1 = __pyx_t_5;
      goto __pyx_L11_bool_binop_done;
    }
    if (unlikely(__pyx_v_LSVIn == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
    }
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_LSVIn);<span class='error_goto'> if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 134, __pyx_L1_error)</span>
    if (unlikely(__pyx_v_LSPoly == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
    }
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_LSPoly);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 134, __pyx_L1_error)</span>
    __pyx_t_5 = ((__pyx_t_8 == __pyx_t_7) != 0);
    __pyx_t_1 = __pyx_t_5;
    __pyx_L11_bool_binop_done:;
    __pyx_v_bool2 = __pyx_t_1;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:         <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;Args LSPoly,LSLim,LSVIn must be None or lists of same len()!&quot;</span></pre>
<pre class='cython code score-2 '>    <span class='trace'>__Pyx_TraceLine</span>(135,0,<span class='error_goto'>__PYX_ERR(0, 135, __pyx_L1_error)</span>)
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_Args_LSPoly_LSLim_LSVIn_must_be);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_Args_LSPoly_LSLim_LSVIn_must_be);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>:         <span class="k">assert</span> <span class="n">bool1</span> <span class="ow">and</span> <span class="n">bool2</span><span class="p">,</span> <span class="n">error_message</span></pre>
<pre class='cython code score-5 '>    <span class='trace'>__Pyx_TraceLine</span>(136,0,<span class='error_goto'>__PYX_ERR(0, 136, __pyx_L1_error)</span>)
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_5 = (__pyx_v_bool1 != 0);
      if (__pyx_t_5) {
      } else {
        __pyx_t_1 = __pyx_t_5;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_5 = (__pyx_v_bool2 != 0);
      __pyx_t_1 = __pyx_t_5;
      __pyx_L13_bool_binop_done:;
      if (unlikely(!__pyx_t_1)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 136, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:         <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;Args [EpsUz,EpsVz,EpsA,EpsB] must be floats &lt; 1.e-4!&quot;</span></pre>
<pre class='cython code score-2 '>    <span class='trace'>__Pyx_TraceLine</span>(137,0,<span class='error_goto'>__PYX_ERR(0, 137, __pyx_L1_error)</span>)
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_Args_EpsUz_EpsVz_EpsA_EpsB_must);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_Args_EpsUz_EpsVz_EpsA_EpsB_must);
</pre><pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">138</span>:         <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">ee</span><span class="o">&lt;</span><span class="mf">1.e-4</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="p">[</span><span class="n">EpsUz</span><span class="p">,</span><span class="n">EpsVz</span><span class="p">,</span><span class="n">EpsA</span><span class="p">,</span><span class="n">EpsB</span><span class="p">,</span><span class="n">EpsPlane</span><span class="p">]]),</span> <span class="n">error_message</span></pre>
<pre class='cython code score-64 '>    <span class='trace'>__Pyx_TraceLine</span>(138,0,<span class='error_goto'>__PYX_ERR(0, 138, __pyx_L1_error)</span>)
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_EpsUz);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_EpsVz);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_EpsA);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_EpsB);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_EpsPlane);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_4);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 2, __pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 3, __pyx_t_10);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 4, __pyx_t_11);
      __pyx_t_4 = 0;
      __pyx_t_3 = 0;
      __pyx_t_9 = 0;
      __pyx_t_10 = 0;
      __pyx_t_11 = 0;
      __pyx_t_11 = __pyx_t_12; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      for (;;) {
        if (__pyx_t_7 &gt;= 5) break;
        #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_11, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 138, __pyx_L1_error)</span>
        #else
        __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_11, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        #endif
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_ee, __pyx_t_12);
        __pyx_t_12 = 0;
        __pyx_t_12 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_ee, __pyx_float_1_eneg_4, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 138, __pyx_L1_error)
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_12))) __PYX_ERR(0, 138, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_all, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 138, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_1)) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 138, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:         <span class="n">error_message</span> <span class="o">=</span> <span class="s">&quot;Arg VType must be a str in [&#39;Tor&#39;,&#39;Lin&#39;]!&quot;</span></pre>
<pre class='cython code score-2 '>    <span class='trace'>__Pyx_TraceLine</span>(139,0,<span class='error_goto'>__PYX_ERR(0, 139, __pyx_L1_error)</span>)
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_s_Arg_VType_must_be_a_str_in_Tor_L);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_error_message, __pyx_kp_s_Arg_VType_must_be_a_str_in_Tor_L);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:         <span class="k">assert</span> <span class="n">VType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;tor&#39;</span><span class="p">,</span><span class="s">&#39;lin&#39;</span><span class="p">],</span> <span class="n">error_message</span></pre>
<pre class='cython code score-10 '>    <span class='trace'>__Pyx_TraceLine</span>(140,0,<span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>)
    #ifndef CYTHON_WITHOUT_ASSERTIONS
    if (unlikely(!Py_OptimizeFlag)) {
      __pyx_t_11 = __Pyx_CallUnboundCMethod0(&amp;__pyx_umethod_PyString_Type_lower, __pyx_v_VType);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_11, __pyx_n_s_tor, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
      if (!__pyx_t_5) {
      } else {
        __pyx_t_1 = __pyx_t_5;
        goto __pyx_L17_bool_binop_done;
      }
      __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_11, __pyx_n_s_lin, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
      __pyx_t_1 = __pyx_t_5;
      __pyx_L17_bool_binop_done:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!(__pyx_t_1 != 0))) {
        <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_v_error_message);
        <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
      }
    }
    #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:     <span class="c"># cdef double *VperpOut = &lt;double *&gt;PyMem_Malloc(3 * num_los * sizeof(double))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     <span class="c"># # cdef double *kPIn  = &lt;double *&gt;PyMem_Malloc(num_los * sizeof(double))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:     <span class="c"># cdef double *kPOut = &lt;double *&gt;PyMem_Malloc(num_los * sizeof(double))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:     <span class="c"># cdef int *IOut = &lt;int *&gt;PyMem_Malloc(3 * num_los * sizeof(int))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:     <span class="c"># cdef double[:] vperp_view = &lt;double[:num_los*3]&gt; VperpOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:     <span class="c"># # cdef double[:] kpin_view  = &lt;double[:num_los]&gt;kPIn</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:     <span class="c"># cdef double[:] kpout_view = &lt;double[:num_los]&gt;kPOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:     <span class="c"># cdef int[:] ind_view = &lt;int[:3*num_los]&gt;IOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:     <span class="n">llim_ves</span> <span class="o">=</span> <span class="p">[]</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(152,0,<span class='error_goto'>__PYX_ERR(0, 152, __pyx_L1_error)</span>)
  __pyx_t_11 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_v_llim_ves = ((PyObject*)__pyx_t_11);
  __pyx_t_11 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">lbounds</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">PyMem_Malloc</span><span class="p">(</span><span class="n">ntotStruct</span> <span class="o">*</span> <span class="mf">6</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(153,0,<span class='error_goto'>__PYX_ERR(0, 153, __pyx_L1_error)</span>)
  __pyx_v_lbounds = ((double *)<span class='py_c_api'>PyMem_Malloc</span>(((__pyx_v_ntotStruct * 6) * (sizeof(double)))));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:     <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">langles</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span> <span class="o">*&gt;</span><span class="n">PyMem_Malloc</span><span class="p">(</span><span class="n">ntotStruct</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(154,0,<span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>)
  __pyx_v_langles = ((double *)<span class='py_c_api'>PyMem_Malloc</span>(((__pyx_v_ntotStruct * 2) * (sizeof(double)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>:     <span class="k">cdef</span> <span class="kt">int</span> *<span class="nf">llen_lim</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:     <span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">lspoly_view</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">nvert</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:     <span class="k">cdef</span> <span class="kt">array</span> <span class="nf">kPIn</span>  <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="n">num_los</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(158,0,<span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>)
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_2 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_11), __pyx_v_num_los, 0));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_v_kPIn = ((arrayobject *)__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">159</span>:     <span class="k">cdef</span> <span class="kt">array</span> <span class="nf">kPOut</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="n">num_los</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(159,0,<span class='error_goto'>__PYX_ERR(0, 159, __pyx_L1_error)</span>)
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_11 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_2), __pyx_v_num_los, 0));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_kPOut = ((arrayobject *)__pyx_t_11);
  __pyx_t_11 = 0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 159, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:     <span class="k">cdef</span> <span class="kt">array</span> <span class="nf">VperpOut</span>  <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="n">num_los</span><span class="o">*</span><span class="mf">3</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(160,0,<span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>)
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_2 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_11), (__pyx_v_num_los * 3), 0));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_v_VperpOut = ((arrayobject *)__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">161</span>:     <span class="k">cdef</span> <span class="kt">array</span> <span class="nf">IOut</span>  <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">),</span> <span class="n">num_los</span><span class="o">*</span><span class="mf">3</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span></pre>
<pre class='cython code score-8 '>  <span class='trace'>__Pyx_TraceLine</span>(161,0,<span class='error_goto'>__PYX_ERR(0, 161, __pyx_L1_error)</span>)
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple__3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_11 = ((PyObject *)__pyx_f_7cpython_5array_clone(((arrayobject *)__pyx_t_2), (__pyx_v_num_los * 3), 0));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_IOut = ((arrayobject *)__pyx_t_11);
  __pyx_t_11 = 0;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 161, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:     <span class="k">if</span> <span class="n">nLim</span><span class="o">==</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(163,0,<span class='error_goto'>__PYX_ERR(0, 163, __pyx_L1_error)</span>)
  switch (__pyx_v_nLim) {
    case 0:
/* … */
    break;
    case 1:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:         <span class="n">lim_is_none</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(164,0,<span class='error_goto'>__PYX_ERR(0, 164, __pyx_L1_error)</span>)
    __pyx_v_lim_is_none = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:     <span class="k">elif</span> <span class="n">nLim</span><span class="o">==</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    break;
    default: break;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:         <span class="n">lim_is_none</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(166,0,<span class='error_goto'>__PYX_ERR(0, 166, __pyx_L1_error)</span>)
    __pyx_v_lim_is_none = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:         <span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lim</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(167,0,<span class='error_goto'>__PYX_ERR(0, 167, __pyx_L1_error)</span>)
    __pyx_t_13 = 0;
    (__pyx_v_lim_ves[0]) = (*((double *) ( /* dim=0 */ (__pyx_v_Lim.data + __pyx_t_13 * __pyx_v_Lim.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:         <span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lim</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(168,0,<span class='error_goto'>__PYX_ERR(0, 168, __pyx_L1_error)</span>)
    __pyx_t_14 = 1;
    (__pyx_v_lim_ves[1]) = (*((double *) ( /* dim=0 */ (__pyx_v_Lim.data + __pyx_t_14 * __pyx_v_Lim.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:         <span class="n">L0</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">Csin</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span><span class="n">Ccos</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(169,0,<span class='error_goto'>__PYX_ERR(0, 169, __pyx_L1_error)</span>)
    __pyx_v_L0 = atan2(sin((__pyx_v_lim_ves[0])), cos((__pyx_v_lim_ves[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:         <span class="n">L1</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">Csin</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]),</span><span class="n">Ccos</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(170,0,<span class='error_goto'>__PYX_ERR(0, 170, __pyx_L1_error)</span>)
    __pyx_v_L1 = atan2(sin((__pyx_v_lim_ves[1])), cos((__pyx_v_lim_ves[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>:     <span class="k">if</span> <span class="n">lSnLim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(171,0,<span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>)
  __pyx_t_1 = (__pyx_v_lSnLim != ((PyObject*)Py_None));
  __pyx_t_5 = (__pyx_t_1 != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:         <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lSnLim</span><span class="p">)):</span></pre>
<pre class='cython code score-6 '>    <span class='trace'>__Pyx_TraceLine</span>(172,0,<span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>)
    if (unlikely(__pyx_v_lSnLim == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
      <span class='error_goto'>__PYX_ERR(0, 172, __pyx_L1_error)</span>
    }
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_lSnLim);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 172, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_7;
    for (__pyx_t_15 = 0; __pyx_t_15 &lt; __pyx_t_8; __pyx_t_15+=1) {
      __pyx_v_ii = __pyx_t_15;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:             <span class="k">if</span> <span class="n">lSnLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">==</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-11 '>      <span class='trace'>__Pyx_TraceLine</span>(173,0,<span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>)
      if (unlikely(__pyx_v_lSnLim == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
        <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_EqObjC</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lSnLim, __pyx_v_ii), __pyx_int_0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (__pyx_t_5) {
/* … */
        goto __pyx_L22;
      }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>:                 <span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-7 '>        <span class='trace'>__Pyx_TraceLine</span>(174,0,<span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>)
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
        }
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_LSLim, __pyx_v_ii, Py_None, int, 1, __Pyx_PyInt_From_int, 1, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 174, __pyx_L1_error)</span>
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>:             <span class="k">elif</span> <span class="n">lSnLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">==</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-11 '>      <span class='trace'>__Pyx_TraceLine</span>(175,0,<span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>)
      if (unlikely(__pyx_v_lSnLim == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
        <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
      }
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_EqObjC</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_lSnLim, __pyx_v_ii), __pyx_int_1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 175, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (__pyx_t_5) {
/* … */
      }
      __pyx_L22:;
    }
</pre><pre class="cython line score-41" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:                 <span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">],</span><span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">]]</span></pre>
<pre class='cython code score-41 '>        <span class='trace'>__Pyx_TraceLine</span>(176,0,<span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>)
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
        }
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii), __pyx_tuple__4);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
        }
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_0);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii), __pyx_tuple__5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_12 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_11);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
        <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_2);
        __pyx_t_11 = 0;
        __pyx_t_2 = 0;
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
        }
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_v_LSLim, __pyx_v_ii, __pyx_t_12, int, 1, __Pyx_PyInt_From_int, 1, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 176, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_int_0, __pyx_int_1);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 176, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
</pre><pre class="cython line score-0">&#xA0;<span class="">177</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:     <span class="k">if</span> <span class="n">VType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;tor&#39;</span><span class="p">:</span></pre>
<pre class='cython code score-3 '>  <span class='trace'>__Pyx_TraceLine</span>(178,0,<span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>)
  __pyx_t_12 = __Pyx_CallUnboundCMethod0(&amp;__pyx_umethod_PyString_Type_lower, __pyx_v_VType);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyString_Equals</span>(__pyx_t_12, __pyx_n_s_tor, Py_EQ)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">179</span>:         <span class="c"># RMin is necessary to avoid looking on the other side of the tokamak</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>:         <span class="k">if</span> <span class="n">RMin</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(180,0,<span class='error_goto'>__PYX_ERR(0, 180, __pyx_L1_error)</span>)
    __pyx_t_5 = ((__pyx_v_RMin &lt; 0.) != 0);
    if (__pyx_t_5) {
/* … */
      goto __pyx_L24;
    }
</pre><pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">181</span>:             <span class="n">val_rmin</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="mf">0.95</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="o">...</span><span class="p">]),</span></pre>
<pre class='cython code score-48 '>      <span class='trace'>__Pyx_TraceLine</span>(181,0,<span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>)
      __pyx_t_12 = <span class='py_c_api'>PyFloat_FromDouble</span>(((double)0.95));<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
/* … */
      <span class='trace'>__Pyx_TraceLine</span>(181,0,<span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>)
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_11, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_min);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_16.data = __pyx_v_VPoly.data;
      __pyx_t_16.memview = __pyx_v_VPoly.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_16, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_VPoly.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_VPoly.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>
    }
        __pyx_t_16.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_16.shape[0] = __pyx_v_VPoly.shape[1];
__pyx_t_16.strides[0] = __pyx_v_VPoly.strides[1];
    __pyx_t_16.suboffsets[0] = -1;

__pyx_t_11 = __pyx_memoryview_fromslice(__pyx_t_16, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
      __pyx_t_16.memview = NULL;
      __pyx_t_16.data = NULL;
      __pyx_t_18 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
        __pyx_t_18 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
        if (likely(__pyx_t_18)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_18);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        }
      }
      __pyx_t_10 = (__pyx_t_18) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_18, __pyx_t_11) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
      <span class='trace'>__Pyx_TraceLine</span>(181,0,<span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>)
      __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_12, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_val_rmin = __pyx_t_19;
</pre><pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:                             <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="o">...</span><span class="p">])))</span></pre>
<pre class='cython code score-86 '>      <span class='trace'>__Pyx_TraceLine</span>(182,0,<span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>)
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_11, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_min);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_hypot);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_16.data = __pyx_v_Ds.data;
      __pyx_t_16.memview = __pyx_v_Ds.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_16, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_Ds.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_Ds.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
    }
        __pyx_t_16.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_16.shape[0] = __pyx_v_Ds.shape[1];
__pyx_t_16.strides[0] = __pyx_v_Ds.strides[1];
    __pyx_t_16.suboffsets[0] = -1;

__pyx_t_9 = __pyx_memoryview_fromslice(__pyx_t_16, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
      __pyx_t_16.memview = NULL;
      __pyx_t_16.data = NULL;
      __pyx_t_16.data = __pyx_v_Ds.data;
      __pyx_t_16.memview = __pyx_v_Ds.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_16, 0);
      {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_Ds.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_Ds.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
    }
        __pyx_t_16.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_16.shape[0] = __pyx_v_Ds.shape[1];
__pyx_t_16.strides[0] = __pyx_v_Ds.strides[1];
    __pyx_t_16.suboffsets[0] = -1;

__pyx_t_4 = __pyx_memoryview_fromslice(__pyx_t_16, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
      __pyx_t_16.memview = NULL;
      __pyx_t_16.data = NULL;
      __pyx_t_17 = NULL;
      __pyx_t_15 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
        __pyx_t_17 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
        if (likely(__pyx_t_17)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_17);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
          __pyx_t_15 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_17, __pyx_t_9, __pyx_t_4};
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_3)) {
        PyObject *__pyx_temp[3] = {__pyx_t_17, __pyx_t_9, __pyx_t_4};
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_3, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      {
        __pyx_t_18 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
        if (__pyx_t_17) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_17); __pyx_t_17 = NULL;
        }
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0+__pyx_t_15, __pyx_t_9);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 1+__pyx_t_15, __pyx_t_4);
        __pyx_t_9 = 0;
        __pyx_t_4 = 0;
        __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_18, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
        __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
        if (likely(__pyx_t_3)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
        }
      }
      __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_3, __pyx_t_11) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
/* … */
      <span class='trace'>__Pyx_TraceLine</span>(182,0,<span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>)
      __pyx_t_11 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_t_10, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_11); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      if (__pyx_t_5) {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
        __pyx_t_3 = __pyx_t_2;
      } else {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        __pyx_t_3 = __pyx_t_10;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">183</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:             <span class="n">val_rmin</span> <span class="o">=</span> <span class="n">RMin</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(184,0,<span class='error_goto'>__PYX_ERR(0, 184, __pyx_L1_error)</span>)
    /*else*/ {
      __pyx_v_val_rmin = __pyx_v_RMin;
    }
    __pyx_L24:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:         <span class="n">rmin2</span> <span class="o">=</span> <span class="n">val_rmin</span><span class="o">*</span><span class="n">val_rmin</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(185,0,<span class='error_goto'>__PYX_ERR(0, 185, __pyx_L1_error)</span>)
    __pyx_v_rmin2 = (__pyx_v_val_rmin * __pyx_v_val_rmin);
</pre><pre class="cython line score-0">&#xA0;<span class="">186</span>:         <span class="c"># Main function to compute intersections with Vessel</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>:         <span class="c">################</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:         <span class="c"># Compute</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:         <span class="k">if</span> <span class="n">Forbid</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(189,0,<span class='error_goto'>__PYX_ERR(0, 189, __pyx_L1_error)</span>)
    __pyx_t_5 = (__pyx_v_Forbid != 0);
    if (__pyx_t_5) {
/* … */
      goto __pyx_L25;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>:             <span class="n">Forbid0</span><span class="p">,</span> <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(190,0,<span class='error_goto'>__PYX_ERR(0, 190, __pyx_L1_error)</span>)
      __pyx_t_5 = 1;
      __pyx_t_1 = 1;
      __pyx_v_Forbid0 = __pyx_t_5;
      __pyx_v_Forbidbis = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">191</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:             <span class="n">Forbid0</span><span class="p">,</span> <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(192,0,<span class='error_goto'>__PYX_ERR(0, 192, __pyx_L1_error)</span>)
    /*else*/ {
      __pyx_t_1 = 0;
      __pyx_t_5 = 0;
      __pyx_v_Forbid0 = __pyx_t_1;
      __pyx_v_Forbidbis = __pyx_t_5;
    }
    __pyx_L25:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:         <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">num_los</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(193,0,<span class='error_goto'>__PYX_ERR(0, 193, __pyx_L1_error)</span>)
    __pyx_t_15 = __pyx_v_num_los;
    __pyx_t_20 = __pyx_t_15;
    for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
      __pyx_v_ii = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>:             <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(194,0,<span class='error_goto'>__PYX_ERR(0, 194, __pyx_L1_error)</span>)
      __pyx_t_22 = 0;
      __pyx_t_23 = __pyx_v_ii;
      (__pyx_v_loc_us[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_22 * __pyx_v_dus.strides[0]) )) + __pyx_t_23)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:             <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(195,0,<span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>)
      __pyx_t_24 = 1;
      __pyx_t_25 = __pyx_v_ii;
      (__pyx_v_loc_us[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_24 * __pyx_v_dus.strides[0]) )) + __pyx_t_25)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:             <span class="n">loc_us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(196,0,<span class='error_goto'>__PYX_ERR(0, 196, __pyx_L1_error)</span>)
      __pyx_t_26 = 2;
      __pyx_t_27 = __pyx_v_ii;
      (__pyx_v_loc_us[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_26 * __pyx_v_dus.strides[0]) )) + __pyx_t_27)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:             <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(197,0,<span class='error_goto'>__PYX_ERR(0, 197, __pyx_L1_error)</span>)
      __pyx_t_28 = 0;
      __pyx_t_29 = __pyx_v_ii;
      (__pyx_v_loc_ds[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_28 * __pyx_v_Ds.strides[0]) )) + __pyx_t_29)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:             <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(198,0,<span class='error_goto'>__PYX_ERR(0, 198, __pyx_L1_error)</span>)
      __pyx_t_30 = 1;
      __pyx_t_31 = __pyx_v_ii;
      (__pyx_v_loc_ds[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_30 * __pyx_v_Ds.strides[0]) )) + __pyx_t_31)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>:             <span class="n">loc_ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(199,0,<span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>)
      __pyx_t_32 = 2;
      __pyx_t_33 = __pyx_v_ii;
      (__pyx_v_loc_ds[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_32 * __pyx_v_Ds.strides[0]) )) + __pyx_t_33)) )));
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:             <span class="n">loc_vp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">VperpOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>      <span class='trace'>__Pyx_TraceLine</span>(200,0,<span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>)
      __pyx_t_34 = (0 + (3 * __pyx_v_ii));
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_loc_vp[0]) = __pyx_t_19;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">201</span>:             <span class="n">loc_vp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">VperpOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>      <span class='trace'>__Pyx_TraceLine</span>(201,0,<span class='error_goto'>__PYX_ERR(0, 201, __pyx_L1_error)</span>)
      __pyx_t_34 = (1 + (3 * __pyx_v_ii));
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 201, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 201, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_loc_vp[1]) = __pyx_t_19;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:             <span class="n">loc_vp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">VperpOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>      <span class='trace'>__Pyx_TraceLine</span>(202,0,<span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>)
      __pyx_t_34 = (2 + (3 * __pyx_v_ii));
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 202, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 202, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_loc_vp[2]) = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:             <span class="n">upscaDp</span> <span class="o">=</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(203,0,<span class='error_goto'>__PYX_ERR(0, 203, __pyx_L1_error)</span>)
      __pyx_v_upscaDp = (((__pyx_v_loc_us[0]) * (__pyx_v_loc_ds[0])) + ((__pyx_v_loc_us[1]) * (__pyx_v_loc_ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:             <span class="n">upar2</span> <span class="o">=</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(204,0,<span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>)
      __pyx_v_upar2 = (((__pyx_v_loc_us[0]) * (__pyx_v_loc_us[0])) + ((__pyx_v_loc_us[1]) * (__pyx_v_loc_us[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:             <span class="n">Dpar2</span> <span class="o">=</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(205,0,<span class='error_goto'>__PYX_ERR(0, 205, __pyx_L1_error)</span>)
      __pyx_v_Dpar2 = (((__pyx_v_loc_ds[0]) * (__pyx_v_loc_ds[0])) + ((__pyx_v_loc_ds[1]) * (__pyx_v_loc_ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:             <span class="n">invDpar2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Dpar2</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(206,0,<span class='error_goto'>__PYX_ERR(0, 206, __pyx_L1_error)</span>)
      __pyx_v_invDpar2 = (1. / __pyx_v_Dpar2);
</pre><pre class="cython line score-0">&#xA0;<span class="">207</span>:             <span class="c"># Prepare in case Forbid is True</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>:             <span class="k">if</span> <span class="n">Forbid0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Dpar2</span><span class="o">&gt;</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(208,0,<span class='error_goto'>__PYX_ERR(0, 208, __pyx_L1_error)</span>)
      __pyx_t_1 = (__pyx_v_Forbid0 != 0);
      if (__pyx_t_1) {
      } else {
        __pyx_t_5 = __pyx_t_1;
        goto __pyx_L29_bool_binop_done;
      }
      __pyx_t_1 = ((!((__pyx_v_Dpar2 &gt; 0.0) != 0)) != 0);
      __pyx_t_5 = __pyx_t_1;
      __pyx_L29_bool_binop_done:;
      if (__pyx_t_5) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:                 <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(209,0,<span class='error_goto'>__PYX_ERR(0, 209, __pyx_L1_error)</span>)
        __pyx_v_Forbidbis = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:             <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(210,0,<span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>)
      __pyx_t_5 = (__pyx_v_Forbidbis != 0);
      if (__pyx_t_5) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">211</span>:                 <span class="c"># Compute coordinates of the 2 points where the tangents touch</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:                 <span class="c"># the inner circle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:                 <span class="n">L</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">Dpar2</span><span class="o">-</span><span class="n">rmin2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(213,0,<span class='error_goto'>__PYX_ERR(0, 213, __pyx_L1_error)</span>)
        __pyx_v_L = sqrt((__pyx_v_Dpar2 - __pyx_v_rmin2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:                 <span class="n">S1X</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">+</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(214,0,<span class='error_goto'>__PYX_ERR(0, 214, __pyx_L1_error)</span>)
        __pyx_v_S1X = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[0])) + ((__pyx_v_val_rmin * (__pyx_v_loc_ds[1])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>:                 <span class="n">S1Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(215,0,<span class='error_goto'>__PYX_ERR(0, 215, __pyx_L1_error)</span>)
        __pyx_v_S1Y = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[1])) - ((__pyx_v_val_rmin * (__pyx_v_loc_ds[0])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:                 <span class="n">S2X</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(216,0,<span class='error_goto'>__PYX_ERR(0, 216, __pyx_L1_error)</span>)
        __pyx_v_S2X = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[0])) - ((__pyx_v_val_rmin * (__pyx_v_loc_ds[1])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>:                 <span class="n">S2Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">+</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(217,0,<span class='error_goto'>__PYX_ERR(0, 217, __pyx_L1_error)</span>)
        __pyx_v_S2Y = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[1])) + ((__pyx_v_val_rmin * (__pyx_v_loc_ds[0])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0">&#xA0;<span class="">218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:             <span class="c"># Compute all solutions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>:             <span class="c"># Set tolerance value for us[2,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:             <span class="c"># EpsUz is the tolerated DZ across 20m (max Tokamak size)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:             <span class="n">Crit2</span> <span class="o">=</span> <span class="n">upar2</span><span class="o">*</span><span class="n">Crit2_base</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(222,0,<span class='error_goto'>__PYX_ERR(0, 222, __pyx_L1_error)</span>)
      __pyx_v_Crit2 = (__pyx_v_upar2 * __pyx_v_Crit2_base);
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:             <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">kPIn</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>      <span class='trace'>__Pyx_TraceLine</span>(223,0,<span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>)
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPIn), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_kpin_loc[0]) = __pyx_t_19;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>:             <span class="n">kpout_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kPOut</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>      <span class='trace'>__Pyx_TraceLine</span>(224,0,<span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>)
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ii, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_kpout_loc[0]) = __pyx_t_19;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:             <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IOut</span><span class="p">[</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-10 '>      <span class='trace'>__Pyx_TraceLine</span>(225,0,<span class='error_goto'>__PYX_ERR(0, 225, __pyx_L1_error)</span>)
      __pyx_t_34 = (2 + (3 * __pyx_v_ii));
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 225, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_35 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_35 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 225, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      (__pyx_v_ind_loc[0]) = __pyx_t_35;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:             <span class="n">found_new</span> <span class="o">=</span> <span class="n">comp_inter_los_vpoly</span><span class="p">(</span><span class="n">loc_ds</span><span class="p">,</span> <span class="n">loc_us</span><span class="p">,</span> <span class="n">VPoly</span><span class="p">,</span> <span class="n">VIn</span><span class="p">,</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">lim_is_none</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(226,0,<span class='error_goto'>__PYX_ERR(0, 226, __pyx_L1_error)</span>)
      __pyx_v_found_new = __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(__pyx_v_loc_ds, __pyx_v_loc_us, __pyx_v_VPoly, __pyx_v_VIn, __pyx_v_Ns, __pyx_v_lim_is_none, __pyx_v_L0, __pyx_v_L1, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_ind_loc, __pyx_v_loc_vp, __pyx_v_Forbidbis, __pyx_v_upscaDp, __pyx_v_upar2, __pyx_v_Dpar2, __pyx_v_invDpar2, __pyx_v_S1X, __pyx_v_S1Y, __pyx_v_S2X, __pyx_v_S2Y, __pyx_v_Crit2, __pyx_v_EpsUz, __pyx_v_EpsVz, __pyx_v_EpsA, __pyx_v_EpsB, __pyx_v_EpsPlane, 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">227</span>:                                              <span class="n">L0</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">kpin_loc</span><span class="p">,</span> <span class="n">kpout_loc</span><span class="p">,</span> <span class="n">ind_loc</span><span class="p">,</span> <span class="n">loc_vp</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:                                              <span class="n">Forbidbis</span><span class="p">,</span> <span class="n">upscaDp</span><span class="p">,</span> <span class="n">upar2</span><span class="p">,</span> <span class="n">Dpar2</span><span class="p">,</span> <span class="n">invDpar2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:                                              <span class="n">S1X</span><span class="p">,</span> <span class="n">S1Y</span><span class="p">,</span> <span class="n">S2X</span><span class="p">,</span> <span class="n">S2Y</span><span class="p">,</span> <span class="n">Crit2</span><span class="p">,</span> <span class="n">EpsUz</span><span class="p">,</span> <span class="n">EpsVz</span><span class="p">,</span> <span class="n">EpsA</span><span class="p">,</span> <span class="n">EpsB</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:                                              <span class="n">EpsPlane</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:             <span class="k">if</span> <span class="n">found_new</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(231,0,<span class='error_goto'>__PYX_ERR(0, 231, __pyx_L1_error)</span>)
      __pyx_t_5 = (__pyx_v_found_new != 0);
      if (__pyx_t_5) {
/* … */
        goto __pyx_L32;
      }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:                 <span class="n">kPIn</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>         <span class="o">=</span> <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(232,0,<span class='error_goto'>__PYX_ERR(0, 232, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_kpin_loc[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 232, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_kPIn), __pyx_v_ii, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 232, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:                 <span class="n">kPOut</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>        <span class="o">=</span> <span class="n">kpout_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(233,0,<span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_kpout_loc[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 233, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ii, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 233, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-5 '>        <span class='trace'>__Pyx_TraceLine</span>(234,0,<span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_ind_loc[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 234, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (2 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 234, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-2 '>        <span class='trace'>__Pyx_TraceLine</span>(235,0,<span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>)
        __pyx_t_34 = (0 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_int_0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 235, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-2 '>        <span class='trace'>__Pyx_TraceLine</span>(236,0,<span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>)
        __pyx_t_34 = (1 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_int_0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 236, __pyx_L1_error)</span>
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(237,0,<span class='error_goto'>__PYX_ERR(0, 237, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (0 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 237, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(238,0,<span class='error_goto'>__PYX_ERR(0, 238, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[1]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (1 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 238, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(239,0,<span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[2]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (2 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:                 <span class="n">kPIn</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>         <span class="o">=</span> <span class="n">Cnan</span></pre>
<pre class='cython code score-8 '>      <span class='trace'>__Pyx_TraceLine</span>(242,0,<span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>)
      /*else*/ {
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_kPIn), __pyx_v_ii, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:                 <span class="n">kPOut</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>        <span class="o">=</span> <span class="n">Cnan</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(243,0,<span class='error_goto'>__PYX_ERR(0, 243, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ii, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 243, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="o">-</span><span class="mf">1000000</span></pre>
<pre class='cython code score-2 '>        <span class='trace'>__Pyx_TraceLine</span>(244,0,<span class='error_goto'>__PYX_ERR(0, 244, __pyx_L1_error)</span>)
        __pyx_t_34 = (2 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_int_neg_1000000, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 244, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-2 '>        <span class='trace'>__Pyx_TraceLine</span>(245,0,<span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>)
        __pyx_t_34 = (0 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_int_0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:                 <span class="n">IOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>     <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-2 '>        <span class='trace'>__Pyx_TraceLine</span>(246,0,<span class='error_goto'>__PYX_ERR(0, 246, __pyx_L1_error)</span>)
        __pyx_t_34 = (1 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_int_0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 246, __pyx_L1_error)</span>
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cnan</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(247,0,<span class='error_goto'>__PYX_ERR(0, 247, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (0 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 247, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cnan</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(248,0,<span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (1 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:                 <span class="n">VperpOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">Cnan</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(249,0,<span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>)
        __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 249, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_34 = (2 + (3 * __pyx_v_ii));
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      }
      __pyx_L32:;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">250</span>:         <span class="c"># Calc_LOS_PInOut_Tor(Ds, dus, VPoly, VIn, kPIn_view,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>:         <span class="c">#                     kPOut_view, VperpOut_view, IOut_view,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:         <span class="c">#                     num_los, val_rmin,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>:         <span class="c">#                     lim_is_none, L0, L1,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>:         <span class="c">#                     Forbid=Forbid,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>:         <span class="c">#                     EpsUz=EpsUz, EpsVz=EpsVz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:         <span class="c">#                     EpsA=EpsA, EpsB=EpsB,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>:         <span class="c">#                     EpsPlane=EpsPlane)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>:         <span class="c"># If there are Struct, call the same function</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>:         <span class="c"># Structural optimzation : do everything in one big for loop and only</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>:         <span class="c"># keep the relevant points (to save memory)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>:         <span class="k">if</span> <span class="n">LSPoly</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(261,0,<span class='error_goto'>__PYX_ERR(0, 261, __pyx_L1_error)</span>)
    __pyx_t_5 = (__pyx_v_LSPoly != ((PyObject*)Py_None));
    __pyx_t_1 = (__pyx_t_5 != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">262</span>:             <span class="n">ind_lim_data</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(262,0,<span class='error_goto'>__PYX_ERR(0, 262, __pyx_L1_error)</span>)
      __pyx_v_ind_lim_data = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:             <span class="n">len_lspoly</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">LSPoly</span><span class="p">)</span></pre>
<pre class='cython code score-6 '>      <span class='trace'>__Pyx_TraceLine</span>(263,0,<span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>)
      if (unlikely(__pyx_v_LSPoly == Py_None)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "object of type 'NoneType' has no len()");
        <span class='error_goto'>__PYX_ERR(0, 263, __pyx_L1_error)</span>
      }
      __pyx_t_7 = <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_LSPoly);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 263, __pyx_L1_error)</span>
      __pyx_v_len_lspoly = __pyx_t_7;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">264</span>:             <span class="n">llen_lim</span>  <span class="o">=</span> <span class="o">&lt;</span><span class="nb">int</span> <span class="o">*&gt;</span><span class="n">PyMem_Malloc</span><span class="p">(</span><span class="n">len_lspoly</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span></pre>
<pre class='cython code score-5 '>      <span class='trace'>__Pyx_TraceLine</span>(264,0,<span class='error_goto'>__PYX_ERR(0, 264, __pyx_L1_error)</span>)
      __pyx_v_llen_lim = ((int *)<span class='py_c_api'>PyMem_Malloc</span>((__pyx_v_len_lspoly * (sizeof(int)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>:             <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_lspoly</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(265,0,<span class='error_goto'>__PYX_ERR(0, 265, __pyx_L1_error)</span>)
      __pyx_t_15 = __pyx_v_len_lspoly;
      __pyx_t_20 = __pyx_t_15;
      for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
        __pyx_v_ii = __pyx_t_21;
</pre><pre class="cython line score-76" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:                 <span class="k">if</span> <span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]]):</span></pre>
<pre class='cython code score-76 '>        <span class='trace'>__Pyx_TraceLine</span>(266,0,<span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>)
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
        }
        __pyx_t_5 = (<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii) == Py_None);
        __pyx_t_6 = (__pyx_t_5 != 0);
        if (!__pyx_t_6) {
        } else {
          __pyx_t_1 = __pyx_t_6;
          goto __pyx_L37_bool_binop_done;
        }
        __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        if (unlikely(__pyx_v_LSLim == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
        }
        if (likely(<span class='py_c_api'>PyList_CheckExact</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii))) || <span class='py_c_api'>PyTuple_CheckExact</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii))) {
          __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3); __pyx_t_7 = 0;
          __pyx_t_36 = NULL;
        } else {
          __pyx_t_7 = -1; __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_36 = Py_TYPE(__pyx_t_3)-&gt;tp_iternext;<span class='error_goto'> if (unlikely(!__pyx_t_36)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
        }
        for (;;) {
          if (likely(!__pyx_t_36)) {
            if (likely(<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
              if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_3)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_12 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_3, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
              #else
              __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
              #endif
            } else {
              if (__pyx_t_7 &gt;= <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_t_3)) break;
              #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
              __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_3, __pyx_t_7); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12); __pyx_t_7++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
              #else
              __pyx_t_12 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_3, __pyx_t_7); __pyx_t_7++;<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
              #endif
            }
          } else {
            __pyx_t_12 = __pyx_t_36(__pyx_t_3);
            if (unlikely(!__pyx_t_12)) {
              PyObject* exc_type = <span class='py_c_api'>PyErr_Occurred</span>();
              if (exc_type) {
                if (likely(<span class='pyx_c_api'>__Pyx_PyErr_GivenExceptionMatches</span>(exc_type, PyExc_StopIteration))) <span class='py_c_api'>PyErr_Clear</span>();
                else <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
              }
              break;
            }
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          }
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_ll, __pyx_t_12);
          __pyx_t_12 = 0;
          __pyx_t_6 = <span class='pyx_c_api'>__Pyx_HasAttr</span>(__pyx_v_ll, __pyx_n_s_iter);<span class='error_goto'> if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 266, __pyx_L1_error)</span>
          __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
          if (unlikely(<span class='pyx_c_api'>__Pyx_ListComp_Append</span>(__pyx_t_2, (PyObject*)__pyx_t_12))) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_all, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely(__pyx_t_6 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = ((!__pyx_t_6) != 0);
        __pyx_t_1 = __pyx_t_5;
        __pyx_L37_bool_binop_done:;
        if (__pyx_t_1) {
/* … */
          goto __pyx_L36;
        }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>:                     <span class="n">lslim</span> <span class="o">=</span> <span class="p">[</span><span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span></pre>
<pre class='cython code score-16 '>          <span class='trace'>__Pyx_TraceLine</span>(267,0,<span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>)
          if (unlikely(__pyx_v_LSLim == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 267, __pyx_L1_error)</span>
          }
          __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 267, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii));
          <span class='refnanny'>__Pyx_GIVEREF</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii));
          <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii));
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_lslim, __pyx_t_3);
          __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">268</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:                     <span class="n">lslim</span> <span class="o">=</span> <span class="n">LSLim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(269,0,<span class='error_goto'>__PYX_ERR(0, 269, __pyx_L1_error)</span>)
        /*else*/ {
          if (unlikely(__pyx_v_LSLim == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 269, __pyx_L1_error)</span>
          }
          __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSLim, __pyx_v_ii);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_lslim, __pyx_t_3);
          __pyx_t_3 = 0;
        }
        __pyx_L36:;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:                 <span class="n">len_lim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lslim</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>        <span class='trace'>__Pyx_TraceLine</span>(270,0,<span class='error_goto'>__PYX_ERR(0, 270, __pyx_L1_error)</span>)
        __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_lslim);<span class='error_goto'> if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 270, __pyx_L1_error)</span>
        __pyx_v_len_lim = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">271</span>:                 <span class="n">llen_lim</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">len_lim</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(271,0,<span class='error_goto'>__PYX_ERR(0, 271, __pyx_L1_error)</span>)
        (__pyx_v_llen_lim[__pyx_v_ii]) = __pyx_v_len_lim;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>:                 <span class="n">lspoly_view</span> <span class="o">=</span> <span class="n">LSPoly</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>        <span class='trace'>__Pyx_TraceLine</span>(272,0,<span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>)
        if (unlikely(__pyx_v_LSPoly == Py_None)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
          <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>
        }
        __pyx_t_37 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSPoly, __pyx_v_ii), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_37.memview)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
        __PYX_XDEC_MEMVIEW(&amp;__pyx_v_lspoly_view, 1);
        __pyx_v_lspoly_view = __pyx_t_37;
        __pyx_t_37.memview = NULL;
        __pyx_t_37.data = NULL;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">273</span>:                 <span class="n">nvert</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lspoly_view</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-7 '>        <span class='trace'>__Pyx_TraceLine</span>(273,0,<span class='error_goto'>__PYX_ERR(0, 273, __pyx_L1_error)</span>)
        __pyx_t_16.data = __pyx_v_lspoly_view.data;
        __pyx_t_16.memview = __pyx_v_lspoly_view.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_16, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_lspoly_view.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_lspoly_view.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 273, __pyx_L1_error)</span>
    }
        __pyx_t_16.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_16.shape[0] = __pyx_v_lspoly_view.shape[1];
__pyx_t_16.strides[0] = __pyx_v_lspoly_view.strides[1];
    __pyx_t_16.suboffsets[0] = -1;

__pyx_t_38 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_t_16); 
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
        __pyx_t_16.memview = NULL;
        __pyx_t_16.data = NULL;
        __pyx_v_nvert = __pyx_t_38;
</pre><pre class="cython line score-0">&#xA0;<span class="">274</span>:                 <span class="c"># sub strcutres limited:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">275</span>:                 <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_lim</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(275,0,<span class='error_goto'>__PYX_ERR(0, 275, __pyx_L1_error)</span>)
        __pyx_t_35 = __pyx_v_len_lim;
        __pyx_t_39 = __pyx_t_35;
        for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_39; __pyx_t_40+=1) {
          __pyx_v_jj = __pyx_t_40;
</pre><pre class="cython line score-0">&#xA0;<span class="">276</span>:                     <span class="c"># We compute the structure&#39;s bounding box:</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:                     <span class="k">if</span> <span class="n">lslim</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-3 '>          <span class='trace'>__Pyx_TraceLine</span>(277,0,<span class='error_goto'>__PYX_ERR(0, 277, __pyx_L1_error)</span>)
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_1 = (__pyx_t_3 != Py_None);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_5 = (__pyx_t_1 != 0);
          if (__pyx_t_5) {
/* … */
            goto __pyx_L43;
          }
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:                         <span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lslim</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-16 '>            <span class='trace'>__Pyx_TraceLine</span>(278,0,<span class='error_goto'>__PYX_ERR(0, 278, __pyx_L1_error)</span>)
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 278, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            (__pyx_v_lim_ves[0]) = __pyx_t_19;
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:                         <span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lslim</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-16 '>            <span class='trace'>__Pyx_TraceLine</span>(279,0,<span class='error_goto'>__PYX_ERR(0, 279, __pyx_L1_error)</span>)
            __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_lslim, __pyx_v_jj, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
            __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
            <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 279, __pyx_L1_error)</span>
            <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
            (__pyx_v_lim_ves[1]) = __pyx_t_19;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:                         <span class="n">llim_ves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>            <span class='trace'>__Pyx_TraceLine</span>(280,0,<span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>)
            __pyx_t_41 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_llim_ves, __pyx_int_0);<span class='error_goto'> if (unlikely(__pyx_t_41 == ((int)-1))) __PYX_ERR(0, 280, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>:                         <span class="n">L0</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">Csin</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">0</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(281,0,<span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>)
            __pyx_v_L0 = atan2(sin((__pyx_v_lim_ves[0])), cos((__pyx_v_lim_ves[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:                         <span class="n">L1</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">Csin</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]),</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">lim_ves</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(282,0,<span class='error_goto'>__PYX_ERR(0, 282, __pyx_L1_error)</span>)
            __pyx_v_L1 = atan2(sin((__pyx_v_lim_ves[1])), cos((__pyx_v_lim_ves[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">283</span>:                         <span class="n">compute_bbox_lim</span><span class="p">(</span><span class="n">nvert</span><span class="p">,</span> <span class="n">lspoly_view</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">L1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(283,0,<span class='error_goto'>__PYX_ERR(0, 283, __pyx_L1_error)</span>)
            __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_lim(__pyx_v_nvert, __pyx_v_lspoly_view, __pyx_v_bounds, __pyx_v_L0, __pyx_v_L1);
</pre><pre class="cython line score-0">&#xA0;<span class="">284</span>:                     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:                         <span class="n">llim_ves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>          <span class='trace'>__Pyx_TraceLine</span>(285,0,<span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>)
          /*else*/ {
            __pyx_t_41 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_v_llim_ves, __pyx_int_1);<span class='error_goto'> if (unlikely(__pyx_t_41 == ((int)-1))) __PYX_ERR(0, 285, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:                         <span class="n">compute_bbox_extr</span><span class="p">(</span><span class="n">nvert</span><span class="p">,</span> <span class="n">lspoly_view</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(286,0,<span class='error_goto'>__PYX_ERR(0, 286, __pyx_L1_error)</span>)
            __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_extr(__pyx_v_nvert, __pyx_v_lspoly_view, __pyx_v_bounds);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>:                         <span class="n">L0</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(287,0,<span class='error_goto'>__PYX_ERR(0, 287, __pyx_L1_error)</span>)
            __pyx_v_L0 = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>:                         <span class="n">L1</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(288,0,<span class='error_goto'>__PYX_ERR(0, 288, __pyx_L1_error)</span>)
            __pyx_v_L1 = 0.;
          }
          __pyx_L43:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:                     <span class="n">langles</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">L0</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(289,0,<span class='error_goto'>__PYX_ERR(0, 289, __pyx_L1_error)</span>)
          (__pyx_v_langles[(__pyx_v_ind_lim_data * 2)]) = __pyx_v_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:                     <span class="n">langles</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">L1</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(290,0,<span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>)
          (__pyx_v_langles[((__pyx_v_ind_lim_data * 2) + 1)]) = __pyx_v_L1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:                     <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">6</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(291,0,<span class='error_goto'>__PYX_ERR(0, 291, __pyx_L1_error)</span>)
          for (__pyx_t_42 = 0; __pyx_t_42 &lt; 6; __pyx_t_42+=1) {
            __pyx_v_jj = __pyx_t_42;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>:                         <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(292,0,<span class='error_goto'>__PYX_ERR(0, 292, __pyx_L1_error)</span>)
            (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + __pyx_v_jj)]) = (__pyx_v_bounds[__pyx_v_jj]);
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">293</span>:                     <span class="n">ind_lim_data</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(293,0,<span class='error_goto'>__PYX_ERR(0, 293, __pyx_L1_error)</span>)
          __pyx_v_ind_lim_data = (__pyx_v_ind_lim_data + 1);
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">294</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:             <span class="k">for</span> <span class="n">ind_tmp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">num_los</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(295,0,<span class='error_goto'>__PYX_ERR(0, 295, __pyx_L1_error)</span>)
      __pyx_t_15 = __pyx_v_num_los;
      __pyx_t_20 = __pyx_t_15;
      for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
        __pyx_v_ind_tmp = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">296</span>:                 <span class="n">ind_lim_data</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(296,0,<span class='error_goto'>__PYX_ERR(0, 296, __pyx_L1_error)</span>)
        __pyx_v_ind_lim_data = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">297</span>:                 <span class="c"># We get the last kpout:</span></pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:                 <span class="n">kpout_jj</span> <span class="o">=</span> <span class="n">kPOut</span><span class="p">[</span><span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>        <span class='trace'>__Pyx_TraceLine</span>(298,0,<span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>)
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ind_tmp, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_3); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_v_kpout_jj = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">299</span>:                 <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpout_jj</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(299,0,<span class='error_goto'>__PYX_ERR(0, 299, __pyx_L1_error)</span>)
        (__pyx_v_kpin_loc[0]) = __pyx_v_kpout_jj;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:                 <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">IOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-10 '>        <span class='trace'>__Pyx_TraceLine</span>(300,0,<span class='error_goto'>__PYX_ERR(0, 300, __pyx_L1_error)</span>)
        __pyx_t_34 = (2 + (3 * __pyx_v_ind_tmp));
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_35 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_35 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 300, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        (__pyx_v_ind_loc[0]) = __pyx_t_35;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>:                 <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(301,0,<span class='error_goto'>__PYX_ERR(0, 301, __pyx_L1_error)</span>)
        __pyx_t_43 = 0;
        __pyx_t_44 = __pyx_v_ind_tmp;
        (__pyx_v_loc_ds[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_43 * __pyx_v_Ds.strides[0]) )) + __pyx_t_44)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">302</span>:                 <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(302,0,<span class='error_goto'>__PYX_ERR(0, 302, __pyx_L1_error)</span>)
        __pyx_t_45 = 1;
        __pyx_t_46 = __pyx_v_ind_tmp;
        (__pyx_v_loc_ds[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_45 * __pyx_v_Ds.strides[0]) )) + __pyx_t_46)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:                 <span class="n">loc_ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(303,0,<span class='error_goto'>__PYX_ERR(0, 303, __pyx_L1_error)</span>)
        __pyx_t_47 = 2;
        __pyx_t_48 = __pyx_v_ind_tmp;
        (__pyx_v_loc_ds[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_Ds.data + __pyx_t_47 * __pyx_v_Ds.strides[0]) )) + __pyx_t_48)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:                 <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(304,0,<span class='error_goto'>__PYX_ERR(0, 304, __pyx_L1_error)</span>)
        __pyx_t_49 = 0;
        __pyx_t_50 = __pyx_v_ind_tmp;
        (__pyx_v_loc_us[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_49 * __pyx_v_dus.strides[0]) )) + __pyx_t_50)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>:                 <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(305,0,<span class='error_goto'>__PYX_ERR(0, 305, __pyx_L1_error)</span>)
        __pyx_t_51 = 1;
        __pyx_t_52 = __pyx_v_ind_tmp;
        (__pyx_v_loc_us[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_51 * __pyx_v_dus.strides[0]) )) + __pyx_t_52)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:                 <span class="n">loc_us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dus</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="n">ind_tmp</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(306,0,<span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>)
        __pyx_t_53 = 2;
        __pyx_t_54 = __pyx_v_ind_tmp;
        (__pyx_v_loc_us[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_dus.data + __pyx_t_53 * __pyx_v_dus.strides[0]) )) + __pyx_t_54)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:                 <span class="n">loc_vp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(307,0,<span class='error_goto'>__PYX_ERR(0, 307, __pyx_L1_error)</span>)
        (__pyx_v_loc_vp[0]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:                 <span class="n">loc_vp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(308,0,<span class='error_goto'>__PYX_ERR(0, 308, __pyx_L1_error)</span>)
        (__pyx_v_loc_vp[1]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>:                 <span class="n">loc_vp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(309,0,<span class='error_goto'>__PYX_ERR(0, 309, __pyx_L1_error)</span>)
        (__pyx_v_loc_vp[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:                 <span class="n">last_pout</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpout_jj</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(310,0,<span class='error_goto'>__PYX_ERR(0, 310, __pyx_L1_error)</span>)
        (__pyx_v_last_pout[0]) = ((__pyx_v_kpout_jj * (__pyx_v_loc_us[0])) + (__pyx_v_loc_ds[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:                 <span class="n">last_pout</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpout_jj</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(311,0,<span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>)
        (__pyx_v_last_pout[1]) = ((__pyx_v_kpout_jj * (__pyx_v_loc_us[1])) + (__pyx_v_loc_ds[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">312</span>:                 <span class="n">last_pout</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpout_jj</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(312,0,<span class='error_goto'>__PYX_ERR(0, 312, __pyx_L1_error)</span>)
        (__pyx_v_last_pout[2]) = ((__pyx_v_kpout_jj * (__pyx_v_loc_us[2])) + (__pyx_v_loc_ds[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>:                 <span class="n">compute_inv_and_sign</span><span class="p">(</span><span class="n">loc_us</span><span class="p">,</span> <span class="n">sign_ray</span><span class="p">,</span> <span class="n">invr_ray</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(313,0,<span class='error_goto'>__PYX_ERR(0, 313, __pyx_L1_error)</span>)
        __pyx_f_4tofu_4geom_8_GG03_LM_compute_inv_and_sign(__pyx_v_loc_us, __pyx_v_sign_ray, __pyx_v_invr_ray);
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>:                 <span class="c"># computing sclar prods for Ray and rmin values</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:                 <span class="k">if</span> <span class="n">Forbid</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(315,0,<span class='error_goto'>__PYX_ERR(0, 315, __pyx_L1_error)</span>)
        __pyx_t_5 = (__pyx_v_Forbid != 0);
        if (__pyx_t_5) {
/* … */
          goto __pyx_L48;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">316</span>:                     <span class="n">Forbid0</span><span class="p">,</span> <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(316,0,<span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>)
          __pyx_t_5 = 1;
          __pyx_t_1 = 1;
          __pyx_v_Forbid0 = __pyx_t_5;
          __pyx_v_Forbidbis = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">317</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:                     <span class="n">Forbid0</span><span class="p">,</span> <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(318,0,<span class='error_goto'>__PYX_ERR(0, 318, __pyx_L1_error)</span>)
        /*else*/ {
          __pyx_t_1 = 0;
          __pyx_t_5 = 0;
          __pyx_v_Forbid0 = __pyx_t_1;
          __pyx_v_Forbidbis = __pyx_t_5;
        }
        __pyx_L48:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">319</span>:                 <span class="n">upscaDp</span> <span class="o">=</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(319,0,<span class='error_goto'>__PYX_ERR(0, 319, __pyx_L1_error)</span>)
        __pyx_v_upscaDp = (((__pyx_v_loc_us[0]) * (__pyx_v_loc_ds[0])) + ((__pyx_v_loc_us[1]) * (__pyx_v_loc_ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>:                 <span class="n">upar2</span>   <span class="o">=</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(320,0,<span class='error_goto'>__PYX_ERR(0, 320, __pyx_L1_error)</span>)
        __pyx_v_upar2 = (((__pyx_v_loc_us[0]) * (__pyx_v_loc_us[0])) + ((__pyx_v_loc_us[1]) * (__pyx_v_loc_us[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>:                 <span class="n">Dpar2</span>   <span class="o">=</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(321,0,<span class='error_goto'>__PYX_ERR(0, 321, __pyx_L1_error)</span>)
        __pyx_v_Dpar2 = (((__pyx_v_loc_ds[0]) * (__pyx_v_loc_ds[0])) + ((__pyx_v_loc_ds[1]) * (__pyx_v_loc_ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">322</span>:                 <span class="n">invDpar2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Dpar2</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(322,0,<span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>)
        __pyx_v_invDpar2 = (1. / __pyx_v_Dpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>:                 <span class="n">Crit2</span> <span class="o">=</span> <span class="n">upar2</span><span class="o">*</span><span class="n">Crit2_base</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(323,0,<span class='error_goto'>__PYX_ERR(0, 323, __pyx_L1_error)</span>)
        __pyx_v_Crit2 = (__pyx_v_upar2 * __pyx_v_Crit2_base);
</pre><pre class="cython line score-0">&#xA0;<span class="">324</span>:                 <span class="c"># Prepare in case Forbid is True</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>:                 <span class="k">if</span> <span class="n">Forbid0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Dpar2</span><span class="o">&gt;</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(325,0,<span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>)
        __pyx_t_1 = (__pyx_v_Forbid0 != 0);
        if (__pyx_t_1) {
        } else {
          __pyx_t_5 = __pyx_t_1;
          goto __pyx_L50_bool_binop_done;
        }
        __pyx_t_1 = ((!((__pyx_v_Dpar2 &gt; 0.0) != 0)) != 0);
        __pyx_t_5 = __pyx_t_1;
        __pyx_L50_bool_binop_done:;
        if (__pyx_t_5) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>:                     <span class="n">Forbidbis</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(326,0,<span class='error_goto'>__PYX_ERR(0, 326, __pyx_L1_error)</span>)
          __pyx_v_Forbidbis = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>:                 <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(327,0,<span class='error_goto'>__PYX_ERR(0, 327, __pyx_L1_error)</span>)
        __pyx_t_5 = (__pyx_v_Forbidbis != 0);
        if (__pyx_t_5) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">328</span>:                     <span class="c"># Compute coordinates of the 2 points where the tangents touch</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>:                     <span class="c"># the inner circle</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:                     <span class="n">rmin2</span> <span class="o">=</span> <span class="n">val_rmin</span><span class="o">*</span><span class="n">val_rmin</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(330,0,<span class='error_goto'>__PYX_ERR(0, 330, __pyx_L1_error)</span>)
          __pyx_v_rmin2 = (__pyx_v_val_rmin * __pyx_v_val_rmin);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:                     <span class="n">L</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">Dpar2</span><span class="o">-</span><span class="n">rmin2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(331,0,<span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>)
          __pyx_v_L = sqrt((__pyx_v_Dpar2 - __pyx_v_rmin2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">332</span>:                     <span class="n">S1X</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">+</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(332,0,<span class='error_goto'>__PYX_ERR(0, 332, __pyx_L1_error)</span>)
          __pyx_v_S1X = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[0])) + ((__pyx_v_val_rmin * (__pyx_v_loc_ds[1])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">333</span>:                     <span class="n">S1Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(333,0,<span class='error_goto'>__PYX_ERR(0, 333, __pyx_L1_error)</span>)
          __pyx_v_S1Y = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[1])) - ((__pyx_v_val_rmin * (__pyx_v_loc_ds[0])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>:                     <span class="n">S2X</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(334,0,<span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>)
          __pyx_v_S2X = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[0])) - ((__pyx_v_val_rmin * (__pyx_v_loc_ds[1])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">335</span>:                     <span class="n">S2Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmin2</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">+</span><span class="n">val_rmin</span><span class="o">*</span><span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">invDpar2</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(335,0,<span class='error_goto'>__PYX_ERR(0, 335, __pyx_L1_error)</span>)
          __pyx_v_S2Y = (((__pyx_v_rmin2 * (__pyx_v_loc_ds[1])) + ((__pyx_v_val_rmin * (__pyx_v_loc_ds[0])) * __pyx_v_L)) * __pyx_v_invDpar2);
</pre><pre class="cython line score-0">&#xA0;<span class="">336</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>:                 <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_lspoly</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(337,0,<span class='error_goto'>__PYX_ERR(0, 337, __pyx_L1_error)</span>)
        __pyx_t_35 = __pyx_v_len_lspoly;
        __pyx_t_39 = __pyx_t_35;
        for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_39; __pyx_t_40+=1) {
          __pyx_v_ii = __pyx_t_40;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">338</span>:                     <span class="n">nvert</span> <span class="o">=</span> <span class="n">LSVIn</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-19 '>          <span class='trace'>__Pyx_TraceLine</span>(338,0,<span class='error_goto'>__PYX_ERR(0, 338, __pyx_L1_error)</span>)
          if (unlikely(__pyx_v_LSVIn == Py_None)) {
            <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
            <span class='error_goto'>__PYX_ERR(0, 338, __pyx_L1_error)</span>
          }
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSVIn, __pyx_v_ii), __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 338, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
          __pyx_t_42 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_42 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 338, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_v_nvert = __pyx_t_42;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">339</span>:                     <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">llen_lim</span><span class="p">[</span><span class="n">ii</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(339,0,<span class='error_goto'>__PYX_ERR(0, 339, __pyx_L1_error)</span>)
          __pyx_t_42 = (__pyx_v_llen_lim[__pyx_v_ii]);
          __pyx_t_55 = __pyx_t_42;
          for (__pyx_t_56 = 0; __pyx_t_56 &lt; __pyx_t_55; __pyx_t_56+=1) {
            __pyx_v_jj = __pyx_t_56;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">340</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(340,0,<span class='error_goto'>__PYX_ERR(0, 340, __pyx_L1_error)</span>)
            (__pyx_v_bounds[0]) = (__pyx_v_lbounds[(__pyx_v_ind_lim_data * 6)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(341,0,<span class='error_goto'>__PYX_ERR(0, 341, __pyx_L1_error)</span>)
            (__pyx_v_bounds[1]) = (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + 1)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(342,0,<span class='error_goto'>__PYX_ERR(0, 342, __pyx_L1_error)</span>)
            (__pyx_v_bounds[2]) = (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + 2)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">343</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(343,0,<span class='error_goto'>__PYX_ERR(0, 343, __pyx_L1_error)</span>)
            (__pyx_v_bounds[3]) = (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + 3)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="mf">4</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(344,0,<span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>)
            (__pyx_v_bounds[4]) = (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + 4)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">345</span>:                         <span class="n">bounds</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">lbounds</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">6</span> <span class="o">+</span> <span class="mf">5</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(345,0,<span class='error_goto'>__PYX_ERR(0, 345, __pyx_L1_error)</span>)
            (__pyx_v_bounds[5]) = (__pyx_v_lbounds[((__pyx_v_ind_lim_data * 6) + 5)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>:                         <span class="n">L0</span> <span class="o">=</span> <span class="n">langles</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(346,0,<span class='error_goto'>__PYX_ERR(0, 346, __pyx_L1_error)</span>)
            __pyx_v_L0 = (__pyx_v_langles[(__pyx_v_ind_lim_data * 2)]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>:                         <span class="n">L1</span> <span class="o">=</span> <span class="n">langles</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="o">*</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(347,0,<span class='error_goto'>__PYX_ERR(0, 347, __pyx_L1_error)</span>)
            __pyx_v_L1 = (__pyx_v_langles[((__pyx_v_ind_lim_data * 2) + 1)]);
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>:                         <span class="n">lim_is_none</span> <span class="o">=</span> <span class="n">llim_ves</span><span class="p">[</span><span class="n">ind_lim_data</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>            <span class='trace'>__Pyx_TraceLine</span>(348,0,<span class='error_goto'>__PYX_ERR(0, 348, __pyx_L1_error)</span>)
            __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_llim_ves, __pyx_v_ind_lim_data)); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 348, __pyx_L1_error)</span>
            __pyx_v_lim_is_none = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">350</span>:                         <span class="n">ind_lim_data</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(350,0,<span class='error_goto'>__PYX_ERR(0, 350, __pyx_L1_error)</span>)
            __pyx_v_ind_lim_data = (__pyx_v_ind_lim_data + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">351</span>:                         <span class="c"># We test if it is really necessary to compute the inter:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>:                         <span class="c"># We check if the ray intersects the bounding box</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">353</span>:                         <span class="n">inter_bbox</span> <span class="o">=</span> <span class="n">ray_intersects_abba_bbox</span><span class="p">(</span><span class="n">sign_ray</span><span class="p">,</span> <span class="n">invr_ray</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">loc_ds</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(353,0,<span class='error_goto'>__PYX_ERR(0, 353, __pyx_L1_error)</span>)
            __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_ray_intersects_abba_bbox(__pyx_v_sign_ray, __pyx_v_invr_ray, __pyx_v_bounds, __pyx_v_loc_ds);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>:                         <span class="k">if</span> <span class="ow">not</span> <span class="n">inter_bbox</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(354,0,<span class='error_goto'>__PYX_ERR(0, 354, __pyx_L1_error)</span>)
            __pyx_t_5 = ((!(__pyx_v_inter_bbox != 0)) != 0);
            if (__pyx_t_5) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>:                             <span class="k">continue</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(355,0,<span class='error_goto'>__PYX_ERR(0, 355, __pyx_L1_error)</span>)
              goto __pyx_L55_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>:                         <span class="c"># We check that the bounding box is not &quot;behind&quot; the last POut encountered</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:                         <span class="n">inter_bbox</span> <span class="o">=</span> <span class="n">ray_intersects_abba_bbox</span><span class="p">(</span><span class="n">sign_ray</span><span class="p">,</span> <span class="n">invr_ray</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">last_pout</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(358,0,<span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>)
            __pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_ray_intersects_abba_bbox(__pyx_v_sign_ray, __pyx_v_invr_ray, __pyx_v_bounds, __pyx_v_last_pout);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:                         <span class="k">if</span> <span class="n">inter_bbox</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(359,0,<span class='error_goto'>__PYX_ERR(0, 359, __pyx_L1_error)</span>)
            __pyx_t_5 = (__pyx_v_inter_bbox != 0);
            if (__pyx_t_5) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:                             <span class="k">continue</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(360,0,<span class='error_goto'>__PYX_ERR(0, 360, __pyx_L1_error)</span>)
              goto __pyx_L55_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">361</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>:                         <span class="c"># We compute new values</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>:                         <span class="n">found_new_kout</span> <span class="o">=</span> <span class="n">comp_inter_los_vpoly</span><span class="p">(</span><span class="n">loc_ds</span><span class="p">,</span> <span class="n">loc_us</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(363,0,<span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>)
            __pyx_v_found_new_kout = __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(__pyx_v_loc_ds, __pyx_v_loc_us, __pyx_t_37, __pyx_t_57, __pyx_v_nvert, __pyx_v_lim_is_none, __pyx_v_L0, __pyx_v_L1, __pyx_v_kpin_loc, __pyx_v_kpout_loc, __pyx_v_ind_loc, __pyx_v_loc_vp, __pyx_v_Forbidbis, __pyx_v_upscaDp, __pyx_v_upar2, __pyx_v_Dpar2, __pyx_v_invDpar2, __pyx_v_S1X, __pyx_v_S1Y, __pyx_v_S2X, __pyx_v_S2Y, __pyx_v_Crit2, __pyx_v_EpsUz, __pyx_v_EpsVz, __pyx_v_EpsA, __pyx_v_EpsB, __pyx_v_EpsPlane, 0);
            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_37, 1);
            __pyx_t_37.memview = NULL;
            __pyx_t_37.data = NULL;
            __PYX_XDEC_MEMVIEW(&amp;__pyx_t_57, 1);
            __pyx_t_57.memview = NULL;
            __pyx_t_57.data = NULL;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>:                                                               <span class="n">LSPoly</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span></pre>
<pre class='cython code score-8 '>            <span class='trace'>__Pyx_TraceLine</span>(364,0,<span class='error_goto'>__PYX_ERR(0, 364, __pyx_L1_error)</span>)
            if (unlikely(__pyx_v_LSPoly == Py_None)) {
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
              <span class='error_goto'>__PYX_ERR(0, 364, __pyx_L1_error)</span>
            }
            __pyx_t_37 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSPoly, __pyx_v_ii), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_37.memview)) __PYX_ERR(0, 364, __pyx_L1_error)</span>
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">365</span>:                                                               <span class="n">LSVIn</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">nvert</span><span class="p">,</span></pre>
<pre class='cython code score-8 '>            <span class='trace'>__Pyx_TraceLine</span>(365,0,<span class='error_goto'>__PYX_ERR(0, 365, __pyx_L1_error)</span>)
            if (unlikely(__pyx_v_LSVIn == Py_None)) {
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
              <span class='error_goto'>__PYX_ERR(0, 365, __pyx_L1_error)</span>
            }
            __pyx_t_57 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(<span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_v_LSVIn, __pyx_v_ii), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_57.memview)) __PYX_ERR(0, 365, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">366</span>:                                                               <span class="n">lim_is_none</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>:                                                               <span class="n">kpin_loc</span><span class="p">,</span> <span class="n">kpout_loc</span><span class="p">,</span> <span class="n">ind_loc</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>:                                                               <span class="n">loc_vp</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>:                                                               <span class="n">Forbidbis</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>:                                                               <span class="n">upscaDp</span><span class="p">,</span> <span class="n">upar2</span><span class="p">,</span> <span class="n">Dpar2</span><span class="p">,</span> <span class="n">invDpar2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>:                                                               <span class="n">S1X</span><span class="p">,</span> <span class="n">S1Y</span><span class="p">,</span> <span class="n">S2X</span><span class="p">,</span> <span class="n">S2Y</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>:                                                               <span class="n">Crit2</span><span class="p">,</span> <span class="n">EpsUz</span><span class="p">,</span> <span class="n">EpsVz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>:                                                               <span class="n">EpsA</span><span class="p">,</span> <span class="n">EpsB</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">374</span>:                                                               <span class="n">EpsPlane</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>:                         <span class="k">if</span> <span class="n">found_new_kout</span> <span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(375,0,<span class='error_goto'>__PYX_ERR(0, 375, __pyx_L1_error)</span>)
            __pyx_t_5 = (__pyx_v_found_new_kout != 0);
            if (__pyx_t_5) {
/* … */
            }
            __pyx_L55_continue:;
          }
        }
      }
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>:                             <span class="n">kPOut</span><span class="p">[</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>              <span class='trace'>__Pyx_TraceLine</span>(376,0,<span class='error_goto'>__PYX_ERR(0, 376, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_kpin_loc[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ind_tmp, __pyx_t_2, int, 1, __Pyx_PyInt_From_int, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 376, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>:                             <span class="n">VperpOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>              <span class='trace'>__Pyx_TraceLine</span>(377,0,<span class='error_goto'>__PYX_ERR(0, 377, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (0 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 377, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:                             <span class="n">VperpOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>              <span class='trace'>__Pyx_TraceLine</span>(378,0,<span class='error_goto'>__PYX_ERR(0, 378, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[1]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (1 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 378, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>:                             <span class="n">VperpOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">loc_vp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-8 '>              <span class='trace'>__Pyx_TraceLine</span>(379,0,<span class='error_goto'>__PYX_ERR(0, 379, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_vp[2]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (2 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_VperpOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 379, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>:                             <span class="n">IOut</span><span class="p">[</span><span class="mf">2</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-5 '>              <span class='trace'>__Pyx_TraceLine</span>(380,0,<span class='error_goto'>__PYX_ERR(0, 380, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((__pyx_v_ind_loc[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (2 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 380, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">381</span>:                             <span class="n">IOut</span><span class="p">[</span><span class="mf">0</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span><span class="o">+</span><span class="n">ii</span></pre>
<pre class='cython code score-5 '>              <span class='trace'>__Pyx_TraceLine</span>(381,0,<span class='error_goto'>__PYX_ERR(0, 381, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((1 + __pyx_v_ii));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (0 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 381, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>:                             <span class="n">IOut</span><span class="p">[</span><span class="mf">1</span><span class="o">+</span><span class="mf">3</span><span class="o">*</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-5 '>              <span class='trace'>__Pyx_TraceLine</span>(382,0,<span class='error_goto'>__PYX_ERR(0, 382, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_jj);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_34 = (1 + (3 * __pyx_v_ind_tmp));
              if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_IOut), __pyx_t_34, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">383</span>:                             <span class="n">last_pout</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kPOut</span><span class="p">[</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-37 '>              <span class='trace'>__Pyx_TraceLine</span>(383,0,<span class='error_goto'>__PYX_ERR(0, 383, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ind_tmp, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_us[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_ds[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_12, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 383, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              (__pyx_v_last_pout[0]) = __pyx_t_19;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">384</span>:                             <span class="n">last_pout</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kPOut</span><span class="p">[</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-37 '>              <span class='trace'>__Pyx_TraceLine</span>(384,0,<span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ind_tmp, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_us[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_ds[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_12, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              (__pyx_v_last_pout[1]) = __pyx_t_19;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>:                             <span class="n">last_pout</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kPOut</span><span class="p">[</span><span class="n">ind_tmp</span><span class="p">]</span> <span class="o">*</span> <span class="n">loc_us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">loc_ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-37 '>              <span class='trace'>__Pyx_TraceLine</span>(385,0,<span class='error_goto'>__PYX_ERR(0, 385, __pyx_L1_error)</span>)
              __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_kPOut), __pyx_v_ind_tmp, int, 1, __Pyx_PyInt_From_int, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_us[2]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_12 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_loc_ds[2]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
              __pyx_t_2 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_12, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
              __pyx_t_19 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_2); if (unlikely((__pyx_t_19 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 385, __pyx_L1_error)</span>
              <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
              (__pyx_v_last_pout[2]) = __pyx_t_19;
</pre><pre class="cython line score-0">&#xA0;<span class="">386</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>:             <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">llen_lim</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>      <span class='trace'>__Pyx_TraceLine</span>(387,0,<span class='error_goto'>__PYX_ERR(0, 387, __pyx_L1_error)</span>)
      <span class='py_c_api'>PyMem_Free</span>(__pyx_v_llen_lim);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>:     <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">lbounds</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(388,0,<span class='error_goto'>__PYX_ERR(0, 388, __pyx_L1_error)</span>)
  <span class='py_c_api'>PyMem_Free</span>(__pyx_v_lbounds);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>:     <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">langles</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  <span class='trace'>__Pyx_TraceLine</span>(389,0,<span class='error_goto'>__PYX_ERR(0, 389, __pyx_L1_error)</span>)
  <span class='py_c_api'>PyMem_Free</span>(__pyx_v_langles);
</pre><pre class="cython line score-0">&#xA0;<span class="">390</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>:     <span class="c"># arr_kpin  = pointer_to_numpy_array_double(kPIn, num_los)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>:     <span class="c"># arr_kpout = pointer_to_numpy_array_double(kPOut, num_los)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">393</span>:     <span class="c"># arr_vperp = pointer_to_numpy_array_double(VperpOut, 3*num_los)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">394</span>:     <span class="c"># arr_iout  = pointer_to_numpy_array_int(IOut, 3*num_los)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>:     <span class="c"># PyMem_Free(kPIn)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">396</span>:     <span class="c"># PyMem_Free(kPOut)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">397</span>:     <span class="c"># PyMem_Free(IOut)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">398</span>:     <span class="c"># PyMem_Free(VperpOut)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">399</span>:     <span class="c"># return arr_kpin, arr_kpout, arr_vperp, arr_iout</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>:     <span class="c"># kpin_view = kPIn</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>:     <span class="c"># kpOut_view = kPOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">403</span>:     <span class="c"># vperp_view = VperpOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>:     <span class="c"># ind_view = IOut</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>: </pre>
<pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">406</span>:     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kPIn</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">kPOut</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">VperpOut</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">IOut</span><span class="p">)</span></pre>
<pre class='cython code score-86 '>  <span class='trace'>__Pyx_TraceLine</span>(406,0,<span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>)
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_3, ((PyObject *)__pyx_v_kPIn)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_12, ((PyObject *)__pyx_v_kPIn));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
    }
  }
  __pyx_t_12 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_3, ((PyObject *)__pyx_v_kPOut)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, ((PyObject *)__pyx_v_kPOut));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_12)) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  __pyx_t_10 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_3, ((PyObject *)__pyx_v_VperpOut)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, ((PyObject *)__pyx_v_VperpOut));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_18))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_18);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_18);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_18, function);
    }
  }
  __pyx_t_11 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_18, __pyx_t_3, ((PyObject *)__pyx_v_IOut)) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_18, ((PyObject *)__pyx_v_IOut));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
  __pyx_t_18 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 1, __pyx_t_12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 2, __pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 3, __pyx_t_11);
  __pyx_t_2 = 0;
  __pyx_t_12 = 0;
  __pyx_t_10 = 0;
  __pyx_t_11 = 0;
  __pyx_r = __pyx_t_18;
  __pyx_t_18 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">407</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">408</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">bint</span> <span class="nf">comp_inter_los_vpoly</span><span class="p">(</span><span class="n">double</span> <span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">Ds</span><span class="p">,</span> <span class="n">double</span> <span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">us</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_comp_inter_los_vpoly(double *__pyx_v_Ds, double *__pyx_v_us, __Pyx_memviewslice __pyx_v_VPoly, __Pyx_memviewslice __pyx_v_vIn, int __pyx_v_vin_shape, int __pyx_v_lim_is_none, double __pyx_v_L0, double __pyx_v_L1, double *__pyx_v_kpin_loc, double *__pyx_v_kpout_loc, int *__pyx_v_ind_loc, double *__pyx_v_vperpin, int __pyx_v_Forbidbis, double __pyx_v_upscaDp, double __pyx_v_upar2, double __pyx_v_Dpar2, CYTHON_UNUSED double __pyx_v_invDpar2, double __pyx_v_S1X, double __pyx_v_S1Y, double __pyx_v_S2X, double __pyx_v_S2Y, double __pyx_v_Crit2, CYTHON_UNUSED double __pyx_v_EpsUz, double __pyx_v_EpsVz, double __pyx_v_EpsA, double __pyx_v_EpsB, double __pyx_v_EpsPlane, int __pyx_v_struct_is_ves) {
  int __pyx_v_jj;
  int __pyx_v_indin;
  int __pyx_v_Done;
  int __pyx_v_indout;
  int __pyx_v_inter_bbox;
  double __pyx_v_kout;
  double __pyx_v_kin;
  double __pyx_v_sca;
  double __pyx_v_sca0;
  double __pyx_v_sca1;
  double __pyx_v_sca2;
  double __pyx_v_q;
  double __pyx_v_C;
  double __pyx_v_delta;
  double __pyx_v_sqd;
  double __pyx_v_k;
  double __pyx_v_sol0;
  double __pyx_v_sol1;
  double __pyx_v_phi;
  double __pyx_v_v0;
  double __pyx_v_v1;
  double __pyx_v_A;
  double __pyx_v_B;
  double __pyx_v_ephiIn0;
  double __pyx_v_ephiIn1;
  double __pyx_v_SOut1;
  double __pyx_v_SOut0;
  double __pyx_v_SIn1;
  double __pyx_v_SIn0;
  double __pyx_v_res_kin;
  double __pyx_v_invupar2;
  double __pyx_v_invuz;
  double __pyx_v_cosl0;
  double __pyx_v_cosl1;
  double __pyx_v_sinl0;
  double __pyx_v_sinl1;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("comp_inter_los_vpoly", 0);
  <span class='trace'>__Pyx_TraceCall</span>("comp_inter_los_vpoly", __pyx_f[0], 408, 0, <span class='error_goto'>__PYX_ERR(0, 408, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_90, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_91, 1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.comp_inter_los_vpoly", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">409</span>:                                 <span class="n">double</span> <span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">VPoly</span><span class="p">,</span> <span class="n">double</span> <span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">vIn</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>:                                 <span class="nb">int</span> <span class="n">vin_shape</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>:                                 <span class="n">bint</span> <span class="n">lim_is_none</span><span class="p">,</span> <span class="n">double</span> <span class="n">L0</span><span class="p">,</span> <span class="n">double</span> <span class="n">L1</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>:                                 <span class="n">double</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="n">kpin_loc</span><span class="p">,</span> <span class="n">double</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="n">kpout_loc</span><span class="p">,</span> <span class="nb">int</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="n">ind_loc</span><span class="p">,</span> <span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">vperpin</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>:                                 <span class="n">bint</span> <span class="n">Forbidbis</span><span class="p">,</span> <span class="n">double</span> <span class="n">upscaDp</span><span class="p">,</span> <span class="n">double</span> <span class="n">upar2</span><span class="p">,</span> <span class="n">double</span> <span class="n">Dpar2</span><span class="p">,</span> <span class="n">double</span> <span class="n">invDpar2</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>:                                 <span class="n">double</span> <span class="n">S1X</span><span class="p">,</span> <span class="n">double</span> <span class="n">S1Y</span><span class="p">,</span> <span class="n">double</span> <span class="n">S2X</span><span class="p">,</span> <span class="n">double</span> <span class="n">S2Y</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>:                                 <span class="n">double</span> <span class="n">Crit2</span><span class="p">,</span> <span class="n">double</span> <span class="n">EpsUz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>:                                 <span class="n">double</span> <span class="n">EpsVz</span><span class="p">,</span> <span class="n">double</span> <span class="n">EpsA</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>:                                 <span class="n">double</span> <span class="n">EpsB</span><span class="p">,</span> <span class="n">double</span> <span class="n">EpsPlane</span><span class="p">,</span> <span class="n">bint</span> <span class="n">struct_is_ves</span><span class="p">)</span> <span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">jj</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">indin</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">Done</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">indout</span><span class="o">=</span><span class="mf">0</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(419,0,<span class='error_goto'>__PYX_ERR(0, 419, __pyx_L1_error)</span>)
  __pyx_v_indin = 0;
  __pyx_v_Done = 0;
  __pyx_v_indout = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">inter_bbox</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">kout</span><span class="p">,</span> <span class="nf">kin</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">422</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sca</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sca0</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sca1</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">sca2</span><span class="o">=</span><span class="mf">0.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(422,0,<span class='error_goto'>__PYX_ERR(0, 422, __pyx_L1_error)</span>)
  __pyx_v_sca = 0.;
  __pyx_v_sca0 = 0.;
  __pyx_v_sca1 = 0.;
  __pyx_v_sca2 = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">q</span><span class="p">,</span> <span class="nf">C</span><span class="p">,</span> <span class="nf">delta</span><span class="p">,</span> <span class="nf">sqd</span><span class="p">,</span> <span class="nf">k</span><span class="p">,</span> <span class="nf">sol0</span><span class="p">,</span> <span class="nf">sol1</span><span class="p">,</span> <span class="nf">phi</span><span class="o">=</span><span class="mf">0.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(423,0,<span class='error_goto'>__PYX_ERR(0, 423, __pyx_L1_error)</span>)
  __pyx_v_phi = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">424</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">v0</span><span class="p">,</span> <span class="nf">v1</span><span class="p">,</span> <span class="nf">A</span><span class="p">,</span> <span class="nf">B</span><span class="p">,</span> <span class="nf">ephiIn0</span><span class="p">,</span> <span class="nf">ephiIn1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">425</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">SOut1</span><span class="p">,</span> <span class="nf">SOut0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">426</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">SIn1</span><span class="p">,</span> <span class="nf">SIn0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">res_kin</span> <span class="o">=</span> <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(427,0,<span class='error_goto'>__PYX_ERR(0, 427, __pyx_L1_error)</span>)
  __pyx_v_res_kin = (__pyx_v_kpin_loc[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">428</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">opp_dir</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">invupar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">430</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">invuz</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">431</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cosl0</span><span class="p">,</span> <span class="nf">cosl1</span><span class="p">,</span> <span class="nf">sinl0</span><span class="p">,</span> <span class="nf">sinl1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">432</span>:     <span class="c">################</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">433</span>:     <span class="c"># Computing some useful values</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>:     <span class="n">cosl0</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">L0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(434,0,<span class='error_goto'>__PYX_ERR(0, 434, __pyx_L1_error)</span>)
  __pyx_v_cosl0 = cos(__pyx_v_L0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>:     <span class="n">cosl1</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">L1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(435,0,<span class='error_goto'>__PYX_ERR(0, 435, __pyx_L1_error)</span>)
  __pyx_v_cosl1 = cos(__pyx_v_L1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">436</span>:     <span class="n">sinl0</span> <span class="o">=</span> <span class="n">Csin</span><span class="p">(</span><span class="n">L0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(436,0,<span class='error_goto'>__PYX_ERR(0, 436, __pyx_L1_error)</span>)
  __pyx_v_sinl0 = sin(__pyx_v_L0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">437</span>:     <span class="n">sinl1</span> <span class="o">=</span> <span class="n">Csin</span><span class="p">(</span><span class="n">L1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(437,0,<span class='error_goto'>__PYX_ERR(0, 437, __pyx_L1_error)</span>)
  __pyx_v_sinl1 = sin(__pyx_v_L1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:     <span class="n">invupar2</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">upar2</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(438,0,<span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>)
  __pyx_v_invupar2 = (1. / __pyx_v_upar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">439</span>:     <span class="n">invuz</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(439,0,<span class='error_goto'>__PYX_ERR(0, 439, __pyx_L1_error)</span>)
  __pyx_v_invuz = (1. / (__pyx_v_us[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">440</span>:     <span class="c"># Compute all solutions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">441</span>:     <span class="c"># Set tolerance value for us[2,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">442</span>:     <span class="c"># EpsUz is the tolerated DZ across 20m (max Tokamak size)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">443</span>:     <span class="n">kout</span><span class="p">,</span> <span class="n">kin</span><span class="p">,</span> <span class="n">Done</span> <span class="o">=</span> <span class="mf">1.e12</span><span class="p">,</span> <span class="mf">1e12</span><span class="p">,</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(443,0,<span class='error_goto'>__PYX_ERR(0, 443, __pyx_L1_error)</span>)
  __pyx_t_1 = 1.e12;
  __pyx_t_2 = 1e12;
  __pyx_t_3 = 0;
  __pyx_v_kout = __pyx_t_1;
  __pyx_v_kin = __pyx_t_2;
  __pyx_v_Done = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">444</span>:     <span class="c"># Case with horizontal semi-line</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>:     <span class="k">if</span> <span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">Crit2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(445,0,<span class='error_goto'>__PYX_ERR(0, 445, __pyx_L1_error)</span>)
  __pyx_t_4 = ((((__pyx_v_us[2]) * (__pyx_v_us[2])) &lt; __pyx_v_Crit2) != 0);
  if (__pyx_t_4) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>:         <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="n">vin_shape</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(446,0,<span class='error_goto'>__PYX_ERR(0, 446, __pyx_L1_error)</span>)
    __pyx_t_3 = __pyx_v_vin_shape;
    __pyx_t_5 = __pyx_t_3;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">447</span>:             <span class="c"># Solutions exist only in the case with non-horizontal</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>:             <span class="c"># segment (i.e.: cone, not plane)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">449</span>:             <span class="c"># TODO : @LM : is this faster than checking abs(diff)&gt;eps ?</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>:             <span class="k">if</span> <span class="p">(</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">**</span><span class="mf">2</span> <span class="o">&gt;</span> <span class="n">EpsVz</span><span class="o">*</span><span class="n">EpsVz</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(450,0,<span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>)
      __pyx_t_7 = 1;
      __pyx_t_8 = (__pyx_v_jj + 1);
      __pyx_t_9 = 1;
      __pyx_t_10 = __pyx_v_jj;
      __pyx_t_4 = ((pow(((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_7 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_8)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_9 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_10)) )))), 2.0) &gt; (__pyx_v_EpsVz * __pyx_v_EpsVz)) != 0);
      if (__pyx_t_4) {
/* … */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>:                 <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(451,0,<span class='error_goto'>__PYX_ERR(0, 451, __pyx_L1_error)</span>)
        __pyx_t_11 = 1;
        __pyx_t_12 = __pyx_v_jj;
        __pyx_t_13 = 1;
        __pyx_t_14 = (__pyx_v_jj + 1);
        __pyx_t_15 = 1;
        __pyx_t_16 = __pyx_v_jj;
        __pyx_v_q = (((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_11 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_12)) )))) / ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_13 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_14)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_15 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_16)) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">452</span>:                 <span class="c"># The intersection must stand on the segment</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>:                 <span class="k">if</span> <span class="n">q</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">q</span><span class="o">&lt;</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(453,0,<span class='error_goto'>__PYX_ERR(0, 453, __pyx_L1_error)</span>)
        __pyx_t_17 = ((__pyx_v_q &gt;= 0.0) != 0);
        if (__pyx_t_17) {
        } else {
          __pyx_t_4 = __pyx_t_17;
          goto __pyx_L8_bool_binop_done;
        }
        __pyx_t_17 = ((__pyx_v_q &lt; 1.0) != 0);
        __pyx_t_4 = __pyx_t_17;
        __pyx_L8_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>:                     <span class="n">C</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(454,0,<span class='error_goto'>__PYX_ERR(0, 454, __pyx_L1_error)</span>)
          __pyx_t_18 = 0;
          __pyx_t_19 = (__pyx_v_jj + 1);
          __pyx_t_20 = 0;
          __pyx_t_21 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:                         <span class="mf">2.</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(455,0,<span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>)
          __pyx_t_22 = 0;
          __pyx_t_23 = __pyx_v_jj;
          __pyx_t_24 = 0;
          __pyx_t_25 = (__pyx_v_jj + 1);
          __pyx_t_26 = 0;
          __pyx_t_27 = __pyx_v_jj;
/* … */
          <span class='trace'>__Pyx_TraceLine</span>(455,0,<span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>)
          __pyx_v_C = ((((__pyx_v_q * __pyx_v_q) * pow(((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_18 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_19)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_20 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_21)) )))), 2.0)) + (((2. * __pyx_v_q) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_22 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_23)) )))) * ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_24 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_25)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_26 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_27)) )))))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_28 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_29)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_30 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_31)) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">456</span>:                         <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(456,0,<span class='error_goto'>__PYX_ERR(0, 456, __pyx_L1_error)</span>)
          __pyx_t_28 = 0;
          __pyx_t_29 = __pyx_v_jj;
          __pyx_t_30 = 0;
          __pyx_t_31 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">457</span>:                     <span class="n">delta</span> <span class="o">=</span> <span class="n">upscaDp</span><span class="o">*</span><span class="n">upscaDp</span> <span class="o">-</span> <span class="n">upar2</span><span class="o">*</span><span class="p">(</span><span class="n">Dpar2</span><span class="o">-</span><span class="n">C</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(457,0,<span class='error_goto'>__PYX_ERR(0, 457, __pyx_L1_error)</span>)
          __pyx_v_delta = ((__pyx_v_upscaDp * __pyx_v_upscaDp) - (__pyx_v_upar2 * (__pyx_v_Dpar2 - __pyx_v_C)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">458</span>:                     <span class="k">if</span> <span class="n">delta</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(458,0,<span class='error_goto'>__PYX_ERR(0, 458, __pyx_L1_error)</span>)
          __pyx_t_4 = ((__pyx_v_delta &gt; 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">459</span>:                         <span class="n">sqd</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(459,0,<span class='error_goto'>__PYX_ERR(0, 459, __pyx_L1_error)</span>)
            __pyx_v_sqd = sqrt(__pyx_v_delta);
</pre><pre class="cython line score-0">&#xA0;<span class="">460</span>:                         <span class="c"># The intersection must be on the semi-line</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">461</span>:                         <span class="c"># (i.e.: k&gt;=0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">462</span>:                         <span class="c"># First solution</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">463</span>:                         <span class="k">if</span> <span class="o">-</span><span class="n">upscaDp</span> <span class="o">-</span> <span class="n">sqd</span> <span class="o">&gt;=</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(463,0,<span class='error_goto'>__PYX_ERR(0, 463, __pyx_L1_error)</span>)
            __pyx_t_4 = ((((-__pyx_v_upscaDp) - __pyx_v_sqd) &gt;= 0.0) != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>:                             <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">upscaDp</span> <span class="o">-</span> <span class="n">sqd</span><span class="p">)</span><span class="o">*</span><span class="n">invupar2</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(464,0,<span class='error_goto'>__PYX_ERR(0, 464, __pyx_L1_error)</span>)
              __pyx_v_k = (((-__pyx_v_upscaDp) - __pyx_v_sqd) * __pyx_v_invupar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>:                             <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> \</pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(465,0,<span class='error_goto'>__PYX_ERR(0, 465, __pyx_L1_error)</span>)
              __pyx_t_2 = ((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">466</span>:                                          <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(466,0,<span class='error_goto'>__PYX_ERR(0, 466, __pyx_L1_error)</span>)
              __pyx_t_1 = ((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1])));
              __pyx_v_sol0 = __pyx_t_2;
              __pyx_v_sol1 = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>:                             <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(467,0,<span class='error_goto'>__PYX_ERR(0, 467, __pyx_L1_error)</span>)
              __pyx_t_4 = (__pyx_v_Forbidbis != 0);
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">468</span>:                                 <span class="n">sca0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(468,0,<span class='error_goto'>__PYX_ERR(0, 468, __pyx_L1_error)</span>)
                __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_S1X) * (__pyx_v_Ds[0])) + ((__pyx_v_sol1 - __pyx_v_S1Y) * (__pyx_v_Ds[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">469</span>:                                        <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">470</span>:                                 <span class="n">sca1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">S1X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">S1Y</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(470,0,<span class='error_goto'>__PYX_ERR(0, 470, __pyx_L1_error)</span>)
                __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_S1X) * __pyx_v_S1X) + ((__pyx_v_sol1 - __pyx_v_S1Y) * __pyx_v_S1Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">471</span>:                                 <span class="n">sca2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S2X</span><span class="p">)</span><span class="o">*</span><span class="n">S2X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S2Y</span><span class="p">)</span><span class="o">*</span><span class="n">S2Y</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(471,0,<span class='error_goto'>__PYX_ERR(0, 471, __pyx_L1_error)</span>)
                __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_S2X) * __pyx_v_S2X) + ((__pyx_v_sol1 - __pyx_v_S2Y) * __pyx_v_S2Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">472</span>:                             <span class="k">if</span> <span class="ow">not</span> <span class="n">Forbidbis</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Forbidbis</span> <span class="ow">and</span> <span class="ow">not</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(472,0,<span class='error_goto'>__PYX_ERR(0, 472, __pyx_L1_error)</span>)
              __pyx_t_17 = ((!(__pyx_v_Forbidbis != 0)) != 0);
              if (!__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L14_bool_binop_done;
              }
              __pyx_t_17 = (__pyx_v_Forbidbis != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L14_bool_binop_done;
              }
/* … */
              <span class='trace'>__Pyx_TraceLine</span>(472,0,<span class='error_goto'>__PYX_ERR(0, 472, __pyx_L1_error)</span>)
              __pyx_t_32 = ((!__pyx_t_17) != 0);
              __pyx_t_4 = __pyx_t_32;
              __pyx_L14_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">473</span>:                                                  <span class="p">(</span><span class="n">sca0</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca1</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(473,0,<span class='error_goto'>__PYX_ERR(0, 473, __pyx_L1_error)</span>)
              __pyx_t_32 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_32) {
              } else {
                __pyx_t_17 = __pyx_t_32;
                goto __pyx_L17_bool_binop_done;
              }
              __pyx_t_32 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_32) {
              } else {
                __pyx_t_17 = __pyx_t_32;
                goto __pyx_L17_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">474</span>:                                                   <span class="n">sca2</span><span class="o">&lt;</span><span class="mf">0</span><span class="p">)):</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(474,0,<span class='error_goto'>__PYX_ERR(0, 474, __pyx_L1_error)</span>)
              __pyx_t_32 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_17 = __pyx_t_32;
              __pyx_L17_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">475</span>:                                 <span class="c"># Get the normalized perpendicular vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">476</span>:                                 <span class="c"># at intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">477</span>:                                 <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span><span class="n">sol0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(477,0,<span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>)
                __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0">&#xA0;<span class="">478</span>:                                 <span class="c"># Check sol inside the Lim</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">479</span>:                                 <span class="k">if</span> <span class="n">lim_is_none</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lim_is_none</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(479,0,<span class='error_goto'>__PYX_ERR(0, 479, __pyx_L1_error)</span>)
                __pyx_t_32 = (__pyx_v_lim_is_none != 0);
                if (!__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L21_bool_binop_done;
                }
                __pyx_t_32 = ((!(__pyx_v_lim_is_none != 0)) != 0);
                if (__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L21_bool_binop_done;
                }
/* … */
                <span class='trace'>__Pyx_TraceLine</span>(479,0,<span class='error_goto'>__PYX_ERR(0, 479, __pyx_L1_error)</span>)
                if (__pyx_t_4) {
/* … */
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">480</span>:                                                    <span class="p">((</span><span class="n">L0</span><span class="o">&lt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="n">L0</span><span class="o">&lt;=</span><span class="n">phi</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(480,0,<span class='error_goto'>__PYX_ERR(0, 480, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_L0 &lt; __pyx_v_L1) != 0);
                if (!__pyx_t_32) {
                  goto __pyx_L24_next_or;
                } else {
                }
                __pyx_t_32 = ((__pyx_v_L0 &lt;= __pyx_v_phi) != 0);
                if (!__pyx_t_32) {
                  goto __pyx_L24_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">481</span>:                                                      <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(481,0,<span class='error_goto'>__PYX_ERR(0, 481, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
                if (!__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L21_bool_binop_done;
                }
                __pyx_L24_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">482</span>:                                                     <span class="ow">or</span> <span class="p">(</span><span class="n">L0</span><span class="o">&gt;</span><span class="n">L1</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(482,0,<span class='error_goto'>__PYX_ERR(0, 482, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_L0 &gt; __pyx_v_L1) != 0);
                if (__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L21_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">483</span>:                                                         <span class="p">(</span><span class="n">phi</span><span class="o">&gt;=</span><span class="n">L0</span> <span class="ow">or</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(483,0,<span class='error_goto'>__PYX_ERR(0, 483, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_phi &gt;= __pyx_v_L0) != 0);
                if (!__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L21_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">484</span>:                                                          <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)))):</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(484,0,<span class='error_goto'>__PYX_ERR(0, 484, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
                __pyx_t_4 = __pyx_t_32;
                __pyx_L21_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">485</span>:                                     <span class="c"># Get the scalar product to determine</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>:                                     <span class="c"># entry or exit point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">487</span>:                                     <span class="n">sca</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(487,0,<span class='error_goto'>__PYX_ERR(0, 487, __pyx_L1_error)</span>)
                  __pyx_t_33 = 0;
                  __pyx_t_34 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">488</span>:                                           <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(488,0,<span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>)
                  __pyx_t_35 = 0;
                  __pyx_t_36 = __pyx_v_jj;
/* … */
                  <span class='trace'>__Pyx_TraceLine</span>(488,0,<span class='error_goto'>__PYX_ERR(0, 488, __pyx_L1_error)</span>)
                  __pyx_v_sca = ((((cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_33 * __pyx_v_vIn.strides[0]) )) + __pyx_t_34)) )))) * (__pyx_v_us[0])) + ((sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_35 * __pyx_v_vIn.strides[0]) )) + __pyx_t_36)) )))) * (__pyx_v_us[1]))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_37 * __pyx_v_vIn.strides[0]) )) + __pyx_t_38)) ))) * (__pyx_v_us[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">489</span>:                                           <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(489,0,<span class='error_goto'>__PYX_ERR(0, 489, __pyx_L1_error)</span>)
                  __pyx_t_37 = 1;
                  __pyx_t_38 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">490</span>:                                     <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(490,0,<span class='error_goto'>__PYX_ERR(0, 490, __pyx_L1_error)</span>)
                  __pyx_t_32 = ((__pyx_v_sca &lt;= 0.0) != 0);
                  if (__pyx_t_32) {
                  } else {
                    __pyx_t_4 = __pyx_t_32;
                    goto __pyx_L30_bool_binop_done;
                  }
                  __pyx_t_32 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                  __pyx_t_4 = __pyx_t_32;
                  __pyx_L30_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                    goto __pyx_L29;
                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">491</span>:                                         <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(491,0,<span class='error_goto'>__PYX_ERR(0, 491, __pyx_L1_error)</span>)
                    __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">492</span>:                                         <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(492,0,<span class='error_goto'>__PYX_ERR(0, 492, __pyx_L1_error)</span>)
                    __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">493</span>:                                         <span class="n">indout</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(493,0,<span class='error_goto'>__PYX_ERR(0, 493, __pyx_L1_error)</span>)
                    __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>:                                     <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(494,0,<span class='error_goto'>__PYX_ERR(0, 494, __pyx_L1_error)</span>)
                  __pyx_t_32 = ((__pyx_v_sca &gt;= 0.0) != 0);
                  if (__pyx_t_32) {
                  } else {
                    __pyx_t_4 = __pyx_t_32;
                    goto __pyx_L32_bool_binop_done;
                  }
                  __pyx_t_1 = __pyx_v_kout;
                  __pyx_t_2 = __pyx_v_kin;
                  if (((__pyx_t_1 &lt; __pyx_t_2) != 0)) {
                    __pyx_t_39 = __pyx_t_1;
                  } else {
                    __pyx_t_39 = __pyx_t_2;
                  }
                  __pyx_t_32 = ((__pyx_v_k &lt; __pyx_t_39) != 0);
                  __pyx_t_4 = __pyx_t_32;
                  __pyx_L32_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                  }
                  __pyx_L29:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">495</span>:                                         <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(495,0,<span class='error_goto'>__PYX_ERR(0, 495, __pyx_L1_error)</span>)
                    __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">496</span>:                                         <span class="n">indin</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(496,0,<span class='error_goto'>__PYX_ERR(0, 496, __pyx_L1_error)</span>)
                    __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">497</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>:                         <span class="c"># Second solution</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">499</span>:                         <span class="k">if</span> <span class="o">-</span><span class="n">upscaDp</span> <span class="o">+</span> <span class="n">sqd</span> <span class="o">&gt;=</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(499,0,<span class='error_goto'>__PYX_ERR(0, 499, __pyx_L1_error)</span>)
            __pyx_t_4 = ((((-__pyx_v_upscaDp) + __pyx_v_sqd) &gt;= 0.0) != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:                             <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">upscaDp</span> <span class="o">+</span> <span class="n">sqd</span><span class="p">)</span><span class="o">*</span><span class="n">invupar2</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(500,0,<span class='error_goto'>__PYX_ERR(0, 500, __pyx_L1_error)</span>)
              __pyx_v_k = (((-__pyx_v_upscaDp) + __pyx_v_sqd) * __pyx_v_invupar2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:                             <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> \</pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(501,0,<span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>)
              __pyx_t_39 = ((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>:                                          <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(502,0,<span class='error_goto'>__PYX_ERR(0, 502, __pyx_L1_error)</span>)
              __pyx_t_1 = ((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1])));
              __pyx_v_sol0 = __pyx_t_39;
              __pyx_v_sol1 = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>:                             <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(503,0,<span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>)
              __pyx_t_4 = (__pyx_v_Forbidbis != 0);
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>:                                 <span class="n">sca0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(504,0,<span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>)
                __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_S1X) * (__pyx_v_Ds[0])) + ((__pyx_v_sol1 - __pyx_v_S1Y) * (__pyx_v_Ds[1])));
</pre><pre class="cython line score-0">&#xA0;<span class="">505</span>:                                        <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>:                                 <span class="n">sca1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">S1X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">S1Y</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(506,0,<span class='error_goto'>__PYX_ERR(0, 506, __pyx_L1_error)</span>)
                __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_S1X) * __pyx_v_S1X) + ((__pyx_v_sol1 - __pyx_v_S1Y) * __pyx_v_S1Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>:                                 <span class="n">sca2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S2X</span><span class="p">)</span><span class="o">*</span><span class="n">S2X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S2Y</span><span class="p">)</span><span class="o">*</span><span class="n">S2Y</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(507,0,<span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>)
                __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_S2X) * __pyx_v_S2X) + ((__pyx_v_sol1 - __pyx_v_S2Y) * __pyx_v_S2Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">508</span>:                             <span class="k">if</span> <span class="ow">not</span> <span class="n">Forbidbis</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Forbidbis</span> <span class="ow">and</span> <span class="ow">not</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(508,0,<span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>)
              __pyx_t_32 = ((!(__pyx_v_Forbidbis != 0)) != 0);
              if (!__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L37_bool_binop_done;
              }
              __pyx_t_32 = (__pyx_v_Forbidbis != 0);
              if (__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L37_bool_binop_done;
              }
/* … */
              <span class='trace'>__Pyx_TraceLine</span>(508,0,<span class='error_goto'>__PYX_ERR(0, 508, __pyx_L1_error)</span>)
              __pyx_t_17 = ((!__pyx_t_32) != 0);
              __pyx_t_4 = __pyx_t_17;
              __pyx_L37_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">509</span>:                                                  <span class="p">(</span><span class="n">sca0</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca1</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(509,0,<span class='error_goto'>__PYX_ERR(0, 509, __pyx_L1_error)</span>)
              __pyx_t_17 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_32 = __pyx_t_17;
                goto __pyx_L40_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_32 = __pyx_t_17;
                goto __pyx_L40_bool_binop_done;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">510</span>:                                                   <span class="n">sca2</span><span class="o">&lt;</span><span class="mf">0</span><span class="p">)):</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(510,0,<span class='error_goto'>__PYX_ERR(0, 510, __pyx_L1_error)</span>)
              __pyx_t_17 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_32 = __pyx_t_17;
              __pyx_L40_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">511</span>:                                 <span class="c"># Get the normalized perpendicular vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>:                                 <span class="c"># at intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">513</span>:                                 <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span><span class="n">sol0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(513,0,<span class='error_goto'>__PYX_ERR(0, 513, __pyx_L1_error)</span>)
                __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>:                                 <span class="k">if</span> <span class="n">lim_is_none</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lim_is_none</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(514,0,<span class='error_goto'>__PYX_ERR(0, 514, __pyx_L1_error)</span>)
                __pyx_t_17 = (__pyx_v_lim_is_none != 0);
                if (!__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L44_bool_binop_done;
                }
                __pyx_t_17 = ((!(__pyx_v_lim_is_none != 0)) != 0);
                if (__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L44_bool_binop_done;
                }
/* … */
                <span class='trace'>__Pyx_TraceLine</span>(514,0,<span class='error_goto'>__PYX_ERR(0, 514, __pyx_L1_error)</span>)
                if (__pyx_t_4) {
/* … */
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">515</span>:                                                    <span class="p">((</span><span class="n">L0</span><span class="o">&lt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="n">L0</span><span class="o">&lt;=</span><span class="n">phi</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(515,0,<span class='error_goto'>__PYX_ERR(0, 515, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_L0 &lt; __pyx_v_L1) != 0);
                if (!__pyx_t_17) {
                  goto __pyx_L47_next_or;
                } else {
                }
                __pyx_t_17 = ((__pyx_v_L0 &lt;= __pyx_v_phi) != 0);
                if (!__pyx_t_17) {
                  goto __pyx_L47_next_or;
                } else {
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">516</span>:                                                      <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)</span> <span class="ow">or</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(516,0,<span class='error_goto'>__PYX_ERR(0, 516, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
                if (!__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L44_bool_binop_done;
                }
                __pyx_L47_next_or:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>:                                                     <span class="p">(</span><span class="n">L0</span><span class="o">&gt;</span><span class="n">L1</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(517,0,<span class='error_goto'>__PYX_ERR(0, 517, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_L0 &gt; __pyx_v_L1) != 0);
                if (__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L44_bool_binop_done;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">518</span>:                                                      <span class="p">(</span><span class="n">phi</span><span class="o">&gt;=</span><span class="n">L0</span> <span class="ow">or</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(518,0,<span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_phi &gt;= __pyx_v_L0) != 0);
                if (!__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L44_bool_binop_done;
                }
                __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
                __pyx_t_4 = __pyx_t_17;
                __pyx_L44_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">519</span>:                                                    <span class="p">)):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">520</span>:                                     <span class="c"># Get the scalar product to determine</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">521</span>:                                     <span class="c"># entry or exit point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">522</span>:                                     <span class="n">sca</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(522,0,<span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>)
                  __pyx_t_40 = 0;
                  __pyx_t_41 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">523</span>:                                           <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(523,0,<span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>)
                  __pyx_t_42 = 0;
                  __pyx_t_43 = __pyx_v_jj;
/* … */
                  <span class='trace'>__Pyx_TraceLine</span>(523,0,<span class='error_goto'>__PYX_ERR(0, 523, __pyx_L1_error)</span>)
                  __pyx_v_sca = ((((cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_40 * __pyx_v_vIn.strides[0]) )) + __pyx_t_41)) )))) * (__pyx_v_us[0])) + ((sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_42 * __pyx_v_vIn.strides[0]) )) + __pyx_t_43)) )))) * (__pyx_v_us[1]))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_44 * __pyx_v_vIn.strides[0]) )) + __pyx_t_45)) ))) * (__pyx_v_us[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">524</span>:                                           <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(524,0,<span class='error_goto'>__PYX_ERR(0, 524, __pyx_L1_error)</span>)
                  __pyx_t_44 = 1;
                  __pyx_t_45 = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">525</span>:                                     <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(525,0,<span class='error_goto'>__PYX_ERR(0, 525, __pyx_L1_error)</span>)
                  __pyx_t_17 = ((__pyx_v_sca &lt;= 0.0) != 0);
                  if (__pyx_t_17) {
                  } else {
                    __pyx_t_4 = __pyx_t_17;
                    goto __pyx_L53_bool_binop_done;
                  }
                  __pyx_t_17 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                  __pyx_t_4 = __pyx_t_17;
                  __pyx_L53_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                    goto __pyx_L52;
                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">526</span>:                                         <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(526,0,<span class='error_goto'>__PYX_ERR(0, 526, __pyx_L1_error)</span>)
                    __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>:                                         <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(527,0,<span class='error_goto'>__PYX_ERR(0, 527, __pyx_L1_error)</span>)
                    __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">528</span>:                                         <span class="n">indout</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(528,0,<span class='error_goto'>__PYX_ERR(0, 528, __pyx_L1_error)</span>)
                    __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">529</span>:                                     <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(529,0,<span class='error_goto'>__PYX_ERR(0, 529, __pyx_L1_error)</span>)
                  __pyx_t_17 = ((__pyx_v_sca &gt;= 0.0) != 0);
                  if (__pyx_t_17) {
                  } else {
                    __pyx_t_4 = __pyx_t_17;
                    goto __pyx_L55_bool_binop_done;
                  }
                  __pyx_t_1 = __pyx_v_kout;
                  __pyx_t_39 = __pyx_v_kin;
                  if (((__pyx_t_1 &lt; __pyx_t_39) != 0)) {
                    __pyx_t_2 = __pyx_t_1;
                  } else {
                    __pyx_t_2 = __pyx_t_39;
                  }
                  __pyx_t_17 = ((__pyx_v_k &lt; __pyx_t_2) != 0);
                  __pyx_t_4 = __pyx_t_17;
                  __pyx_L55_bool_binop_done:;
                  if (__pyx_t_4) {
/* … */
                  }
                  __pyx_L52:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>:                                         <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(530,0,<span class='error_goto'>__PYX_ERR(0, 530, __pyx_L1_error)</span>)
                    __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">531</span>:                                         <span class="n">indin</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                    <span class='trace'>__Pyx_TraceLine</span>(531,0,<span class='error_goto'>__PYX_ERR(0, 531, __pyx_L1_error)</span>)
                    __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">532</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">533</span>:     <span class="c"># More general non-horizontal semi-line case</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">534</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">535</span>:         <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">vin_shape</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(535,0,<span class='error_goto'>__PYX_ERR(0, 535, __pyx_L1_error)</span>)
  /*else*/ {
    __pyx_t_3 = __pyx_v_vin_shape;
    __pyx_t_5 = __pyx_t_3;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_jj = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>:             <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">],</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(536,0,<span class='error_goto'>__PYX_ERR(0, 536, __pyx_L1_error)</span>)
      __pyx_t_46 = 0;
      __pyx_t_47 = (__pyx_v_jj + 1);
      __pyx_t_48 = 0;
      __pyx_t_49 = __pyx_v_jj;
      __pyx_t_2 = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_46 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_47)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_48 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_49)) ))));
      __pyx_t_50 = 1;
      __pyx_t_51 = (__pyx_v_jj + 1);
      __pyx_t_52 = 1;
      __pyx_t_53 = __pyx_v_jj;
      __pyx_t_1 = ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_50 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_51)) ))) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_52 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_53)) ))));
      __pyx_v_v0 = __pyx_t_2;
      __pyx_v_v1 = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>:             <span class="n">A</span> <span class="o">=</span> <span class="n">v0</span><span class="o">*</span><span class="n">v0</span> <span class="o">-</span> <span class="n">upar2</span><span class="o">*</span><span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">invuz</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">invuz</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(537,0,<span class='error_goto'>__PYX_ERR(0, 537, __pyx_L1_error)</span>)
      __pyx_v_A = ((__pyx_v_v0 * __pyx_v_v0) - ((__pyx_v_upar2 * (__pyx_v_v1 * __pyx_v_invuz)) * (__pyx_v_v1 * __pyx_v_invuz)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>:             <span class="n">B</span> <span class="o">=</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">v0</span> <span class="o">+</span> <span class="n">v1</span><span class="o">*</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="n">upar2</span><span class="o">*</span><span class="n">invuz</span><span class="o">*</span><span class="n">invuz</span> <span class="o">-</span> <span class="n">upscaDp</span><span class="o">*</span><span class="n">v1</span><span class="o">*</span><span class="n">invuz</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(538,0,<span class='error_goto'>__PYX_ERR(0, 538, __pyx_L1_error)</span>)
      __pyx_t_54 = 0;
      __pyx_t_55 = __pyx_v_jj;
      __pyx_t_56 = 1;
      __pyx_t_57 = __pyx_v_jj;
      __pyx_v_B = ((((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_54 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_55)) ))) * __pyx_v_v0) + ((((__pyx_v_v1 * ((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_56 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_57)) ))))) * __pyx_v_upar2) * __pyx_v_invuz) * __pyx_v_invuz)) - ((__pyx_v_upscaDp * __pyx_v_v1) * __pyx_v_invuz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">539</span>:             <span class="n">C</span> <span class="o">=</span> <span class="o">-</span><span class="n">upar2</span><span class="o">*</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">**</span><span class="mf">2</span><span class="o">*</span><span class="n">invuz</span><span class="o">*</span><span class="n">invuz</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">upscaDp</span><span class="o">*</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span><span class="o">*</span><span class="n">invuz</span> <span class="o">-</span> <span class="n">Dpar2</span> <span class="o">+</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(539,0,<span class='error_goto'>__PYX_ERR(0, 539, __pyx_L1_error)</span>)
      __pyx_t_58 = 1;
      __pyx_t_59 = __pyx_v_jj;
      __pyx_t_60 = 1;
      __pyx_t_61 = __pyx_v_jj;
      __pyx_t_62 = 0;
      __pyx_t_63 = __pyx_v_jj;
      __pyx_t_64 = 0;
      __pyx_t_65 = __pyx_v_jj;
      __pyx_v_C = (((((((-__pyx_v_upar2) * pow(((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_58 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_59)) )))), 2.0)) * __pyx_v_invuz) * __pyx_v_invuz) + (((2. * __pyx_v_upscaDp) * ((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_60 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_61)) ))))) * __pyx_v_invuz)) - __pyx_v_Dpar2) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_62 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_63)) ))) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_64 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_65)) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">540</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:             <span class="k">if</span> <span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">&lt;</span><span class="n">EpsA</span><span class="o">*</span><span class="n">EpsA</span> <span class="ow">and</span> <span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">&gt;</span><span class="n">EpsB</span><span class="o">*</span><span class="n">EpsB</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(541,0,<span class='error_goto'>__PYX_ERR(0, 541, __pyx_L1_error)</span>)
      __pyx_t_17 = (((__pyx_v_A * __pyx_v_A) &lt; (__pyx_v_EpsA * __pyx_v_EpsA)) != 0);
      if (__pyx_t_17) {
      } else {
        __pyx_t_4 = __pyx_t_17;
        goto __pyx_L60_bool_binop_done;
      }
      __pyx_t_17 = (((__pyx_v_B * __pyx_v_B) &gt; (__pyx_v_EpsB * __pyx_v_EpsB)) != 0);
      __pyx_t_4 = __pyx_t_17;
      __pyx_L60_bool_binop_done:;
      if (__pyx_t_4) {
/* … */
        goto __pyx_L59;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">542</span>:                 <span class="n">q</span> <span class="o">=</span> <span class="o">-</span><span class="n">C</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">B</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(542,0,<span class='error_goto'>__PYX_ERR(0, 542, __pyx_L1_error)</span>)
        __pyx_v_q = ((-__pyx_v_C) / (2. * __pyx_v_B));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:                 <span class="k">if</span> <span class="n">q</span><span class="o">&gt;=</span><span class="mf">0.</span> <span class="ow">and</span> <span class="n">q</span><span class="o">&lt;</span><span class="mf">1.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(543,0,<span class='error_goto'>__PYX_ERR(0, 543, __pyx_L1_error)</span>)
        __pyx_t_17 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_17) {
        } else {
          __pyx_t_4 = __pyx_t_17;
          goto __pyx_L63_bool_binop_done;
        }
        __pyx_t_17 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_17;
        __pyx_L63_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">544</span>:                     <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">v1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]))</span><span class="o">*</span><span class="n">invuz</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(544,0,<span class='error_goto'>__PYX_ERR(0, 544, __pyx_L1_error)</span>)
          __pyx_t_66 = 1;
          __pyx_t_67 = __pyx_v_jj;
          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_66 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_67)) ))))) * __pyx_v_invuz);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:                     <span class="k">if</span> <span class="n">k</span><span class="o">&gt;=</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(545,0,<span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>)
          __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">546</span>:                         <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(546,0,<span class='error_goto'>__PYX_ERR(0, 546, __pyx_L1_error)</span>)
            __pyx_t_1 = ((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0])));
            __pyx_t_2 = ((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1])));
            __pyx_v_sol0 = __pyx_t_1;
            __pyx_v_sol1 = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:                         <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(547,0,<span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>)
            __pyx_t_4 = (__pyx_v_Forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">548</span>:                             <span class="n">sca0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(548,0,<span class='error_goto'>__PYX_ERR(0, 548, __pyx_L1_error)</span>)
              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_S1X) * (__pyx_v_Ds[0])) + ((__pyx_v_sol1 - __pyx_v_S1Y) * (__pyx_v_Ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:                             <span class="n">sca1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">S1X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">S1Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(549,0,<span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>)
              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_S1X) * __pyx_v_S1X) + ((__pyx_v_sol1 - __pyx_v_S1Y) * __pyx_v_S1Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">550</span>:                             <span class="n">sca2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S2X</span><span class="p">)</span><span class="o">*</span><span class="n">S2X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S2Y</span><span class="p">)</span><span class="o">*</span><span class="n">S2Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(550,0,<span class='error_goto'>__PYX_ERR(0, 550, __pyx_L1_error)</span>)
              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_S2X) * __pyx_v_S2X) + ((__pyx_v_sol1 - __pyx_v_S2Y) * __pyx_v_S2Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">551</span>:                             <span class="k">if</span> <span class="n">sca0</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca1</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca2</span><span class="o">&lt;</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(551,0,<span class='error_goto'>__PYX_ERR(0, 551, __pyx_L1_error)</span>)
              __pyx_t_17 = ((__pyx_v_sca0 &lt; 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L68_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_sca1 &lt; 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L68_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_sca2 &lt; 0.0) != 0);
              __pyx_t_4 = __pyx_t_17;
              __pyx_L68_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">552</span>:                                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(552,0,<span class='error_goto'>__PYX_ERR(0, 552, __pyx_L1_error)</span>)
                goto __pyx_L57_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">553</span>:                         <span class="c"># Get the normalized perpendicular vector at intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>:                         <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span><span class="n">sol0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(554,0,<span class='error_goto'>__PYX_ERR(0, 554, __pyx_L1_error)</span>)
            __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>:                         <span class="k">if</span> <span class="n">lim_is_none</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lim_is_none</span> <span class="ow">and</span> <span class="p">((</span><span class="n">L0</span><span class="o">&lt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="n">L0</span><span class="o">&lt;=</span><span class="n">phi</span> <span class="ow">and</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">L0</span><span class="o">&gt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phi</span><span class="o">&gt;=</span><span class="n">L0</span> <span class="ow">or</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)))):</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(555,0,<span class='error_goto'>__PYX_ERR(0, 555, __pyx_L1_error)</span>)
            __pyx_t_17 = (__pyx_v_lim_is_none != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_t_17 = ((!(__pyx_v_lim_is_none != 0)) != 0);
            if (__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_L0 &lt; __pyx_v_L1) != 0);
            if (!__pyx_t_17) {
              goto __pyx_L75_next_or;
            } else {
            }
            __pyx_t_17 = ((__pyx_v_L0 &lt;= __pyx_v_phi) != 0);
            if (!__pyx_t_17) {
              goto __pyx_L75_next_or;
            } else {
            }
            __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_L75_next_or:;
            __pyx_t_17 = ((__pyx_v_L0 &gt; __pyx_v_L1) != 0);
            if (__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_phi &gt;= __pyx_v_L0) != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L72_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
            __pyx_t_4 = __pyx_t_17;
            __pyx_L72_bool_binop_done:;
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">556</span>:                             <span class="c"># Get the scalar product to determine entry or exit point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">557</span>:                             <span class="n">sca</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(557,0,<span class='error_goto'>__PYX_ERR(0, 557, __pyx_L1_error)</span>)
              __pyx_t_68 = 0;
              __pyx_t_69 = __pyx_v_jj;
              __pyx_t_70 = 0;
              __pyx_t_71 = __pyx_v_jj;
              __pyx_t_72 = 1;
              __pyx_t_73 = __pyx_v_jj;
              __pyx_v_sca = ((((cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_68 * __pyx_v_vIn.strides[0]) )) + __pyx_t_69)) )))) * (__pyx_v_us[0])) + ((sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_70 * __pyx_v_vIn.strides[0]) )) + __pyx_t_71)) )))) * (__pyx_v_us[1]))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_72 * __pyx_v_vIn.strides[0]) )) + __pyx_t_73)) ))) * (__pyx_v_us[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>:                             <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(558,0,<span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>)
              __pyx_t_17 = ((__pyx_v_sca &lt;= 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L81_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
              __pyx_t_4 = __pyx_t_17;
              __pyx_L81_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
                goto __pyx_L80;
              }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>:                                 <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(559,0,<span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>)
                __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">560</span>:                                 <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(560,0,<span class='error_goto'>__PYX_ERR(0, 560, __pyx_L1_error)</span>)
                __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>:                                 <span class="n">indout</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(561,0,<span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>)
                __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">562</span>:                             <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(562,0,<span class='error_goto'>__PYX_ERR(0, 562, __pyx_L1_error)</span>)
              __pyx_t_17 = ((__pyx_v_sca &gt;= 0.0) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L83_bool_binop_done;
              }
              __pyx_t_2 = __pyx_v_kout;
              __pyx_t_1 = __pyx_v_kin;
              if (((__pyx_t_2 &lt; __pyx_t_1) != 0)) {
                __pyx_t_39 = __pyx_t_2;
              } else {
                __pyx_t_39 = __pyx_t_1;
              }
              __pyx_t_17 = ((__pyx_v_k &lt; __pyx_t_39) != 0);
              __pyx_t_4 = __pyx_t_17;
              __pyx_L83_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
              __pyx_L80:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">563</span>:                                 <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(563,0,<span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>)
                __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">564</span>:                                 <span class="n">indin</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(564,0,<span class='error_goto'>__PYX_ERR(0, 564, __pyx_L1_error)</span>)
                __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">565</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">566</span>:             <span class="k">elif</span> <span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">&gt;=</span><span class="n">EpsA</span><span class="o">*</span><span class="n">EpsA</span> <span class="ow">and</span> <span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">&gt;</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(566,0,<span class='error_goto'>__PYX_ERR(0, 566, __pyx_L1_error)</span>)
      __pyx_t_17 = (((__pyx_v_A * __pyx_v_A) &gt;= (__pyx_v_EpsA * __pyx_v_EpsA)) != 0);
      if (__pyx_t_17) {
      } else {
        __pyx_t_4 = __pyx_t_17;
        goto __pyx_L85_bool_binop_done;
      }
      __pyx_t_17 = (((__pyx_v_B * __pyx_v_B) &gt; (__pyx_v_A * __pyx_v_C)) != 0);
      __pyx_t_4 = __pyx_t_17;
      __pyx_L85_bool_binop_done:;
      if (__pyx_t_4) {
/* … */
      }
      __pyx_L59:;
      __pyx_L57_continue:;
    }
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">567</span>:                 <span class="n">sqd</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="o">*</span><span class="n">C</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(567,0,<span class='error_goto'>__PYX_ERR(0, 567, __pyx_L1_error)</span>)
        __pyx_v_sqd = sqrt(((__pyx_v_B * __pyx_v_B) - (__pyx_v_A * __pyx_v_C)));
</pre><pre class="cython line score-0">&#xA0;<span class="">568</span>:                 <span class="c"># First solution</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">569</span>:                 <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">sqd</span><span class="p">)</span><span class="o">/</span><span class="n">A</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(569,0,<span class='error_goto'>__PYX_ERR(0, 569, __pyx_L1_error)</span>)
        __pyx_v_q = (((-__pyx_v_B) + __pyx_v_sqd) / __pyx_v_A);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">570</span>:                 <span class="k">if</span> <span class="n">q</span><span class="o">&gt;=</span><span class="mf">0.</span> <span class="ow">and</span> <span class="n">q</span><span class="o">&lt;</span><span class="mf">1.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(570,0,<span class='error_goto'>__PYX_ERR(0, 570, __pyx_L1_error)</span>)
        __pyx_t_17 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_17) {
        } else {
          __pyx_t_4 = __pyx_t_17;
          goto __pyx_L88_bool_binop_done;
        }
        __pyx_t_17 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_17;
        __pyx_L88_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>:                     <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">v1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]))</span><span class="o">*</span><span class="n">invuz</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(571,0,<span class='error_goto'>__PYX_ERR(0, 571, __pyx_L1_error)</span>)
          __pyx_t_74 = 1;
          __pyx_t_75 = __pyx_v_jj;
          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_74 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_75)) ))))) * __pyx_v_invuz);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">572</span>:                     <span class="k">if</span> <span class="n">k</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(572,0,<span class='error_goto'>__PYX_ERR(0, 572, __pyx_L1_error)</span>)
          __pyx_t_4 = ((__pyx_v_k &gt;= 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>:                         <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(573,0,<span class='error_goto'>__PYX_ERR(0, 573, __pyx_L1_error)</span>)
            __pyx_t_39 = ((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0])));
            __pyx_t_2 = ((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1])));
            __pyx_v_sol0 = __pyx_t_39;
            __pyx_v_sol1 = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>:                         <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(574,0,<span class='error_goto'>__PYX_ERR(0, 574, __pyx_L1_error)</span>)
            __pyx_t_4 = (__pyx_v_Forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>:                             <span class="n">sca0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(575,0,<span class='error_goto'>__PYX_ERR(0, 575, __pyx_L1_error)</span>)
              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_S1X) * (__pyx_v_Ds[0])) + ((__pyx_v_sol1 - __pyx_v_S1Y) * (__pyx_v_Ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>:                             <span class="n">sca1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">S1X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">S1Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(576,0,<span class='error_goto'>__PYX_ERR(0, 576, __pyx_L1_error)</span>)
              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_S1X) * __pyx_v_S1X) + ((__pyx_v_sol1 - __pyx_v_S1Y) * __pyx_v_S1Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>:                             <span class="n">sca2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S2X</span><span class="p">)</span><span class="o">*</span><span class="n">S2X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S2Y</span><span class="p">)</span><span class="o">*</span><span class="n">S2Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(577,0,<span class='error_goto'>__PYX_ERR(0, 577, __pyx_L1_error)</span>)
              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_S2X) * __pyx_v_S2X) + ((__pyx_v_sol1 - __pyx_v_S2Y) * __pyx_v_S2Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">578</span>:                         <span class="k">if</span> <span class="ow">not</span> <span class="n">Forbidbis</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Forbidbis</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">sca0</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca1</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca2</span><span class="o">&lt;</span><span class="mf">0</span><span class="p">)):</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(578,0,<span class='error_goto'>__PYX_ERR(0, 578, __pyx_L1_error)</span>)
            __pyx_t_17 = ((!(__pyx_v_Forbidbis != 0)) != 0);
            if (!__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L93_bool_binop_done;
            }
            __pyx_t_17 = (__pyx_v_Forbidbis != 0);
            if (__pyx_t_17) {
            } else {
              __pyx_t_4 = __pyx_t_17;
              goto __pyx_L93_bool_binop_done;
            }
            __pyx_t_32 = ((__pyx_v_sca0 &lt; 0.0) != 0);
            if (__pyx_t_32) {
            } else {
              __pyx_t_17 = __pyx_t_32;
              goto __pyx_L96_bool_binop_done;
            }
            __pyx_t_32 = ((__pyx_v_sca1 &lt; 0.0) != 0);
            if (__pyx_t_32) {
            } else {
              __pyx_t_17 = __pyx_t_32;
              goto __pyx_L96_bool_binop_done;
            }
            __pyx_t_32 = ((__pyx_v_sca2 &lt; 0.0) != 0);
            __pyx_t_17 = __pyx_t_32;
            __pyx_L96_bool_binop_done:;
            __pyx_t_32 = ((!__pyx_t_17) != 0);
            __pyx_t_4 = __pyx_t_32;
            __pyx_L93_bool_binop_done:;
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">579</span>:                             <span class="c"># Get the normalized perpendicular vector at intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">580</span>:                             <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span><span class="n">sol0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(580,0,<span class='error_goto'>__PYX_ERR(0, 580, __pyx_L1_error)</span>)
              __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">581</span>:                             <span class="k">if</span> <span class="n">lim_is_none</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lim_is_none</span> <span class="ow">and</span> <span class="p">((</span><span class="n">L0</span><span class="o">&lt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="n">L0</span><span class="o">&lt;=</span><span class="n">phi</span> <span class="ow">and</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">L0</span><span class="o">&gt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phi</span><span class="o">&gt;=</span><span class="n">L0</span> <span class="ow">or</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)))):</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(581,0,<span class='error_goto'>__PYX_ERR(0, 581, __pyx_L1_error)</span>)
              __pyx_t_32 = (__pyx_v_lim_is_none != 0);
              if (!__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_t_32 = ((!(__pyx_v_lim_is_none != 0)) != 0);
              if (__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_t_32 = ((__pyx_v_L0 &lt; __pyx_v_L1) != 0);
              if (!__pyx_t_32) {
                goto __pyx_L103_next_or;
              } else {
              }
              __pyx_t_32 = ((__pyx_v_L0 &lt;= __pyx_v_phi) != 0);
              if (!__pyx_t_32) {
                goto __pyx_L103_next_or;
              } else {
              }
              __pyx_t_32 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
              if (!__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_L103_next_or:;
              __pyx_t_32 = ((__pyx_v_L0 &gt; __pyx_v_L1) != 0);
              if (__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_t_32 = ((__pyx_v_phi &gt;= __pyx_v_L0) != 0);
              if (!__pyx_t_32) {
              } else {
                __pyx_t_4 = __pyx_t_32;
                goto __pyx_L100_bool_binop_done;
              }
              __pyx_t_32 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
              __pyx_t_4 = __pyx_t_32;
              __pyx_L100_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0">&#xA0;<span class="">582</span>:                                 <span class="c"># Get the scalar product to determine entry or exit point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">583</span>:                                 <span class="n">sca</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(583,0,<span class='error_goto'>__PYX_ERR(0, 583, __pyx_L1_error)</span>)
                __pyx_t_76 = 0;
                __pyx_t_77 = __pyx_v_jj;
                __pyx_t_78 = 0;
                __pyx_t_79 = __pyx_v_jj;
                __pyx_t_80 = 1;
                __pyx_t_81 = __pyx_v_jj;
                __pyx_v_sca = ((((cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_76 * __pyx_v_vIn.strides[0]) )) + __pyx_t_77)) )))) * (__pyx_v_us[0])) + ((sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_78 * __pyx_v_vIn.strides[0]) )) + __pyx_t_79)) )))) * (__pyx_v_us[1]))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_80 * __pyx_v_vIn.strides[0]) )) + __pyx_t_81)) ))) * (__pyx_v_us[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">584</span>:                                 <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(584,0,<span class='error_goto'>__PYX_ERR(0, 584, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_sca &lt;= 0.0) != 0);
                if (__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L109_bool_binop_done;
                }
                __pyx_t_32 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                __pyx_t_4 = __pyx_t_32;
                __pyx_L109_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                  goto __pyx_L108;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">585</span>:                                     <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(585,0,<span class='error_goto'>__PYX_ERR(0, 585, __pyx_L1_error)</span>)
                  __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>:                                     <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(586,0,<span class='error_goto'>__PYX_ERR(0, 586, __pyx_L1_error)</span>)
                  __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">587</span>:                                     <span class="n">indout</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(587,0,<span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>)
                  __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">588</span>:                                 <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(588,0,<span class='error_goto'>__PYX_ERR(0, 588, __pyx_L1_error)</span>)
                __pyx_t_32 = ((__pyx_v_sca &gt;= 0.0) != 0);
                if (__pyx_t_32) {
                } else {
                  __pyx_t_4 = __pyx_t_32;
                  goto __pyx_L111_bool_binop_done;
                }
                __pyx_t_2 = __pyx_v_kout;
                __pyx_t_39 = __pyx_v_kin;
                if (((__pyx_t_2 &lt; __pyx_t_39) != 0)) {
                  __pyx_t_1 = __pyx_t_2;
                } else {
                  __pyx_t_1 = __pyx_t_39;
                }
                __pyx_t_32 = ((__pyx_v_k &lt; __pyx_t_1) != 0);
                __pyx_t_4 = __pyx_t_32;
                __pyx_L111_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                }
                __pyx_L108:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">589</span>:                                     <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(589,0,<span class='error_goto'>__PYX_ERR(0, 589, __pyx_L1_error)</span>)
                  __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>:                                     <span class="n">indin</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(590,0,<span class='error_goto'>__PYX_ERR(0, 590, __pyx_L1_error)</span>)
                  __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">591</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">592</span>:                 <span class="c"># Second solution</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">593</span>:                 <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">-</span> <span class="n">sqd</span><span class="p">)</span><span class="o">/</span><span class="n">A</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(593,0,<span class='error_goto'>__PYX_ERR(0, 593, __pyx_L1_error)</span>)
        __pyx_v_q = (((-__pyx_v_B) - __pyx_v_sqd) / __pyx_v_A);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">594</span>:                 <span class="k">if</span> <span class="n">q</span><span class="o">&gt;=</span><span class="mf">0.</span> <span class="ow">and</span> <span class="n">q</span><span class="o">&lt;</span><span class="mf">1.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(594,0,<span class='error_goto'>__PYX_ERR(0, 594, __pyx_L1_error)</span>)
        __pyx_t_32 = ((__pyx_v_q &gt;= 0.) != 0);
        if (__pyx_t_32) {
        } else {
          __pyx_t_4 = __pyx_t_32;
          goto __pyx_L114_bool_binop_done;
        }
        __pyx_t_32 = ((__pyx_v_q &lt; 1.) != 0);
        __pyx_t_4 = __pyx_t_32;
        __pyx_L114_bool_binop_done:;
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">595</span>:                     <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">v1</span> <span class="o">-</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">-</span><span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]))</span><span class="o">*</span><span class="n">invuz</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(595,0,<span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>)
          __pyx_t_82 = 1;
          __pyx_t_83 = __pyx_v_jj;
          __pyx_v_k = (((__pyx_v_q * __pyx_v_v1) - ((__pyx_v_Ds[2]) - (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_VPoly.data + __pyx_t_82 * __pyx_v_VPoly.strides[0]) )) + __pyx_t_83)) ))))) * __pyx_v_invuz);
</pre><pre class="cython line score-0">&#xA0;<span class="">596</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">597</span>:                     <span class="k">if</span> <span class="n">k</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(597,0,<span class='error_goto'>__PYX_ERR(0, 597, __pyx_L1_error)</span>)
          __pyx_t_4 = ((__pyx_v_k &gt;= 0.) != 0);
          if (__pyx_t_4) {
/* … */
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">598</span>:                         <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(598,0,<span class='error_goto'>__PYX_ERR(0, 598, __pyx_L1_error)</span>)
            __pyx_t_1 = ((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0])));
            __pyx_t_2 = ((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1])));
            __pyx_v_sol0 = __pyx_t_1;
            __pyx_v_sol1 = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">599</span>:                         <span class="k">if</span> <span class="n">Forbidbis</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(599,0,<span class='error_goto'>__PYX_ERR(0, 599, __pyx_L1_error)</span>)
            __pyx_t_4 = (__pyx_v_Forbidbis != 0);
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">600</span>:                             <span class="n">sca0</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(600,0,<span class='error_goto'>__PYX_ERR(0, 600, __pyx_L1_error)</span>)
              __pyx_v_sca0 = (((__pyx_v_sol0 - __pyx_v_S1X) * (__pyx_v_Ds[0])) + ((__pyx_v_sol1 - __pyx_v_S1Y) * (__pyx_v_Ds[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>:                             <span class="n">sca1</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S1X</span><span class="p">)</span><span class="o">*</span><span class="n">S1X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S1Y</span><span class="p">)</span><span class="o">*</span><span class="n">S1Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(601,0,<span class='error_goto'>__PYX_ERR(0, 601, __pyx_L1_error)</span>)
              __pyx_v_sca1 = (((__pyx_v_sol0 - __pyx_v_S1X) * __pyx_v_S1X) + ((__pyx_v_sol1 - __pyx_v_S1Y) * __pyx_v_S1Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">602</span>:                             <span class="n">sca2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sol0</span><span class="o">-</span><span class="n">S2X</span><span class="p">)</span><span class="o">*</span><span class="n">S2X</span> <span class="o">+</span> <span class="p">(</span><span class="n">sol1</span><span class="o">-</span><span class="n">S2Y</span><span class="p">)</span><span class="o">*</span><span class="n">S2Y</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(602,0,<span class='error_goto'>__PYX_ERR(0, 602, __pyx_L1_error)</span>)
              __pyx_v_sca2 = (((__pyx_v_sol0 - __pyx_v_S2X) * __pyx_v_S2X) + ((__pyx_v_sol1 - __pyx_v_S2Y) * __pyx_v_S2Y));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>:                         <span class="k">if</span> <span class="ow">not</span> <span class="n">Forbidbis</span> <span class="ow">or</span> <span class="p">(</span><span class="n">Forbidbis</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">sca0</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca1</span><span class="o">&lt;</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">sca2</span><span class="o">&lt;</span><span class="mf">0</span><span class="p">)):</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(603,0,<span class='error_goto'>__PYX_ERR(0, 603, __pyx_L1_error)</span>)
            __pyx_t_32 = ((!(__pyx_v_Forbidbis != 0)) != 0);
            if (!__pyx_t_32) {
            } else {
              __pyx_t_4 = __pyx_t_32;
              goto __pyx_L119_bool_binop_done;
            }
            __pyx_t_32 = (__pyx_v_Forbidbis != 0);
            if (__pyx_t_32) {
            } else {
              __pyx_t_4 = __pyx_t_32;
              goto __pyx_L119_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_sca0 &lt; 0.0) != 0);
            if (__pyx_t_17) {
            } else {
              __pyx_t_32 = __pyx_t_17;
              goto __pyx_L122_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_sca1 &lt; 0.0) != 0);
            if (__pyx_t_17) {
            } else {
              __pyx_t_32 = __pyx_t_17;
              goto __pyx_L122_bool_binop_done;
            }
            __pyx_t_17 = ((__pyx_v_sca2 &lt; 0.0) != 0);
            __pyx_t_32 = __pyx_t_17;
            __pyx_L122_bool_binop_done:;
            __pyx_t_17 = ((!__pyx_t_32) != 0);
            __pyx_t_4 = __pyx_t_17;
            __pyx_L119_bool_binop_done:;
            if (__pyx_t_4) {
/* … */
            }
</pre><pre class="cython line score-0">&#xA0;<span class="">604</span>:                             <span class="c"># Get the normalized perpendicular vector at intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>:                             <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">sol1</span><span class="p">,</span><span class="n">sol0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(605,0,<span class='error_goto'>__PYX_ERR(0, 605, __pyx_L1_error)</span>)
              __pyx_v_phi = atan2(__pyx_v_sol1, __pyx_v_sol0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">606</span>:                             <span class="k">if</span> <span class="n">lim_is_none</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">lim_is_none</span> <span class="ow">and</span> <span class="p">((</span><span class="n">L0</span><span class="o">&lt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="n">L0</span><span class="o">&lt;=</span><span class="n">phi</span> <span class="ow">and</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">L0</span><span class="o">&gt;</span><span class="n">L1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">phi</span><span class="o">&gt;=</span><span class="n">L0</span> <span class="ow">or</span> <span class="n">phi</span><span class="o">&lt;=</span><span class="n">L1</span><span class="p">)))):</span></pre>
<pre class='cython code score-0 '>              <span class='trace'>__Pyx_TraceLine</span>(606,0,<span class='error_goto'>__PYX_ERR(0, 606, __pyx_L1_error)</span>)
              __pyx_t_17 = (__pyx_v_lim_is_none != 0);
              if (!__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_t_17 = ((!(__pyx_v_lim_is_none != 0)) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_L0 &lt; __pyx_v_L1) != 0);
              if (!__pyx_t_17) {
                goto __pyx_L129_next_or;
              } else {
              }
              __pyx_t_17 = ((__pyx_v_L0 &lt;= __pyx_v_phi) != 0);
              if (!__pyx_t_17) {
                goto __pyx_L129_next_or;
              } else {
              }
              __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
              if (!__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_L129_next_or:;
              __pyx_t_17 = ((__pyx_v_L0 &gt; __pyx_v_L1) != 0);
              if (__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_phi &gt;= __pyx_v_L0) != 0);
              if (!__pyx_t_17) {
              } else {
                __pyx_t_4 = __pyx_t_17;
                goto __pyx_L126_bool_binop_done;
              }
              __pyx_t_17 = ((__pyx_v_phi &lt;= __pyx_v_L1) != 0);
              __pyx_t_4 = __pyx_t_17;
              __pyx_L126_bool_binop_done:;
              if (__pyx_t_4) {
/* … */
              }
</pre><pre class="cython line score-0">&#xA0;<span class="">607</span>:                                 <span class="c"># Get the scalar product to determine entry or exit point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">608</span>:                                 <span class="n">sca</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(608,0,<span class='error_goto'>__PYX_ERR(0, 608, __pyx_L1_error)</span>)
                __pyx_t_84 = 0;
                __pyx_t_85 = __pyx_v_jj;
                __pyx_t_86 = 0;
                __pyx_t_87 = __pyx_v_jj;
                __pyx_t_88 = 1;
                __pyx_t_89 = __pyx_v_jj;
                __pyx_v_sca = ((((cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_84 * __pyx_v_vIn.strides[0]) )) + __pyx_t_85)) )))) * (__pyx_v_us[0])) + ((sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_86 * __pyx_v_vIn.strides[0]) )) + __pyx_t_87)) )))) * (__pyx_v_us[1]))) + ((*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_88 * __pyx_v_vIn.strides[0]) )) + __pyx_t_89)) ))) * (__pyx_v_us[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>:                                 <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(609,0,<span class='error_goto'>__PYX_ERR(0, 609, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_sca &lt;= 0.0) != 0);
                if (__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L135_bool_binop_done;
                }
                __pyx_t_17 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
                __pyx_t_4 = __pyx_t_17;
                __pyx_L135_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                  goto __pyx_L134;
                }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">610</span>:                                     <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(610,0,<span class='error_goto'>__PYX_ERR(0, 610, __pyx_L1_error)</span>)
                  __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>:                                     <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(611,0,<span class='error_goto'>__PYX_ERR(0, 611, __pyx_L1_error)</span>)
                  __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">612</span>:                                     <span class="n">indout</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(612,0,<span class='error_goto'>__PYX_ERR(0, 612, __pyx_L1_error)</span>)
                  __pyx_v_indout = __pyx_v_jj;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">613</span>:                                 <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                <span class='trace'>__Pyx_TraceLine</span>(613,0,<span class='error_goto'>__PYX_ERR(0, 613, __pyx_L1_error)</span>)
                __pyx_t_17 = ((__pyx_v_sca &gt;= 0.0) != 0);
                if (__pyx_t_17) {
                } else {
                  __pyx_t_4 = __pyx_t_17;
                  goto __pyx_L137_bool_binop_done;
                }
                __pyx_t_2 = __pyx_v_kout;
                __pyx_t_1 = __pyx_v_kin;
                if (((__pyx_t_2 &lt; __pyx_t_1) != 0)) {
                  __pyx_t_39 = __pyx_t_2;
                } else {
                  __pyx_t_39 = __pyx_t_1;
                }
                __pyx_t_17 = ((__pyx_v_k &lt; __pyx_t_39) != 0);
                __pyx_t_4 = __pyx_t_17;
                __pyx_L137_bool_binop_done:;
                if (__pyx_t_4) {
/* … */
                }
                __pyx_L134:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>:                                     <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(614,0,<span class='error_goto'>__PYX_ERR(0, 614, __pyx_L1_error)</span>)
                  __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">615</span>:                                     <span class="n">indin</span> <span class="o">=</span> <span class="n">jj</span></pre>
<pre class='cython code score-0 '>                  <span class='trace'>__Pyx_TraceLine</span>(615,0,<span class='error_goto'>__PYX_ERR(0, 615, __pyx_L1_error)</span>)
                  __pyx_v_indin = __pyx_v_jj;
</pre><pre class="cython line score-0">&#xA0;<span class="">616</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>:     <span class="k">if</span> <span class="ow">not</span> <span class="n">lim_is_none</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(617,0,<span class='error_goto'>__PYX_ERR(0, 617, __pyx_L1_error)</span>)
  __pyx_t_4 = ((!(__pyx_v_lim_is_none != 0)) != 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>:         <span class="n">ephiIn0</span> <span class="o">=</span> <span class="o">-</span><span class="n">sinl0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(618,0,<span class='error_goto'>__PYX_ERR(0, 618, __pyx_L1_error)</span>)
    __pyx_v_ephiIn0 = (-__pyx_v_sinl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">619</span>:         <span class="n">ephiIn1</span> <span class="o">=</span>  <span class="n">cosl0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(619,0,<span class='error_goto'>__PYX_ERR(0, 619, __pyx_L1_error)</span>)
    __pyx_v_ephiIn1 = __pyx_v_cosl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">620</span>:         <span class="k">if</span> <span class="n">Cabs</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">EpsPlane</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(620,0,<span class='error_goto'>__PYX_ERR(0, 620, __pyx_L1_error)</span>)
    __pyx_t_4 = ((fabs((((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1))) &gt; __pyx_v_EpsPlane) != 0);
    if (__pyx_t_4) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">621</span>:             <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(621,0,<span class='error_goto'>__PYX_ERR(0, 621, __pyx_L1_error)</span>)
      __pyx_v_k = ((-(((__pyx_v_Ds[0]) * __pyx_v_ephiIn0) + ((__pyx_v_Ds[1]) * __pyx_v_ephiIn1))) / (((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">622</span>:             <span class="k">if</span> <span class="n">k</span><span class="o">&gt;=</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(622,0,<span class='error_goto'>__PYX_ERR(0, 622, __pyx_L1_error)</span>)
      __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>:                 <span class="c"># Check if in VPoly</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">624</span>:                 <span class="n">sol0</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">cosl0</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sinl0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(624,0,<span class='error_goto'>__PYX_ERR(0, 624, __pyx_L1_error)</span>)
        __pyx_v_sol0 = ((((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0]))) * __pyx_v_cosl0) + (((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1]))) * __pyx_v_sinl0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">625</span>:                 <span class="n">sol1</span> <span class="o">=</span>  <span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(625,0,<span class='error_goto'>__PYX_ERR(0, 625, __pyx_L1_error)</span>)
        __pyx_v_sol1 = ((__pyx_v_Ds[2]) + (__pyx_v_k * (__pyx_v_us[2])));
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">626</span>:                 <span class="n">inter_bbox</span> <span class="o">=</span> <span class="n">is_point_in_path</span><span class="p">(</span><span class="n">vin_shape</span><span class="p">,</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>        <span class='trace'>__Pyx_TraceLine</span>(626,0,<span class='error_goto'>__PYX_ERR(0, 626, __pyx_L1_error)</span>)
        __pyx_t_90.data = __pyx_v_VPoly.data;
        __pyx_t_90.memview = __pyx_v_VPoly.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_90, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_VPoly.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_VPoly.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 626, __pyx_L1_error)</span>
    }
        __pyx_t_90.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_90.shape[0] = __pyx_v_VPoly.shape[1];
__pyx_t_90.strides[0] = __pyx_v_VPoly.strides[1];
    __pyx_t_90.suboffsets[0] = -1;

__pyx_t_91.data = __pyx_v_VPoly.data;
        __pyx_t_91.memview = __pyx_v_VPoly.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_91, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_VPoly.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_VPoly.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 626, __pyx_L1_error)</span>
    }
        __pyx_t_91.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_91.shape[0] = __pyx_v_VPoly.shape[1];
__pyx_t_91.strides[0] = __pyx_v_VPoly.strides[1];
    __pyx_t_91.suboffsets[0] = -1;

__pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(__pyx_v_vin_shape, __pyx_t_90, __pyx_t_91, __pyx_v_sol0, __pyx_v_sol1);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_90, 1);
        __pyx_t_90.memview = NULL;
        __pyx_t_90.data = NULL;
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_91, 1);
        __pyx_t_91.memview = NULL;
        __pyx_t_91.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>:                 <span class="k">if</span> <span class="n">inter_bbox</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(627,0,<span class='error_goto'>__PYX_ERR(0, 627, __pyx_L1_error)</span>)
        __pyx_t_4 = (__pyx_v_inter_bbox != 0);
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">628</span>:                     <span class="c"># Check PIn (POut not possible for limited torus)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">629</span>:                     <span class="n">sca</span> <span class="o">=</span> <span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span> <span class="o">+</span> <span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(629,0,<span class='error_goto'>__PYX_ERR(0, 629, __pyx_L1_error)</span>)
          __pyx_v_sca = (((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">630</span>:                     <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(630,0,<span class='error_goto'>__PYX_ERR(0, 630, __pyx_L1_error)</span>)
          __pyx_t_17 = ((__pyx_v_sca &lt;= 0.0) != 0);
          if (__pyx_t_17) {
          } else {
            __pyx_t_4 = __pyx_t_17;
            goto __pyx_L144_bool_binop_done;
          }
          __pyx_t_17 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
          __pyx_t_4 = __pyx_t_17;
          __pyx_L144_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
            goto __pyx_L143;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>:                         <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(631,0,<span class='error_goto'>__PYX_ERR(0, 631, __pyx_L1_error)</span>)
            __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>:                         <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(632,0,<span class='error_goto'>__PYX_ERR(0, 632, __pyx_L1_error)</span>)
            __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>:                         <span class="n">indout</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(633,0,<span class='error_goto'>__PYX_ERR(0, 633, __pyx_L1_error)</span>)
            __pyx_v_indout = -1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>:                     <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(634,0,<span class='error_goto'>__PYX_ERR(0, 634, __pyx_L1_error)</span>)
          __pyx_t_17 = ((__pyx_v_sca &gt;= 0.0) != 0);
          if (__pyx_t_17) {
          } else {
            __pyx_t_4 = __pyx_t_17;
            goto __pyx_L146_bool_binop_done;
          }
          __pyx_t_39 = __pyx_v_kout;
          __pyx_t_2 = __pyx_v_kin;
          if (((__pyx_t_39 &lt; __pyx_t_2) != 0)) {
            __pyx_t_1 = __pyx_t_39;
          } else {
            __pyx_t_1 = __pyx_t_2;
          }
          __pyx_t_17 = ((__pyx_v_k &lt; __pyx_t_1) != 0);
          __pyx_t_4 = __pyx_t_17;
          __pyx_L146_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
          }
          __pyx_L143:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">635</span>:                         <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(635,0,<span class='error_goto'>__PYX_ERR(0, 635, __pyx_L1_error)</span>)
            __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">636</span>:                         <span class="n">indin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(636,0,<span class='error_goto'>__PYX_ERR(0, 636, __pyx_L1_error)</span>)
            __pyx_v_indin = -1;
</pre><pre class="cython line score-0">&#xA0;<span class="">637</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">638</span>:         <span class="n">ephiIn0</span> <span class="o">=</span>  <span class="n">sinl1</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(638,0,<span class='error_goto'>__PYX_ERR(0, 638, __pyx_L1_error)</span>)
    __pyx_v_ephiIn0 = __pyx_v_sinl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>:         <span class="n">ephiIn1</span> <span class="o">=</span> <span class="o">-</span><span class="n">cosl1</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(639,0,<span class='error_goto'>__PYX_ERR(0, 639, __pyx_L1_error)</span>)
    __pyx_v_ephiIn1 = (-__pyx_v_cosl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>:         <span class="k">if</span> <span class="n">Cabs</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span><span class="o">&gt;</span><span class="n">EpsPlane</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(640,0,<span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>)
    __pyx_t_4 = ((fabs((((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1))) &gt; __pyx_v_EpsPlane) != 0);
    if (__pyx_t_4) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">641</span>:             <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span><span class="o">+</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(641,0,<span class='error_goto'>__PYX_ERR(0, 641, __pyx_L1_error)</span>)
      __pyx_v_k = ((-(((__pyx_v_Ds[0]) * __pyx_v_ephiIn0) + ((__pyx_v_Ds[1]) * __pyx_v_ephiIn1))) / (((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>:             <span class="k">if</span> <span class="n">k</span><span class="o">&gt;=</span><span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(642,0,<span class='error_goto'>__PYX_ERR(0, 642, __pyx_L1_error)</span>)
      __pyx_t_4 = ((__pyx_v_k &gt;= 0.0) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">643</span>:                 <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="o">*</span><span class="n">cosl1</span> <span class="o">+</span> <span class="p">(</span><span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="o">*</span><span class="n">sinl1</span><span class="p">,</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(643,0,<span class='error_goto'>__PYX_ERR(0, 643, __pyx_L1_error)</span>)
        __pyx_t_1 = ((((__pyx_v_Ds[0]) + (__pyx_v_k * (__pyx_v_us[0]))) * __pyx_v_cosl1) + (((__pyx_v_Ds[1]) + (__pyx_v_k * (__pyx_v_us[1]))) * __pyx_v_sinl1));
        __pyx_t_39 = ((__pyx_v_Ds[2]) + (__pyx_v_k * (__pyx_v_us[2])));
        __pyx_v_sol0 = __pyx_t_1;
        __pyx_v_sol1 = __pyx_t_39;
</pre><pre class="cython line score-0">&#xA0;<span class="">644</span>:                 <span class="c"># Check if in VPoly</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">645</span>:                 <span class="c">#if path_poly_t.contains_point([sol0,sol1], transform=None, radius=0.0):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">646</span>:                 <span class="c"># if ray_tracing(VPoly, sol0, sol1):</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">647</span>:                 <span class="n">inter_bbox</span> <span class="o">=</span> <span class="n">is_point_in_path</span><span class="p">(</span><span class="n">vin_shape</span><span class="p">,</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">VPoly</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">sol0</span><span class="p">,</span> <span class="n">sol1</span><span class="p">)</span></pre>
<pre class='cython code score-10 '>        <span class='trace'>__Pyx_TraceLine</span>(647,0,<span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>)
        __pyx_t_91.data = __pyx_v_VPoly.data;
        __pyx_t_91.memview = __pyx_v_VPoly.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_91, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_VPoly.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_VPoly.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>
    }
        __pyx_t_91.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_91.shape[0] = __pyx_v_VPoly.shape[1];
__pyx_t_91.strides[0] = __pyx_v_VPoly.strides[1];
    __pyx_t_91.suboffsets[0] = -1;

__pyx_t_90.data = __pyx_v_VPoly.data;
        __pyx_t_90.memview = __pyx_v_VPoly.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_90, 0);
        {
    Py_ssize_t __pyx_tmp_idx = 1;
    Py_ssize_t __pyx_tmp_shape = __pyx_v_VPoly.shape[0];
    Py_ssize_t __pyx_tmp_stride = __pyx_v_VPoly.strides[0];
    if (0 &amp;&amp; (__pyx_tmp_idx &lt; 0))
        __pyx_tmp_idx += __pyx_tmp_shape;
    if (0 &amp;&amp; !__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_IndexError, "Index out of bounds (axis 0)");
        <span class='error_goto'>__PYX_ERR(0, 647, __pyx_L1_error)</span>
    }
        __pyx_t_90.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_90.shape[0] = __pyx_v_VPoly.shape[1];
__pyx_t_90.strides[0] = __pyx_v_VPoly.strides[1];
    __pyx_t_90.suboffsets[0] = -1;

__pyx_v_inter_bbox = __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(__pyx_v_vin_shape, __pyx_t_91, __pyx_t_90, __pyx_v_sol0, __pyx_v_sol1);
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_91, 1);
        __pyx_t_91.memview = NULL;
        __pyx_t_91.data = NULL;
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_90, 1);
        __pyx_t_90.memview = NULL;
        __pyx_t_90.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">648</span>:                 <span class="k">if</span> <span class="n">inter_bbox</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(648,0,<span class='error_goto'>__PYX_ERR(0, 648, __pyx_L1_error)</span>)
        __pyx_t_4 = (__pyx_v_inter_bbox != 0);
        if (__pyx_t_4) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">649</span>:                     <span class="c"># Check PIn (POut not possible for limited torus)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">650</span>:                     <span class="n">sca</span> <span class="o">=</span> <span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn0</span> <span class="o">+</span> <span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ephiIn1</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(650,0,<span class='error_goto'>__PYX_ERR(0, 650, __pyx_L1_error)</span>)
          __pyx_v_sca = (((__pyx_v_us[0]) * __pyx_v_ephiIn0) + ((__pyx_v_us[1]) * __pyx_v_ephiIn1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">651</span>:                     <span class="k">if</span> <span class="n">sca</span><span class="o">&lt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(651,0,<span class='error_goto'>__PYX_ERR(0, 651, __pyx_L1_error)</span>)
          __pyx_t_17 = ((__pyx_v_sca &lt;= 0.0) != 0);
          if (__pyx_t_17) {
          } else {
            __pyx_t_4 = __pyx_t_17;
            goto __pyx_L152_bool_binop_done;
          }
          __pyx_t_17 = ((__pyx_v_k &lt; __pyx_v_kout) != 0);
          __pyx_t_4 = __pyx_t_17;
          __pyx_L152_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
            goto __pyx_L151;
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">652</span>:                         <span class="n">kout</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(652,0,<span class='error_goto'>__PYX_ERR(0, 652, __pyx_L1_error)</span>)
            __pyx_v_kout = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">653</span>:                         <span class="n">Done</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(653,0,<span class='error_goto'>__PYX_ERR(0, 653, __pyx_L1_error)</span>)
            __pyx_v_Done = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">654</span>:                         <span class="n">indout</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(654,0,<span class='error_goto'>__PYX_ERR(0, 654, __pyx_L1_error)</span>)
            __pyx_v_indout = -2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">655</span>:                     <span class="k">elif</span> <span class="n">sca</span><span class="o">&gt;=</span><span class="mf">0</span> <span class="ow">and</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">min</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span><span class="n">kout</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          <span class='trace'>__Pyx_TraceLine</span>(655,0,<span class='error_goto'>__PYX_ERR(0, 655, __pyx_L1_error)</span>)
          __pyx_t_17 = ((__pyx_v_sca &gt;= 0.0) != 0);
          if (__pyx_t_17) {
          } else {
            __pyx_t_4 = __pyx_t_17;
            goto __pyx_L154_bool_binop_done;
          }
          __pyx_t_39 = __pyx_v_kout;
          __pyx_t_1 = __pyx_v_kin;
          if (((__pyx_t_39 &lt; __pyx_t_1) != 0)) {
            __pyx_t_2 = __pyx_t_39;
          } else {
            __pyx_t_2 = __pyx_t_1;
          }
          __pyx_t_17 = ((__pyx_v_k &lt; __pyx_t_2) != 0);
          __pyx_t_4 = __pyx_t_17;
          __pyx_L154_bool_binop_done:;
          if (__pyx_t_4) {
/* … */
          }
          __pyx_L151:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">656</span>:                         <span class="n">kin</span> <span class="o">=</span> <span class="n">k</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(656,0,<span class='error_goto'>__PYX_ERR(0, 656, __pyx_L1_error)</span>)
            __pyx_v_kin = __pyx_v_k;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">657</span>:                         <span class="n">indin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>            <span class='trace'>__Pyx_TraceLine</span>(657,0,<span class='error_goto'>__PYX_ERR(0, 657, __pyx_L1_error)</span>)
            __pyx_v_indin = -2;
</pre><pre class="cython line score-0">&#xA0;<span class="">658</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">659</span>:     <span class="k">if</span> <span class="n">Done</span><span class="o">==</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(659,0,<span class='error_goto'>__PYX_ERR(0, 659, __pyx_L1_error)</span>)
  __pyx_t_4 = ((__pyx_v_Done == 1) != 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">660</span>:         <span class="k">if</span> <span class="n">struct_is_ves</span> <span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(660,0,<span class='error_goto'>__PYX_ERR(0, 660, __pyx_L1_error)</span>)
    __pyx_t_4 = (__pyx_v_struct_is_ves != 0);
    if (__pyx_t_4) {
/* … */
      goto __pyx_L157;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">661</span>:             <span class="n">kpout_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kout</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(661,0,<span class='error_goto'>__PYX_ERR(0, 661, __pyx_L1_error)</span>)
      (__pyx_v_kpout_loc[0]) = __pyx_v_kout;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">662</span>:             <span class="k">if</span> <span class="n">indout</span><span class="o">==-</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(662,0,<span class='error_goto'>__PYX_ERR(0, 662, __pyx_L1_error)</span>)
      switch (__pyx_v_indout) {
        case -1L:
/* … */
        break;
        case -2L:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">663</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sinl0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(663,0,<span class='error_goto'>__PYX_ERR(0, 663, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[0]) = (-__pyx_v_sinl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">664</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cosl0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(664,0,<span class='error_goto'>__PYX_ERR(0, 664, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[1]) = __pyx_v_cosl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">665</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(665,0,<span class='error_goto'>__PYX_ERR(0, 665, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">666</span>:             <span class="k">elif</span> <span class="n">indout</span><span class="o">==-</span><span class="mf">2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        break;
        default:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">667</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinl1</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(667,0,<span class='error_goto'>__PYX_ERR(0, 667, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[0]) = __pyx_v_sinl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">668</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cosl1</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(668,0,<span class='error_goto'>__PYX_ERR(0, 668, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[1]) = (-__pyx_v_cosl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">669</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(669,0,<span class='error_goto'>__PYX_ERR(0, 669, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">670</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">671</span>:                 <span class="n">SOut0</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kout</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(671,0,<span class='error_goto'>__PYX_ERR(0, 671, __pyx_L1_error)</span>)
        __pyx_v_SOut0 = ((__pyx_v_Ds[0]) + (__pyx_v_kout * (__pyx_v_us[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">672</span>:                 <span class="n">SOut1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kout</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(672,0,<span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>)
        __pyx_v_SOut1 = ((__pyx_v_Ds[1]) + (__pyx_v_kout * (__pyx_v_us[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">673</span>:                 <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">SOut1</span><span class="p">,</span><span class="n">SOut0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(673,0,<span class='error_goto'>__PYX_ERR(0, 673, __pyx_L1_error)</span>)
        __pyx_v_phi = atan2(__pyx_v_SOut1, __pyx_v_SOut0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">674</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">indout</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(674,0,<span class='error_goto'>__PYX_ERR(0, 674, __pyx_L1_error)</span>)
        __pyx_t_92 = 0;
        __pyx_t_93 = __pyx_v_indout;
        (__pyx_v_vperpin[0]) = (cos(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_92 * __pyx_v_vIn.strides[0]) )) + __pyx_t_93)) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">675</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">indout</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(675,0,<span class='error_goto'>__PYX_ERR(0, 675, __pyx_L1_error)</span>)
        __pyx_t_94 = 0;
        __pyx_t_95 = __pyx_v_indout;
        (__pyx_v_vperpin[1]) = (sin(__pyx_v_phi) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_94 * __pyx_v_vIn.strides[0]) )) + __pyx_t_95)) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">676</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">indout</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(676,0,<span class='error_goto'>__PYX_ERR(0, 676, __pyx_L1_error)</span>)
        __pyx_t_96 = 1;
        __pyx_t_97 = __pyx_v_indout;
        (__pyx_v_vperpin[2]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_96 * __pyx_v_vIn.strides[0]) )) + __pyx_t_97)) )));
        break;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">677</span>:             <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">indout</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(677,0,<span class='error_goto'>__PYX_ERR(0, 677, __pyx_L1_error)</span>)
      (__pyx_v_ind_loc[0]) = __pyx_v_indout;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">678</span>:             <span class="k">if</span> <span class="n">kin</span><span class="o">&lt;</span><span class="n">kout</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(678,0,<span class='error_goto'>__PYX_ERR(0, 678, __pyx_L1_error)</span>)
      __pyx_t_4 = ((__pyx_v_kin &lt; __pyx_v_kout) != 0);
      if (__pyx_t_4) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">679</span>:                 <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kin</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(679,0,<span class='error_goto'>__PYX_ERR(0, 679, __pyx_L1_error)</span>)
        (__pyx_v_kpin_loc[0]) = __pyx_v_kin;
</pre><pre class="cython line score-0">&#xA0;<span class="">680</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">681</span>:         <span class="k">elif</span> <span class="n">kin</span><span class="o">&lt;</span><span class="n">kout</span> <span class="ow">and</span> <span class="n">kin</span> <span class="o">&lt;</span> <span class="n">res_kin</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(681,0,<span class='error_goto'>__PYX_ERR(0, 681, __pyx_L1_error)</span>)
    __pyx_t_17 = ((__pyx_v_kin &lt; __pyx_v_kout) != 0);
    if (__pyx_t_17) {
    } else {
      __pyx_t_4 = __pyx_t_17;
      goto __pyx_L159_bool_binop_done;
    }
    __pyx_t_17 = ((__pyx_v_kin &lt; __pyx_v_res_kin) != 0);
    __pyx_t_4 = __pyx_t_17;
    __pyx_L159_bool_binop_done:;
    if (__pyx_t_4) {
/* … */
    }
    __pyx_L157:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">682</span>:             <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kin</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(682,0,<span class='error_goto'>__PYX_ERR(0, 682, __pyx_L1_error)</span>)
      (__pyx_v_kpin_loc[0]) = __pyx_v_kin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">683</span>:             <span class="k">if</span> <span class="n">indin</span><span class="o">==-</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(683,0,<span class='error_goto'>__PYX_ERR(0, 683, __pyx_L1_error)</span>)
      switch (__pyx_v_indin) {
        case -1L:
/* … */
        break;
        case -2L:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">684</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sinl0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(684,0,<span class='error_goto'>__PYX_ERR(0, 684, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[0]) = __pyx_v_sinl0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">685</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cosl0</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(685,0,<span class='error_goto'>__PYX_ERR(0, 685, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[1]) = (-__pyx_v_cosl0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">686</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(686,0,<span class='error_goto'>__PYX_ERR(0, 686, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">687</span>:             <span class="k">elif</span> <span class="n">indin</span><span class="o">==-</span><span class="mf">2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        break;
        default:
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">688</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sinl1</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(688,0,<span class='error_goto'>__PYX_ERR(0, 688, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[0]) = (-__pyx_v_sinl1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">689</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cosl1</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(689,0,<span class='error_goto'>__PYX_ERR(0, 689, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[1]) = __pyx_v_cosl1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">690</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(690,0,<span class='error_goto'>__PYX_ERR(0, 690, __pyx_L1_error)</span>)
        (__pyx_v_vperpin[2]) = 0.;
</pre><pre class="cython line score-0">&#xA0;<span class="">691</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">692</span>:                 <span class="n">SIn0</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kin</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(692,0,<span class='error_goto'>__PYX_ERR(0, 692, __pyx_L1_error)</span>)
        __pyx_v_SIn0 = ((__pyx_v_Ds[0]) + (__pyx_v_kin * (__pyx_v_us[0])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">693</span>:                 <span class="n">SIn1</span> <span class="o">=</span> <span class="n">Ds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kin</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(693,0,<span class='error_goto'>__PYX_ERR(0, 693, __pyx_L1_error)</span>)
        __pyx_v_SIn1 = ((__pyx_v_Ds[1]) + (__pyx_v_kin * (__pyx_v_us[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">694</span>:                 <span class="n">phi</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">SIn1</span><span class="p">,</span><span class="n">SIn0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(694,0,<span class='error_goto'>__PYX_ERR(0, 694, __pyx_L1_error)</span>)
        __pyx_v_phi = atan2(__pyx_v_SIn1, __pyx_v_SIn0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">695</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">indin</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(695,0,<span class='error_goto'>__PYX_ERR(0, 695, __pyx_L1_error)</span>)
        __pyx_t_98 = 0;
        __pyx_t_99 = __pyx_v_indin;
        (__pyx_v_vperpin[0]) = ((-cos(__pyx_v_phi)) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_98 * __pyx_v_vIn.strides[0]) )) + __pyx_t_99)) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">696</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Csin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">vIn</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">indin</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(696,0,<span class='error_goto'>__PYX_ERR(0, 696, __pyx_L1_error)</span>)
        __pyx_t_100 = 0;
        __pyx_t_101 = __pyx_v_indin;
        (__pyx_v_vperpin[1]) = ((-sin(__pyx_v_phi)) * (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_100 * __pyx_v_vIn.strides[0]) )) + __pyx_t_101)) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">697</span>:                 <span class="n">vperpin</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">vIn</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">indin</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        <span class='trace'>__Pyx_TraceLine</span>(697,0,<span class='error_goto'>__PYX_ERR(0, 697, __pyx_L1_error)</span>)
        __pyx_t_102 = 1;
        __pyx_t_103 = __pyx_v_indin;
        (__pyx_v_vperpin[2]) = (-(*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vIn.data + __pyx_t_102 * __pyx_v_vIn.strides[0]) )) + __pyx_t_103)) ))));
        break;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">698</span>:             <span class="n">ind_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">indin</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(698,0,<span class='error_goto'>__PYX_ERR(0, 698, __pyx_L1_error)</span>)
      (__pyx_v_ind_loc[0]) = __pyx_v_indin;
</pre><pre class="cython line score-0">&#xA0;<span class="">699</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">700</span>:     <span class="k">return</span> <span class="n">res_kin</span> <span class="o">!=</span> <span class="n">kpin_loc</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(700,0,<span class='error_goto'>__PYX_ERR(0, 700, __pyx_L1_error)</span>)
  __pyx_r = (__pyx_v_res_kin != (__pyx_v_kpin_loc[0]));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">701</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">702</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">compute_inv_and_sign</span><span class="p">(</span><span class="n">const</span> <span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">us</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_inv_and_sign(double *__pyx_v_us, int *__pyx_v_sign, double *__pyx_v_inv_direction) {
  int __pyx_v_t0;
  long __pyx_v_ii;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("compute_inv_and_sign", __pyx_f[0], 702, 1, <span class='error_goto'>__PYX_ERR(0, 702, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.compute_inv_and_sign", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">703</span>:                                       <span class="nb">int</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">sign</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">704</span>:                                       <span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">inv_direction</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">705</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">t0</span> <span class="o">=</span> <span class="mf">1000000</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(705,1,<span class='error_goto'>__PYX_ERR(0, 705, __pyx_L1_error)</span>)
  __pyx_v_t0 = 0xF4240;
</pre><pre class="cython line score-0">&#xA0;<span class="">706</span>:     <span class="c"># computing sign and direction</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">707</span>:     <span class="k">for</span>  <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(707,1,<span class='error_goto'>__PYX_ERR(0, 707, __pyx_L1_error)</span>)
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_ii = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">708</span>:         <span class="k">if</span> <span class="n">us</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">*</span><span class="n">us</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">_VERYSMALL</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(708,1,<span class='error_goto'>__PYX_ERR(0, 708, __pyx_L1_error)</span>)
    __pyx_t_2 = ((((__pyx_v_us[__pyx_v_ii]) * (__pyx_v_us[__pyx_v_ii])) &lt; __pyx_v_4tofu_4geom_8_GG03_LM__VERYSMALL) != 0);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">709</span>:             <span class="n">inv_direction</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">t0</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(709,1,<span class='error_goto'>__PYX_ERR(0, 709, __pyx_L1_error)</span>)
      (__pyx_v_inv_direction[__pyx_v_ii]) = __pyx_v_t0;
</pre><pre class="cython line score-0">&#xA0;<span class="">710</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">711</span>:             <span class="n">inv_direction</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">us</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(711,1,<span class='error_goto'>__PYX_ERR(0, 711, __pyx_L1_error)</span>)
    /*else*/ {
      (__pyx_v_inv_direction[__pyx_v_ii]) = (1. / (__pyx_v_us[__pyx_v_ii]));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">712</span>:         <span class="k">if</span> <span class="n">us</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(712,1,<span class='error_goto'>__PYX_ERR(0, 712, __pyx_L1_error)</span>)
    __pyx_t_2 = (((__pyx_v_us[__pyx_v_ii]) &lt; 0.) != 0);
    if (__pyx_t_2) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">713</span>:             <span class="n">sign</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(713,1,<span class='error_goto'>__PYX_ERR(0, 713, __pyx_L1_error)</span>)
      (__pyx_v_sign[__pyx_v_ii]) = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">714</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">715</span>:             <span class="n">sign</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(715,1,<span class='error_goto'>__PYX_ERR(0, 715, __pyx_L1_error)</span>)
    /*else*/ {
      (__pyx_v_sign[__pyx_v_ii]) = 0;
    }
    __pyx_L6:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">716</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">717</span>:     <span class="k">return</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(717,1,<span class='error_goto'>__PYX_ERR(0, 717, __pyx_L1_error)</span>)
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">718</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">719</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">bint</span> <span class="nf">ray_intersects_abba_bbox</span><span class="p">(</span><span class="n">const</span> <span class="nb">int</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">sign</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_ray_intersects_abba_bbox(int *__pyx_v_sign, double *__pyx_v_inv_direction, double *__pyx_v_bounds, double *__pyx_v_ds) {
  double __pyx_v_tmin;
  double __pyx_v_tmax;
  double __pyx_v_tymin;
  double __pyx_v_tymax;
  double __pyx_v_tzmin;
  double __pyx_v_tzmax;
  int __pyx_v_t0;
  int __pyx_v_res;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("ray_intersects_abba_bbox", __pyx_f[0], 719, 1, <span class='error_goto'>__PYX_ERR(0, 719, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.ray_intersects_abba_bbox", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">720</span>:                                           <span class="n">const</span> <span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">inv_direction</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">721</span>:                                           <span class="n">const</span> <span class="n">double</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span> <span class="n">bounds</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">722</span>:                                           <span class="n">const</span> <span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">ds</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">723</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">724</span>: <span class="sd">    bounds = [3d coords of lowerleftback point of bounding box,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">725</span>: <span class="sd">              3d coords of upperrightfront point of bounding box]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">726</span>: <span class="sd">    ds = [3d coords of origin of ray]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">727</span>: <span class="sd">    returns True if ray intersects bounding box, else False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">728</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">729</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">tmin</span><span class="p">,</span> <span class="nf">tmax</span><span class="p">,</span> <span class="nf">tymin</span><span class="p">,</span> <span class="nf">tymax</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">730</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">tzmin</span><span class="p">,</span> <span class="nf">tzmax</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">731</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">t0</span> <span class="o">=</span> <span class="mf">1000000</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(731,1,<span class='error_goto'>__PYX_ERR(0, 731, __pyx_L1_error)</span>)
  __pyx_v_t0 = 0xF4240;
</pre><pre class="cython line score-0">&#xA0;<span class="">732</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">res</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">733</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">734</span>:     <span class="c"># computing intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">735</span>:     <span class="n">tmin</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="n">sign</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="mf">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(735,1,<span class='error_goto'>__PYX_ERR(0, 735, __pyx_L1_error)</span>)
  __pyx_v_tmin = (((__pyx_v_bounds[((__pyx_v_sign[0]) * 3)]) - (__pyx_v_ds[0])) * (__pyx_v_inv_direction[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">736</span>:     <span class="n">tmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[(</span><span class="mf">1</span><span class="o">-</span><span class="n">sign</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="o">*</span><span class="mf">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(736,1,<span class='error_goto'>__PYX_ERR(0, 736, __pyx_L1_error)</span>)
  __pyx_v_tmax = (((__pyx_v_bounds[((1 - (__pyx_v_sign[0])) * 3)]) - (__pyx_v_ds[0])) * (__pyx_v_inv_direction[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">737</span>:     <span class="n">tymin</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[(</span><span class="n">sign</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="o">*</span><span class="mf">3</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(737,1,<span class='error_goto'>__PYX_ERR(0, 737, __pyx_L1_error)</span>)
  __pyx_v_tymin = (((__pyx_v_bounds[(((__pyx_v_sign[1]) * 3) + 1)]) - (__pyx_v_ds[1])) * (__pyx_v_inv_direction[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">738</span>:     <span class="n">tymax</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[(</span><span class="mf">1</span><span class="o">-</span><span class="n">sign</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span><span class="o">*</span><span class="mf">3</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(738,1,<span class='error_goto'>__PYX_ERR(0, 738, __pyx_L1_error)</span>)
  __pyx_v_tymax = (((__pyx_v_bounds[(((1 - (__pyx_v_sign[1])) * 3) + 1)]) - (__pyx_v_ds[1])) * (__pyx_v_inv_direction[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">739</span>:     <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">tmin</span> <span class="o">&gt;</span> <span class="n">tymax</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tymin</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">)</span> <span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(739,1,<span class='error_goto'>__PYX_ERR(0, 739, __pyx_L1_error)</span>)
  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tymax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tymin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">740</span>:         <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(740,1,<span class='error_goto'>__PYX_ERR(0, 740, __pyx_L1_error)</span>)
    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">741</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">tymin</span> <span class="o">&gt;</span> <span class="n">tmin</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(741,1,<span class='error_goto'>__PYX_ERR(0, 741, __pyx_L1_error)</span>)
  __pyx_t_1 = ((__pyx_v_tymin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">742</span>:         <span class="n">tmin</span> <span class="o">=</span> <span class="n">tymin</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(742,1,<span class='error_goto'>__PYX_ERR(0, 742, __pyx_L1_error)</span>)
    __pyx_v_tmin = __pyx_v_tymin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">743</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">tymax</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(743,1,<span class='error_goto'>__PYX_ERR(0, 743, __pyx_L1_error)</span>)
  __pyx_t_1 = ((__pyx_v_tymax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">744</span>:         <span class="n">tmax</span> <span class="o">=</span> <span class="n">tymax</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(744,1,<span class='error_goto'>__PYX_ERR(0, 744, __pyx_L1_error)</span>)
    __pyx_v_tmax = __pyx_v_tymax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">745</span>:     <span class="n">tzmin</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[(</span><span class="n">sign</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span><span class="o">*</span><span class="mf">3</span><span class="o">+</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(745,1,<span class='error_goto'>__PYX_ERR(0, 745, __pyx_L1_error)</span>)
  __pyx_v_tzmin = (((__pyx_v_bounds[(((__pyx_v_sign[2]) * 3) + 2)]) - (__pyx_v_ds[2])) * (__pyx_v_inv_direction[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">746</span>:     <span class="n">tzmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[(</span><span class="mf">1</span><span class="o">-</span><span class="n">sign</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span><span class="o">*</span><span class="mf">3</span><span class="o">+</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="o">*</span> <span class="n">inv_direction</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(746,1,<span class='error_goto'>__PYX_ERR(0, 746, __pyx_L1_error)</span>)
  __pyx_v_tzmax = (((__pyx_v_bounds[(((1 - (__pyx_v_sign[2])) * 3) + 2)]) - (__pyx_v_ds[2])) * (__pyx_v_inv_direction[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">747</span>:     <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">tmin</span> <span class="o">&gt;</span> <span class="n">tzmax</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tzmin</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">)</span> <span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(747,1,<span class='error_goto'>__PYX_ERR(0, 747, __pyx_L1_error)</span>)
  __pyx_t_2 = ((__pyx_v_tmin &gt; __pyx_v_tzmax) != 0);
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L9_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tzmin &gt; __pyx_v_tmax) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L9_bool_binop_done:;
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">748</span>:         <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(748,1,<span class='error_goto'>__PYX_ERR(0, 748, __pyx_L1_error)</span>)
    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">749</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">tzmin</span> <span class="o">&gt;</span> <span class="n">tmin</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(749,1,<span class='error_goto'>__PYX_ERR(0, 749, __pyx_L1_error)</span>)
  __pyx_t_1 = ((__pyx_v_tzmin &gt; __pyx_v_tmin) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">750</span>:         <span class="n">tmin</span> <span class="o">=</span> <span class="n">tzmin</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(750,1,<span class='error_goto'>__PYX_ERR(0, 750, __pyx_L1_error)</span>)
    __pyx_v_tmin = __pyx_v_tzmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">751</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">tzmax</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(751,1,<span class='error_goto'>__PYX_ERR(0, 751, __pyx_L1_error)</span>)
  __pyx_t_1 = ((__pyx_v_tzmax &lt; __pyx_v_tmax) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">752</span>:         <span class="n">tmax</span> <span class="o">=</span> <span class="n">tzmax</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(752,1,<span class='error_goto'>__PYX_ERR(0, 752, __pyx_L1_error)</span>)
    __pyx_v_tmax = __pyx_v_tzmax;
</pre><pre class="cython line score-0">&#xA0;<span class="">753</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">754</span>:     <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmin</span> <span class="o">&lt;</span> <span class="n">t0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmax</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">t0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(754,1,<span class='error_goto'>__PYX_ERR(0, 754, __pyx_L1_error)</span>)
  __pyx_t_2 = ((__pyx_v_tmin &lt; __pyx_v_t0) != 0);
  if (__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_2 = ((__pyx_v_tmax &gt; (-__pyx_v_t0)) != 0);
  __pyx_t_1 = __pyx_t_2;
  __pyx_L13_bool_binop_done:;
  __pyx_v_res = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">755</span>:     <span class="k">if</span> <span class="p">(</span><span class="n">tmin</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(755,1,<span class='error_goto'>__PYX_ERR(0, 755, __pyx_L1_error)</span>)
  __pyx_t_1 = ((__pyx_v_tmin &lt; 0.0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">756</span>:         <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(756,1,<span class='error_goto'>__PYX_ERR(0, 756, __pyx_L1_error)</span>)
    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">757</span>:     <span class="k">return</span>  <span class="n">res</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(757,1,<span class='error_goto'>__PYX_ERR(0, 757, __pyx_L1_error)</span>)
  __pyx_r = __pyx_v_res;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">758</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">759</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">760</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">bint</span> <span class="nf">is_point_in_path</span><span class="p">(</span><span class="nb">int</span> <span class="n">nvert</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">vertx</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">verty</span><span class="p">,</span> <span class="n">double</span> <span class="n">testx</span><span class="p">,</span> <span class="n">double</span> <span class="n">testy</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE int __pyx_f_4tofu_4geom_8_GG03_LM_is_point_in_path(int __pyx_v_nvert, __Pyx_memviewslice __pyx_v_vertx, __Pyx_memviewslice __pyx_v_verty, double __pyx_v_testx, double __pyx_v_testy) {
  int __pyx_v_i;
  int __pyx_v_c;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("is_point_in_path", __pyx_f[0], 760, 1, <span class='error_goto'>__PYX_ERR(0, 760, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.is_point_in_path", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">761</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">762</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">c</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(762,1,<span class='error_goto'>__PYX_ERR(0, 762, __pyx_L1_error)</span>)
  __pyx_v_c = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">763</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvert</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(763,1,<span class='error_goto'>__PYX_ERR(0, 763, __pyx_L1_error)</span>)
  __pyx_t_1 = __pyx_v_nvert;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">764</span>:         <span class="k">if</span> <span class="p">(</span> <span class="p">((</span><span class="n">verty</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">testy</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">verty</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">testy</span><span class="p">))</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(764,1,<span class='error_goto'>__PYX_ERR(0, 764, __pyx_L1_error)</span>)
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = (__pyx_v_i + 1);
    __pyx_t_7 = ((((*((double *) ( /* dim=0 */ (__pyx_v_verty.data + __pyx_t_5 * __pyx_v_verty.strides[0]) ))) &gt; __pyx_v_testy) != ((*((double *) ( /* dim=0 */ (__pyx_v_verty.data + __pyx_t_6 * __pyx_v_verty.strides[0]) ))) &gt; __pyx_v_testy)) != 0);
    if (__pyx_t_7) {
    } else {
      __pyx_t_4 = __pyx_t_7;
      goto __pyx_L6_bool_binop_done;
    }
/* … */
    <span class='trace'>__Pyx_TraceLine</span>(764,1,<span class='error_goto'>__PYX_ERR(0, 764, __pyx_L1_error)</span>)
    if (__pyx_t_4) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">765</span>:             <span class="p">(</span><span class="n">testx</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">vertx</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">vertx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">testy</span><span class="o">-</span><span class="n">verty</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">verty</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">verty</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">vertx</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">):</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(765,1,<span class='error_goto'>__PYX_ERR(0, 765, __pyx_L1_error)</span>)
    __pyx_t_8 = (__pyx_v_i + 1);
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_11 = (__pyx_v_i + 1);
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_13 = __pyx_v_i;
    __pyx_t_7 = ((__pyx_v_testx &lt; (((((*((double *) ( /* dim=0 */ (__pyx_v_vertx.data + __pyx_t_8 * __pyx_v_vertx.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_vertx.data + __pyx_t_9 * __pyx_v_vertx.strides[0]) )))) * (__pyx_v_testy - (*((double *) ( /* dim=0 */ (__pyx_v_verty.data + __pyx_t_10 * __pyx_v_verty.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_verty.data + __pyx_t_11 * __pyx_v_verty.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_verty.data + __pyx_t_12 * __pyx_v_verty.strides[0]) ))))) + (*((double *) ( /* dim=0 */ (__pyx_v_vertx.data + __pyx_t_13 * __pyx_v_vertx.strides[0]) ))))) != 0);
    __pyx_t_4 = __pyx_t_7;
    __pyx_L6_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">766</span>:             <span class="n">c</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">c</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(766,1,<span class='error_goto'>__PYX_ERR(0, 766, __pyx_L1_error)</span>)
      __pyx_v_c = (!(__pyx_v_c != 0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">767</span>:     <span class="k">return</span> <span class="n">c</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(767,1,<span class='error_goto'>__PYX_ERR(0, 767, __pyx_L1_error)</span>)
  __pyx_r = __pyx_v_c;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">768</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">769</span>: <span class="c"># cdef inline void Calc_LOS_PInOut_Tor(double [:,::1] Ds, double [:,::1] us,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">770</span>: <span class="c">#                                      double [:,::1] VPoly, double [:,::1] vIn,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">771</span>: <span class="c">#                                      double[:] kPIn_view, double[:] kPOut_view,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">772</span>: <span class="c">#                                      double[:] VperpOut_view, int[:] IOut_view,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">773</span>: <span class="c">#                                      int Nl,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">774</span>: <span class="c">#                                      double Rmin, bint lim_is_none, double L0, double L1,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">775</span>: <span class="c">#                                      bint Forbid,  double EpsUz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">776</span>: <span class="c">#                                      double EpsVz, double EpsA,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">777</span>: <span class="c">#                                      double EpsB,  double EpsPlane):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">778</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">779</span>: <span class="c">#     cdef int ii, jj, Ns=vIn.shape[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">780</span>: <span class="c">#     cdef double upscaDp, upar2, Dpar2, Crit2, kout, kin, invDpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">781</span>: <span class="c">#     cdef int indout=0, Done=0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">782</span>: <span class="c">#     cdef double L=0., S1X=0., S1Y=0., S2X=0., S2Y=0., sca=0., sca0=0., sca1=0., sca2=0.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">783</span>: <span class="c">#     cdef double q, C, delta, sqd, k, sol0, sol1, phi=0., rmin2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">784</span>: <span class="c">#     cdef double v0, v1, A, B, ephiIn0, ephiIn1, Crit2_base = EpsUz*EpsUz/400.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">785</span>: <span class="c">#     cdef double[3] loc_ds</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">786</span>: <span class="c">#     cdef double[3] loc_us</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">787</span>: <span class="c">#     cdef double[3] loc_vp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">788</span>: <span class="c">#     cdef double[1] kpin_loc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">789</span>: <span class="c">#     cdef double[1] kpout_loc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">790</span>: <span class="c">#     cdef int[1] ind_loc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">791</span>: <span class="c">#     cdef double SOut1, SOut0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">792</span>: <span class="c">#     cdef int Forbidbis, Forbid0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">793</span>: <span class="c">#     cdef bint found_new</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">794</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">795</span>: <span class="c">#     ################</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">796</span>: <span class="c">#     # Compute</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">797</span>: <span class="c">#     if Forbid:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">798</span>: <span class="c">#         Forbid0, Forbidbis = 1, 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">799</span>: <span class="c">#     else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">800</span>: <span class="c">#         Forbid0, Forbidbis = 0, 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">801</span>: <span class="c">#     for ii in range(0,Nl):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">802</span>: <span class="c">#         loc_us[0] = us[0,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">803</span>: <span class="c">#         loc_us[1] = us[1,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">804</span>: <span class="c">#         loc_us[2] = us[2,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">805</span>: <span class="c">#         loc_ds[0] = Ds[0,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">806</span>: <span class="c">#         loc_ds[1] = Ds[1,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">807</span>: <span class="c">#         loc_ds[2] = Ds[2,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">808</span>: <span class="c">#         loc_vp[0] = VperpOut_view[0+3*ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">809</span>: <span class="c">#         loc_vp[1] = VperpOut_view[1+3*ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">810</span>: <span class="c">#         loc_vp[2] = VperpOut_view[2+3*ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">811</span>: <span class="c">#         upscaDp = loc_us[0]*loc_ds[0] + loc_us[1]*loc_ds[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">812</span>: <span class="c">#         upar2 = loc_us[0]*loc_us[0] + loc_us[1]*loc_us[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">813</span>: <span class="c">#         Dpar2 = loc_ds[0]*loc_ds[0] + loc_ds[1]*loc_ds[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">814</span>: <span class="c">#         invDpar2 = 1./Dpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">815</span>: <span class="c">#         # Prepare in case Forbid is True</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">816</span>: <span class="c">#         if Forbid0 and not Dpar2&gt;0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">817</span>: <span class="c">#             Forbidbis = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">818</span>: <span class="c">#         if Forbidbis:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">819</span>: <span class="c">#             # Compute coordinates of the 2 points where the tangents touch</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">820</span>: <span class="c">#             # the inner circle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">821</span>: <span class="c">#             rmin2 = Rmin*Rmin</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">822</span>: <span class="c">#             L = Csqrt(Dpar2-rmin2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">823</span>: <span class="c">#             S1X = (rmin2*loc_ds[0]+Rmin*loc_ds[1]*L)*invDpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">824</span>: <span class="c">#             S1Y = (rmin2*loc_ds[1]-Rmin*loc_ds[0]*L)*invDpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">825</span>: <span class="c">#             S2X = (rmin2*loc_ds[0]-Rmin*loc_ds[1]*L)*invDpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">826</span>: <span class="c">#             S2Y = (rmin2*loc_ds[1]+Rmin*loc_ds[0]*L)*invDpar2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">827</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">828</span>: <span class="c">#         # Compute all solutions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">829</span>: <span class="c">#         # Set tolerance value for us[2,ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">830</span>: <span class="c">#         # EpsUz is the tolerated DZ across 20m (max Tokamak size)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">831</span>: <span class="c">#         Crit2 = upar2*Crit2_base</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">832</span>: <span class="c">#         kpin_loc[0]  = kPIn_view[ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">833</span>: <span class="c">#         kpout_loc[0] = kPOut_view[ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">834</span>: <span class="c">#         ind_loc[0] = IOut_view[2 + 3*ii]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">835</span>: <span class="c">#         found_new = comp_inter_los_vpoly(loc_ds, loc_us, VPoly, vIn, Ns, lim_is_none,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">836</span>: <span class="c">#                                          L0, L1, kpin_loc, kpout_loc, ind_loc, loc_vp,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">837</span>: <span class="c">#                                          Forbidbis, upscaDp, upar2, Dpar2, invDpar2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">838</span>: <span class="c">#                                          S1X, S1Y, S2X, S2Y, Crit2, EpsUz, EpsVz, EpsA, EpsB,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">839</span>: <span class="c">#                                          EpsPlane, True)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">840</span>: <span class="c">#         if found_new:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">841</span>: <span class="c">#             kPIn_view[ii]         = kpin_loc[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">842</span>: <span class="c">#             kPOut_view[ii]        = kpout_loc[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">843</span>: <span class="c">#             IOut_view[2+3*ii]     = ind_loc[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">844</span>: <span class="c">#             IOut_view[0+3*ii]     = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">845</span>: <span class="c">#             IOut_view[1+3*ii]     = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">846</span>: <span class="c">#             VperpOut_view[0+3*ii] = loc_vp[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">847</span>: <span class="c">#             VperpOut_view[1+3*ii] = loc_vp[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">848</span>: <span class="c">#             VperpOut_view[2+3*ii] = loc_vp[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">849</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">850</span>: <span class="c">#         else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">851</span>: <span class="c">#             kPIn_view[ii]         = Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">852</span>: <span class="c">#             kPOut_view[ii]        = Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">853</span>: <span class="c">#             IOut_view[2+3*ii]     = -1000000</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">854</span>: <span class="c">#             IOut_view[0+3*ii]     = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">855</span>: <span class="c">#             IOut_view[1+3*ii]     = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">856</span>: <span class="c">#             VperpOut_view[0+3*ii] = Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">857</span>: <span class="c">#             VperpOut_view[1+3*ii] = Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">858</span>: <span class="c">#             VperpOut_view[2+3*ii] = Cnan</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">859</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">860</span>: <span class="c">#     return</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">861</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">862</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">863</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">864</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">compute_bbox_extr</span><span class="p">(</span><span class="nb">int</span> <span class="n">nvert</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">vert</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_extr(int __pyx_v_nvert, __Pyx_memviewslice __pyx_v_vert, double *__pyx_v_bounds) {
  int __pyx_v_ii;
  double __pyx_v_rmax;
  double __pyx_v_zmin;
  double __pyx_v_zmax;
  double __pyx_v_tmp_val;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("compute_bbox_extr", __pyx_f[0], 864, 1, <span class='error_goto'>__PYX_ERR(0, 864, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.compute_bbox_extr", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">865</span>:                                    <span class="n">double</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span> <span class="n">bounds</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">866</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ii</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">867</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rmax</span><span class="o">=</span><span class="n">vert</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">],</span> <span class="n">zmin</span><span class="o">=</span><span class="n">vert</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">],</span> <span class="n">zmax</span><span class="o">=</span><span class="n">vert</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(867,1,<span class='error_goto'>__PYX_ERR(0, 867, __pyx_L1_error)</span>)
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_v_rmax = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_1 * __pyx_v_vert.strides[0]) )) + __pyx_t_2)) )));
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_v_zmin = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_3 * __pyx_v_vert.strides[0]) )) + __pyx_t_4)) )));
  __pyx_t_5 = 1;
  __pyx_t_6 = 0;
  __pyx_v_zmax = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_5 * __pyx_v_vert.strides[0]) )) + __pyx_t_6)) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">868</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">tmp_val</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">869</span>:     <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">nvert</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(869,1,<span class='error_goto'>__PYX_ERR(0, 869, __pyx_L1_error)</span>)
  __pyx_t_7 = __pyx_v_nvert;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 1; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_ii = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">870</span>:         <span class="n">tmp_val</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(870,1,<span class='error_goto'>__PYX_ERR(0, 870, __pyx_L1_error)</span>)
    __pyx_t_10 = 0;
    __pyx_t_11 = __pyx_v_ii;
    __pyx_v_tmp_val = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_10 * __pyx_v_vert.strides[0]) )) + __pyx_t_11)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">871</span>:         <span class="k">if</span> <span class="n">tmp_val</span> <span class="o">&gt;</span> <span class="n">rmax</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(871,1,<span class='error_goto'>__PYX_ERR(0, 871, __pyx_L1_error)</span>)
    __pyx_t_12 = ((__pyx_v_tmp_val &gt; __pyx_v_rmax) != 0);
    if (__pyx_t_12) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">872</span>:             <span class="n">rmax</span> <span class="o">=</span> <span class="n">tmp_val</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(872,1,<span class='error_goto'>__PYX_ERR(0, 872, __pyx_L1_error)</span>)
      __pyx_v_rmax = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">873</span>:         <span class="n">tmp_val</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(873,1,<span class='error_goto'>__PYX_ERR(0, 873, __pyx_L1_error)</span>)
    __pyx_t_13 = 1;
    __pyx_t_14 = __pyx_v_ii;
    __pyx_v_tmp_val = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_13 * __pyx_v_vert.strides[0]) )) + __pyx_t_14)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">874</span>:         <span class="k">if</span> <span class="n">tmp_val</span> <span class="o">&gt;</span> <span class="n">zmax</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(874,1,<span class='error_goto'>__PYX_ERR(0, 874, __pyx_L1_error)</span>)
    __pyx_t_12 = ((__pyx_v_tmp_val &gt; __pyx_v_zmax) != 0);
    if (__pyx_t_12) {
/* … */
      goto __pyx_L6;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">875</span>:             <span class="n">zmax</span> <span class="o">=</span> <span class="n">tmp_val</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(875,1,<span class='error_goto'>__PYX_ERR(0, 875, __pyx_L1_error)</span>)
      __pyx_v_zmax = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">876</span>:         <span class="k">elif</span> <span class="n">tmp_val</span> <span class="o">&lt;</span> <span class="n">zmin</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(876,1,<span class='error_goto'>__PYX_ERR(0, 876, __pyx_L1_error)</span>)
    __pyx_t_12 = ((__pyx_v_tmp_val &lt; __pyx_v_zmin) != 0);
    if (__pyx_t_12) {
/* … */
    }
    __pyx_L6:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">877</span>:             <span class="n">zmin</span> <span class="o">=</span> <span class="n">tmp_val</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(877,1,<span class='error_goto'>__PYX_ERR(0, 877, __pyx_L1_error)</span>)
      __pyx_v_zmin = __pyx_v_tmp_val;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">878</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(878,1,<span class='error_goto'>__PYX_ERR(0, 878, __pyx_L1_error)</span>)
  (__pyx_v_bounds[0]) = (-__pyx_v_rmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">879</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(879,1,<span class='error_goto'>__PYX_ERR(0, 879, __pyx_L1_error)</span>)
  (__pyx_v_bounds[1]) = (-__pyx_v_rmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">880</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmin</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(880,1,<span class='error_goto'>__PYX_ERR(0, 880, __pyx_L1_error)</span>)
  (__pyx_v_bounds[2]) = __pyx_v_zmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">881</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(881,1,<span class='error_goto'>__PYX_ERR(0, 881, __pyx_L1_error)</span>)
  (__pyx_v_bounds[3]) = __pyx_v_rmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">882</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(882,1,<span class='error_goto'>__PYX_ERR(0, 882, __pyx_L1_error)</span>)
  (__pyx_v_bounds[4]) = __pyx_v_rmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">883</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(883,1,<span class='error_goto'>__PYX_ERR(0, 883, __pyx_L1_error)</span>)
  (__pyx_v_bounds[5]) = __pyx_v_zmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">884</span>:     <span class="k">return</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(884,1,<span class='error_goto'>__PYX_ERR(0, 884, __pyx_L1_error)</span>)
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">885</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">886</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">887</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">compute_bbox_lim</span><span class="p">(</span><span class="nb">int</span> <span class="n">nvert</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,::</span><span class="mf">1</span><span class="p">]</span> <span class="n">vert</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_compute_bbox_lim(int __pyx_v_nvert, __Pyx_memviewslice __pyx_v_vert, double *__pyx_v_bounds, double __pyx_v_lmin, double __pyx_v_lmax) {
  int __pyx_v_ii;
  double __pyx_v_toto;
  double __pyx_v_xmin;
  double __pyx_v_xmax;
  double __pyx_v_ymin;
  double __pyx_v_ymax;
  double __pyx_v_zmin;
  double __pyx_v_zmax;
  double __pyx_v_cos_min;
  double __pyx_v_sin_min;
  double __pyx_v_cos_max;
  double __pyx_v_sin_max;
  double __pyx_v_temp[3];
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("compute_bbox_lim", __pyx_f[0], 887, 1, <span class='error_goto'>__PYX_ERR(0, 887, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.compute_bbox_lim", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
}
</pre><pre class="cython line score-0">&#xA0;<span class="">888</span>:                                   <span class="n">double</span><span class="p">[</span><span class="mf">6</span><span class="p">]</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">double</span> <span class="n">lmin</span><span class="p">,</span> <span class="n">double</span> <span class="n">lmax</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">889</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ii</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">890</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">toto</span><span class="o">=</span><span class="mf">100000.</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(890,1,<span class='error_goto'>__PYX_ERR(0, 890, __pyx_L1_error)</span>)
  __pyx_v_toto = 100000.;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">891</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">xmin</span><span class="o">=</span><span class="n">toto</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=-</span><span class="n">toto</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(891,1,<span class='error_goto'>__PYX_ERR(0, 891, __pyx_L1_error)</span>)
  __pyx_v_xmin = __pyx_v_toto;
  __pyx_v_xmax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">892</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ymin</span><span class="o">=</span><span class="n">toto</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=-</span><span class="n">toto</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(892,1,<span class='error_goto'>__PYX_ERR(0, 892, __pyx_L1_error)</span>)
  __pyx_v_ymin = __pyx_v_toto;
  __pyx_v_ymax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">893</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">zmin</span><span class="o">=</span><span class="n">toto</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=-</span><span class="n">toto</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(893,1,<span class='error_goto'>__PYX_ERR(0, 893, __pyx_L1_error)</span>)
  __pyx_v_zmin = __pyx_v_toto;
  __pyx_v_zmax = (-__pyx_v_toto);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">894</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cos_min</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">lmin</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(894,1,<span class='error_goto'>__PYX_ERR(0, 894, __pyx_L1_error)</span>)
  __pyx_v_cos_min = cos(__pyx_v_lmin);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">895</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sin_min</span> <span class="o">=</span> <span class="n">Csin</span><span class="p">(</span><span class="n">lmin</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(895,1,<span class='error_goto'>__PYX_ERR(0, 895, __pyx_L1_error)</span>)
  __pyx_v_sin_min = sin(__pyx_v_lmin);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">896</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">cos_max</span> <span class="o">=</span> <span class="n">Ccos</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(896,1,<span class='error_goto'>__PYX_ERR(0, 896, __pyx_L1_error)</span>)
  __pyx_v_cos_max = cos(__pyx_v_lmax);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">897</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sin_max</span> <span class="o">=</span> <span class="n">Csin</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(897,1,<span class='error_goto'>__PYX_ERR(0, 897, __pyx_L1_error)</span>)
  __pyx_v_sin_max = sin(__pyx_v_lmax);
</pre><pre class="cython line score-0">&#xA0;<span class="">898</span>:     <span class="k">cdef</span> <span class="kt">double</span>[3] <span class="nf">temp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">899</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">900</span>:     <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nvert</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(900,1,<span class='error_goto'>__PYX_ERR(0, 900, __pyx_L1_error)</span>)
  __pyx_t_1 = __pyx_v_nvert;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_ii = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">901</span>:         <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(901,1,<span class='error_goto'>__PYX_ERR(0, 901, __pyx_L1_error)</span>)
    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_ii;
    (__pyx_v_temp[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_4 * __pyx_v_vert.strides[0]) )) + __pyx_t_5)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">902</span>:         <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(902,1,<span class='error_goto'>__PYX_ERR(0, 902, __pyx_L1_error)</span>)
    __pyx_t_6 = 1;
    __pyx_t_7 = __pyx_v_ii;
    (__pyx_v_temp[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_6 * __pyx_v_vert.strides[0]) )) + __pyx_t_7)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">903</span>:         <span class="n">coordshift_simple1d</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">in_is_cartesian</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">CrossRef</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(903,1,<span class='error_goto'>__PYX_ERR(0, 903, __pyx_L1_error)</span>)
    __pyx_t_8.__pyx_n = 4;
    __pyx_t_8.in_is_cartesian = 0;
    __pyx_t_8.CrossRef = 1.;
    __pyx_t_8.cos_phi = __pyx_v_cos_min;
    __pyx_t_8.sin_phi = __pyx_v_sin_min;
    __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(__pyx_v_temp, &amp;__pyx_t_8); 
</pre><pre class="cython line score-0">&#xA0;<span class="">904</span>:                           <span class="n">cos_phi</span><span class="o">=</span><span class="n">cos_min</span><span class="p">,</span> <span class="n">sin_phi</span><span class="o">=</span><span class="n">sin_min</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">905</span>:         <span class="k">if</span> <span class="n">xmin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(905,1,<span class='error_goto'>__PYX_ERR(0, 905, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_xmin &gt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">906</span>:             <span class="n">xmin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(906,1,<span class='error_goto'>__PYX_ERR(0, 906, __pyx_L1_error)</span>)
      __pyx_v_xmin = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">907</span>:         <span class="k">if</span> <span class="n">xmax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(907,1,<span class='error_goto'>__PYX_ERR(0, 907, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_xmax &lt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">908</span>:             <span class="n">xmax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(908,1,<span class='error_goto'>__PYX_ERR(0, 908, __pyx_L1_error)</span>)
      __pyx_v_xmax = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">909</span>:         <span class="k">if</span> <span class="n">ymin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(909,1,<span class='error_goto'>__PYX_ERR(0, 909, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_ymin &gt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">910</span>:             <span class="n">ymin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(910,1,<span class='error_goto'>__PYX_ERR(0, 910, __pyx_L1_error)</span>)
      __pyx_v_ymin = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">911</span>:         <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(911,1,<span class='error_goto'>__PYX_ERR(0, 911, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_ymax &lt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">912</span>:             <span class="n">ymax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(912,1,<span class='error_goto'>__PYX_ERR(0, 912, __pyx_L1_error)</span>)
      __pyx_v_ymax = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">913</span>:         <span class="k">if</span> <span class="n">zmin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(913,1,<span class='error_goto'>__PYX_ERR(0, 913, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_zmin &gt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">914</span>:             <span class="n">zmin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(914,1,<span class='error_goto'>__PYX_ERR(0, 914, __pyx_L1_error)</span>)
      __pyx_v_zmin = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">915</span>:         <span class="k">if</span> <span class="n">zmax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(915,1,<span class='error_goto'>__PYX_ERR(0, 915, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_zmax &lt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">916</span>:             <span class="n">zmax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(916,1,<span class='error_goto'>__PYX_ERR(0, 916, __pyx_L1_error)</span>)
      __pyx_v_zmax = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">917</span>:         <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(917,1,<span class='error_goto'>__PYX_ERR(0, 917, __pyx_L1_error)</span>)
    __pyx_t_10 = 0;
    __pyx_t_11 = __pyx_v_ii;
    (__pyx_v_temp[0]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_10 * __pyx_v_vert.strides[0]) )) + __pyx_t_11)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">918</span>:         <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vert</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(918,1,<span class='error_goto'>__PYX_ERR(0, 918, __pyx_L1_error)</span>)
    __pyx_t_12 = 1;
    __pyx_t_13 = __pyx_v_ii;
    (__pyx_v_temp[1]) = (*((double *) ( /* dim=1 */ ((char *) (((double *) ( /* dim=0 */ (__pyx_v_vert.data + __pyx_t_12 * __pyx_v_vert.strides[0]) )) + __pyx_t_13)) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">919</span>:         <span class="n">coordshift_simple1d</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">in_is_cartesian</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">CrossRef</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(919,1,<span class='error_goto'>__PYX_ERR(0, 919, __pyx_L1_error)</span>)
    __pyx_t_8.__pyx_n = 4;
    __pyx_t_8.in_is_cartesian = 0;
    __pyx_t_8.CrossRef = 1.;
    __pyx_t_8.cos_phi = __pyx_v_cos_max;
    __pyx_t_8.sin_phi = __pyx_v_sin_max;
    __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(__pyx_v_temp, &amp;__pyx_t_8); 
</pre><pre class="cython line score-0">&#xA0;<span class="">920</span>:                           <span class="n">cos_phi</span><span class="o">=</span><span class="n">cos_max</span><span class="p">,</span> <span class="n">sin_phi</span><span class="o">=</span><span class="n">sin_max</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">921</span>:         <span class="k">if</span> <span class="n">xmin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(921,1,<span class='error_goto'>__PYX_ERR(0, 921, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_xmin &gt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">922</span>:             <span class="n">xmin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(922,1,<span class='error_goto'>__PYX_ERR(0, 922, __pyx_L1_error)</span>)
      __pyx_v_xmin = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">923</span>:         <span class="k">if</span> <span class="n">xmax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(923,1,<span class='error_goto'>__PYX_ERR(0, 923, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_xmax &lt; (__pyx_v_temp[0])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">924</span>:             <span class="n">xmax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(924,1,<span class='error_goto'>__PYX_ERR(0, 924, __pyx_L1_error)</span>)
      __pyx_v_xmax = (__pyx_v_temp[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">925</span>:         <span class="k">if</span> <span class="n">ymin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(925,1,<span class='error_goto'>__PYX_ERR(0, 925, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_ymin &gt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">926</span>:             <span class="n">ymin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(926,1,<span class='error_goto'>__PYX_ERR(0, 926, __pyx_L1_error)</span>)
      __pyx_v_ymin = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">927</span>:         <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(927,1,<span class='error_goto'>__PYX_ERR(0, 927, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_ymax &lt; (__pyx_v_temp[1])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">928</span>:             <span class="n">ymax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(928,1,<span class='error_goto'>__PYX_ERR(0, 928, __pyx_L1_error)</span>)
      __pyx_v_ymax = (__pyx_v_temp[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">929</span>:         <span class="k">if</span> <span class="n">zmin</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(929,1,<span class='error_goto'>__PYX_ERR(0, 929, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_zmin &gt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">930</span>:             <span class="n">zmin</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(930,1,<span class='error_goto'>__PYX_ERR(0, 930, __pyx_L1_error)</span>)
      __pyx_v_zmin = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">931</span>:         <span class="k">if</span> <span class="n">zmax</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(931,1,<span class='error_goto'>__PYX_ERR(0, 931, __pyx_L1_error)</span>)
    __pyx_t_9 = ((__pyx_v_zmax &lt; (__pyx_v_temp[2])) != 0);
    if (__pyx_t_9) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">932</span>:             <span class="n">zmax</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(932,1,<span class='error_goto'>__PYX_ERR(0, 932, __pyx_L1_error)</span>)
      __pyx_v_zmax = (__pyx_v_temp[2]);
</pre><pre class="cython line score-0">&#xA0;<span class="">933</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">934</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmin</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(934,1,<span class='error_goto'>__PYX_ERR(0, 934, __pyx_L1_error)</span>)
  (__pyx_v_bounds[0]) = __pyx_v_xmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">935</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(935,1,<span class='error_goto'>__PYX_ERR(0, 935, __pyx_L1_error)</span>)
  (__pyx_v_bounds[1]) = __pyx_v_ymin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">936</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmin</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(936,1,<span class='error_goto'>__PYX_ERR(0, 936, __pyx_L1_error)</span>)
  (__pyx_v_bounds[2]) = __pyx_v_zmin;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">937</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(937,1,<span class='error_goto'>__PYX_ERR(0, 937, __pyx_L1_error)</span>)
  (__pyx_v_bounds[3]) = __pyx_v_xmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">938</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(938,1,<span class='error_goto'>__PYX_ERR(0, 938, __pyx_L1_error)</span>)
  (__pyx_v_bounds[4]) = __pyx_v_ymax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">939</span>:     <span class="n">bounds</span><span class="p">[</span><span class="mf">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">zmax</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(939,1,<span class='error_goto'>__PYX_ERR(0, 939, __pyx_L1_error)</span>)
  (__pyx_v_bounds[5]) = __pyx_v_zmax;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">940</span>:     <span class="k">return</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(940,1,<span class='error_goto'>__PYX_ERR(0, 940, __pyx_L1_error)</span>)
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">941</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">942</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">943</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">944</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">coordshift_simple1d</span><span class="p">(</span><span class="n">double</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="n">pts</span><span class="p">,</span> <span class="n">bint</span> <span class="n">in_is_cartesian</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_4tofu_4geom_8_GG03_LM_coordshift_simple1d(double *__pyx_v_pts, struct __pyx_opt_args_4tofu_4geom_8_GG03_LM_coordshift_simple1d *__pyx_optional_args) {
  int __pyx_v_in_is_cartesian = ((int)1);
  double __pyx_v_CrossRef = ((double)0.);
  double __pyx_v_cos_phi = ((double)0.);
  double __pyx_v_sin_phi = ((double)0.);
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_z;
  double __pyx_v_r;
  double __pyx_v_p;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("coordshift_simple1d", __pyx_f[0], 944, 1, <span class='error_goto'>__PYX_ERR(0, 944, __pyx_L1_error)</span>);
  if (__pyx_optional_args) {
    if (__pyx_optional_args-&gt;__pyx_n &gt; 0) {
      __pyx_v_in_is_cartesian = __pyx_optional_args-&gt;in_is_cartesian;
      if (__pyx_optional_args-&gt;__pyx_n &gt; 1) {
        __pyx_v_CrossRef = __pyx_optional_args-&gt;CrossRef;
        if (__pyx_optional_args-&gt;__pyx_n &gt; 2) {
          __pyx_v_cos_phi = __pyx_optional_args-&gt;cos_phi;
          if (__pyx_optional_args-&gt;__pyx_n &gt; 3) {
            __pyx_v_sin_phi = __pyx_optional_args-&gt;sin_phi;
          }
        }
      }
    }
  }
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("tofu.geom._GG03_LM.coordshift_simple1d", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
}
/* … */
struct __pyx_opt_args_4tofu_4geom_8_GG03_LM_coordshift_simple1d {
  int __pyx_n;
  int in_is_cartesian;
  double CrossRef;
  double cos_phi;
  double sin_phi;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">945</span>:                                      <span class="n">double</span> <span class="n">CrossRef</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">double</span> <span class="n">cos_phi</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">946</span>:                                      <span class="n">double</span> <span class="n">sin_phi</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">947</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">948</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x</span><span class="p">,</span> <span class="nf">y</span><span class="p">,</span> <span class="nf">z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">949</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">r</span><span class="p">,</span> <span class="nf">p</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">950</span>:     <span class="k">if</span> <span class="n">in_is_cartesian</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(950,1,<span class='error_goto'>__PYX_ERR(0, 950, __pyx_L1_error)</span>)
  __pyx_t_1 = (__pyx_v_in_is_cartesian != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">951</span>:         <span class="k">if</span> <span class="n">CrossRef</span><span class="o">==</span><span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(951,1,<span class='error_goto'>__PYX_ERR(0, 951, __pyx_L1_error)</span>)
    __pyx_t_1 = ((__pyx_v_CrossRef == 0.) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L4;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">952</span>:             <span class="n">x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(952,1,<span class='error_goto'>__PYX_ERR(0, 952, __pyx_L1_error)</span>)
      __pyx_v_x = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">953</span>:             <span class="n">y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(953,1,<span class='error_goto'>__PYX_ERR(0, 953, __pyx_L1_error)</span>)
      __pyx_v_y = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">954</span>:             <span class="n">z</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(954,1,<span class='error_goto'>__PYX_ERR(0, 954, __pyx_L1_error)</span>)
      __pyx_v_z = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">955</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(955,1,<span class='error_goto'>__PYX_ERR(0, 955, __pyx_L1_error)</span>)
      (__pyx_v_pts[0]) = sqrt(((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">956</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(956,1,<span class='error_goto'>__PYX_ERR(0, 956, __pyx_L1_error)</span>)
      (__pyx_v_pts[1]) = __pyx_v_z;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">957</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Catan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(957,1,<span class='error_goto'>__PYX_ERR(0, 957, __pyx_L1_error)</span>)
      (__pyx_v_pts[2]) = atan2(__pyx_v_y, __pyx_v_x);
</pre><pre class="cython line score-0">&#xA0;<span class="">958</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">959</span>:             <span class="n">x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(959,1,<span class='error_goto'>__PYX_ERR(0, 959, __pyx_L1_error)</span>)
    /*else*/ {
      __pyx_v_x = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">960</span>:             <span class="n">y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(960,1,<span class='error_goto'>__PYX_ERR(0, 960, __pyx_L1_error)</span>)
      __pyx_v_y = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">961</span>:             <span class="n">z</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(961,1,<span class='error_goto'>__PYX_ERR(0, 961, __pyx_L1_error)</span>)
      __pyx_v_z = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">962</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Csqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(962,1,<span class='error_goto'>__PYX_ERR(0, 962, __pyx_L1_error)</span>)
      (__pyx_v_pts[0]) = sqrt(((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">963</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(963,1,<span class='error_goto'>__PYX_ERR(0, 963, __pyx_L1_error)</span>)
      (__pyx_v_pts[1]) = __pyx_v_z;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">964</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">CrossRef</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(964,1,<span class='error_goto'>__PYX_ERR(0, 964, __pyx_L1_error)</span>)
      (__pyx_v_pts[2]) = __pyx_v_CrossRef;
    }
    __pyx_L4:;
</pre><pre class="cython line score-0">&#xA0;<span class="">965</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">966</span>:         <span class="k">if</span> <span class="n">CrossRef</span><span class="o">==</span><span class="mf">0.</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(966,1,<span class='error_goto'>__PYX_ERR(0, 966, __pyx_L1_error)</span>)
  /*else*/ {
    __pyx_t_1 = ((__pyx_v_CrossRef == 0.) != 0);
    if (__pyx_t_1) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">967</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(967,1,<span class='error_goto'>__PYX_ERR(0, 967, __pyx_L1_error)</span>)
      __pyx_v_r = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">968</span>:             <span class="n">z</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(968,1,<span class='error_goto'>__PYX_ERR(0, 968, __pyx_L1_error)</span>)
      __pyx_v_z = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">969</span>:             <span class="n">p</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(969,1,<span class='error_goto'>__PYX_ERR(0, 969, __pyx_L1_error)</span>)
      __pyx_v_p = (__pyx_v_pts[2]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">970</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">Ccos</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(970,1,<span class='error_goto'>__PYX_ERR(0, 970, __pyx_L1_error)</span>)
      (__pyx_v_pts[0]) = (__pyx_v_r * cos(__pyx_v_p));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">971</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">Csin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(971,1,<span class='error_goto'>__PYX_ERR(0, 971, __pyx_L1_error)</span>)
      (__pyx_v_pts[1]) = (__pyx_v_r * sin(__pyx_v_p));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">972</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(972,1,<span class='error_goto'>__PYX_ERR(0, 972, __pyx_L1_error)</span>)
      (__pyx_v_pts[2]) = __pyx_v_z;
</pre><pre class="cython line score-0">&#xA0;<span class="">973</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">974</span>:             <span class="n">r</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    <span class='trace'>__Pyx_TraceLine</span>(974,1,<span class='error_goto'>__PYX_ERR(0, 974, __pyx_L1_error)</span>)
    /*else*/ {
      __pyx_v_r = (__pyx_v_pts[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">975</span>:             <span class="n">z</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(975,1,<span class='error_goto'>__PYX_ERR(0, 975, __pyx_L1_error)</span>)
      __pyx_v_z = (__pyx_v_pts[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">976</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">cos_phi</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(976,1,<span class='error_goto'>__PYX_ERR(0, 976, __pyx_L1_error)</span>)
      (__pyx_v_pts[0]) = (__pyx_v_r * __pyx_v_cos_phi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">977</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">sin_phi</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(977,1,<span class='error_goto'>__PYX_ERR(0, 977, __pyx_L1_error)</span>)
      (__pyx_v_pts[1]) = (__pyx_v_r * __pyx_v_sin_phi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">978</span>:             <span class="n">pts</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span></pre>
<pre class='cython code score-0 '>      <span class='trace'>__Pyx_TraceLine</span>(978,1,<span class='error_goto'>__PYX_ERR(0, 978, __pyx_L1_error)</span>)
      (__pyx_v_pts[2]) = __pyx_v_z;
    }
    __pyx_L5:;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">979</span>:     <span class="k">return</span></pre>
<pre class='cython code score-0 '>  <span class='trace'>__Pyx_TraceLine</span>(979,1,<span class='error_goto'>__PYX_ERR(0, 979, __pyx_L1_error)</span>)
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">980</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">981</span>: </pre>
</div></body></html>
