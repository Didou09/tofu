<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tofu.pathfile &mdash; tofu v1.1</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="tofu v1.1" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">tofu v1.1</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tofu.pathfile</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Jul 30 14:37:31 2014</span>

<span class="sd">@author: didiervezinet</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>                   <span class="c"># For accessing cuurent working direcVesy</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pck</span>       <span class="c"># For saving / loading objects</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dtm</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c"># ToFu specific</span>
<span class="kn">from</span> <span class="nn">tofu.defaults</span> <span class="k">import</span> <span class="n">dtmFormat</span> <span class="k">as</span> <span class="n">TFDdtmFormat</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s">&quot;Didier Vezinet&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Find_Rootpath&quot;</span><span class="p">,</span><span class="s">&quot;get_DefaultPaths&quot;</span><span class="p">,</span><span class="s">&quot;get_Default_dtimeFmt&quot;</span><span class="p">,</span><span class="s">&quot;_get_PathFileExt_FromName&quot;</span><span class="p">,</span><span class="s">&quot;convert_units&quot;</span><span class="p">,</span><span class="s">&quot;get_PolyFromPolyFileObj&quot;</span><span class="p">,</span>
           <span class="s">&quot;ID&quot;</span><span class="p">,</span>
           <span class="s">&quot;CheckSameObj&quot;</span><span class="p">,</span><span class="s">&quot;Save_Generic&quot;</span><span class="p">,</span><span class="s">&quot;Open&quot;</span><span class="p">]</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                Path Handling</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="Find_Rootpath"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.Find_Rootpath">[docs]</a><span class="k">def</span> <span class="nf">Find_Rootpath</span><span class="p">(</span><span class="n">Path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">substr</span><span class="o">=</span><span class="s">&#39;/tofu&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the absolute path of the root directory of ToFu, searching for a pattern in the provided input path</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Path :      str</span>
<span class="sd">        An absolute path in which a pattern is to be looked for</span>
<span class="sd">    substr :    str</span>
<span class="sd">        The pattern to look for</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    root :  str</span>
<span class="sd">        The absolute path containing the pattern</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indstr</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indstr</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">substr</span> <span class="o">=</span> <span class="n">substr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">indstr</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">[:</span><span class="n">indstr</span><span class="p">]</span> <span class="o">+</span> <span class="n">substr</span>
    <span class="k">return</span> <span class="n">root</span></div>



<div class="viewcode-block" id="get_DefaultPaths"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.get_DefaultPaths">[docs]</a><span class="k">def</span> <span class="nf">get_DefaultPaths</span><span class="p">(</span><span class="n">RootPath</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Plugin</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">lSubs</span><span class="o">=</span><span class="p">[],</span> <span class="n">PathInp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">PathObj</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">PathOut</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the default paths for input loading, object and output saving depending on the root path used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">RootPath</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">RootPath</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg RootPath must be a str !&quot;</span>
    <span class="k">assert</span> <span class="n">Plugin</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Plugin</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Plugin must be a str !&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">ss</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PathInp</span><span class="p">,</span> <span class="n">PathObj</span><span class="p">,</span> <span class="n">PathOut</span><span class="p">]]),</span> <span class="s">&quot;Args PathInp, PathObj, PathOut must be None or str !&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">lSubs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">lSubs</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">RootPath</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">RootPath</span> <span class="o">=</span> <span class="n">Find_Rootpath</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pp</span><span class="p">,</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">PathInp</span><span class="p">,</span><span class="s">&#39;Inputs&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">PathObj</span><span class="p">,</span><span class="s">&#39;Objects&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">PathOut</span><span class="p">,</span><span class="s">&#39;Outputs&#39;</span><span class="p">)]:</span>
        <span class="k">if</span> <span class="n">pp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">RootPath</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Plugin</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">pp</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">Plugin</span>
            <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">lSubs</span><span class="p">:</span>
                <span class="n">pp</span> <span class="o">=</span> <span class="n">pp</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">sub</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">pp</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">ss</span>

    <span class="k">return</span> <span class="n">PathInp</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">PathObj</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">PathOut</span><span class="o">+</span><span class="s">&#39;/&#39;</span></div>


<div class="viewcode-block" id="get_Default_dtimeFmt"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.get_Default_dtimeFmt">[docs]</a><span class="k">def</span> <span class="nf">get_Default_dtimeFmt</span><span class="p">(</span><span class="n">dtime</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">TFDdtmFormat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the default datetime value and format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dtime</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dtime</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span><span class="n">dtFormat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dtime</span><span class="p">,</span> <span class="n">dtFormat</span></div>


<span class="k">def</span> <span class="nf">_get_PathFileExt_FromName</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">Lstr</span><span class="o">=</span><span class="p">[]):</span>    <span class="c"># Used in tofu.plugin.ITER.Ves.create()</span>
    <span class="sd">&quot;&quot;&quot; Retrieve PathFileExt from a Name, in Path if absolute path not specified in Name, with possible TFMod and ext options &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Name</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">Name</span><span class="p">:</span>
        <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LF</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">Lstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">Lstr</span> <span class="o">=</span> <span class="n">Lstr</span><span class="o">+</span><span class="n">Name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Lstr</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">LF</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="n">ff</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Lstr</span><span class="p">])]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Several or no possibility for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; in &quot;</span><span class="o">+</span><span class="n">Path</span><span class="o">+</span><span class="s">&quot; with &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Lstr</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;    LF = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span>
        <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Path</span> <span class="o">+</span> <span class="n">LF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">PathFileExt</span>



<span class="k">def</span> <span class="nf">_set_arrayorder</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">arrayorder</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">arrayorder</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">],</span> <span class="s">&quot;Arg arrayorder must be in [&#39;C&#39;,&#39;F&#39;]&quot;</span>
    <span class="n">Lattr</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Lattr</span><span class="p">:</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="ow">and</span> <span class="n">bb</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arrayorder</span><span class="o">==</span><span class="s">&#39;C&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">asfortranarray</span><span class="p">(</span><span class="n">bb</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span> <span class="o">=</span> <span class="n">arrayorder</span>


<div class="viewcode-block" id="convert_units"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.convert_units">[docs]</a><span class="k">def</span> <span class="nf">convert_units</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">In</span><span class="o">=</span><span class="s">&#39;cm&#39;</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Quickly convert distance units between meters, centimeters and millimeters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;m&#39;</span><span class="p">:{</span><span class="s">&#39;mm&#39;</span><span class="p">:</span><span class="mf">1000.</span><span class="p">,</span><span class="s">&#39;cm&#39;</span><span class="p">:</span><span class="mf">100.</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">},</span>
            <span class="s">&#39;cm&#39;</span><span class="p">:{</span><span class="s">&#39;mm&#39;</span><span class="p">:</span><span class="mf">10.</span><span class="p">,</span><span class="s">&#39;cm&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">},</span>
            <span class="s">&#39;mm&#39;</span><span class="p">:{</span><span class="s">&#39;mm&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span><span class="s">&#39;cm&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">:</span><span class="mf">0.001</span><span class="p">}}</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="n">In</span><span class="p">][</span><span class="n">Out</span><span class="p">]</span><span class="o">*</span><span class="n">P</span></div>



<div class="viewcode-block" id="get_PolyFromPolyFileObj"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.get_PolyFromPolyFileObj">[docs]</a><span class="k">def</span> <span class="nf">get_PolyFromPolyFileObj</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span> <span class="n">SavePathInp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shape0</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a polygon as a np.ndarray, extracted from a txt file or from a ToFu object, with appropriate units</span>

<span class="sd">    Useful for :meth:`tofu.plugins.AUG.Ves._create()`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    PolyFileObj :   str / :mod:`tofu.geom` object / np.ndarray</span>
<span class="sd">        The source where the polygon is to be found, either:</span>
<span class="sd">            - str: the name of a file containing the coorindates of a polygon to be loaded with :meth:`numpy.loadtxt()`</span>
<span class="sd">            - A :mod:`tofu.geom` object: with attribute &#39;Poly&#39;</span>
<span class="sd">            - np.ndarray: an 2-dimensional array containing the 2D cartesian coordinates of a polygon</span>
<span class="sd">    SavePathInp :   str / None</span>
<span class="sd">        The absolute path where the input file is stored</span>
<span class="sd">    units :         str</span>
<span class="sd">        Flag indicating in which units the polygon coordinates is expressed in the input file / object / array (will be converted to meters)</span>
<span class="sd">    comments :      str</span>
<span class="sd">        Parameter to be fed to :meth:`numpy.loadtxt()` if PolyFileObj is a file name</span>
<span class="sd">    skiprows :      int</span>
<span class="sd">        Parameter to be fed to :meth:`numpy.loadtxt()` if PolyFileObj is a file name</span>
<span class="sd">    shape0 :          int</span>
<span class="sd">        Specifies whether the loaded array is a (2,N) or (3,N) array (transposed it if necessary)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Poly :          np.ndarray</span>
<span class="sd">        (2,N) np.ndarray containing the 2D cartesian coordinates of the polygon, where N is the number of points</span>
<span class="sd">    addInfo :       dict</span>
<span class="sd">        Dictionaryb containing information on the origin of the polygon, for the record (e.g.: the name and absolute path of the file from which it was extracted)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span><span class="s">&quot;Poly&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Arg PolyFileObj must be str (PathFileExt), a ToFu object with attribute Poly or an iterable convertible to 2d np.ndarray !&quot;</span>

    <span class="c"># Load PolyFileObj if file and check shape</span>
    <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">_get_PathFileExt_FromName</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span> <span class="n">Path</span><span class="o">=</span><span class="n">SavePathInp</span><span class="p">,</span> <span class="n">Lstr</span><span class="o">=</span><span class="p">[])</span>
        <span class="c"># Include PathFileExt in ID for tracability</span>
        <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Input&#39;</span><span class="p">:</span><span class="n">PathFileExt</span><span class="p">}</span>
        <span class="n">PolyFileObj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">,</span><span class="s">&quot;Poly&quot;</span><span class="p">):</span>
        <span class="n">addInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Input&#39;</span><span class="p">:</span><span class="n">PolyFileObj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">}</span>
        <span class="n">PolyFileObj</span> <span class="o">=</span> <span class="n">PolyFileObj</span><span class="o">.</span><span class="n">Poly</span>

    <span class="n">Poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PolyFileObj</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Poly</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">Poly</span><span class="o">.</span><span class="n">shape</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="n">Poly</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Poly</span><span class="p">)),</span> <span class="s">&quot;Arg np.asarray(PolyFileObj) must be a (2,N) or (N,2) np.ndarray with non NaNs !&quot;</span>
    <span class="n">Poly</span> <span class="o">=</span> <span class="n">Poly</span> <span class="k">if</span> <span class="n">Poly</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">shape0</span> <span class="k">else</span> <span class="n">Poly</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Poly</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">Poly</span><span class="p">,</span> <span class="n">In</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">addInfo</span></div>






<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                Generic input checking and retrieving</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_check_NotNone</span><span class="p">(</span><span class="n">Dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">,</span> <span class="s">&quot;Arg &quot;</span><span class="o">+</span><span class="n">aa</span><span class="o">+</span><span class="s">&quot; must not be None !&quot;</span>


<span class="k">def</span> <span class="nf">_get_FromItself</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Dict</span><span class="p">[</span><span class="n">aa</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">aa</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
    <span class="k">return</span> <span class="n">Dict</span>




<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">                ID Class and naming</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="ID"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID">[docs]</a><span class="k">class</span> <span class="nc">ID</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A class used by all ToFu objects as an attribute, storing all relevant data for the identification of created instances and providing default path and names for saving objects</span>

<span class="sd">    Each detector created in ToFu should be identifiable thanks to user-friendly criteria, like its name, the diagnostic and experiment it is attached to, the shot number from from it was physically installed on the experiement...</span>
<span class="sd">    Users can also freely add some information they consider relevant, such as some characteristics of the detector (size, manufacturer, date of last calibration...)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Cls :       str</span>
<span class="sd">        Flag indicating which class is the object fro which the ID instance is being created, available class flags are:</span>
<span class="sd">            - From :mod:`tofu.geom`: &#39;Ves&#39;, &#39;Struct&#39;, &#39;LOS&#39;, &#39;GLOS&#39;, &#39;Apert&#39;, &#39;Lens&#39;, &#39;Detect&#39; and &#39;GDetect&#39;</span>
<span class="sd">            - From :mod:`tofu.mesh`: &#39;Mesh1D&#39;, &#39;Mesh2D&#39;, &#39;LBF1D&#39; and &#39;LBF2D&#39; (to be finished)</span>
<span class="sd">            - From :mod:`tofu.`: (to be completed)</span>
<span class="sd">    Name :      str</span>
<span class="sd">        Name to be assigned to the created instance, should be a str without &#39; &#39; or &#39;_&#39; (spaces and underscores will be automatically removed if present)</span>
<span class="sd">    Type :      None / str</span>
<span class="sd">        If provided (necessary for some objects, but not for all), specifies the Type of object (i.e.: &#39;Tor&#39; or &#39;Lin&#39; for a Ves instance)</span>
<span class="sd">    Deg :       None / int</span>
<span class="sd">        If provided (necessary only for objects of class &#39;LBF1D&#39; and &#39;LBF2D&#39;), specifies the degree of the b-splines constituting the :mod:`tofu.mesh` object</span>
<span class="sd">    Exp :       None / str</span>
<span class="sd">        A short 3-4 letters max flag specifying the experiment to which the created instance belongs (e.g.: &#39;AUG&#39;, &#39;ITER&#39;, &#39;TCV&#39;, &#39;JET&#39;...)</span>
<span class="sd">    Diag :      None / str</span>
<span class="sd">        A short flag indicating which diagnostic the the created instance belongs to (e.g.: &#39;SXR&#39;, &#39;HXR&#39;, &#39;Bolo&#39;...)</span>
<span class="sd">    shot :      None / int</span>
<span class="sd">        A shot number from which the created instance can be considered valid (useful for tracking geometry changes in the case of Ves and Detect objects)</span>
<span class="sd">    SaveName :  None / str</span>
<span class="sd">        If provided, overrides the automatically generated name for saving the created instance (not recommended)</span>
<span class="sd">    SavePath :  None / str</span>
<span class="sd">        If provided, overrides the automatically generated path for saving the created instance</span>
<span class="sd">    USRdict :   None / dict</span>
<span class="sd">        If provided, a user-defined dictionary containing information about the instance considered relevant (e.g.: thickness of the diode, date of installation...)</span>
<span class="sd">    LObj :      None / dict / list</span>
<span class="sd">        If provided, either</span>
<span class="sd">            - list: list of other ID instances of objects on which the created object depends (this list will then be sorted by class and formatted into a dictionary storign key attributes)</span>
<span class="sd">            - dict: a ready-made such dictionary</span>
<span class="sd">    dtime :     None / dtm.datetime</span>
<span class="sd">        If provided, a time reference to be used to identify this particular instance (used for debugging mostly)</span>
<span class="sd">    dtFormat :  None / str</span>
<span class="sd">        If provided, the format in which dtime should be written in the automatically generated saving name for the created instance</span>
<span class="sd">    dtimeIn :   bool</span>
<span class="sd">        Flag indicating whether the dtm.datetime should be included in the automatically generated saving name for the created instance</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Id          ID instance</span>
<span class="sd">        The created ID instance, with all necessary computed attributes and methods</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Cls</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">SavePath</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">USRdict</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">LObj</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">TFDdtmFormat</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Exp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Exp must be a str !&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Cls must be a str !&quot;</span>
        <span class="k">assert</span> <span class="n">shot</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">,</span> <span class="s">&quot;Arg shot must be a int !&quot;</span>
        <span class="k">assert</span> <span class="n">Diag</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Diag</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Diag must be a str !&quot;</span>
        <span class="k">assert</span> <span class="n">Type</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Type</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Type must be a str !&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span> <span class="o">=</span> <span class="n">Exp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Cls</span> <span class="o">=</span> <span class="n">Cls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span> <span class="o">=</span> <span class="n">Type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span> <span class="o">=</span> <span class="n">Deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span> <span class="o">=</span> <span class="n">Diag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shot</span> <span class="o">=</span> <span class="n">shot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_dtime</span><span class="p">(</span><span class="n">dtime</span><span class="o">=</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">dtFormat</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">dtimeIn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Name</span><span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_SavePath</span><span class="p">(</span><span class="n">SavePath</span><span class="o">=</span><span class="n">SavePath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_LObj</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_USRdict</span><span class="p">(</span><span class="n">USRdict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_dtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dtime</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">TFDdtmFormat</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">dtime</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="p">),</span> <span class="s">&quot;Arg dtime must be a dtm.datetime instance !&quot;</span>
        <span class="k">if</span> <span class="n">dtime</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtime</span> <span class="o">=</span> <span class="n">dtime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtFormat</span> <span class="o">=</span> <span class="n">dtFormat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtimeIn</span> <span class="o">=</span> <span class="n">dtimeIn</span>

<div class="viewcode-block" id="ID.set_Name"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID.set_Name">[docs]</a>    <span class="k">def</span> <span class="nf">set_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the Name of the created instance, automatically updating the SaveName</span>

<span class="sd">        When the name is changed (reminding it should not include space (&#39; &#39;) or underscore (&#39;_&#39;) characters), the name used for saving the object is automatically changed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Name :      str</span>
<span class="sd">            Name to be assigned to the created instance, should be a str without &#39; &#39; or &#39;_&#39; (spaces and underscores will be automatically removed if present)</span>
<span class="sd">        SaveName :  None / str</span>
<span class="sd">            If provided, overrides the automatically generated name for saving the created instance (not recommended)</span>
<span class="sd">        dtimeIn :   None / bool</span>
<span class="sd">            If provided, modifies the value of dtimeIn provided upon creation of the ID object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;ID.Name must be assigned to a str !&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span> <span class="o">=</span> <span class="n">Name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_SaveName</span><span class="p">(</span><span class="n">SaveName</span><span class="o">=</span><span class="n">SaveName</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">dtimeIn</span><span class="p">)</span></div>

<div class="viewcode-block" id="ID.set_SaveName"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID.set_SaveName">[docs]</a>    <span class="k">def</span> <span class="nf">set_SaveName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">SaveName</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enables either to automatically compute a ToFu-consistent saving name for the created instance, or to override that default saving name with the user-provided SaveName</span>

<span class="sd">        When creating an object of any class, an ID object is assigned to it that automatically computes a saving name in case the user wants to save the object.</span>
<span class="sd">        This automatically generated saving name includes not only the name given to the instance but also useful classifying info such as the class of the object, its Type, experiment, diagnostic...</span>
<span class="sd">        It is not recommended to override this automatically generated saving name (because some routines rely on it for fast identification of saved files), but it is made possible for flexibility.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        SaveName :  None / str</span>
<span class="sd">            If provided, a str that overrides the automatically generated saving name</span>
<span class="sd">        dtimeIn :   None / bool</span>
<span class="sd">            If provided, modifies the value of dtimeIn provided upon creation of the ID object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">SaveName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;ID.SaveName must be assigned to a str !&quot;</span>
        <span class="n">dtimeIn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtimeIn</span> <span class="k">if</span> <span class="n">dtimeIn</span> <span class="ow">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">dtimeIn</span>
        <span class="k">if</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span> <span class="o">=</span> <span class="n">SaveName_Conv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cls</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Deg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_shot</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtime</span><span class="p">,</span> <span class="n">Format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">dtimeIn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span> <span class="o">=</span> <span class="n">SaveName</span></div>

<div class="viewcode-block" id="ID.set_SavePath"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID.set_SavePath">[docs]</a>    <span class="k">def</span> <span class="nf">set_SavePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">SavePath</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Enables to automatically generate a saving path for the created object, or to override that default path with the user-provided SavePath</span>

<span class="sd">        Similarily to SaveName, ToFu automatically generates a saving path for any created object.</span>
<span class="sd">        This saving path can be overriden if desired.</span>
<span class="sd">        This is less crucial than SaveName, changing the SavePath has little consequences as long as you remember what you are doing.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        SavePath :  None / str</span>
<span class="sd">            If provided, a str that overrides the automatically generated saving path</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">SavePath</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">SavePath</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;ID.SavePath must be assigned to a str !&quot;</span>
        <span class="k">if</span> <span class="n">SavePath</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">SavePath</span> <span class="o">=</span> <span class="n">Find_Rootpath</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;/Objects_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Exp</span><span class="o">+</span><span class="s">&#39;/&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PreData&#39;</span><span class="p">,</span><span class="s">&#39;Sol2D&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">Find_Rootpath</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;/Outputs_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Exp</span><span class="o">+</span><span class="s">&#39;/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SavePath</span> <span class="o">=</span> <span class="n">SavePath</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;//&#39;</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ID.set_LObj"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID.set_LObj">[docs]</a>    <span class="k">def</span> <span class="nf">set_LObj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">LObj</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the LObj attribute to store the list of ID of other objects the created instance depends on</span>

<span class="sd">        A Detect object depends on a vessel and some optics (e.g.: a list of apertures).</span>
<span class="sd">        It is necessary that the link between the created Detect object and the already-existing Ves and Apert objects be stored somewhere, so that even after saving and closing the session, this correspondence can be retrieved and the Detect object can be re-loaded with links to the proper Ves and Apert objects, themselves beoing possibly saved elsewhere (so their respective SavePath must also be stored).</span>
<span class="sd">        The LObj parameter does this: it stores all information necessary about each of the other objects the created instance depends on, mostly by storing their ID attributes as dictionaries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        LObj :  None / dict / list</span>
<span class="sd">            If provided, either</span>
<span class="sd">                - list: list of other ID instances of objects on which the created object depends (this list will then be sorted by class and formatted into a dictionary storign key attributes)</span>
<span class="sd">                - dict: a ready-made such dictionary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">LObj</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">oo</span><span class="p">,</span><span class="n">ID</span><span class="p">)</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span><span class="p">])),</span> <span class="s">&quot;Arg LObj must be a list of ID instances !&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">LCls</span> <span class="o">=</span> <span class="p">[</span><span class="n">oo</span><span class="o">.</span><span class="n">Cls</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span><span class="p">]</span>
            <span class="n">ClsU</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">LCls</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="n">ClsU</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="p">[</span><span class="n">Cls</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Exp&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">Exp</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;Name&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">Name</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;SaveName&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">SaveName</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span>
                        <span class="s">&#39;SavePath&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">SavePath</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;Type&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">Type</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;Diag&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">Diag</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span>
                        <span class="s">&#39;shot&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">shot</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span>
                        <span class="s">&#39;dtFormat&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">_dtFormat</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;dtime&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">dtime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">oo</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">)</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span>
                        <span class="s">&#39;USRdict&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">_USRdict</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">],</span> <span class="s">&#39;LObj&#39;</span><span class="p">:[</span><span class="n">oo</span><span class="o">.</span><span class="n">_LObj</span> <span class="k">for</span> <span class="n">oo</span> <span class="ow">in</span> <span class="n">LObj</span> <span class="k">if</span> <span class="n">oo</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="n">Cls</span><span class="p">]}</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">LObj</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span> <span class="o">=</span> <span class="n">LObj</span></div>

    <span class="k">def</span> <span class="nf">get_LObjasLId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Cls</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Cls</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">Cls</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="n">Cls</span> <span class="o">=</span> <span class="p">[</span><span class="n">Cls</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Cls</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">Cls</span>
        <span class="n">DId</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Cls</span><span class="p">)):</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="p">[</span><span class="n">Cls</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="p">[</span><span class="n">Cls</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="s">&#39;Exp&#39;</span><span class="p">])):</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">dd</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span><span class="p">[</span><span class="n">Cls</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s">&#39;dtime&#39;</span><span class="p">]</span>
                <span class="n">lid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">Cls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">dd</span><span class="p">))</span>
            <span class="n">DId</span><span class="p">[</span><span class="n">Cls</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lid</span>
        <span class="k">return</span> <span class="n">DId</span>


<div class="viewcode-block" id="ID.set_USRdict"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.ID.set_USRdict">[docs]</a>    <span class="k">def</span> <span class="nf">set_USRdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">USRdict</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the USRdict to enable the user to store arbitrary information about the instance created</span>

<span class="sd">        It may sometimes be useful to store unforeseen arbitrary info about some objects created, like the manufacturing date of a diode, the material used for a filter...</span>
<span class="sd">        The USRdict attribute is a user-defined dictionary for this purpose.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        USRdict :   None / dict</span>
<span class="sd">            If provided, a user-defined dictionary containing information about the instance considered relevant (e.g.: thickness of the diode, date of installation...)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">USRdict</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">USRdict</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">,</span> <span class="s">&quot;Arg USRdict must be a dictionnary !&quot;</span>
        <span class="n">USRdict</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">USRdict</span> <span class="ow">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">USRdict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_USRdict</span> <span class="o">=</span> <span class="n">USRdict</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Cls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Cls</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Name</span>
    <span class="nd">@Name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Name</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">NameLTX</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;$&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="s">&#39;\_&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">r&quot;$&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Diag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Diag</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shot</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Type</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SaveName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SaveName</span>
    <span class="nd">@SaveName</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">SaveName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_SaveName</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">SavePath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SavePath</span>
    <span class="nd">@SavePath</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">SavePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_SavePath</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtime</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Exp</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">LObj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LObj</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">USRdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_USRdict</span>
    <span class="nd">@USRdict</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">USRdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_USRdict</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">todict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_Id_todict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">SaveName_Conv</span><span class="p">(</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Cls</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Deg</span><span class="p">,</span> <span class="n">Diag</span><span class="p">,</span> <span class="n">Name</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Format</span><span class="o">=</span><span class="s">&quot;D%Y%m%d_T%H%M%S&quot;</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a default name for saving the object, including key info for fast identification of the object class, type, experiement...</span>

<span class="sd">    When create a ToFu object, this function called by the ID class to generate a default name for saving the object.</span>
<span class="sd">    This automatically generated name includes all key info about the object, in addition to its user-defined name.</span>
<span class="sd">    It is recommended to use this default name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Exp :       None / str</span>
<span class="sd">        A short 3-4 letters max flag specifying the experiment to which the created instance belongs (e.g.: &#39;AUG&#39;, &#39;ITER&#39;, &#39;TCV&#39;, &#39;JET&#39;...)</span>
<span class="sd">    Cls :       None / str</span>
<span class="sd">        Flag indicating which class is the object fro which the ID instance is being created, available class flags are:</span>
<span class="sd">            - From :mod:`tofu.geom`: &#39;Ves&#39;, &#39;Struct&#39;, &#39;LOS&#39;, &#39;GLOS&#39;, &#39;Apert&#39;, &#39;Lens&#39;, &#39;Detect&#39; and &#39;GDetect&#39;</span>
<span class="sd">            - From :mod:`tofu.mesh`: &#39;Mesh1D&#39;, &#39;Mesh2D&#39;, &#39;LBF1D&#39; and &#39;LBF2D&#39; (to be finished)</span>
<span class="sd">            - From :mod:`tofu.`: (to be completed)</span>
<span class="sd">    Type :      None / str</span>
<span class="sd">        If provided (necessary for some objects, but not for all), specifies the Type of object (i.e.: &#39;Tor&#39; or &#39;Lin&#39; for a Ves instance)</span>
<span class="sd">    Deg :       None / int</span>
<span class="sd">        If provided (necessary only for objects of class &#39;LBF1D&#39; and &#39;LBF2D&#39;), specifies the degree of the b-splines constituting the :mod:`tofu.mesh` object</span>
<span class="sd">    Diag :      None / str</span>
<span class="sd">        A short flag indicating which diagnostic the the created instance belongs to (e.g.: &#39;SXR&#39;, &#39;HXR&#39;, &#39;Bolo&#39;...)</span>
<span class="sd">    Name :      str</span>
<span class="sd">        Name to be assigned to the created instance, should be a str without &#39; &#39; or &#39;_&#39; (spaces and underscores will be automatically removed if present)</span>
<span class="sd">    shot :      None / int</span>
<span class="sd">        A shot number from which the created instance can be considered valid (useful for tracking geometry changes in the case of Ves and Detect objects)</span>
<span class="sd">    dtime :     None / dtm.datetime</span>
<span class="sd">        If provided, a time reference to be used to identify this particular instance (used for debugging mostly)</span>
<span class="sd">    Format :    None / str</span>
<span class="sd">        If provided, the format in which dtime should be written in the automatically generated saving name for the created instance</span>
<span class="sd">    dtimeIn :   bool</span>
<span class="sd">        Flag indicating whether the dtm.datetime should be included in the automatically generated saving name for the created instance</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SVN :       str</span>
<span class="sd">        The automatically generated saving name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">,</span><span class="s">&#39;Struct&#39;</span><span class="p">,</span><span class="s">&#39;LOS&#39;</span><span class="p">,</span><span class="s">&#39;GLOS&#39;</span><span class="p">,</span><span class="s">&#39;Lens&#39;</span><span class="p">,</span><span class="s">&#39;Apert&#39;</span><span class="p">,</span><span class="s">&#39;Detect&#39;</span><span class="p">,</span><span class="s">&#39;GDetect&#39;</span><span class="p">]:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFG&#39;</span>
    <span class="k">elif</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Mesh1D&#39;</span><span class="p">,</span><span class="s">&#39;Mesh2D&#39;</span><span class="p">,</span><span class="s">&#39;Mesh3D&#39;</span><span class="p">,</span><span class="s">&#39;LBF1D&#39;</span><span class="p">,</span><span class="s">&#39;LBF2D&#39;</span><span class="p">,</span><span class="s">&#39;LBF3D&#39;</span><span class="p">]:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFM&#39;</span>
    <span class="k">elif</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Eq2D&#39;</span><span class="p">]:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFEq&#39;</span>
    <span class="k">elif</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;GMat2D&#39;</span><span class="p">,</span><span class="s">&#39;GMat3D&#39;</span><span class="p">]:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFMC&#39;</span>
    <span class="k">elif</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Corresp&#39;</span><span class="p">,</span><span class="s">&#39;PreData&#39;</span><span class="p">]:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFT&#39;</span>
    <span class="k">elif</span> <span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Sol2D&#39;</span><span class="p">:</span>
        <span class="n">Mod</span> <span class="o">=</span> <span class="s">&#39;TFI&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">ClsType</span> <span class="o">=</span> <span class="n">Cls</span> <span class="k">if</span> <span class="n">Type</span> <span class="ow">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">Cls</span><span class="o">+</span><span class="n">Type</span>
    <span class="k">if</span> <span class="n">Cls</span><span class="o">==</span><span class="s">&#39;PreData&#39;</span><span class="p">:</span>
        <span class="n">Elts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ClsType</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),(</span><span class="n">Exp</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),(</span><span class="n">Deg</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">),(</span><span class="n">Diag</span><span class="p">,</span><span class="s">&#39;Dg&#39;</span><span class="p">),(</span><span class="n">shot</span><span class="p">,</span><span class="s">&#39;sh&#39;</span><span class="p">),(</span><span class="n">Name</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Elts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ClsType</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),(</span><span class="n">Exp</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),(</span><span class="n">Deg</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">),(</span><span class="n">Diag</span><span class="p">,</span><span class="s">&#39;Dg&#39;</span><span class="p">),(</span><span class="n">Name</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),(</span><span class="n">shot</span><span class="p">,</span><span class="s">&#39;sh&#39;</span><span class="p">)]</span>
    <span class="n">SVN</span> <span class="o">=</span> <span class="n">Mod</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Elts</span><span class="p">)):</span>
        <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">Elts</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Elts</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">Elts</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">SVN</span>
    <span class="k">if</span> <span class="n">dtimeIn</span><span class="p">:</span>
        <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">dtime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">Format</span><span class="p">)</span>
    <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Cls</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PreData&#39;</span><span class="p">,</span><span class="s">&#39;Sol2D&#39;</span><span class="p">]:</span>
        <span class="n">SVN</span> <span class="o">=</span> <span class="n">SVN</span> <span class="o">+</span> <span class="s">&#39;_U&#39;</span> <span class="o">+</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">SVN</span>


<span class="c"># Checking several instances are the same object</span>
<div class="viewcode-block" id="CheckSameObj"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.CheckSameObj">[docs]</a><span class="k">def</span> <span class="nf">CheckSameObj</span><span class="p">(</span><span class="n">obj0</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">LFields</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check two variable refer to the same instance of a ToFu class by checking some key attributes</span>

<span class="sd">    Sometimes two different variables can refer to the same instance (for example if an object was created and assigned to obj0, then later saved and loaded and assigned to obj1).</span>
<span class="sd">    Occasionally it may be useful to check whether two variables really represent the same instance, according to important criteria from the point of view of ToFu.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj0 :      tofu object</span>
<span class="sd">        A variable refering to a ToFu object of any class</span>
<span class="sd">    obj1 :      tofu object</span>
<span class="sd">        A variable refering to a ToFu object of any class (but the same class as obj0)</span>
<span class="sd">    LFields :   None / str / list</span>
<span class="sd">        The criteria against which the two objects are evaluated, if not None, must be str matching an attribute of the ID class or an attribute of the object class itself (or a list of such)</span>
<span class="sd">            - None: True is returned</span>
<span class="sd">            - str or list: tests whether the attributes have the same value or not and only returns True if all do</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A :     bool</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">LFields</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">LFields</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">LFields</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">LFields</span><span class="p">])),</span> <span class="s">&quot;Arg LFields must be a str or a list of str !&quot;</span>
    <span class="k">if</span> <span class="n">LFields</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">LFields</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">LFields</span> <span class="o">=</span> <span class="p">[</span><span class="n">LFields</span><span class="p">]</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="k">False</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LFields</span><span class="p">))]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LFields</span><span class="p">)):</span>
        <span class="k">assert</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span><span class="o">+</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj0</span><span class="p">),</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; not in &quot;</span><span class="o">+</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s">&quot; !&quot;</span>
        <span class="k">assert</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span><span class="o">+</span><span class="nb">dir</span><span class="p">(</span><span class="n">obj1</span><span class="p">),</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; not in &quot;</span><span class="o">+</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="o">+</span><span class="s">&quot; !&quot;</span>
        <span class="k">if</span> <span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj0</span><span class="p">):</span>
            <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj0</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">==</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj1</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj0</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">==</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj1</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span><span class="n">LFields</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">A</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span></div>


<span class="k">def</span> <span class="nf">SelectFromIdLObj</span><span class="p">(</span><span class="n">IdLObjCls</span><span class="p">,</span> <span class="n">Val</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Crit</span><span class="o">=</span><span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="n">PreExp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">PostExp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Log</span><span class="o">=</span><span class="s">&#39;any&#39;</span><span class="p">,</span> <span class="n">InOut</span><span class="o">=</span><span class="s">&#39;In&#39;</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; To do (deprecated ?)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Crit</span><span class="p">])),</span> <span class="s">&quot;Arg Crit must be a str or list of str !&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">rr</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]))</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">,</span><span class="n">PostExp</span><span class="p">]]),</span> <span class="s">&quot;Args PreExp and PostExp must be a str or list of str !&quot;</span>
    <span class="k">assert</span> <span class="n">Log</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;any&#39;</span><span class="p">,</span><span class="s">&#39;all&#39;</span><span class="p">],</span> <span class="s">&quot;Arg Log must be in [&#39;and&#39;,&#39;or&#39;] !&quot;</span>
    <span class="k">assert</span> <span class="n">InOut</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;In&#39;</span><span class="p">,</span><span class="s">&#39;Out&#39;</span><span class="p">],</span> <span class="s">&quot;Arg InOut must be in [&#39;In&#39;,&#39;Out&#39;] !&quot;</span>
    <span class="n">NObj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IdLObjCls</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">Val</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">NObj</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">Val</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">Val</span><span class="o">=</span><span class="p">[</span><span class="n">Val</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">NObj</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">idd</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">IdLObjCls</span><span class="p">[</span><span class="n">Crit</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">idd</span><span class="p">[</span><span class="n">Crit</span><span class="p">]</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">IdLObjCls</span><span class="p">[</span><span class="s">&#39;USRdict&#39;</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PostExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PreExp</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">PostExp</span><span class="p">),</span> <span class="s">&quot;Arg Exp must be a list of same length as Crit !&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">NObj</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; idd &quot;</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">IdLObjCls</span><span class="p">[</span><span class="n">Crit</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; idd[Crit] &quot;</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">idd</span> <span class="ow">in</span> <span class="n">IdLObjCls</span><span class="p">[</span><span class="s">&#39;USRdict&#39;</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">Log</span><span class="o">==</span><span class="s">&#39;any&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">InOut</span><span class="o">==</span><span class="s">&#39;Out&#39;</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="o">~</span><span class="n">ind</span>
    <span class="k">if</span> <span class="n">Out</span><span class="o">==</span><span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ind</span>
    <span class="k">elif</span> <span class="n">Out</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Out</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">IdLObjCls</span><span class="p">[</span><span class="n">Out</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">IdLObjCls</span><span class="p">[</span><span class="s">&#39;USRdict&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="n">Out</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>



<span class="k">def</span> <span class="nf">SelectFromListId</span><span class="p">(</span><span class="n">LId</span><span class="p">,</span> <span class="n">Val</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Crit</span><span class="o">=</span><span class="s">&#39;Name&#39;</span><span class="p">,</span> <span class="n">PreExp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">PostExp</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Log</span><span class="o">=</span><span class="s">&#39;any&#39;</span><span class="p">,</span> <span class="n">InOut</span><span class="o">=</span><span class="s">&#39;In&#39;</span><span class="p">,</span> <span class="n">Out</span><span class="o">=</span><span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Select the ID instances in the provided list that match the criteria and return their index or other attributes</span>

<span class="sd">    Return</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    LId :       list</span>

<span class="sd">    Val :       None / str / list</span>

<span class="sd">    Crit :      str</span>

<span class="sd">    PreExp :    None / str</span>

<span class="sd">    PostExp :   None / str</span>

<span class="sd">    Log :       str</span>

<span class="sd">    InOut :     str</span>

<span class="sd">    Out :       type / str</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ind :       np.ndarray / list</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Crit</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">Crit</span><span class="p">])),</span> <span class="s">&quot;Arg Crit must be a str or list of str !&quot;</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">rr</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">]))</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">,</span><span class="n">PostExp</span><span class="p">]]),</span> <span class="s">&quot;Args PreExp and PostExp must be a str or list of str !&quot;</span>
    <span class="k">assert</span> <span class="n">Log</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;any&#39;</span><span class="p">,</span><span class="s">&#39;all&#39;</span><span class="p">],</span> <span class="s">&quot;Arg Log must be in [&#39;any&#39;,&#39;all&#39;] !&quot;</span>
    <span class="k">assert</span> <span class="n">InOut</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;In&#39;</span><span class="p">,</span><span class="s">&#39;Out&#39;</span><span class="p">],</span> <span class="s">&quot;Arg InOut must be in [&#39;In&#39;,&#39;Out&#39;] !&quot;</span>
    <span class="k">if</span> <span class="n">Val</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">Val</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">Val</span><span class="o">=</span><span class="p">[</span><span class="n">Val</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Val</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span><span class="n">Crit</span><span class="p">)</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">iid</span><span class="o">.</span><span class="n">USRdict</span><span class="p">[</span><span class="n">Crit</span><span class="p">]</span><span class="o">==</span><span class="n">Val</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PreExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">PostExp</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PreExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">PreExp</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PostExp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">PostExp</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">PostExp</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">PreExp</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">PostExp</span><span class="p">),</span> <span class="s">&quot;Arg Exp must be a list of same length as Crit !&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">PreExp</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LId</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Crit</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">ID</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; getattr(iid,Crit) &quot;</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="n">ind</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="nb">eval</span><span class="p">(</span><span class="n">PreExp</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; iid.USRdict[Crit] &quot;</span><span class="o">+</span><span class="n">PostExp</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">iid</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">Log</span><span class="o">==</span><span class="s">&#39;any&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">InOut</span><span class="o">==</span><span class="s">&#39;Out&#39;</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="o">~</span><span class="n">ind</span>
    <span class="k">if</span> <span class="n">Out</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">Out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="n">Out</span><span class="p">):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">LId</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">Out</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">Out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="n">Out</span> <span class="ow">in</span> <span class="n">LId</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">USRdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">LId</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">USRdict</span><span class="p">[</span><span class="n">Out</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">ind</span>



<span class="k">def</span> <span class="nf">_Id_todict</span><span class="p">(</span><span class="n">Id</span><span class="p">):</span>
    <span class="n">IdTxt</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Cls&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="p">,</span> <span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&#39;SaveName&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span> <span class="s">&#39;SavePath&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="s">&#39;Diag&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="s">&#39;shot&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="s">&#39;Exp&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">}</span>
    <span class="n">Iddtime</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dtime&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="s">&#39;dtFormat&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">,</span> <span class="s">&#39;dtimeIn&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">}</span>
    <span class="n">IdLobjUsr</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;LObj&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">,</span> <span class="s">&#39;USRdict&#39;</span><span class="p">:</span><span class="n">Id</span><span class="o">.</span><span class="n">USRdict</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">IdTxt</span><span class="p">,</span><span class="n">Iddtime</span><span class="p">,</span><span class="n">IdLobjUsr</span><span class="p">]</span>




<span class="k">def</span> <span class="nf">_Id_recreateFromdict</span><span class="p">(</span><span class="n">IdS</span><span class="p">):</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="n">Cls</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Cls&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Type&#39;</span><span class="p">],</span> <span class="n">Exp</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Exp&#39;</span><span class="p">],</span> <span class="n">Diag</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Diag&#39;</span><span class="p">],</span> <span class="n">shot</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;shot&#39;</span><span class="p">],</span> <span class="n">Name</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">],</span> <span class="n">SaveName</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">],</span> <span class="n">SavePath</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">],</span>
            <span class="n">dtime</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;dtime&#39;</span><span class="p">],</span> <span class="n">dtFormat</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;dtFormat&#39;</span><span class="p">],</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;dtimeIn&#39;</span><span class="p">],</span>
            <span class="n">LObj</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;LObj&#39;</span><span class="p">],</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">IdS</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="s">&#39;USRdict&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Id</span>





<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">        Saving and loading ToFu objects with numpy and cPickle</span>
<span class="sd">###############################################################################</span>
<span class="sd">###############################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c">###########################</span>
<span class="c">#   IDentify a Sol2D file</span>
<span class="c">###########################</span>

<span class="k">def</span> <span class="nf">FindSolFile</span><span class="p">(</span><span class="n">shot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="s">&#39;Rough1&#39;</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Deriv</span><span class="o">=</span><span class="s">&#39;D2N2&#39;</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="s">&#39;/afs/ipp-garching.mpg.de/home/d/didiv/Python/tofu/src/Outputs_AUG/&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Identify the good Sol2D saved file in a given folder (OutPath), based on key ToFu criteria</span>

<span class="sd">    When trying to load a Sol2D object (i.e.: solution of a tomographic inversion), it may be handy to provide the key parameters (shot, time, mesh name, degree of basis functions, regularisation functional) instead of copy-pasting the full file name.</span>
<span class="sd">    This function identifies, within the relevant repository (OutPath), the files matching the provided criteria.</span>
<span class="sd">    This function only works of the automatically generated default SaveName was preserved for the Sol2D objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shot :      int</span>
<span class="sd">        A shot number</span>
<span class="sd">    t :         None / int / float</span>
<span class="sd">        A time value that must be contained in the time interval of the Sol2D file, must be provided if Dt is None</span>
<span class="sd">    Dt :        None / iterable</span>
<span class="sd">        A time interval that the Sol2D file has to match, must be provided if t is None</span>
<span class="sd">    Mesh :      str</span>
<span class="sd">        The name of the mesh that was used to compute the inversion</span>
<span class="sd">    Deg :       int</span>
<span class="sd">        The of the b-splines (LBF2D object) that were used to discretize the solution</span>
<span class="sd">    Deriv :     str</span>
<span class="sd">        The flag indicating the regularization functional that was used for the inversion</span>
<span class="sd">    Sep :       bool</span>
<span class="sd">        The flag value that was used for indicating whether the boundary constraint at the separatrix should be considered</span>
<span class="sd">    Pos :       bool</span>
<span class="sd">        The flag value that was used for indicating whether the positivity constraint was considered</span>
<span class="sd">    Outpath :   str</span>
<span class="sd">        The absolute path of the repository where to look</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out :       None / str</span>
<span class="sd">        The matching file name, if any</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="k">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">Dt</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">t</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">Dt</span> <span class="ow">is</span> <span class="k">None</span><span class="p">),</span> <span class="s">&quot;Arg t or Dt must be None, but not both !&quot;</span>
    <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">OutPath</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;TFI_Sol2D_AUG_SXR&#39;</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">]</span>
    <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">LF</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">ss</span> <span class="ow">in</span> <span class="n">ff</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">shot</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">Mesh</span><span class="o">+</span><span class="s">&#39;_D&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Deg</span><span class="p">),</span> <span class="s">&#39;_Deriv&#39;</span><span class="o">+</span><span class="n">Deriv</span><span class="o">+</span><span class="s">&#39;_Sep&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Sep</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;_Pos&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Pos</span><span class="p">)]])]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s">&quot;No matching Sol2D file in &quot;</span><span class="p">,</span> <span class="n">OutPath</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">None</span>
    <span class="n">LDTstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="n">ff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;_Dt&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">:</span><span class="n">ff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;s_&#39;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">LF</span><span class="p">]</span>
    <span class="n">LDTstr</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ss</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span><span class="n">ss</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">LDTstr</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">LF</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">))</span> <span class="k">if</span> <span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;{0:07.4f}-{1:07.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Dt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">elif</span> <span class="n">Dt</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">LF</span> <span class="o">=</span> <span class="p">[</span><span class="n">LF</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">))</span> <span class="k">if</span> <span class="n">t</span><span class="o">&gt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">t</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">LDTstr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">])]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s">&quot;No matching Sol2D file in &quot;</span><span class="p">,</span> <span class="n">OutPath</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">LF</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s">&quot;Several matching Sol2D files in &quot;</span><span class="p">,</span> <span class="n">OutPath</span>
        <span class="nb">print</span> <span class="n">LF</span>
        <span class="n">out</span> <span class="o">=</span> <span class="k">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">LF</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>



<span class="k">def</span> <span class="nf">_get_ClsFromName</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg PathFileExt must be a str !&quot;</span>
    <span class="n">LCls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">,</span><span class="s">&#39;LOS&#39;</span><span class="p">,</span><span class="s">&#39;GLOS&#39;</span><span class="p">,</span><span class="s">&#39;Apert&#39;</span><span class="p">,</span><span class="s">&#39;Lens&#39;</span><span class="p">,</span><span class="s">&#39;Detect&#39;</span><span class="p">,</span><span class="s">&#39;GDetect&#39;</span><span class="p">,</span><span class="s">&#39;Mesh1D&#39;</span><span class="p">,</span><span class="s">&#39;Mesh2D&#39;</span><span class="p">,</span><span class="s">&#39;BF1D&#39;</span><span class="p">,</span><span class="s">&#39;BF2D&#39;</span><span class="p">,</span><span class="s">&#39;PreData&#39;</span><span class="p">,</span><span class="s">&#39;Sol2D&#39;</span><span class="p">]</span>
    <span class="n">Found</span> <span class="o">=</span> <span class="k">False</span>
    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">LCls</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;_&#39;</span><span class="o">+</span><span class="n">nn</span><span class="o">+</span><span class="s">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">PathFileExt</span><span class="p">:</span>
            <span class="n">Found</span> <span class="o">=</span> <span class="k">True</span>
            <span class="k">break</span>
    <span class="k">assert</span> <span class="n">Found</span><span class="p">,</span> <span class="s">&quot;Class could not be identified in &quot;</span><span class="o">+</span><span class="n">PathFileExt</span>
    <span class="k">return</span> <span class="n">nn</span>



<span class="c">###########################</span>
<span class="c">#   Saving</span>
<span class="c">###########################</span>


<div class="viewcode-block" id="Save_Generic"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.Save_Generic">[docs]</a><span class="k">def</span> <span class="nf">Save_Generic</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">SaveName</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Path</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Mode</span><span class="o">=</span><span class="s">&#39;npz&#39;</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Save a ToFu object under file name SaveName, in folder Path, using specified mode</span>

<span class="sd">    ToFu provides built-in saving and loading functions for ToFu objects.</span>
<span class="sd">    They can be saved at their default SavePath under their default SaveName or user-defined values can be forced if necessary.</span>
<span class="sd">    Saving can be done in two ways :</span>
<span class="sd">        - by direct object saving using cPickle (straightforward but heavy)</span>
<span class="sd">        - by mapping the key object attributes to a dictionary and using :meth:`numpy.savez_compressed()` (faster and lighter, recommended)</span>

<span class="sd">    ToFu now automatically saves information on smaller objects on which the object of interest depends (like apertures for detectors), so that all info is stored in a single file.</span>
<span class="sd">    In particular, provided the Ves object is saved separately, a whole camera can be saved in a single file (i.e.: all detectors and apertures).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SaveName :      str</span>
<span class="sd">        The name to be used to for the saved file, if None (recommended) uses obj.Id.SaveName</span>
<span class="sd">    Path :          str</span>
<span class="sd">        Path specifying where to save the file, if None (recommended) uses obj.Id.SavePath</span>
<span class="sd">    Mode :          str</span>
<span class="sd">        Flag specifying whether to save the object as a numpy array file (&#39;.npz&#39;, recommended) or an object using cPickle (not recommended, may cause retro-compatibility issues with later versions)</span>
<span class="sd">    compressed :    bool</span>
<span class="sd">        Flag, used when Mode=&#39;npz&#39;, indicating whether to use np.savez or np.savez_compressed (slower saving and loading but smaller files)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Path</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">Path</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg Path must be a str !&quot;</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_Id</span><span class="o">.</span><span class="n">SavePath</span> <span class="o">=</span> <span class="n">Path</span>
    <span class="k">if</span> <span class="n">SaveName</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">SaveName</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">SaveName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">,</span> <span class="s">&quot;Arg SaveName must be a str !&quot;</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span> <span class="o">=</span> <span class="n">SaveName</span>
    <span class="n">Ext</span> <span class="o">=</span> <span class="s">&#39;.npz&#39;</span> <span class="k">if</span> <span class="s">&#39;npz&#39;</span> <span class="ow">in</span> <span class="n">Mode</span> <span class="k">else</span> <span class="s">&#39;.pck&#39;</span>
    <span class="n">pathfileext</span> <span class="o">=</span> <span class="n">Path</span><span class="o">+</span><span class="n">SaveName</span><span class="o">+</span><span class="n">Ext</span>
    <span class="k">if</span> <span class="s">&#39;.npz&#39;</span> <span class="ow">in</span> <span class="n">Ext</span><span class="p">:</span>
        <span class="n">_save_np</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathfileext</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="n">compressed</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_save_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathfileext</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&quot;Saved in :  &quot;</span><span class="o">+</span><span class="n">pathfileext</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_save_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pathfileext</span><span class="p">):</span>
    <span class="k">if</span> <span class="s">&#39;TFM&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">LFunc</span> <span class="o">=</span> <span class="k">None</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">pck</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">_convert_Detect2Ldict</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="c"># Store LOS data</span>
    <span class="n">llos</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">LOSprops</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Keys&#39;</span><span class="p">:</span><span class="n">llos</span><span class="p">,</span> <span class="s">&#39;Id&#39;</span><span class="p">:[</span><span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;LOS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">llos</span><span class="p">],</span> <span class="s">&#39;Du&#39;</span><span class="p">:[(</span><span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;LOS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">D</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;LOS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">llos</span><span class="p">]}</span>
    <span class="n">lprops</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">lprops</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pp</span><span class="o">==</span><span class="s">&#39;LOS&#39;</span><span class="p">:</span>
            <span class="n">LOSprops</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">LOS</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">pp</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">llos</span><span class="p">]</span>

    <span class="c"># Get all attributes</span>
    <span class="n">lAttr</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{},</span> <span class="p">{}</span>

    <span class="c"># Store Sino data</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">lAttr</span><span class="p">:</span>
        <span class="c">#print inspect.ismethod(getattr(obj,pp)), type(getattr(obj,pp)), pp</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s">&#39;_Sino&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">Sino</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_Span&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">Span</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_Cone&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">Cone</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_SAng&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">SAng</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_SynthDiag&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">SynthDiag</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_Res&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">Res</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>


    <span class="c"># Store Optics key parameters (for re-creating if not saved independantly)</span>
    <span class="n">Optics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Optics</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">OpticsType</span><span class="o">==</span><span class="s">&#39;Apert&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">Optics</span><span class="p">:</span>
                <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;Id&#39;</span><span class="p">:</span><span class="n">aa</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="s">&#39;Poly&#39;</span><span class="p">:</span><span class="n">aa</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="s">&#39;arrayorder&#39;</span><span class="p">:</span><span class="n">aa</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="s">&#39;Clock&#39;</span><span class="p">:</span><span class="n">aa</span><span class="o">.</span><span class="n">_Clock</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">OpticsType</span><span class="o">==</span><span class="s">&#39;Lens&#39;</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Optics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;Id&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">(),</span> <span class="s">&#39;O&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">O</span><span class="p">,</span> <span class="s">&#39;nIn&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">nIn</span><span class="p">,</span> <span class="s">&#39;Rad&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">Rad</span><span class="p">,</span> <span class="s">&#39;F1&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">F1</span><span class="p">,</span> <span class="s">&#39;F2&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">F2</span><span class="p">,</span> <span class="s">&#39;R1&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">R1</span><span class="p">,</span> <span class="s">&#39;R2&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">R2</span><span class="p">,</span> <span class="s">&#39;dd&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">dd</span><span class="p">,</span> <span class="s">&#39;Type&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="s">&#39;arrayorder&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="s">&#39;Clock&#39;</span><span class="p">:</span><span class="n">ln</span><span class="o">.</span><span class="n">_Clock</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">LOSprops</span><span class="p">,</span> <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Optics</span>



<span class="k">def</span> <span class="nf">_convert_PreData2Ldict</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="n">Init</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;data&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_dataRef</span><span class="p">,</span> <span class="s">&#39;t&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_tRef</span><span class="p">,</span> <span class="s">&#39;Chans&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_ChansRef</span><span class="p">,</span> <span class="s">&#39;DtRef&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_DtRef</span><span class="p">}</span>
    <span class="n">PhysNoiseParam</span> <span class="o">=</span> <span class="k">None</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">_PhysNoise</span> <span class="ow">is</span> <span class="k">None</span> <span class="k">else</span> <span class="n">obj</span><span class="o">.</span><span class="n">_PhysNoise</span><span class="p">[</span><span class="s">&#39;Param&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_NoiseModel</span><span class="p">[</span><span class="s">&#39;Par&#39;</span><span class="p">])</span>
    <span class="n">Update</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Dt&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">Dt</span><span class="p">,</span> <span class="s">&#39;Resamp_t&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_Resamp_t</span><span class="p">,</span> <span class="s">&#39;Resamp_f&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_Resamp_f</span><span class="p">,</span> <span class="s">&#39;Resamp_Method&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_Resamp_Method</span><span class="p">,</span> <span class="s">&#39;Resamp_interpkind&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_Resamp_interpkind</span><span class="p">,</span>
            <span class="s">&#39;indOut&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_indOut</span><span class="p">,</span> <span class="s">&#39;indCorr&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_indCorr</span><span class="p">,</span> <span class="s">&#39;interp_lt&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_interp_lt</span><span class="p">,</span> <span class="s">&#39;interp_lNames&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_interp_lNames</span><span class="p">,</span> <span class="s">&#39;Subtract_tsub&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_Subtract_tsub</span><span class="p">,</span>
            <span class="s">&#39;FFTPar&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_FFTPar</span><span class="p">,</span> <span class="s">&#39;PhysNoiseParam&#39;</span><span class="p">:</span><span class="n">PhysNoiseParam</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Init</span><span class="p">,</span> <span class="n">Update</span>



<span class="k">def</span> <span class="nf">_save_np</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">pathfileext</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span> <span class="k">if</span> <span class="n">compressed</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">savez</span>

    <span class="n">Idsave</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>

    <span class="c"># tofu.geom</span>
    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Ves&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">DLong</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">DLong</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span> <span class="n">Sino_NP</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_NP</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Struct&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">DLong</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">DLong</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;LOS&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">Du</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Du</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;GLOS&#39;</span><span class="p">:</span>
        <span class="n">LIdLOS</span> <span class="o">=</span> <span class="p">[</span><span class="n">ll</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">LLOS</span><span class="p">]</span>
        <span class="n">LDs</span><span class="p">,</span> <span class="n">Lus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll</span><span class="o">.</span><span class="n">D</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">LLOS</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ll</span><span class="o">.</span><span class="n">u</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">LLOS</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">LIdLOS</span><span class="o">=</span><span class="n">LIdLOS</span><span class="p">,</span> <span class="n">LDs</span><span class="o">=</span><span class="n">LDs</span><span class="p">,</span> <span class="n">Lus</span><span class="o">=</span><span class="n">Lus</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Lens&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">O</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">O</span><span class="p">,</span> <span class="n">nIn</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">nIn</span><span class="p">,</span> <span class="n">Rad</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Rad</span><span class="p">],</span> <span class="n">F1</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">F1</span><span class="p">],</span> <span class="n">F2</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">F2</span><span class="p">],</span> <span class="n">R1</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">R1</span><span class="p">],</span> <span class="n">R2</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">R2</span><span class="p">],</span> <span class="n">dd</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">dd</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Apert&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Detect&#39;</span><span class="p">:</span>
        <span class="n">LOSprops</span><span class="p">,</span> <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Optics</span> <span class="o">=</span> <span class="n">_convert_Detect2Ldict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">Rad</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Rad</span><span class="p">,</span> <span class="n">BaryS</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">BaryS</span><span class="p">,</span> <span class="n">nIn</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">nIn</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span> <span class="n">LOSNP</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">_LOS_NP</span><span class="p">],</span>
                <span class="n">LOSprops</span><span class="o">=</span><span class="p">[</span><span class="n">LOSprops</span><span class="p">],</span> <span class="n">Sino</span><span class="o">=</span><span class="p">[</span><span class="n">Sino</span><span class="p">],</span> <span class="n">Span</span><span class="o">=</span><span class="p">[</span><span class="n">Span</span><span class="p">],</span> <span class="n">Cone</span><span class="o">=</span><span class="p">[</span><span class="n">Cone</span><span class="p">],</span> <span class="n">SAng</span><span class="o">=</span><span class="p">[</span><span class="n">SAng</span><span class="p">],</span> <span class="n">SynthDiag</span><span class="o">=</span><span class="p">[</span><span class="n">SynthDiag</span><span class="p">],</span> <span class="n">Res</span><span class="o">=</span><span class="p">[</span><span class="n">Res</span><span class="p">],</span> <span class="n">Optics</span><span class="o">=</span><span class="p">[</span><span class="n">Optics</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;GDetect&#39;</span><span class="p">:</span>
        <span class="n">LDetsave</span><span class="p">,</span> <span class="n">LDetSynthRes</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">nDetect</span><span class="p">):</span>
            <span class="n">ddIdsave</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">todict</span><span class="p">()</span>
            <span class="n">LOSprops</span><span class="p">,</span> <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Optics</span> <span class="o">=</span> <span class="n">_convert_Detect2Ldict</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Idsave</span><span class="o">=</span><span class="n">ddIdsave</span><span class="p">,</span> <span class="n">Poly</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Poly</span><span class="p">,</span> <span class="n">Rad</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">Rad</span><span class="p">,</span> <span class="n">BaryS</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">BaryS</span><span class="p">,</span> <span class="n">nIn</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">nIn</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span>
                      <span class="n">LOSNP</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">LDetect</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">_LOS_NP</span><span class="p">],</span> <span class="n">LOSprops</span><span class="o">=</span><span class="p">[</span><span class="n">LOSprops</span><span class="p">],</span> <span class="n">Sino</span><span class="o">=</span><span class="p">[</span><span class="n">Sino</span><span class="p">],</span> <span class="n">Span</span><span class="o">=</span><span class="p">[</span><span class="n">Span</span><span class="p">],</span> <span class="n">Cone</span><span class="o">=</span><span class="p">[</span><span class="n">Cone</span><span class="p">],</span> <span class="n">SAng</span><span class="o">=</span><span class="p">[</span><span class="n">SAng</span><span class="p">],</span> <span class="n">Optics</span><span class="o">=</span><span class="p">[</span><span class="n">Optics</span><span class="p">])</span>
            <span class="n">LDetsave</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
            <span class="n">LDetSynthRes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;SynthDiag&#39;</span><span class="p">:[</span><span class="n">SynthDiag</span><span class="p">],</span><span class="s">&#39;Res&#39;</span><span class="p">:[</span><span class="n">Res</span><span class="p">]})</span>
        <span class="n">Res</span><span class="p">,</span> <span class="n">lAttr</span> <span class="o">=</span> <span class="p">{},</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">lAttr</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span> <span class="ow">and</span> <span class="s">&#39;_Res&#39;</span> <span class="ow">in</span> <span class="n">pp</span><span class="p">:</span>
                <span class="n">Res</span><span class="p">[</span><span class="n">pp</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_arrayorder</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Clock</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">,</span> <span class="n">LOSRef</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_LOSRef</span><span class="p">,</span> <span class="n">Res</span><span class="o">=</span><span class="p">[</span><span class="n">Res</span><span class="p">],</span> <span class="n">LDetsave</span><span class="o">=</span><span class="n">LDetsave</span><span class="p">,</span> <span class="n">LDetSynthRes</span><span class="o">=</span><span class="n">LDetSynthRes</span><span class="p">)</span>

    <span class="c"># tofu.Eq</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Eq2D&#39;</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="o">**</span><span class="n">obj</span><span class="o">.</span><span class="n">_Tab</span><span class="p">)</span>

    <span class="c"># tofu.mesh</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Mesh1D&#39;</span><span class="p">:</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">Knots</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Knots</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Mesh2D&#39;</span><span class="p">:</span>
        <span class="n">SubMinds</span> <span class="o">=</span> <span class="p">[{</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="n">kk</span><span class="p">,</span> <span class="s">&#39;ind&#39;</span><span class="p">:</span><span class="n">obj</span><span class="o">.</span><span class="n">_SubMesh</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="s">&#39;ind&#39;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_SubMesh</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">Knots</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">MeshX1</span><span class="o">.</span><span class="n">Knots</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">MeshX2</span><span class="o">.</span><span class="n">Knots</span><span class="p">],</span> <span class="n">SubMinds</span><span class="o">=</span><span class="n">SubMinds</span><span class="p">,</span> <span class="n">IndBg</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_get_CentBckg</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;BF2D&#39;</span><span class="p">:</span>
        <span class="n">Id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;BF2D&#39;</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_shot</span><span class="p">),</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">IdMesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;Mesh2D&#39;</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeMesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtime</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtime</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">USR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">USRdict</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">Id</span><span class="p">,</span> <span class="n">IdMesh</span><span class="o">=</span><span class="n">IdMesh</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtime</span><span class="p">,</span> <span class="n">IdUSR</span><span class="o">=</span><span class="n">USR</span><span class="p">,</span> <span class="n">dtimeMesh</span><span class="o">=</span><span class="n">dtimeMesh</span><span class="p">,</span> <span class="n">KnotsR</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">MeshR</span><span class="o">.</span><span class="n">Knots</span><span class="p">,</span> <span class="n">KnotsZ</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">MeshZ</span><span class="o">.</span><span class="n">Knots</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">Deg</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">Ind</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Mesh</span><span class="o">.</span><span class="n">_get_CentBckg</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c"># tofu.matcomp</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;GMat2D&#39;</span><span class="p">:</span>
        <span class="n">Id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;GMat2D&#39;</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_shot</span><span class="p">),</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtime</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">USR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">USRdict</span><span class="p">)</span>
        <span class="n">IdObj</span><span class="p">,</span> <span class="n">IdObjUSR</span> <span class="o">=</span> <span class="n">save_np_IdObj</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span>
        <span class="n">CompParamVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_epsrel</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Mat_SubP</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Mat_SubTheta</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_indMat_SubP</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_epsrel</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_SubP</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_Fast</span><span class="p">)])</span>
        <span class="n">CompParamStr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_Mode</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Mat_SubMode</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Mat_SubThetaMode</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_Mode</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_SubMode</span><span class="p">])</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">Id</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtime</span><span class="p">,</span> <span class="n">IdUSR</span><span class="o">=</span><span class="n">USR</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">VesUSR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">LDetect</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">BF2</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">BF2USR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetectUSR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">CompParamVal</span><span class="o">=</span><span class="n">CompParamVal</span><span class="p">,</span>
                <span class="n">CompParamStr</span><span class="o">=</span><span class="n">CompParamStr</span><span class="p">,</span> <span class="n">indMat</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_indMat</span><span class="p">,</span> <span class="n">Matdata</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_csr</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Matind</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_csr</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">Matindpr</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_csr</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">Matshape</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mat_csr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="n">MatLOSdata</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_csr</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">MatLOSind</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_csr</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">MatLOSindpr</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_csr</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">MatLOSshape</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_MatLOS_csr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="n">BF2Par</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">_BF2_Deg</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">_BF2_NFunc</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">_BF2_NCents</span><span class="p">]),</span> <span class="n">LD_nD</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_LD_nDetect</span><span class="p">)</span>

    <span class="c"># tofu.treat</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;PreData&#39;</span><span class="p">:</span>
        <span class="n">Init</span><span class="p">,</span> <span class="n">Update</span> <span class="o">=</span> <span class="n">_convert_PreData2Ldict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Idsave</span><span class="o">=</span><span class="n">Idsave</span><span class="p">,</span> <span class="n">Init</span><span class="o">=</span><span class="p">[</span><span class="n">Init</span><span class="p">],</span> <span class="n">Update</span><span class="o">=</span><span class="p">[</span><span class="n">Update</span><span class="p">])</span>

        <span class="c">#Id = np.array([&#39;PreData&#39;,obj.Id.Name,obj.Id.SaveName,obj.Id.SavePath,obj.Id._dtFormat,obj.Id._Diag,str(obj.Id._shot), [obj.Id.Type], obj.Id.Exp],dtype=str)</span>
        <span class="c">#dtime = np.array([obj.Id._dtime],dtype=object)</span>
        <span class="c">#USR = np.asarray(obj.Id.USRdict)</span>
        <span class="c">#IdObj, IdObjUSR = save_np_IdObj(obj.Id)</span>
        <span class="c">#StrPar = np.asarray([obj._Exp, obj._interpkind])</span>
        <span class="c">#func(pathfileext, Id=Id, dtime=dtime, IdUSR=USR, LDetect=IdObj[0], LDetectUSR=IdObjUSR[0],</span>
        <span class="c">#        DLPar=obj._DLPar, shot=obj._shot, StrPar=StrPar, Dt=obj._Dt, DtMarg=obj._DtMargin, MovMeanfreq=obj._MovMeanfreq, Resamp=obj._Resamp,</span>
        <span class="c">#        indOut=obj._indOut, indCorr=obj._indCorr, PhysNoise=obj._PhysNoise, NoiseMod=obj._NoiseModel, interp_lt=obj._interp_lt, interp_lN=obj._interp_lNames)</span>

    <span class="c"># tofu.inv</span>
    <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Sol2D&#39;</span><span class="p">:</span>
        <span class="n">Id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;Sol2D&#39;</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtFormat</span><span class="p">,</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_Diag</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_shot</span><span class="p">),</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">],</span> <span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">dtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtime</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">USR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">USRdict</span><span class="p">)</span>
        <span class="n">IdObj</span><span class="p">,</span> <span class="n">IdObjUSR</span> <span class="o">=</span> <span class="n">save_np_IdObj</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Id</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">timing</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_timing</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">timing</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_t2</span>
        <span class="n">func</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Id</span><span class="o">=</span><span class="n">Id</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtime</span><span class="p">,</span> <span class="n">IdUSR</span><span class="o">=</span><span class="n">USR</span><span class="p">,</span> <span class="n">PreData</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">PreDataUSR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">GMat2D</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">GMatUSR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">BF2D</span><span class="o">=</span><span class="n">IdObj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">BF2DUSR</span><span class="o">=</span><span class="n">IdObjUSR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">InvParam</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">InvParam</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">LNames</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_LNames</span><span class="p">,</span> <span class="n">Run</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_run</span><span class="p">,</span>
                <span class="n">LOS</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_LOS</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">Coefs</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Coefs</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_sigma</span><span class="p">,</span> <span class="n">Mu</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Mu</span><span class="p">,</span> <span class="n">Chi2N</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Chi2N</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_R</span><span class="p">,</span> <span class="n">Nit</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Nit</span><span class="p">,</span> <span class="n">Spec</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_Spec</span><span class="p">,</span> <span class="n">t2</span><span class="o">=</span><span class="n">timing</span><span class="p">,</span> <span class="n">PostTreat</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">_PostTreat</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">save_np_IdObj</span><span class="p">(</span><span class="n">Id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; (to do) &quot;&quot;&quot;</span>
    <span class="n">LObj</span><span class="p">,</span> <span class="n">LObjUSR</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">Keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Keys</span><span class="p">)):</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">Larr</span><span class="p">,</span> <span class="n">LarrUSR</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;USRdict&#39;</span><span class="p">:</span>
                <span class="n">LarrUSR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Larr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="n">Keys</span><span class="p">[</span><span class="n">ii</span><span class="p">]][</span><span class="n">kk</span><span class="p">[</span><span class="n">jj</span><span class="p">]]],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">))</span>
        <span class="n">LObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">Larr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">LObjUSR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">LarrUSR</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">LObj</span><span class="p">,</span> <span class="n">LObjUSR</span>



<span class="c">###########################</span>
<span class="c">#   Opening</span>
<span class="c">###########################</span>


<div class="viewcode-block" id="Open"><a class="viewcode-back" href="../../Auto_tofu.pathfile.html#tofu.pathfile.Open">[docs]</a><span class="k">def</span> <span class="nf">Open</span><span class="p">(</span><span class="n">pathfileext</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Deriv</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">ReplacePath</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Open a ToFu object saved file</span>

<span class="sd">    This generic open function identifies the required loading routine by detecting how the object was saved from the file name extension.</span>
<span class="sd">    Also, it uses :meth:`~tofu.pathfile.FindSolFile()` to identify the relevant file in case key criteria such as shot, Deg... are provided instead of the file name itself.</span>
<span class="sd">    Finally, once all the relevant data is loaded from the file, a ToFu object is re-created, if necessary by implicitly loading all other objects it may depend on (i.e.: vessel, apertures...)</span>

<span class="sd">    If pathfileext is not provided (None), then the following keyword arguments are fed to :meth:`~tofu.pathfile.FindSolFile()`: shot, t, Dt, Mesh, Deg, Deriv, Sep, Pos</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pathfileext :   None / str</span>
<span class="sd">        If provided, the name of the file to load</span>
<span class="sd">    OutPath :       None / str</span>
<span class="sd">        If provided, the absolute path where the file is to be found</span>
<span class="sd">    ReplacePath :   str</span>
<span class="sd">        If provided, ? (to finish)</span>
<span class="sd">    Ves :           None /</span>
<span class="sd">        If provided, the :class:`tofu.geom.Ves` object that shall be used to reconstruct the object (if not provided, the appropriate vessel will be loaded).</span>
<span class="sd">    out :           str</span>
<span class="sd">        Flag indicating whether the object should be loaded completely (&#39;full&#39;), in a light dismissing the heaviest attributes (&#39;light&#39;) or whether only the Id or a list of Id should be returned (&#39;Id&#39;), valid only for &#39;.npz&#39;</span>
<span class="sd">    Verb :          bool</span>
<span class="sd">        Flag indicating whether to pring intermediate comments on the loading procedure</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    obj             ToFu object</span>
<span class="sd">        The loaded and re-created ToFu object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="k">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pathfileext</span><span class="p">,</span><span class="n">shot</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pathfileext</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">shot</span> <span class="ow">is</span> <span class="k">None</span><span class="p">),</span> <span class="s">&quot;Arg pathfileext or shot must be None, but not both !&quot;</span>
    <span class="k">if</span> <span class="n">pathfileext</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="n">File</span> <span class="o">=</span> <span class="n">FindSolFile</span><span class="p">(</span><span class="n">shot</span><span class="o">=</span><span class="n">shot</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">Dt</span><span class="o">=</span><span class="n">Dt</span><span class="p">,</span> <span class="n">Mesh</span><span class="o">=</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Deg</span><span class="o">=</span><span class="n">Deg</span><span class="p">,</span> <span class="n">Deriv</span><span class="o">=</span><span class="n">Deriv</span><span class="p">,</span> <span class="n">Sep</span><span class="o">=</span><span class="n">Sep</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="n">Pos</span><span class="p">,</span> <span class="n">OutPath</span><span class="o">=</span><span class="n">OutPath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">File</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">File</span>
        <span class="n">pathfileext</span> <span class="o">=</span> <span class="n">OutPath</span><span class="o">+</span><span class="n">File</span>
    <span class="k">assert</span> <span class="s">&#39;.npz&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span> <span class="ow">or</span> <span class="s">&#39;.pck&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">,</span> <span class="s">&quot;Arg pathfileext must contain &#39;.npz&#39; or .pck !&quot;</span>

    <span class="k">if</span> <span class="s">&#39;.npz&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_open_np</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">ReplacePath</span><span class="o">=</span><span class="n">ReplacePath</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_open_object</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&quot;Loaded :  &quot;</span><span class="o">+</span><span class="n">pathfileext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>



<span class="k">def</span> <span class="nf">_open_object</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">Open</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">input</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">pck</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;TFM&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_BasisFunc</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Deg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>


<span class="k">def</span> <span class="nf">open_np_IdObj</span><span class="p">(</span><span class="n">LCls</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">LIdArr</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="n">LIdUSR</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="n">LIdObj</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">LIdArr</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">LCls</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">,</span> <span class="s">&quot;Args LCls and LIdArr must be lists !&quot;</span>
        <span class="n">NObj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NObj</span><span class="p">):</span>
            <span class="n">no</span> <span class="o">=</span> <span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">no</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">LIdUSR</span> <span class="ow">is</span> <span class="k">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">LIdUSR</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                    <span class="n">LIdObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">LCls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="n">SaveName</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">Exp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">5</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])),</span> <span class="n">dtFormat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">USRdict</span><span class="o">=</span><span class="n">LIdUSR</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">jj</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">LIdObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">LCls</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="n">SaveName</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">3</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">Exp</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span> <span class="n">dtime</span><span class="o">=</span><span class="n">dtm</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">5</span><span class="p">,</span><span class="n">jj</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])),</span> <span class="n">dtFormat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">LIdArr</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="mi">4</span><span class="p">,</span><span class="n">jj</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">LIdObj</span>


<span class="k">def</span> <span class="nf">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Ves</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ves</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span> <span class="ow">and</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">Ves</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span> <span class="ow">and</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">Ves</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">SaveName</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ves</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.npz&#39;</span>
            <span class="n">Ves</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s">&quot; : associated Ves object could not be loaded from &quot;</span><span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ves</span>

<span class="k">def</span> <span class="nf">_tryLoadOpticsElseCreate</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">TFG</span>
    <span class="k">if</span> <span class="s">&#39;Apert&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">Optics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Apert&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">])):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Apert&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Apert&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.npz&#39;</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
                <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Opt</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ves</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="s">&quot;Arg Ves must be a TFG.Ves instance !&quot;</span>
                    <span class="k">if</span> <span class="n">Verb</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s">&quot; : no saved Apert =&gt; creating the associated Apert object !&quot;</span><span class="p">)</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">jj</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Opt</span><span class="p">))</span> <span class="k">if</span> <span class="n">Opt</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s">&#39;Id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Apert&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Opt</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="s">&#39;Id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Apert&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Several possible solutions !&quot;</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">iid</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s">&#39;Id&#39;</span><span class="p">])</span>
                    <span class="n">aa</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Apert</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span> <span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s">&#39;arrayorder&#39;</span><span class="p">],</span> <span class="n">Clock</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="s">&#39;Clock&#39;</span><span class="p">])</span>
                    <span class="n">Optics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s">&quot; : associated Apert object could not be loaded from &quot;</span><span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s">&#39;Lens&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PathFileExt</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Lens&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;Lens&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.npz&#39;</span>
            <span class="n">Optics</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">PathFileExt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Opt</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ves</span><span class="p">)</span> <span class="ow">is</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="s">&quot;Arg Ves must be a TFG.Ves instance !&quot;</span>
                <span class="k">if</span> <span class="n">Verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s">&quot; : no saved Lens =&gt; creating the associated Lens object !&quot;</span><span class="p">)</span>
                <span class="n">iid</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Id&#39;</span><span class="p">])</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Lens</span><span class="p">(</span><span class="n">iid</span><span class="p">,</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;O&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;nIn&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Rad&#39;</span><span class="p">],</span> <span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;F1&#39;</span><span class="p">],</span> <span class="n">F2</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;F2&#39;</span><span class="p">],</span> <span class="n">R1</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;R1&#39;</span><span class="p">],</span> <span class="n">R2</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;R2&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;dd&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Type&#39;</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span>
                              <span class="n">arrayorder</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;arrayorder&#39;</span><span class="p">],</span> <span class="n">Clock</span><span class="o">=</span><span class="n">Opt</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Clock&#39;</span><span class="p">])</span>
                <span class="n">Optics</span> <span class="o">=</span> <span class="n">aa</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">Name</span> <span class="o">+</span><span class="s">&quot; : associated Lens object could not be loaded from &quot;</span><span class="o">+</span><span class="n">PathFileExt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Optics</span>



<span class="k">def</span> <span class="nf">_resetDetectAttr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Out</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">TFG</span>
    <span class="c"># Re-creating LOS</span>
    <span class="n">LOS</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">kkeys</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s">&#39;Keys&#39;</span><span class="p">])):</span>
        <span class="n">idlos</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s">&#39;Id&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">los</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">LOS</span><span class="p">(</span><span class="n">idlos</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s">&#39;Du&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">Sino_RefPt</span><span class="p">)</span>
        <span class="n">LOS</span><span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s">&#39;Keys&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;LOS&#39;</span><span class="p">:</span><span class="n">los</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">kkeys</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Keys&#39;</span><span class="p">,</span><span class="s">&#39;Id&#39;</span><span class="p">,</span><span class="s">&#39;Du&#39;</span><span class="p">]:</span>
                <span class="n">LOS</span><span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="s">&#39;Keys&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">]][</span><span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="n">kkeys</span><span class="p">[</span><span class="n">jj</span><span class="p">]][</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">_LOS</span> <span class="o">=</span> <span class="n">LOS</span>

    <span class="c"># Re-assigning tabulated data</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Sino&#39;</span><span class="p">,</span> <span class="s">&#39;Span&#39;</span><span class="p">,</span> <span class="s">&#39;Cone&#39;</span><span class="p">,</span> <span class="s">&#39;SAng&#39;</span><span class="p">,</span> <span class="s">&#39;SynthDiag&#39;</span><span class="p">,</span> <span class="s">&#39;Res&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="n">ff</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">Out</span><span class="p">[</span><span class="n">ff</span><span class="p">][</span><span class="n">kk</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>




<span class="k">def</span> <span class="nf">_get_light_SynthDiag_Res</span><span class="p">():</span>
    <span class="n">SynthDiag</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;_SynthDiag_Done&#39;</span><span class="p">:</span><span class="k">False</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_ds&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_dsMode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_MarginS&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_dX12&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_dX12Mode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_Colis&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span>
                 <span class="s">&#39;_SynthDiag_Points&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_SAng&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_Vect&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_SynthDiag_dV&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">}</span>
    <span class="n">Res</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;_Res_Mode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_Amp&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_Deg&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span>
           <span class="s">&#39;_Res_Pts&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_Res&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_CrossMesh&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_CrossMeshMode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span>
           <span class="s">&#39;_Res_steps&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_Thres&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_ThresMode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_ThresMin&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span>
           <span class="s">&#39;_Res_IntResCross&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_IntResCrossMode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_IntResLong&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_IntResLongMode&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span> <span class="s">&#39;_Res_IntNtt&#39;</span><span class="p">:</span><span class="k">None</span><span class="p">,</span>
           <span class="s">&#39;_Res_EqName&#39;</span><span class="p">:</span> <span class="k">None</span><span class="p">,</span>
           <span class="s">&#39;_Res_Done&#39;</span><span class="p">:</span> <span class="k">False</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span>




<span class="k">def</span> <span class="nf">_open_np</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">ReplacePath</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="s">&#39;TFG&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.geom</span> <span class="k">as</span> <span class="nn">TFG</span>
    <span class="k">elif</span> <span class="s">&#39;TFEq&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.Eq</span> <span class="k">as</span> <span class="nn">tfEq</span>
    <span class="k">elif</span> <span class="s">&#39;TFM&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.mesh</span> <span class="k">as</span> <span class="nn">TFM</span>
    <span class="k">elif</span> <span class="s">&#39;TFMC&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.matcomp</span> <span class="k">as</span> <span class="nn">TFMC</span>
    <span class="k">elif</span> <span class="s">&#39;TFT&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.treat</span> <span class="k">as</span> <span class="nn">tft</span>
    <span class="k">elif</span> <span class="s">&#39;TFI&#39;</span> <span class="ow">in</span> <span class="n">pathfileext</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">tofu.inv</span> <span class="k">as</span> <span class="nn">TFI</span>

    <span class="n">Out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pathfileext</span><span class="p">,</span><span class="n">mmap_mode</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
    <span class="n">Id</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Idsave&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s">&#39;Id&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Id</span>

    <span class="k">if</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;Ves&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Ves</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">DLong</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;DLong&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">Sino_NP</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_NP&#39;</span><span class="p">]),</span>
                      <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;Struct&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">DLong</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;DLong&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span>
                         <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;LOS&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">LOS</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Du&#39;</span><span class="p">]),</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span>
                      <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;GLOS&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="n">LLOS</span><span class="p">,</span> <span class="n">IdLOS</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;LOS&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">IdLOS</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">])):</span>
            <span class="n">Idl</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LIdLOS&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">LOS</span><span class="p">(</span><span class="n">Idl</span><span class="p">,</span> <span class="n">Du</span><span class="o">=</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LDs&#39;</span><span class="p">][:,</span><span class="n">ii</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Lus&#39;</span><span class="p">][:,</span><span class="n">ii</span><span class="p">]),</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]))</span>
            <span class="n">LLOS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">GLOS</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">LLOS</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span>
                       <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;Lens&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Lens</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;O&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;nIn&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Rad&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;F1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">F2</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;F2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">R1</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;R1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">R2</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;R2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dd</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;dd&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span>
                <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;Apert&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Apert</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Poly&#39;</span><span class="p">],</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;Detect&#39;</span><span class="p">:</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="n">LOSprops</span><span class="p">,</span> <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">Opt</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Span&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Cone&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;SAng&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Optics&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">(</span><span class="n">SynthDiag</span><span class="p">,</span><span class="n">Res</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;SynthDiag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s">&#39;full&#39;</span> <span class="k">else</span> <span class="n">_get_light_SynthDiag_Res</span><span class="p">()</span>
        <span class="n">Optics</span> <span class="o">=</span> <span class="n">_tryLoadOpticsElseCreate</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="n">Opt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">)</span>

        <span class="n">Poly</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Poly&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Optics</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Rad</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Rad&#39;</span><span class="p">]),</span><span class="n">O</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BaryS&#39;</span><span class="p">],</span><span class="n">nIn</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;nIn&#39;</span><span class="p">])</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Detect</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">Optics</span><span class="o">=</span><span class="n">Optics</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Sino</span><span class="p">[</span><span class="s">&#39;_Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">CalcEtend</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcSpanImp</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcCone</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcPreComp</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">Calc</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">,</span>
                         <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_resetDetectAttr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;LOSprops&#39;</span><span class="p">:</span><span class="n">LOSprops</span><span class="p">,</span> <span class="s">&#39;Sino&#39;</span><span class="p">:</span><span class="n">Sino</span><span class="p">,</span> <span class="s">&#39;Span&#39;</span><span class="p">:</span><span class="n">Span</span><span class="p">,</span> <span class="s">&#39;Cone&#39;</span><span class="p">:</span><span class="n">Cone</span><span class="p">,</span> <span class="s">&#39;SAng&#39;</span><span class="p">:</span><span class="n">SAng</span><span class="p">,</span> <span class="s">&#39;SynthDiag&#39;</span><span class="p">:</span><span class="n">SynthDiag</span><span class="p">,</span> <span class="s">&#39;Res&#39;</span><span class="p">:</span><span class="n">Res</span><span class="p">,</span> <span class="s">&#39;Optics&#39;</span><span class="p">:</span><span class="n">Opt</span><span class="p">})</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_LOS_NP</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSNP&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">_SynthDiag_Done</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">_SynthDiag_Points</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_SigPrecomp</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="o">==</span> <span class="s">&#39;GDetect&#39;</span><span class="p">:</span>
        <span class="n">LDetsave</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LDetsave&#39;</span><span class="p">])</span>
        <span class="n">LDet</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Ves</span> <span class="o">=</span> <span class="n">_tryloadVes</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s">&#39;light&#39;</span><span class="p">:</span>
            <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span> <span class="o">=</span> <span class="n">_get_light_SynthDiag_Res</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LDetSynthRes</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LDetSynthRes&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">LDetsave</span><span class="p">)):</span>
            <span class="n">ddIdsave</span> <span class="o">=</span> <span class="n">_Id_recreateFromdict</span><span class="p">(</span><span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Idsave&#39;</span><span class="p">])</span>
            <span class="n">LOSprops</span><span class="p">,</span> <span class="n">Sino</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Cone</span><span class="p">,</span> <span class="n">SAng</span><span class="p">,</span> <span class="n">Opt</span> <span class="o">=</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;LOSprops&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Sino&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Span&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Cone&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;SAng&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Optics&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">SynthDiag</span><span class="p">,</span> <span class="n">Res</span> <span class="o">=</span> <span class="n">LDetSynthRes</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;SynthDiag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LDetSynthRes</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Optics</span> <span class="o">=</span> <span class="n">_tryLoadOpticsElseCreate</span><span class="p">(</span><span class="n">ddIdsave</span><span class="p">,</span> <span class="n">Opt</span><span class="o">=</span><span class="n">Opt</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">)</span>
            <span class="n">Poly</span> <span class="o">=</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Poly&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Optics</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Rad</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Rad&#39;</span><span class="p">]),</span><span class="n">O</span><span class="o">=</span><span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;BaryS&#39;</span><span class="p">],</span><span class="n">nIn</span><span class="o">=</span><span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;nIn&#39;</span><span class="p">])</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">Detect</span><span class="p">(</span><span class="n">ddIdsave</span><span class="p">,</span> <span class="n">Poly</span><span class="p">,</span> <span class="n">Optics</span><span class="o">=</span><span class="n">Optics</span><span class="p">,</span> <span class="n">Ves</span><span class="o">=</span><span class="n">Ves</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">CalcEtend</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcSpanImp</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcCone</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcPreComp</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">Calc</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="n">Verb</span><span class="p">,</span>
                            <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]))</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="n">_resetDetectAttr</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;LOSprops&#39;</span><span class="p">:</span><span class="n">LOSprops</span><span class="p">,</span> <span class="s">&#39;Sino&#39;</span><span class="p">:</span><span class="n">Sino</span><span class="p">,</span> <span class="s">&#39;Span&#39;</span><span class="p">:</span><span class="n">Span</span><span class="p">,</span> <span class="s">&#39;Cone&#39;</span><span class="p">:</span><span class="n">Cone</span><span class="p">,</span> <span class="s">&#39;SAng&#39;</span><span class="p">:</span><span class="n">SAng</span><span class="p">,</span> <span class="s">&#39;SynthDiag&#39;</span><span class="p">:</span><span class="n">SynthDiag</span><span class="p">,</span> <span class="s">&#39;Res&#39;</span><span class="p">:</span><span class="n">Res</span><span class="p">,</span> <span class="s">&#39;Optics&#39;</span><span class="p">:</span><span class="n">Opt</span><span class="p">})</span>
            <span class="n">dd</span><span class="o">.</span><span class="n">_LOS_NP</span> <span class="o">=</span> <span class="n">LDetsave</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;LOSNP&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">_SynthDiag_Done</span> <span class="ow">and</span> <span class="n">dd</span><span class="o">.</span><span class="n">_SynthDiag_Points</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">dd</span><span class="o">.</span><span class="n">set_SigPrecomp</span><span class="p">()</span>
            <span class="n">LDet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFG</span><span class="o">.</span><span class="n">GDetect</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">LDet</span><span class="p">,</span> <span class="n">Type</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">Exp</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Exp</span><span class="p">,</span> <span class="n">Diag</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">Diag</span><span class="p">,</span> <span class="n">shot</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">shot</span><span class="p">,</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">dtime</span><span class="p">,</span> <span class="n">dtimeIn</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">_dtimeIn</span><span class="p">,</span> <span class="n">Sino_RefPt</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sino_RefPt&#39;</span><span class="p">],</span> <span class="n">LOSRef</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOSRef&#39;</span><span class="p">]),</span>
                          <span class="n">arrayorder</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;arrayorder&#39;</span><span class="p">]),</span> <span class="n">Clock</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Clock&#39;</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="n">Id</span><span class="o">.</span><span class="n">SavePath</span><span class="p">)</span>
        <span class="n">Res</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Res&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">out</span><span class="o">==</span><span class="s">&#39;full&#39;</span> <span class="k">else</span> <span class="n">Res</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">Res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">Res</span><span class="p">[</span><span class="n">kk</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Eq2D&#39;</span><span class="p">:</span>
        <span class="n">Sep</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Sep&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">tfEq</span><span class="o">.</span><span class="n">Eq2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;PtsCross&#39;</span><span class="p">],</span> <span class="n">t</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">MagAx</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;MagAx&#39;</span><span class="p">],</span> <span class="n">Sep</span><span class="o">=</span><span class="n">Sep</span><span class="p">,</span> <span class="n">rho_p</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;rho_p&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">rho_t</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;rho_t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">surf</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;surf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">vol</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;vol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">q</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">jp</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;jp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">pf</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;pf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">tf</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;tf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">theta</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;theta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">thetastar</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;thetastar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                        <span class="n">BTX</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BTX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">BRY</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BRY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">BZ</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">Ref</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Ref&#39;</span><span class="p">]))</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Mesh1D&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Mesh1D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Knots&#39;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Mesh2D&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Mesh2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Knots&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Knots&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Mesh2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">Knots</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">ind</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IndBg&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;SubMinds&#39;</span><span class="p">])):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">add_SubMesh</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;SubMinds&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;SubMinds&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">][</span><span class="s">&#39;ind&#39;</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Metric1D&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Metric1D</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Metric2D&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Metric2D</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span> <span class="ow">in</span> <span class="s">&#39;BF2D&#39;</span><span class="p">:</span>
        <span class="n">IdMesh</span> <span class="o">=</span> <span class="n">ID</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IdMesh&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IdMesh&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">SaveName</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IdMesh&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">SavePath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IdMesh&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span> <span class="n">dtime</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;dtimeMesh&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtFormat</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;IdMesh&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Mesh2D</span><span class="p">(</span><span class="n">IdMesh</span><span class="p">,</span> <span class="n">Knots</span><span class="o">=</span><span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;KnotsR&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;KnotsZ&#39;</span><span class="p">]])</span>
        <span class="n">M2bis</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">Mesh2D</span><span class="p">(</span><span class="n">IdMesh</span><span class="p">,</span><span class="n">Knots</span><span class="o">=</span><span class="n">M2</span><span class="p">,</span><span class="n">Ind</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Ind&#39;</span><span class="p">])</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFM</span><span class="o">.</span><span class="n">BF2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">M2bis</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Deg&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;GMat2D&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ToFu_MatComp</span> <span class="k">as</span> <span class="nn">TFMC</span>
        <span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">scpsp</span>
        <span class="n">Id</span><span class="o">.</span><span class="n">set_LObj</span><span class="p">(</span><span class="n">open_np_IdObj</span><span class="p">([</span><span class="s">&#39;Ves&#39;</span><span class="p">,</span><span class="s">&#39;BF2D&#39;</span><span class="p">,</span><span class="s">&#39;Detect&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Ves&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LDetect&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;VesUSR&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2USR&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LDetectUSR&#39;</span><span class="p">]]))</span>
        <span class="n">Mat</span> <span class="o">=</span> <span class="n">scpsp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Matdata&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Matind&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Matindpr&#39;</span><span class="p">]),</span> <span class="n">shape</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Matshape&#39;</span><span class="p">])</span>
        <span class="n">MatLOS</span> <span class="o">=</span> <span class="n">scpsp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;MatLOSdata&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;MatLOSind&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;MatLOSindpr&#39;</span><span class="p">]),</span> <span class="n">shape</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;MatLOSshape&#39;</span><span class="p">])</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFMC</span><span class="o">.</span><span class="n">GMat2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="k">None</span><span class="p">,</span> <span class="k">None</span><span class="p">,</span> <span class="n">Mat</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">indMat</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">MatLOS</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">Calcind</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">CalcLOS</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_init_CompParam</span><span class="p">(</span><span class="n">Mode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamStr&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">epsrel</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">SubP</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">SubMode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamStr&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">SubTheta</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">SubThetaMode</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamStr&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">Fast</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">SubPind</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">ModeLOS</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamStr&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]),</span> <span class="n">epsrelLOS</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">SubPLOS</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamVal&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">SubModeLOS</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;CompParamStr&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_BF2</span> <span class="o">=</span> <span class="k">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_BF2_Deg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2Par&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_BF2_NCents</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2Par&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_BF2_NFunc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2Par&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_Ves</span> <span class="o">=</span> <span class="k">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_LD</span> <span class="o">=</span> <span class="k">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_LD_nDetect</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LD_nD&#39;</span><span class="p">])</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_indMat</span><span class="p">(</span><span class="n">indMat</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;indMat&#39;</span><span class="p">],</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_MatLOS</span><span class="p">(</span><span class="n">MatLOS</span><span class="o">=</span><span class="n">MatLOS</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_Mat</span><span class="p">(</span><span class="n">Mat</span><span class="o">=</span><span class="n">Mat</span><span class="p">,</span> <span class="n">Verb</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>



    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;PreData&#39;</span><span class="p">:</span>
        <span class="n">LIdDet</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">get_LObjasLId</span><span class="p">(</span><span class="s">&#39;Detect&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;Detect&#39;</span> <span class="ow">in</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="k">None</span>
        <span class="n">Init</span><span class="p">,</span> <span class="n">Update</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Init&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Update&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">tft</span><span class="o">.</span><span class="n">PreData</span><span class="p">(</span><span class="n">Init</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">],</span> <span class="n">Id</span><span class="o">=</span><span class="n">Id</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">Init</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">Chans</span><span class="o">=</span><span class="n">Init</span><span class="p">[</span><span class="s">&#39;Chans&#39;</span><span class="p">],</span> <span class="n">DtRef</span><span class="o">=</span><span class="n">Init</span><span class="p">[</span><span class="s">&#39;DtRef&#39;</span><span class="p">],</span> <span class="n">LIdDet</span><span class="o">=</span><span class="n">LIdDet</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_Dt</span><span class="p">(</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Dt&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_Resamp</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Resamp_t&#39;</span><span class="p">],</span> <span class="n">f</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Resamp_f&#39;</span><span class="p">],</span> <span class="n">Method</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Resamp_Method&#39;</span><span class="p">],</span> <span class="n">interpkind</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Resamp_interpkind&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Out_add</span><span class="p">(</span><span class="n">indOut</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;indOut&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">Corr_add</span><span class="p">(</span><span class="n">indCorr</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;indCorr&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lt</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;interp_lt&#39;</span><span class="p">],</span> <span class="n">lNames</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;interp_lNames&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">substract_Dt</span><span class="p">(</span><span class="n">tsub</span><span class="o">=</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;Subtract_tsub&#39;</span><span class="p">],</span> <span class="n">Calc</span><span class="o">=</span><span class="k">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">set_fft</span><span class="p">(</span><span class="n">Calc</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="o">**</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;FFTPar&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Update</span><span class="p">[</span><span class="s">&#39;PhysNoiseParam&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">Method</span> <span class="o">=</span> <span class="s">&#39;svd&#39;</span> <span class="k">if</span> <span class="s">&#39;Modes&#39;</span> <span class="ow">in</span> <span class="n">Update</span><span class="p">[</span><span class="s">&#39;PhysNoiseParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s">&#39;fft&#39;</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">set_PhysNoise</span><span class="p">(</span><span class="o">**</span><span class="n">Update</span><span class="p">[</span><span class="s">&#39;PhysNoiseParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;Method&#39;</span><span class="p">:</span><span class="n">Method</span><span class="p">}))</span>


        <span class="c">#Id.set_LObj(open_np_IdObj([&#39;Detect&#39;],[Out[&#39;LDetect&#39;]], [Out[&#39;LDetectUSR&#39;]]))</span>
        <span class="c">#obj = TFT.PreData(Id=Id, shot=int(Out[&#39;shot&#39;]), DLPar=Out[&#39;DLPar&#39;].item(), Exp=str(Out[&#39;StrPar&#39;][0]), Dt=list(Out[&#39;Dt&#39;]), DtMargin=float(Out[&#39;DtMarg&#39;]), MovMeanfreq=float(Out[&#39;MovMeanfreq&#39;]), Resamp=bool(Out[&#39;Resamp&#39;]),</span>
        <span class="c">#        interpkind=str(Out[&#39;StrPar&#39;][1]), indOut=Out[&#39;indOut&#39;], indCorr=Out[&#39;indCorr&#39;], lt=Out[&#39;interp_lt&#39;], lNames=Out[&#39;interp_lN&#39;].tolist(), Test=True)</span>
        <span class="c">#if not Out[&#39;PhysNoise&#39;].item() is None:</span>
        <span class="c">#    obj.set_PhysNoise(Deg=int(Out[&#39;NoiseMod&#39;].item()[&#39;Deg&#39;]), Nbin=int(Out[&#39;NoiseMod&#39;].item()[&#39;Nbin&#39;]), LimRatio=float(Out[&#39;NoiseMod&#39;].item()[&#39;LimRatio&#39;]), **Out[&#39;PhysNoise&#39;].item()[&#39;Param&#39;])</span>


    <span class="k">elif</span> <span class="n">Id</span><span class="o">.</span><span class="n">Cls</span><span class="o">==</span><span class="s">&#39;Sol2D&#39;</span><span class="p">:</span>
        <span class="n">Id</span><span class="o">.</span><span class="n">set_LObj</span><span class="p">(</span><span class="n">open_np_IdObj</span><span class="p">([</span><span class="s">&#39;PreData&#39;</span><span class="p">,</span><span class="s">&#39;GMat2D&#39;</span><span class="p">,</span><span class="s">&#39;BF2D&#39;</span><span class="p">],[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;PreData&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;GMat2D&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2D&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;PreDataUSR&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;GMatUSR&#39;</span><span class="p">],</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;BF2DUSR&#39;</span><span class="p">]]))</span>
        <span class="n">GMSaveName</span> <span class="o">=</span> <span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;GMat2D&#39;</span><span class="p">][</span><span class="s">&#39;SaveName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">GMat</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;GMat2D&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">GMSaveName</span><span class="o">+</span><span class="s">&#39;.npz&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">GMSaveName</span> <span class="o">=</span> <span class="n">GMSaveName</span><span class="p">[:</span><span class="n">GMSaveName</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;All_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;sh&#39;</span><span class="o">+</span><span class="n">GMSaveName</span><span class="p">[</span><span class="n">GMSaveName</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;All_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">:]</span>
            <span class="n">GMat</span> <span class="o">=</span> <span class="n">Open</span><span class="p">(</span><span class="n">Id</span><span class="o">.</span><span class="n">LObj</span><span class="p">[</span><span class="s">&#39;GMat2D&#39;</span><span class="p">][</span><span class="s">&#39;SavePath&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">GMSaveName</span><span class="o">+</span><span class="s">&#39;.npz&#39;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TFI</span><span class="o">.</span><span class="n">Sol2D</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span> <span class="n">PreData</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">GMat</span><span class="o">=</span><span class="n">GMat</span><span class="p">,</span> <span class="n">InvParam</span><span class="o">=</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;InvParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">SVesePreData</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">SVeseGMat</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">SVeseBF</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_PreData</span> <span class="o">=</span> <span class="k">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_GMat</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GMat</span><span class="o">.</span><span class="n">get_SubGMat2D</span><span class="p">(</span><span class="n">Val</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LNames&#39;</span><span class="p">]),</span> <span class="n">Crit</span><span class="o">=</span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="n">InOut</span><span class="o">=</span><span class="s">&#39;In&#39;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_shot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;shot&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_LNames</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;LNames&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_LNames</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">PreData</span><span class="o">.</span><span class="n">In_list</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_run</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Run&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Run&#39;</span><span class="p">]):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_LOS</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;LOS&#39;</span><span class="p">])</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_Coefs</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_sigma</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Coefs&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;sigma&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_Mu</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Chi2N</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_R</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">_Nit</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Mu&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Chi2N&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">],</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;Nit&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_Spec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;Spec&#39;</span><span class="p">])</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_timing</span> <span class="o">=</span> <span class="n">Out</span><span class="p">[</span><span class="s">&#39;t2&#39;</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_PostTreat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Out</span><span class="p">[</span><span class="s">&#39;PostTreat&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">obj</span>




</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">tofu v1.1</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Didier VEZINET.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>